[{"content":" è¶ç€èŠ‚å‰ï¼Œéœ€è¦æŠ˜(dao)è…¾(shi)ä¸€ä¸‹å»å¹´éƒ¨ç½²çš„artifactoryé•œåƒæºï¼Œå¹¶å°†å‡çº§åˆ°7.xç‰ˆæœ¬ã€‚\n åœºæ™¯ éƒ¨ç½²ç§æœ‰åŒ–è½¯ä»¶æºï¼Œå¯¹å†…æä¾›æœåŠ¡ã€‚è¿™é‡Œåªä½œä¸ºè½¯ä»¶æºæµ‹è¯•ä½¿ç”¨ï¼Œå…¶ä»–åœºæ™¯è‡ªè¡Œç¢ç£¨ã€‚\néƒ¨ç½²æœåŠ¡ éƒ¨ç½²å¾ˆç®€å•ï¼Œè¿™é‡Œä½¿ç”¨docker-composeæ–¹å¼éƒ¨ç½²\n# docker-compose.yaml version: '2.1' services: ossv2: image: registry.cn-beijing.aliyuncs.com/k7scn/artifactory-pro:7.6.1 container_name: ossv2 volumes: - /data/ossv2:/var/opt/jfrog/artifactory network_mode: host restart: always nginx: image: registry.cn-beijing.aliyuncs.com/k7scn/nginx:1.17.3 container_name: nginx volumes: - /var/log/nginx:/var/log/nginx:rw - ./config:/etc/nginx/conf.d:rw - ./nginxconfig.io:/etc/nginx/nginxconfig.io:rw - ./ssl:/etc/nginx/ssl:rw - ./wwwroot:/var/www:rw network_mode: host restart: always æ³¨æ„äº‹é¡¹  artifactory æŒä¹…åŒ–æ•°æ®ç›®å½•å¯ç”¨ç©ºé—´æœ€å¥½ç¨å¾®å¤§äº›(\u0026gt;500GB)ï¼Œå…·ä½“çœ‹é•œåƒæºæ•°ç›®å¤šå°‘ã€‚ ä½¿ç”¨nginxè¿›è¡Œåå‘ä»£ç†ã€‚  é…ç½®æº 7.x å’Œ 6.x ç‰ˆæœ¬å·®åˆ«è¿˜æŒºå¤§çš„ã€‚\ndocker-compose up -d å¯åŠ¨æœåŠ¡åï¼Œè®¿é—® \u0026lt;ip\u0026gt;:8082 è¿›è¡Œåˆå§‹åŒ–æœåŠ¡é…ç½®ï¼ŒåŸºæœ¬é»˜è®¤é…ç½®å³å¯æˆ–è€…SKIPè·³è¿‡ã€‚\n åœ¨æ­¤è¿‡ç¨‹ä¸­æœ‰ä¸€æ­¥æ¯”è¾ƒå‘ï¼Œå°±æ˜¯åˆ›å»ºé»˜è®¤çš„Repositoriesï¼Œè¿™ä¸ªè·³è¿‡è·³è¿‡ï¼Œå¦åˆ™åé¢åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å°±è¦è¸©å‘äº†ï¼Œå¦‚é…ç½®Debianæˆ–è€…æºåAlpineåï¼Œå¦‚æœæ–‡ä»¶è·¯å¾„é‡Œæœ‰**.**å°±ä¼šå¯¼è‡´æ–‡ä»¶æ— æ³•ä¸‹è½½404\n artifactory æº ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œ\n Local æœ¬åœ° ï¼ˆé€šå¸¸æ”¾ä¸€äº›å†…éƒ¨çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…å…¶ä»–ï¼Œå½“ossç”¨ï¼‰ Remote è¿œç¨‹ (å¸¸ç”¨ï¼Œé»˜è®¤å°±åŸºæœ¬ä½¿ç”¨è¿™ä¸ª é€šå¸¸é•œåƒaliyunæˆ–è€…tuna) Virtual è™šæ‹Ÿ (local + remote)  è¿™é‡Œæˆ‘æˆªå–éƒ¨åˆ†è½¯ä»¶æºç¤ºä¾‹ï¼ŒåŸºæœ¬å‚»ç“œå¼æ“ä½œ\nç¤ºä¾‹é…ç½®Debianæº æ­£å¸¸Debianæºå¦‚ä¸‹:\n1 2 3 4  deb https://mirrors.ysicing.me/debian/ buster main contrib non-free deb https://mirrors.ysicing.me/debian/ buster-updates main contrib non-free deb https://mirrors.ysicing.me/debian/ buster-backports main contrib non-free deb https://mirrors.ysicing.me/debian-security buster/updates main contrib non-free   å¦‚æœæƒ³è¾¾æˆå¦‚ä¸Šï¼Œéœ€è¦åšä¸¤ä»¶äº‹\n é•œåƒDebianæº é…ç½®åŸŸå  é•œåƒDebianæº  åˆ›å»ºRemote Repositories debian å’Œ debian-security   é…ç½®debian Remote Repositories  åŒç† debian-security ç±»ä¼¼\n é…ç½®å®Œæˆåè®¿é—® \u0026lt;ip\u0026gt;:8082/artifactory/debian/ æˆ–è€… \u0026lt;ip\u0026gt;:8081/artifactory/debian/  åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†\n1 2  deb http://172.16.72.42:8082/artifactory/debian/ buster main contrib non-free ....   ip+ç«¯å£çš„æ–¹å¼ç»ˆç©¶ä¸å¤ªå¥½è®°ï¼Œæ˜¯æ—¶å€™æ‹–å‡ºnginxå¤§æ€å™¨äº†\né…ç½®nginx è¿™é‡Œä¸å…·ä½“è¯´nginxé…ç½®äº†ï¼Œç›´æ¥ä¸Šé…ç½®\n# mirrors.conf server { listen 80; listen [::]:80; listen 443 ssl http2; listen [::]:443 ssl http2; server_name mirrors.ysicing.me; if ($http_x_forwarded_proto = '') { set $http_x_forwarded_proto $scheme; } index index.html; root /var/www/mirrors.ysicing.me/public; # SSL ssl_certificate /etc/nginx/ssl/ysicing.me.crt; ssl_certificate_key /etc/nginx/ssl/ysicing.me.key; # security # include security.conf; location = / { root /var/www/mirrors.ysicing.me/public; } location ~ .*\\.(html|htm|reponew)$ { root /var/www/mirrors.ysicing.me/public; } location ~ (docker.sh|func.sh|data.json)$ { root /var/www/mirrors.ysicing.me/public; } # location ~ ^/$ { # root /var/www/mirrors.ysicing.me/public; # } location /pypi/ { proxy_pass http://127.0.0.1:8081/artifactory/api/pypi/pypi/; include nginxconfig.io/proxy.conf; } # chunked_transfer_encoding on; # client_max_body_size 0; # reverse proxy location / { proxy_buffering off; proxy_buffer_size 128k; proxy_buffers 100 128k; client_max_body_size 100m; proxy_pass http://127.0.0.1:8081/artifactory/; include nginxconfig.io/proxy.conf; location ~ ^/artifactory/ { proxy_pass http://127.0.0.1:8081; include nginxconfig.io/proxy.conf; } } # additional config include nginxconfig.io/general.conf; } ç±»ä¼¼ä¸¤ä¸ªé…ç½®æ‹¿è‡ªnginxconfig.io\n# proxy.conf proxy_http_version 1.1; proxy_cache_bypass $http_upgrade; proxy_read_timeout 2400s; proxy_pass_header Server; proxy_next_upstream error timeout non_idempotent; proxy_next_upstream_tries 1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026quot;upgrade\u0026quot;; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; # general.conf # favicon.ico location = /favicon.ico { log_not_found off; access_log off; } # robots.txt location = /robots.txt { log_not_found off; access_log off; } # assets, media location ~* \\.(?:css(\\.map)?|js(\\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv)$ { expires 7d; access_log on; } # svg, fonts location ~* \\.(?:svgz?|ttf|ttc|otf|eot|woff2?)$ { add_header Access-Control-Allow-Origin \u0026quot;*\u0026quot;; expires 7d; access_log off; } # gzip gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml; åˆ°è¿™é‡Œè½¯ä»¶æºé…ç½®å°±åŸºæœ¬å®Œæˆäº†ã€‚\næ•ˆæœå›¾å¦‚ä¸‹:\nUIå€Ÿé‰´äº†ç½‘æ˜“å¼€æºé•œåƒç«™\nè¸©çš„pypiå‘ï¼Œå°è®°å¤‡å¿˜ pypiæºä¸åŒäºå…¶ä»–ï¼Œéœ€è¦é¢å¤–é…ç½®nginxè§„åˆ™\n location /pypi/ { proxy_pass http://127.0.0.1:8081/artifactory/api/pypi/pypi/; include nginxconfig.io/proxy.conf; } ä½¿ç”¨\n~/.pip/pip.conf [global] index-url = https://mirrors.ysicing.me/pypi/simple # æµ‹è¯• git clone https://gitee.com/ysbot/CTFd.git --depth 1 cd CTFd pip3 install -r requirements.txt Goä»£ç† æ–°ç‰ˆæœ¬å¯¹Goä»£ç†åšäº†ä¼˜åŒ–ï¼Œä½¿ç”¨å¾ˆæµç¨‹ï¼Œåˆ›å»ºè¿œç¨‹Goï¼Œæºä½¿ç”¨https://goproxy.cn\ngo env -w GO111MODULE=on go env -w GOPROXY=https://mirrors.ysicing.me/go/,direct æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œç¼˜ç”Ÿå°åŠ©æ‰‹â€ï¼ŒåŸåˆ›å®è·µæ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚\n  ","description":"ä½¿ç”¨Artifactoryéƒ¨ç½²ç§æœ‰åŒ–è½¯ä»¶æº","id":3,"section":"posts","tags":["Artifactory"],"title":"ä½¿ç”¨Artifactoryéƒ¨ç½²ç§æœ‰åŒ–è½¯ä»¶æº","uri":"https://ysicing.me/posts/artifactory-setup-mirrors/"},{"content":" è¶ç€æ¬å®¶ï¼Œéœ€è¦æŠ˜(dao)è…¾(shi)ä¸€ä¸‹åƒç°çš„ç¾¤æ™–ï¼Œå°†Clashå‡çº§åˆ°2.0\n å‡†å¤‡clashé…ç½®æ–‡ä»¶ ç”±äºæ—¥å¸¸ä½¿ç”¨clashxï¼Œè¿™é‡Œå°±ä¸ä»‹ç»å¦‚ä½•è·å–Clashé…ç½®æ–‡ä»¶äº†ã€‚è‡ªè¡Œè§£å†³ï¼Œå¯ä»¥å‚è€ƒå¤§ä½¬æ•´ç†çš„LAZY_RULES\næ³¨æ„å‡ ç‚¹ 1 2 3 4 5 6  #HTTP(S) and SOCKS5 å…±ç”¨ç«¯å£mixed-port:7890# å…è®¸å±€åŸŸç½‘çš„è¿æ¥ï¼ˆå¯ç”¨æ¥å…±äº«ä»£ç†ï¼‰allow-lan:true# clash çš„ RESTful APIexternal-controller:0.0.0.0:9090  æ•ˆæœ åˆ›å»ºclash-prodæœåŠ¡  è·å–é•œåƒæˆ–è€…ä¸Šä¼ é•œåƒï¼Œè¿™é‡Œé»˜è®¤ä¸Šä¼ é•œåƒ  docker pull registry.cn-beijing.aliyuncs.com/k7scn/clash:1.1.0 docker save registry.cn-beijing.aliyuncs.com/k7scn/clash:1.1.0 \u0026gt; clash.tar  åˆ›å»ºå®¹å™¨  ç‚¹å‡»é•œåƒåˆ›å»ºå®¹å™¨åï¼Œé«˜çº§è®¾ç½®ã€‚\n  é«˜çº§è®¾ç½®ï¼Œå‹¾é€‰å¯ç”¨è‡ªåŠ¨é‡æ–°å¯åŠ¨ å·ï¼ŒæŒä¹…åŒ–é…ç½®æ–‡ä»¶ ç½‘ç»œï¼Œå‹¾é€‰ä½¿ç”¨ä¸Docker Hostç›¸åŒçš„ç½‘ç»œ(å…±äº«ç½‘ç»œ)   é…ç½®å®Œæˆåº”ç”¨ï¼Œå³å¯ã€‚\nåˆ›å»ºclash-uiæœåŠ¡ åŒç†ç±»ä¼¼ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/clash:yacd docker save registry.cn-beijing.aliyuncs.com/k7scn/clash:yacd \u0026gt; yacd.tar  ä¸éœ€è¦é¢å¤–é…ç½®ï¼Œå½“æœåŠ¡èµ·æ¥åï¼Œè·å–clash-uié»˜è®¤åˆ†é…çš„ç«¯å£ï¼Œæµè§ˆå™¨è®¿é—®ï¼Œé…ç½®APIåœ°å€ä¸ºhttp://127.0.0.1:9090  åˆ°è¿™é‡Œå°±è¾¾åˆ°äº†ä¸Šè¿°æ•ˆæœã€‚\nç¾¤æ™–é…ç½®ä»£ç† æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œç¼˜ç”Ÿå°åŠ©æ‰‹â€ï¼ŒåŸåˆ›å®è·µæ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚\n  ","description":"","id":4,"section":"posts","tags":["clash"],"title":"ç¾¤æ™–é…ç½®Clash","uri":"https://ysicing.me/posts/clash-dsm/"},{"content":"Caddy2ä½¿ç”¨å°è®°  å°†Caddyå‡çº§åˆ° Caddy2ï¼Œ è®°å½•ä¸€ä¸‹ã€‚ 2.0ç‰ˆæœ¬æ”¹å˜æŒºå¤§çš„ã€‚\n ç¯å¢ƒ è…¾è®¯äº‘é¦™æ¸¯è½»é‡, Debian 10, ç§’ä¸å¯è¨€ã€‚\nå®‰è£…caddy2 ä½¿ç”¨é•œåƒæˆ–è€…æºå®‰è£…(æ¨èæºå®‰è£…) 1 2 3 4 5  docker pull registry.cn-beijing.aliyuncs.com/k7scn/caddy # æˆ–è€… echo \u0026#34;deb [trusted=yes] https://apt.fury.io/caddy/ /\u0026#34; \u0026gt; /etc/apt/sources.list.d/caddy-fury.list apt update apt install caddy   ä½¿ç”¨äºŒè¿›åˆ¶å®‰è£… 1 2 3  wget https://github.com/caddyserver/caddy/releases/download/v2.1.1/caddy_2.1.1_linux_amd64.tar.gz tar xf caddy_2.1.1_linux_amd64.tar.gz mv caddy /usr/local/bin/caddy2   é…ç½®systemd\n# /etc/systemd/system/caddy.service [Unit] Description=Caddy Documentation=https://caddyserver.com/docs/ After=network.target [Service] User=caddy Group=caddy EnvironmentFile=-/etc/caddy/caddy.env ExecStart=/usr/local/bin/caddy2 run --environ --config /etc/caddy/Caddyfile ExecReload=/usr/local/bin/caddy2 reload --config /etc/caddy/Caddyfile TimeoutStopSec=5s LimitNOFILE=1048576 LimitNPROC=512 PrivateTmp=true ProtectSystem=full AmbientCapabilities=CAP_NET_BIND_SERVICE [Install] WantedBy=multi-user.target Caddyfileä½¿ç”¨  ç›®å‰ Caddy2 å®˜æ–¹æ¨èé…ç½®æ–‡ä»¶ä½¿ç”¨ JSON æ ¼å¼ï¼Œæˆ–è€…ï¼Œä¸ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œç›´æ¥è°ƒç”¨ admin APIã€‚ä½†æˆ‘æ¨èä½¿ç”¨ Caddyfile, æ—¥å¸¸ç»´æŠ¤èµ·æ¥è¦æ–¹ä¾¿ä¸€äº›\n 1  caddy2 adapt --config /etc/caddy/Caddyfile --validate #æ ¡éªŒæ˜¯å¦åˆæ³•   å®˜æ–¹è™½ç„¶è¯´ä»v1å‡çº§åˆ°v2å¾ˆç®€å•ï¼Œæˆ‘ä¿¡ä½ çš„é¬¼\nç¤ºä¾‹  { # å¼€å¯å®éªŒæ€§ HTTP/3 experimental_http3 # æµ‹è¯•é€šè¿‡çš„ç”Ÿäº§ç¯å¢ƒä¸­å»é™¤è¯¥é¡¹ # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory } (common_headers) { encode gzip } (secure_headers) { header { Strict-Transport-Security \u0026quot;max-age=31536000; includeSubDomains; preload\u0026quot; X-Frame-Options SAMEORIGIN X-Content-Type-Options nosniff } } ci.hk2.godu.dev { tls ops.ysicing@gmail.com import common_headers import secure_headers reverse_proxy 169.254.0.2:80 } cr.hk2.godu.dev { tls ops.ysicing@gmail.com import common_headers import secure_headers reverse_proxy 127.0.0.1:404 } :80 { respond \u0026quot;2020 hello\u0026quot; } é…ç½®è¯´æ˜ caddy2 å¼•å…¥äº†å…¨å±€é€‰é¡¹global optionsçš„æ¦‚å¿µï¼Œå¹¶ä¸”å¦‚æœå…¨å±€é€‰é¡¹å­˜åœ¨ï¼Œå¿…é¡»ä½äº Caddyfile çš„å¼€å¤´\n# å…¨å±€é…ç½® { # å¼€å¯å®éªŒæ€§ HTTP/3 experimental_http3 # æµ‹è¯•é€šè¿‡çš„ç”Ÿäº§ç¯å¢ƒä¸­å»é™¤è¯¥é¡¹ # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory }  æ”¯æŒHTTP/3ï¼Œ å·¥ä½œåœ¨ UDP åè®®ä¸Šï¼Œéœ€è¦æ”¾è¡Œ443 UDP Letâ€™s Encrypt æµ‹è¯•ç¯å¢ƒï¼Œé»˜è®¤caddy2æ˜¯å¤„äºç”Ÿäº§ç¯å¢ƒï¼Œæµ‹è¯•æ—¶å¯æ”¹ä¸ºæµ‹è¯•ç¯å¢ƒ  å®˜æ–¹æ–‡æ¡£\næ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œç¼˜ç”Ÿå°åŠ©æ‰‹â€ï¼ŒåŸåˆ›å®è·µæ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚\n ","description":"Caddy2åˆä½“éªŒ","id":5,"section":"posts","tags":["caddy"],"title":"Caddy2åˆä½“éªŒ","uri":"https://ysicing.me/posts/caddy2/"},{"content":"æºèµ· æœ‰æ—¶å€™è·‘ä¸€äº›æœåŠ¡ï¼Œéœ€è¦åœ¨Linuxä¸Šè¿è¡Œï¼Œéœ€è¦å¿«é€Ÿæ‹‰èµ·åˆ†å¸ƒå¼å¼€å‘æµ‹è¯•ç¯å¢ƒé…ç½®ï¼Œä¸å¯èƒ½é€šè¿‡åˆ›å»ºè™šæ‹Ÿæœºå®‰è£…æœåŠ¡ç­‰ä¸€ç³»åˆ—æ“ä½œï¼Œå¦åˆ™ä¸€è¡Œå‘½ä»¤ï¼Œä¸€ä¸Šåˆã€‚è¿™æ—¶å€™å°±éœ€è¦ä¸€æ¬¾ç§‘å­¦çš„å·¥å…·æ¥ç®¡ç†è™šæ‹Ÿæœºã€‚æœ‰äººä¼šè¯´ï¼Œä¸æ˜¯æœ‰dockerä¹ˆï¼Œä¸ºå•¥è¿˜ç”¨vagrant\nåŒºåˆ« è¿™é‡Œç®€å•è¯´ä¸‹åŒºåˆ«\nvagrantæ˜¯vmçš„ç¼–æ’å·¥å…·,æ˜¯ç®¡ç†ç¼–æ’ç¯å¢ƒï¼Œå¯¹æ ‡åº”è¯¥æ˜¯docker-compose\ndockeræ˜¯å°†åº”ç”¨è½»é‡åŒ–æ„å»ºå’Œéƒ¨ç½²å·¥å…·\nä¸ªäººè®¤ä¸ºä¸¤è€…ä½¿ç”¨çº¬åº¦ä¸ä¸€æ ·ï¼Œ è€Œä¸”åº”ç”¨åœºæ™¯å“ªä¸ªæ–¹ä¾¿ç”¨å“ªä¸ªã€‚\nç”¨æ³• ä¸Šé¢è¯´åˆ°vagrantæ˜¯vmè™šæ‹Ÿæœºçš„ç¼–æ’å·¥å…·ï¼Œç›®å‰æ”¯æŒå¤šä¸ªè™šæ‹Ÿæœºè½¯ä»¶ï¼Œå¸¸è§ç”¨virtualboxï¼Œä¹Ÿæ¨èç”¨è¿™ä¸ªã€‚\nå®˜æ–¹æ–‡æ¡£ Getting Started\nå®‰è£…vagrant 1 2  # MacOS, é»˜è®¤å·²ç»virtualbox brew cask install vagrant   æˆ–è€…é€šè¿‡å®˜ç½‘å®‰è£… Download Vagrant\nåˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›® Vagrantfileæ˜¯ç”¨æ¥å®šä¹‰vagrant projectçš„ï¼Œä½¿ç”¨rubyè¯­æ³•ï¼Œä¸è¿‡ä½ ä¸éœ€è¦çŸ¥é“rubyå°±å¯ä»¥å†™ä¸€ä¸ªVagrantfileã€‚\nç¤ºä¾‹æ¥æºäº ysicing/debian-vagrant\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\u0026#34;2\u0026#34;) do |config| config.vm.box_check_update = false config.vm.provider \u0026#39;virtualbox\u0026#39; do |vb| vb.customize [ \u0026#34;guestproperty\u0026#34;, \u0026#34;set\u0026#34;, :id, \u0026#34;/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\u0026#34;, 1000 ] end config.vm.synced_folder \u0026#34;.\u0026#34;, \u0026#34;/vagrant\u0026#34;, type: \u0026#34;nfs\u0026#34;, nfs_udp: false, disabled: true $num_instances = 1 (1..$num_instances).each do |i| config.vm.define \u0026#34;node#{i}\u0026#34; do |node| node.vm.box = \u0026#34;ysicing/debian\u0026#34; node.vm.hostname = \u0026#34;debian105-#{i}\u0026#34; #node.ssh.username = \u0026#34;root\u0026#34; #node.ssh.password = \u0026#34;vagrant\u0026#34; ip = \u0026#34;11.11.11.#{i+10}\u0026#34; node.vm.network \u0026#34;private_network\u0026#34;, ip: ip node.vm.provider \u0026#34;virtualbox\u0026#34; do |vb| vb.gui = false vb.memory = \u0026#34;1024\u0026#34; vb.cpus = 1 vb.name = \u0026#34;node#{i}\u0026#34; vb.customize [\u0026#34;modifyvm\u0026#34;, :id, \u0026#34;--natdnshostresolver1\u0026#34;, \u0026#34;on\u0026#34;] vb.customize [\u0026#34;modifyvm\u0026#34;, :id, \u0026#34;--ioapic\u0026#34;, \u0026#34;on\u0026#34;] end node.vm.provision \u0026#34;shell\u0026#34;, inline: \u0026#34;uname -a\u0026#34; end end end   ç®€å•è¯´ä¸‹æ ¸å¿ƒé‡è¦ç›¸å…³å‚æ•°:\n vm.provider è™šæ‹ŸæœºæœåŠ¡ vm.box è™šæ‹Ÿæœºé•œåƒ, ç±»ä¼¼dockeré•œåƒé•œåƒ cpus,memory,network,instances è™šæ‹Ÿæœºèµ„æºå‰¯æœ¬ä¿¡æ¯ç­‰  å¸¸ç”¨åŸºç¡€å‘½ä»¤ 1 2 3 4 5 6 7 8  # å¯åŠ¨ vagrant up # sshç™»å½• vagrant ssh # é”€æ¯ vagrant destroy # å…³æœº vagrant halt   ç¤ºä¾‹éƒ¨ç½²k8sé›†ç¾¤ mkdir vm cat \u0026gt; vm/Vagrantfile \u0026lt;\u0026lt;EOF # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\u0026quot;2\u0026quot;) do |config| config.vm.box_check_update = false config.vm.provider 'virtualbox' do |vb| vb.customize [ \u0026quot;guestproperty\u0026quot;, \u0026quot;set\u0026quot;, :id, \u0026quot;/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\u0026quot;, 1000 ] end $num_instances = 3 (1..$num_instances).each do |i| config.vm.define \u0026quot;0660b6a92e962a930692651db4562957#{i}\u0026quot; do |node| node.vm.box = \u0026quot;ysicing/debian\u0026quot; node.vm.hostname = \u0026quot;0660b6a92e962a930692651db4562957#{i}\u0026quot; node.vm.network \u0026quot;public_network\u0026quot;, use_dhcp_assigned_default_route: true, bridge: 'en0: Wi-Fi (Wireless)' # node.vm.provision \u0026quot;shell\u0026quot;, run: \u0026quot;always\u0026quot;, inline: \u0026quot;ntpdate ntp.api.bz\u0026quot; node.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;11.11.11.11#{i}\u0026quot; node.vm.provision \u0026quot;shell\u0026quot;, run: \u0026quot;always\u0026quot;, inline: \u0026quot;echo hello from 0660b6a92e962a930692651db4562957#{i}\u0026quot; node.vm.provider \u0026quot;virtualbox\u0026quot; do |vb| vb.gui = false vb.memory = 4096 vb.cpus = 2 vb.name = \u0026quot;0660b6a92e962a930692651db4562957#{i}\u0026quot; vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--natdnshostresolver1\u0026quot;, \u0026quot;on\u0026quot;] vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--ioapic\u0026quot;, \u0026quot;on\u0026quot;] # cpu ä½¿ç”¨ç‡50% vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--cpuexecutioncap\u0026quot;, \u0026quot;50\u0026quot;] end end end end EOF # å¯åŠ¨è™šæ‹Ÿæœº vagrant up # 11.11.11.110ï¼Œ11.11.11.111ï¼Œ11.11.11.112 root/vagrant # pre k8s pkg docker run --rm -v /tmp:/data registry.cn-beijing.aliyuncs.com/k7scn/k7s:1.16.15 cp -a /kube.tgz /data/kube.tgz sealos init --master 11.11.11.110 --node 11.11.11.111 --node 11.11.11.112 --user root --passwd vagrant --version v1.16.15 --repo registry.cn-beijing.aliyuncs.com/k7scn --pkg-url /tmp/kube.tgz å…¶ä»–åœºæ™¯ æœ¬åœ°èµ·å¤šä¸ªè™šæ‹Ÿæœºç¯å¢ƒæµ‹è¯•ï¼Œå…¶ä»–æ²¡å¿…è¦ï¼Œæ„Ÿè§‰æ²¡docker-composeæ–¹ä¾¿ã€‚\nVagrant.configure(\u0026quot;2\u0026quot;) do |config| config.vm.provision \u0026quot;shell\u0026quot;, inline: \u0026quot;echo Hello\u0026quot; config.vm.define \u0026quot;web\u0026quot; do |web| web.vm.box = \u0026quot;apache\u0026quot; end config.vm.define \u0026quot;db\u0026quot; do |db| db.vm.box = \u0026quot;mysql\u0026quot; end end debian boxç®€ä»‹ é»˜è®¤boxä½¿ç”¨ysicing/debian, ä¸ªäººè‡ªç”¨debiané•œåƒï¼Œæºç å¦‚ä¸‹ysicing/debian-vagrant\nå®šåˆ¶  é»˜è®¤å…è®¸root(å¯†ç vagrant)ç”¨æˆ·ç™»å½• é»˜è®¤dnsä¸º1.2.4.8, 114.114.114.114 é•œåƒæºä¸º mirrors.aliyun.com é»˜è®¤ç¡¬ç›˜80G å®‰è£…äº†å¸¸ç”¨è¿ç»´å·¥å…· \u0026hellip;  æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·â€œç¼˜ç”Ÿå°åŠ©æ‰‹â€ï¼ŒåŸåˆ›å®è·µæ–‡ç« ç¬¬ä¸€æ—¶é—´æ¨é€ã€‚\n  ","description":"vagrantç®€å•ä»‹ç»ä½¿ç”¨","id":6,"section":"posts","tags":["vagrant"],"title":"Vagrantä»å…¥é—¨åˆ°æ”¾å¼ƒ","uri":"https://ysicing.me/posts/vagrant-study/"},{"content":"å®‰è£…è®°å½• 1 2 3 4  git clone https://github.com/ysicing/istio-install.git cd istio-install istioctl install --set profile=demo --set hub=registry.cn-beijing.aliyuncs.com/k7scn kubectl apply -f .   éƒ¨ç½²demo kubectl create ns istio-demo kubectl label namespace istio-demo istio-injection=enabled kubectl apply -f example/bookinfo.yaml -n istio-demo ","description":"k8séƒ¨ç½²istio 1.7","id":7,"section":"posts","tags":["istio"],"title":"Istio 1.7å®‰è£…","uri":"https://ysicing.me/posts/istio-install/"},{"content":" é€šè¿‡helmå¿«é€Ÿå®‰è£…helm\n # é»˜è®¤å·²å­˜åœ¨é»˜è®¤sc kubectl get sc nfs-data (default) nfs-data Delete Immediate false 206d å®‰è£…consul\nhelminit kubectl create ns gaea-op helm upgrade -i consul --set global.imageRegistry=registry.cn-beijing.aliyuncs.com \\ --set image.repository=k7scn/b-consul \\ --set volumePermissions.enabled=true \\ --set volumePermissions.image.repository=k7scn/b-minideb \\ --set persistence.enabled=true \\ --set metrics.enabled=true \\ --set metrics.image.repository=k7scn/b-consul-exporter \\ --set ingress.enabled=true \\ --version 7.1.3 \\ bitnami/consul -n gaea-op ","description":"helmå®‰è£…helm","id":8,"section":"posts","tags":["consul"],"title":"Consulå®‰è£…","uri":"https://ysicing.me/posts/consul-install/"},{"content":" åŸºäºsealos, ä¸€é”®é«˜å¯ç”¨ï¼Œç®€å•ä¸Šæ‰‹, å®‰è£…k8s 1.18.4ç‰ˆæœ¬\n å‡†å¤‡è™šæ‹Ÿæœº ç¯å¢ƒ: 3å°æœºå™¨(debian/buster 10.4, 11.11.11.111~11.11.11.113, 2æ ¸4G80Gå­˜å‚¨)\n  ergo vm create --vmname k8s --vmnum 3  âœ ~ ergo vm create --vmname k8s --vmnum 3 I0523 15:20:15.819808 17953 root.go:51] Using config file: 2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:66] check system 2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/vm/linux.go:73] check system done. It looks good 2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:78] check vagrant 2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/utils/command.go:15] [os]exec cmd is : which [vagrant] /usr/local/bin/vagrant 2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/utils/command.go:15] [os]exec cmd is : which [VirtualBoxVM] /usr/local/bin/VirtualBoxVM 2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:85] write Vagrantfile 2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/vm/linux.go:92] vagranfile: # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\u0026quot;2\u0026quot;) do |config| config.vm.box_check_update = false config.vm.provider 'virtualbox' do |vb| vb.customize [ \u0026quot;guestproperty\u0026quot;, \u0026quot;set\u0026quot;, :id, \u0026quot;/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\u0026quot;, 1000 ] end $num_instances = 3 (1..$num_instances).each do |i| config.vm.define \u0026quot;k8s#{i}\u0026quot; do |node| node.vm.box = \u0026quot;ysicing/debian\u0026quot; node.vm.hostname = \u0026quot;k8s#{i}\u0026quot; node.vm.network \u0026quot;public_network\u0026quot;, use_dhcp_assigned_default_route: true, bridge: 'en0: Wi-Fi (Wireless)' # node.vm.provision \u0026quot;shell\u0026quot;, run: \u0026quot;always\u0026quot;, inline: \u0026quot;ntpdate ntp.api.bz\u0026quot; node.vm.network \u0026quot;private_network\u0026quot;, ip: \u0026quot;11.11.11.11#{i}\u0026quot; node.vm.provision \u0026quot;shell\u0026quot;, run: \u0026quot;always\u0026quot;, inline: \u0026quot;echo hello from k8s#{i}\u0026quot; node.vm.provider \u0026quot;virtualbox\u0026quot; do |vb| vb.gui = false vb.memory = 4096 vb.cpus = 2 vb.name = \u0026quot;k8s#{i}\u0026quot; vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--natdnshostresolver1\u0026quot;, \u0026quot;on\u0026quot;] vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--ioapic\u0026quot;, \u0026quot;on\u0026quot;] # cpu ä½¿ç”¨ç‡50% vb.customize [\u0026quot;modifyvm\u0026quot;, :id, \u0026quot;--cpuexecutioncap\u0026quot;, \u0026quot;50\u0026quot;] end end end end 2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:117] vagrant up Bringing machine 'k8s1' up with 'virtualbox' provider... Bringing machine 'k8s2' up with 'virtualbox' provider... Bringing machine 'k8s3' up with 'virtualbox' provider... ... 2020-05-23 15:26:37 [INFO] [github.com/ysicing/ergo/vm/linux.go:130] ip: 11.11.11.111-11.11.11.113, root/vagrant 2020-05-23 15:26:37 [INFO] [github.com/ysicing/ergo/vm/linux.go:133] é”€æ¯æ–¹å¼: cd /Users/ysicing/vm, vagrant destroy -f    åˆå§‹åŒ–ç¯å¢ƒ   ergo vm init --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113  =============================================================================== prepare : å®‰è£…åŸºç¡€è½¯ä»¶ -------------------------------------------------------- 8.77s prepare : Install dbus for the hostname module -------------------------- 5.84s prepare : åˆ é™¤é»˜è®¤å®‰è£… -------------------------------------------------------- 3.60s Gathering Facts --------------------------------------------------------- 1.15s prepare : åŠ è½½å†…æ ¸æ¨¡å— -------------------------------------------------------- 0.92s prepare : gather facts -------------------------------------------------- 0.67s prepare : å¢åŠ å†…æ ¸æ¨¡å—å¼€æœºåŠ è½½é…ç½® -------------------------------------------------- 0.63s prepare : å¯ç”¨systemdè‡ªåŠ¨åŠ è½½æ¨¡å—æœåŠ¡ --------------------------------------------- 0.53s prepare : ç¦ç”¨ç³»ç»Ÿ swap ----------------------------------------------------- 0.47s prepare : è®¾ç½®ç³»ç»Ÿ ulimits -------------------------------------------------- 0.41s prepare : ä¼˜åŒ–è®¾ç½® journal æ—¥å¿— ----------------------------------------------- 0.37s prepare : æŠŠSCTPåˆ—å…¥å†…æ ¸æ¨¡å—é»‘åå• ------------------------------------------------ 0.36s prepare : åˆ é™¤fstab swap ç›¸å…³é…ç½® --------------------------------------------- 0.34s prepare : è®¾ç½®ç³»ç»Ÿå‚æ•° -------------------------------------------------------- 0.32s prepare : å‡†å¤‡ journal æ—¥å¿—ç›¸å…³ç›®å½• --------------------------------------------- 0.32s prepare : åˆ›å»º systemd é…ç½®ç›®å½• ----------------------------------------------- 0.30s prepare : é‡å¯ journald æœåŠ¡ ------------------------------------------------ 0.30s prepare : update /etc/security/limits.conf ------------------------------ 0.28s prepare : ç”Ÿæ•ˆç³»ç»Ÿå‚æ•° -------------------------------------------------------- 0.19s prepare : è®¾ç½® ulimits ---------------------------------------------------- 0.12s    å®‰è£…docker   ergo install docker --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant  ... + sh -c 'docker version' Client: Docker Engine - Community Version: 19.03.9 API version: 1.40 Go version: go1.13.10 Git commit: 9d988398e7 Built: Fri May 15 00:25:25 2020 OS/Arch: linux/amd64 Experimental: false Server: Docker Engine - Community Engine: Version: 19.03.9 API version: 1.40 (minimum version 1.12) Go version: go1.13.10 Git commit: 9d988398e7 Built: Fri May 15 00:23:57 2020 OS/Arch: linux/amd64 Experimental: false containerd: Version: 1.2.13 GitCommit: 7ad184331fa3e55e52b890ea95e65ba581ae3429 runc: Version: 1.0.0-rc10 GitCommit: dc9208a3303feef5b3839f4323d9beb36df0a9dd docker-init: Version: 0.18.0 GitCommit: fec3683 If you would like to use Docker as a non-root user, you should now consider adding your user to the \u0026quot;docker\u0026quot; group with something like: sudo usermod -aG docker your-user Remember that you will have to log out and back in for this to take effect! WARNING: Adding a user to the \u0026quot;docker\u0026quot; group will grant the ability to run containers which can be used to obtain root privileges on the docker host. Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface for more information. Synchronizing state of docker.service with SysV service script with /lib/systemd/systemd-sysv-install. Executing: /lib/systemd/systemd-sysv-install enable docker \u0026quot;19.03.9\u0026quot; Unable to find image 'ysicing/tools:latest' locally latest: Pulling from ysicing/tools 0d6b48c80e92: Pull complete f28c196b1246: Pull complete 04bb1e97c214: Pull complete Digest: sha256:c689021150ec06af298db958d24c19fdbe3aea7c6717c5dee53f7e9071b4cd76 Status: Downloaded newer image for ysicing/tools:latest    å®‰è£…å¸¸ç”¨å°å·¥å…·   ergo install tools --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant  I0523 15:35:59.919563 19284 root.go:51] Using config file: I0523 15:35:59.920024 19284 install.go:55] ğŸ‰ å®‰è£… tools 2020-05-23 15:35:59 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.111]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir 2020-05-23 15:36:08 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.111]command result is: 2020-05-23 15:36:08 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.112]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir 2020-05-23 15:36:17 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.112]command result is: 2020-05-23 15:36:17 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.113]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir 2020-05-23 15:36:26 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.113]command result is:    ergo shell --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant --cmd upgrade-tools\næˆ–è€…åœ¨å½“å‰æœºå™¨ç›´æ¥æ‰§è¡Œ\nupgrade-tools å®‰è£…k8s  è¯´æ˜ï¼Œæˆ‘å®šåˆ¶äº†sealoså’Œcalicoç‰ˆæœ¬ä¸ºæœ€æ–°ç‰ˆæœ¬,ä¸”ä½¿ç”¨äº†åœ¨çº¿å®‰è£…åŒ…\n # å®‰è£…äº†k8s 1.18.4, å®‰è£…äº†ingress, é…ç½®nfsï¼Œé»˜è®¤å­˜å‚¨ç±»ä¸ºnfs-data ergo install k8s --enablenfs=true --mip 11.11.11.111 --wip 11.11.11.112-11.11.11.113 --pass vagrant --ingresstype --enablekuboard --regioncn å®‰è£…å…¶ä»–ingress æ”¯æŒnginx-ingress, traefik, ingress-nginx\nergo install ingress --ip 11.11.11.111 --pk ~/.ssh/id_rsa --regioncn --ingresstype éªŒè¯ root@k8s1:~# kubectl get node NAME STATUS ROLES AGE VERSION k8s1 Ready master 2m2s v1.18.4 k8s2 Ready \u0026lt;none\u0026gt; 87s v1.18.4 k8s3 Ready \u0026lt;none\u0026gt; 87s v1.18.4 root@k8s1:~# kubectl get ns NAME STATUS AGE default Active 2m6s ingress-nginx Active 2m13s kube-node-lease Active 2m7s kube-public Active 2m7s kube-system Active 2m8s root@k8s1:~# kubectl get cs NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok etcd-0 Healthy {\u0026quot;health\u0026quot;:\u0026quot;true\u0026quot;} root@k8s1:~# kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE nfs-data (default) nfs-provisioner Delete Immediate false 60s ","description":"æœ¬åœ°ä½¿ç”¨ergoå¿«é€Ÿå®‰è£…k8s1.18.4","id":9,"section":"posts","tags":["kubernetes"],"title":"ä½¿ç”¨ergoå¿«é€Ÿå®‰è£…k8s1.18.4","uri":"https://ysicing.me/posts/k8s-install-ergo/"},{"content":"ç®€ä»‹ k8sçš„LoadBalancerç±»å‹çš„Serviceä¾èµ–äº‘æœåŠ¡å•†çš„Load Balancer, å¦‚é˜¿é‡Œäº‘çš„slbã€‚\nå½“æˆ‘ä»¬æŠŠk8séƒ¨ç½²åœ¨ç§æœ‰äº‘æ—¶ï¼Œéœ€è¦ç®€å•çš„LoadBalanceræ¥éªŒè¯å·¥ä½œï¼Œå¼€æºçš„metallbå°±æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\né€šè¿‡k8såŸç”Ÿçš„æ–¹å¼æä¾›LBç±»å‹çš„Serviceæ”¯æŒï¼Œå¼€ç®±å³ç”¨ã€‚\nåŸç†  Layer2 (é»˜è®¤ä½¿ç”¨) BGP  Layer2 åªéœ€è¦ä¸€æ®µè·ŸK8sç®¡ç†ç½‘ç›¸åŒç½‘æ®µçš„åœ°å€å³å¯, é€šå¸¸è¿™ç§å°±å¯ä»¥äº†ã€‚\nåœ¨æ­¤æ¨¡å¼ä¸‹, ä¼šä»k8sèŠ‚ç‚¹ä¸­é€‰ä¸€ä¸ªLeaderèŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šé¢å“åº”LBåœ°å€æ®µçš„ARPè¯·æ±‚ï¼Œä»è€Œä½¿ä¸Šå±‚è·¯ç”±æŠŠå‘å¾€LBçš„æµé‡éƒ½å‘åˆ°LeaderèŠ‚ç‚¹ã€‚ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ‰€æœ‰å¯¹LBçš„è¯·æ±‚éƒ½ä¼šå‘å¾€LeaderèŠ‚ç‚¹ã€‚å¦‚æœå½“å‰Serviceä¸‹é¢çš„Podåˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæµé‡è¿˜ä¼šä»Leaderå‘å¾€ç›¸åº”çš„èŠ‚ç‚¹ã€‚\nå±€é™æ€§: å•èŠ‚ç‚¹æµé‡ç“¶é¢ˆå’Œæ…¢æ•…éšœè½¬ç§»\nBGP éœ€è¦ä¸Šå±‚è·¯ç”±å™¨æ”¯æŒBGPï¼Œä¸åœ¨éœ€è¦LeaderèŠ‚ç‚¹ã€‚\nå®‰è£… kubectl get ns | grep metallb-system \u0026amp;\u0026amp; exit 0 kubectl apply -f https://gitee.com/ysicing/ergo/raw/master/hack/k8s/metallb/metallb.yaml kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\u0026quot;$(openssl rand -base64 128)\u0026quot; kubectl apply -f https://gitee.com/ysicing/ergo/raw/master/hack/k8s/metallb/lbconfig.yaml # æˆ–è€…ä½¿ç”¨ergo ergo install mlb --pass vagrant é…ç½®è¯´æ˜ # https://gitee.com/ysicing/ergo/raw/master/hack/k8s/metallb/lbconfig.yaml apiVersion: v1 kind: ConfigMap metadata: namespace: metallb-system name: config data: config: | address-pools: - name: lbpool protocol: layer2 addresses: - 11.11.11.150-11.11.11.200 æµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  # lb.yamlapiVersion:apps/v1kind:Deploymentmetadata:name:nginx-deploymentspec:selector:matchLabels:app:nginxreplicas:2template:metadata:labels:app:nginxspec:containers:- name:nginximage:nginxports:- containerPort:80---apiVersion:v1kind:Servicemetadata:name:nginx-servicespec:selector:app:nginxports:- port:80targetPort:80type:LoadBalancer  æµ‹è¯•\nroot@k8s1:~# kubectl apply -f lb.yaml root@k8s1:~# kubectl get pods,svc NAME READY STATUS RESTARTS AGE pod/nginx-deployment-d46f5678b-hm7r6 1/1 Running 0 96s pod/nginx-deployment-d46f5678b-zgfxd 1/1 Running 0 96s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/kubernetes ClusterIP 10.96.0.1 \u0026lt;none\u0026gt; 443/TCP 88m service/nginx-service LoadBalancer 10.98.184.75 11.11.11.150 80:32002/TCP 6s ","description":"","id":10,"section":"posts","tags":["kubernetes","LoadBalancer"],"title":"å¼€æºk8slbå·¥å…·Metallb","uri":"https://ysicing.me/posts/k8s-slb-metallb/"},{"content":"ç®€ä»‹ etcdæ˜¯CoreOSå›¢é˜Ÿå‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼é”®å€¼(key-value)æ•°æ®åº“ã€‚etcdå†…éƒ¨é‡‡ç”¨raftåè®®ä½œä¸ºä¸€è‡´æ€§ç®—æ³•ï¼ŒetcdåŸºäºGoè¯­è¨€å®ç°ã€‚\netcdæ¯”è¾ƒå¤šçš„åº”ç”¨åœºæ™¯æ˜¯ç”¨äºæœåŠ¡å‘ç°ã€‚\nä½¿ç”¨helmå®‰è£…etcd 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  # æŸ¥è¯¢ helm search repo etcd NAME CHART VERSION APP VERSION DESCRIPTION bitnami/etcd 4.8.2 3.4.9 etcd is a distributed key value store that prov... incubator/etcd 0.7.4 3.2.26 Distributed reliable key-value store for the mo... stable/etcd-operator 0.10.3 0.9.4 CoreOS etcd-operator Helm chart for Kubernetes stable/zetcd 0.1.9 0.0.3 CoreOS zetcd Helm chart for Kubernetes # ä¸‹è½½helmåŒ…,æ‰§è¡Œå®šåˆ¶ helm pull bitnami/etcd # ä½¿ç”¨nodeport, ç¦ç”¨rbacï¼Œç¦ç”¨å­˜å‚¨ helm install etcd bitnami/etcd --set service.type=NodePort --set service.type=NodePort --set auth.rbac.enabled=false --set persistence.enabled=false -n ops-open export NODE_IP=$(kubectl get nodes --namespace ops-open -o jsonpath=\u0026#34;{.items[0].status.addresses[0].address}\u0026#34;) export NODE_PORT=$(kubectl get --namespace ops-open -o jsonpath=\u0026#34;{.spec.ports[0].nodePort}\u0026#34; services etcd) export ETCDURL=http://$NODE_IP:$NODE_PORT echo \u0026#34;etcd URL: $ETCDURL\u0026#34; export ECTDCTL_API=3 etcdctl member list --endpoints=$ETCDURL   ","description":"Etcdä½¿ç”¨å…¥é—¨","id":11,"section":"posts","tags":["etcd"],"title":"Etcdä½¿ç”¨å…¥é—¨","uri":"https://ysicing.me/posts/etcd-op/"},{"content":"éƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  # docker.yamlapiVersion:apps/v1kind:StatefulSetmetadata:name:docker-apinamespace:gaea-opannotations:k8s.gaea.me/workload:applabels:k8s.gaea.me/name:docker-apispec:replicas:1template:metadata:labels:k8s.gaea.me/name:docker-apispec:containers:- name:dockerdimage:\u0026#39;docker:18.09.9-dind\u0026#39;securityContext:privileged:true- name:docker-cliimage:\u0026#39;docker:18.09.9\u0026#39;env:- name:DOCKER_HOSTvalue:tcp://127.0.0.1:2375command:[\u0026#34;/bin/sh\u0026#34;]args:[\u0026#34;-c\u0026#34;,\u0026#34;docker info \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; while [ $? -ne 0 ] ; do sleep 3; docker info \u0026gt;/dev/null 2\u0026gt;\u0026amp;1; done; docker pull library/busybox:latest; docker save -o busybox-latest.tar library/busybox:latest; docker rmi library/busybox:latest; while true; do sleep 86400; done\u0026#34;]selector:matchLabels:k8s.gaea.me/name:docker-apiserviceName:docker-api---apiVersion:v1kind:Servicemetadata:name:docker-apinamespace:gaea-opspec:ports:- name:tcp-2375port:2375clusterIP:Noneselector:k8s.gaea.me/name:docker-api  1  kubectl apply -f docker.yaml   ä½¿ç”¨ 1 2 3  # docker apiåœ°å€: docker-api-0.docker-api.gaea-op.svc.cluster.local kubectl exec -it pods/docker-api-0 -n gaea-op -c docker-cli -- ash / # docker info   go apiæ“ä½œ ","description":"ä½¿ç”¨docker in docker","id":12,"section":"posts","tags":["docker","kubernetes"],"title":"åœ¨k8sä¸­ä½¿ç”¨docker in docker","uri":"https://ysicing.me/posts/docker-in-k8s/"},{"content":" é€šè¿‡Operatoråˆ›å»ºPrometheus\n è„šæœ¬éƒ¨ç½² # åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šï¼Œé…ç½®äº†å­˜å‚¨storageclass git clone https://github.com/ysicing/prometheus.git cd prometheus # prometheus-service/prometheus-storageclass.yaml #é…ç½®å­˜å‚¨ bash -x ./deploy.sh # åœ¨ç®¡ç†èŠ‚ç‚¹æ‰§è¡Œï¼Œå¦‚æœ‰æŠ¥é”™ï¼Œåœ¨æ‰§è¡Œä¸€ä¸‹ ä¸å®˜æ–¹çš„åŒºåˆ«æ”¯æŒäº†æ•°æ®æŒä¹…åŒ–å’ŒåŸŸåé…ç½®,éƒ¨åˆ†ç›‘æ§ç»„ä»¶å¦‚etcdç­‰\nergoå®‰è£… ergo install prom --ip 10.147.20.42 --pass oac5eeWosie7aiP5Um2AeKahkaiCeigh --domain godu.dev ","description":"Prometheus Operator åˆä½“éªŒ","id":13,"section":"posts","tags":["kubernetes","prometheus"],"title":"Prometheus Operator åˆä½“éªŒ","uri":"https://ysicing.me/posts/prometheus-install/"},{"content":"å®‰è£…  å®‰è£…dockeræ—¶é»˜è®¤å·²ç»å®‰è£…äº†helm,å¦‚æœä¸æ˜¯æœ€æ–°ç‰ˆæœ¬è¯·upgrade-tools\n 1 2 3 4  upgrade-tools # ç‰ˆæœ¬ helm version version.BuildInfo{Version:\u0026#34;v3.2.1\u0026#34;, GitCommit:\u0026#34;fe51cd1e31e6a202cba7dead9552a6d418ded79a\u0026#34;, GitTreeState:\u0026#34;clean\u0026#34;, GoVersion:\u0026#34;go1.13.10\u0026#34;}   é…ç½®helmé•œåƒåº“ 1 2 3 4 5 6  # è‡ªåŠ¨ helminit # æ‰‹åŠ¨ helm repo add stable http://mirror.azure.cn/kubernetes/charts/ helm repo add incubator http://mirror.azure.cn/kubernetes/charts-incubator/   ","description":"è®°å½•helmç›¸å…³ä½¿ç”¨","id":14,"section":"posts","tags":["helm"],"title":"helmå°è®°","uri":"https://ysicing.me/posts/helm/"},{"content":"åŸŸåç›¸å…³ é»˜è®¤æƒ…å†µä¸‹, æœ¬åœ°ç¯å¢ƒåŸŸåæµ‹è¯•\n*.k7s.xyz 11.11.11.111 *.slb.k7s.xyz 11.11.11.112 *.vlb.k7s.xyz 11.11.11.113 ergoå®‰è£… Usage: ergo install ingress [flags] Flags: -h, --help help for ingress --ingresstype string ingress: nginx-ingress, traefik, ingress-nginx (default \u0026quot;ingress-nginx\u0026quot;) Global Flags: --config string config file (default is $HOME/.doge/config.yaml) --ip strings éœ€è¦å®‰è£…èŠ‚ç‚¹ip (default [11.11.11.111]) --pass string ç®¡ç†å‘˜å¯†ç  --pk string ç®¡ç†å‘˜ç§é’¥ --regioncn é»˜è®¤ä½¿ç”¨giteeæº (default true) --user string ç®¡ç†å‘˜ (default \u0026quot;root\u0026quot;) ç¤ºä¾‹: ergo install ingress --ip 10.147.20.43 --pk ~/.ssh/id_rsa --regioncn --ingresstype traefik\nå†å²å®‰è£… NGINX Ingress Controller (ingress-nginx) ä½¿ç”¨helmæ–¹å¼å®‰è£…\nkubectl apply -f https://ysicing.me/hack/helm/nginx-ingress/ns.yaml # å®‰è£… helm install nginx-ingress -f https://ysicing.me/hack/helm/nginx-ingress/nginx-ingress-1.34.2.yaml stable/nginx-ingress -n ingress-nginx # å‡çº§ helm upgrade nginx-ingress -f https://ysicing.me/hack/helm/nginx-ingress/nginx-ingress-1.34.2.yaml stable/nginx-ingress -n ingress-nginx NGINX Ingress Controllers (kubernetes-ingress) helm repo add nginx-stable https://helm.nginx.com/stable helm repo update helm install nginx-ingress -f https://ysicing.me/hack/helm/hack/helm/nginxnc-ingress/nginx-ingress-0.4.3.yaml nginx-stable/nginx-ingress -n ingress-nginx # æˆ–è€… kubectl apply -f https://ysicing.me/hack/k7s/install/nginx-ingress/nginx-ingress.yml éƒ¨ç½²æ–‡æ¡£ nginxinc/kubernetes-ingress v1.6.0\n","description":"k8séƒ¨ç½²ingress","id":15,"section":"posts","tags":["kubernetes","ingress"],"title":"ergoå®‰è£…ingresså®‰è£…","uri":"https://ysicing.me/posts/ingress-install/"},{"content":"1. èƒŒæ™¯  äº‘æœåŠ¡å•†æä¾›çš„æœºå™¨å¯èƒ½å®‰è£…äº†ä¸€äº›æœåŠ¡ç»„ä»¶ï¼Œå¦‚ç›‘æ§ç­‰ç­‰ï¼Œæƒ³è¦ä¸€ä¸ªå¹²å‡€çš„ç¯å¢ƒã€‚ ä¸€æ¡å‘½ä»¤å¿«é€Ÿé‡è£…å¹²å‡€çš„Linuxç¯å¢ƒ ç›®å‰ä»…æ”¯æŒDebian(ä¸ä¼šä¸æ‰“ç®—æ”¯æŒå…¶ä»–ç³»ç»Ÿ) åŸºäºèŒå’–å¤§ä½¬çš„äºŒæ¬¡é­”æ”¹  2. å®šåˆ¶  é»˜è®¤rootå¯†ç  vagrant(å®‰è£…å®Œæˆå»ºè®®ä¿®æ”¹ï¼Œç¦æ­¢å¯†ç ç™»å½•) é»˜è®¤é…ç½®æºä¸ºmirrors.tuna.tsinghua.edu.cn,é»˜è®¤æ·»åŠ äº†security,backports é»˜è®¤æ—¶åŒºä¸ºAsia/Shanghai é»˜è®¤å®‰è£…äº†curl wget openssh-server sudo sed apt-transport-https net-toolsç­‰å¸¸ç”¨å·¥å…· åŒæ—¶é»˜è®¤æ”¯æŒè‡ªå®šä¹‰å¯†ç   3. å®‰è£… 1 2 3  curl -sSL https://ysicing.me/hack/reinstall/install.sh | bash # æŒ‡å®šå‚æ•° bash \u0026lt;(wget --no-check-certificate -qO- \u0026#39;https://ysicing.me/hack/reinstall/install.sh\u0026#39;) -p thah6oob7KieChie   3.1 ç‰¹æ®Š: è‡ªå®šä¹‰ç¡¬ç›˜  å­˜åœ¨å¤šä¸ªç¡¬ç›˜æ—¶ï¼Œéœ€è¦ä¸‹è½½ https://ysicing.me/hack/reinstall/installhk.shæ–‡ä»¶ï¼Œç¼–è¾‘å¦‚ä¸‹éƒ¨åˆ†å³å¯\n 1  d-i partman-auto/disk string /dev/sdb   4. å‚è€ƒé™„å½• [ Linux VPS ] Debian/Ubuntu/CentOS ç½‘ç»œå®‰è£…/é‡è£…ç³»ç»Ÿ/çº¯å‡€å®‰è£… ä¸€é”®è„šæœ¬\n","description":"ä»‹ç»å¦‚ä½•ç»™äº‘æœåŠ¡å•†æä¾›çš„æœºå™¨åœ¨çº¿é‡è£…Debianï¼Œä»¥é˜¿é‡Œè½»é‡äº‘ä¸ºä¾‹","id":16,"section":"posts","tags":["debian"],"title":"å¦‚ä½•åœ¨çº¿é‡è£…Debian","uri":"https://ysicing.me/posts/debian-reinstall/"},{"content":"å®‰è£…docker curl -fsSL https://ysicing.me/hack/docker/install.sh | bash æˆ–è€… ergo install docker -h åšäº†å¦‚ä¸‹è®¾ç½®\n1 2 3 4 5 6 7 8 9 10 11 12 13  { \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;], \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://reg-mirror.qiniu.com\u0026#34;,\u0026#34;https://dyucrs4l.mirror.aliyuncs.com\u0026#34;,\u0026#34;https://dockerhub.azk8s.cn\u0026#34;], \u0026#34;bip\u0026#34;: \u0026#34;169.254.0.1/24\u0026#34;, \u0026#34;max-concurrent-downloads\u0026#34;: 10, \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-level\u0026#34;: \u0026#34;warn\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;20m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;2\u0026#34; }, \u0026#34;storage-driver\u0026#34;: \u0026#34;overlay2\u0026#34; }   å®‰è£…tools docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir å†…ç½®äº†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  etcdctl helm(v3) helminit // åˆå§‹åŒ–helm, é»˜è®¤é…ç½®çš„æ˜¯mirror.azure.cn docker-compose calicoctl ctop cclear (æ¸…ç†é€€å‡ºå®¹å™¨) din (è¿›å…¥å®¹å™¨ din \u0026lt;cname/\u0026gt;cid\u0026gt; ash/bash(é»˜è®¤)/sh) dps (å®¹å™¨çŠ¶æ€) etcdcli (ç‰¹åˆ«æ”¯æŒk8sé›†ç¾¤çš„etcd) kbtoken (æŸ¥çœ‹kuboard adminç”¨æˆ·token) kdtoken (æŸ¥çœ‹dashboard-admin ç”¨æˆ·token) istioctl linkerd upgrade-tools // å‡çº§äºŒè¿›åˆ¶   ","description":"ä½¿ç”¨ergoå¿«é€Ÿå®‰è£…docker","id":17,"section":"posts","tags":["docker"],"title":"dockerå¿«é€Ÿå®‰è£…","uri":"https://ysicing.me/posts/docker/"},{"content":"å…ˆå·²ç»åˆ›å»ºå¥½å†…ç½‘slb,è·å–slbçš„IDä¸ºlb-xxxx\n# intranet-slb-ingress.yml apiVersion: v1 kind: Service metadata: # è¿™é‡ŒæœåŠ¡å–åä¸ºnginx-ingress-lb-intranet name: nginx-ingress-lb-intranet namespace: kube-system labels: app: nginx-ingress-lb-intranet annotations: # æŒ‡æ˜SLBå®ä¾‹åœ°å€ç±»å‹ä¸ºç§ç½‘ç±»å‹ service.beta.kubernetes.io/alicloud-loadbalancer-address-type: intranet # ä¿®æ”¹ä¸ºæ‚¨çš„ç§ç½‘SLBå®ä¾‹ID service.beta.kubernetes.io/alicloud-loadbalancer-id: lb-xxxx # æ˜¯å¦è‡ªåŠ¨åˆ›å»ºSLBç«¯å£ç›‘å¬ï¼ˆä¼šè¦†å†™å·²æœ‰ç«¯å£ç›‘å¬ï¼‰ï¼Œä¹Ÿå¯æ‰‹åŠ¨åˆ›å»ºç«¯å£ç›‘å¬ service.beta.kubernetes.io/alicloud-loadbalancer-force-override-listeners: 'true' spec: type: LoadBalancer # route traffic to other nodes externalTrafficPolicy: \u0026quot;Cluster\u0026quot; ports: - port: 80 name: http targetPort: 80 - port: 443 name: https targetPort: 443 selector: # select app=ingress-nginx pods app: ingress-nginx ç”Ÿæ•ˆå†…ç½‘slb\nkubectl apply -f intranet-slb-ingress.yml æŸ¥çœ‹slb\nnginx-ingress-lb LoadBalancer 172.x.x.x 39.x.x.x 80:31110/TCP,443:31574/TCP 20h nginx-ingress-lb-intranet LoadBalancer 172.x.x.x 10.x.x.x 80:30740/TCP,443:30852/TCP 73m ","description":"ACK æ·»åŠ å†…ç½‘è´Ÿè½½å‡è¡¡","id":18,"section":"posts","tags":["ingress","kubernetes","ack"],"title":"ACK æ·»åŠ å†…ç½‘è´Ÿè½½å‡è¡¡","uri":"https://ysicing.me/posts/aliyun-ack-ingress/"},{"content":"k3s æ˜¯Rancheræ¨å‡ºçš„è½»é‡çº§ k8s.\nå‡çº§å†…æ ¸ç‰ˆæœ¬ apt update apt dist-upgrade apt install -t buster-backports linux-image-amd64 -y update-grub reboot # å†…æ ¸ Linux cn2 5.6.0-0.bpo.2-amd64 #1 SMP Debian 5.6.14-2~bpo10+1 (2020-06-09) x86_64 GNU/Linux å…·ä½“å¯ä»¥å‚è€ƒ Debianä¸ªäººå¸¸ç”¨æ“ä½œæŒ‡å— å‡çº§å†…æ ¸éƒ¨åˆ†ã€‚\nå®‰è£… wireguard # æ‰€æœ‰èŠ‚ç‚¹éœ€å®‰è£… apt install wireguard -y éƒ¨ç½²æ§åˆ¶å¹³é¢masterèŠ‚ç‚¹ cat \u0026gt; /etc/systemd/system/k3s.service \u0026lt;\u0026lt;EOF [Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io Wants=network-online.target [Install] WantedBy=multi-user.target [Service] Type=notify EnvironmentFile=-/etc/systemd/system/k3s.service.env KillMode=process Delegate=yes # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s ExecStartPre=-/sbin/modprobe br_netfilter ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/k3s \\ server \\ --tls-san 10.147.20.42 \\ --node-ip 10.147.20.42 \\ --node-external-ip 10.147.20.42 \\ --docker \\ --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 \\ --flannel-backend wireguard \\ --kube-proxy-arg \u0026quot;proxy-mode=ipvs\u0026quot; \u0026quot;masquerade-all=true\u0026quot; \\ --kube-proxy-arg \u0026quot;metrics-bind-address=0.0.0.0\u0026quot; EOF å¼€æœºå¯åŠ¨\n1  systemctl enable k3s --now   æŸ¥çœ‹ç»„ä»¶çŠ¶æ€\nk3s kubectl get cs NAME STATUS MESSAGE ERROR controller-manager Healthy ok scheduler Healthy ok éƒ¨ç½²è®¡ç®—workerèŠ‚ç‚¹ cat \u0026gt; /etc/systemd/system/k3s-agent.service \u0026lt;\u0026lt;EOF [Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io Wants=network-online.target [Install] WantedBy=multi-user.target [Service] Type=exec EnvironmentFile=-/etc/systemd/system/k3s-agent.service.env KillMode=process Delegate=yes LimitNOFILE=infinity LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s ExecStartPre=-/sbin/modprobe br_netfilter ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/k3s agent \\ --node-external-ip 10.147.20.43 \\ --node-ip 10.147.20.43 \\ --docker \\ --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 \\ --kube-proxy-arg \u0026quot;proxy-mode=ipvs\u0026quot; \u0026quot;masquerade-all=true\u0026quot; \\ --kube-proxy-arg \u0026quot;metrics-bind-address=0.0.0.0\u0026quot; EOF  K3S_TOKEN : åŠ å…¥é›†ç¾¤æ‰€éœ€çš„tokenï¼Œå¯ä»¥åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹/var/lib/rancher/k3s/server/node-token æ–‡ä»¶  cat \u0026gt; /etc/systemd/system/k3s-agent.service.env \u0026lt;\u0026lt;EOF K3S_URL=https://10.147.20.42:6443 K3S_TOKEN=K102f2c1f6c878f693700c24b741d309d2ff4038ade912f0a44248781c04376e878::server:bc39d44d89042011b985f267eebe2b2f EOF å¼€æœºå¯åŠ¨\nsystemctl enable k3s-agent --now ","description":"debianæŒ‰ç…§k3s","id":19,"section":"posts","tags":["kubernetes","k3s"],"title":"debianæŒ‰ç…§k3s","uri":"https://ysicing.me/posts/k3s-install/"},{"content":"å˜é‡å’Œå¸¸é‡ å…³é”®å­—\u0026amp;ä¿ç•™å­—\n# 25ä¸ªä¿ç•™å­— break default func interface select case defer go map struct chan else goto package switch const fallthrough if range type continue for import return var # 37ä¸ªä¿ç•™å­— Constants: true false iota nil Types: int int8 int16 int32 int64 uint uint8 uint16 uint32 uint64 uintptr float32 float64 complex128 complex64 bool byte rune string error Functions: make len cap new append copy close delete complex real imag panic recover æ³¨æ„\n1. å‡½æ•°å¤–çš„æ¯ä¸ªè¯­å¥éƒ½å¿…é¡»ä»¥å…³é”®å­—å¼€å§‹ï¼ˆvarã€constã€funcç­‰ï¼‰ 2. :=ä¸èƒ½ä½¿ç”¨åœ¨å‡½æ•°å¤–ã€‚ 3. _å¤šç”¨äºå ä½ï¼Œè¡¨ç¤ºå¿½ç•¥å€¼(åŒ¿åå˜é‡ï¼Œä¸å ç”¨å‘½åç©ºé—´ï¼Œä¸ä¼šåˆ†é…å†…å­˜ï¼Œä¸éœ€è¦å­˜åœ¨é‡å¤ç”³æ˜) å˜é‡ 1 2 3 4 5 6 7 8 9 10 11 12 13  package main import ( \u0026#34;fmt\u0026#34; ) // å…¨å±€å˜é‡m var m = 100 func main() { n := 10 m := 200 // æ­¤å¤„å£°æ˜å±€éƒ¨å˜é‡m \tfmt.Println(m, n) }   å¸¸é‡ å¸¸é‡æ˜¯æ’å®šä¸å˜çš„å€¼\n1 2 3 4 5 6 7 8  const pi = 3.1415 const ( // constå£°æ˜å¤šä¸ªå¸¸é‡æ—¶ï¼Œå¦‚æœçœç•¥äº†å€¼åˆ™è¡¨ç¤ºå’Œä¸Šé¢ä¸€è¡Œçš„å€¼ç›¸åŒ  p1 = 3.1415 p2 // 3.1415  p3 // 3.1415 )   iota iotaæ˜¯goè¯­è¨€çš„å¸¸é‡è®¡æ•°å™¨ï¼Œåªèƒ½åœ¨å¸¸é‡çš„è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚iotaåœ¨constå…³é”®å­—å‡ºç°æ—¶å°†è¢«é‡ç½®ä¸º0ã€‚constä¸­æ¯æ–°å¢ä¸€è¡Œå¸¸é‡å£°æ˜å°†ä½¿iotaè®¡æ•°ä¸€æ¬¡(iotaå¯ç†è§£ä¸ºconstè¯­å¥å—ä¸­çš„è¡Œç´¢å¼•)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  const ( n1 = iota // 0  n2 // 1  n3 // 2  _ // è·³è¿‡æŸäº›å€¼  n4 // 3  n5 = 10 // 10  n6 // 4 ) const ( _ = iota // 0  KB = 1 \u0026lt;\u0026lt; (10 * iota) // 1 1\u0026lt;\u0026lt;10 2^10 1024  MB = 1 \u0026lt;\u0026lt; (10 * iota) // 2 1\u0026lt;\u0026lt;20 2^20 1024*1024 ) const ( a, b = iota + 1, iota + 2 // 1,2  c, d // 2, 3 )   åŸºæœ¬æ•°æ®ç±»å‹ package main import ( \u0026quot;fmt\u0026quot; \u0026quot;math\u0026quot; ) func main() { var a int = 17 // int å‹ (int64) fmt.Printf(\u0026quot;%d \\n\u0026quot;, a) // 17 åè¿›åˆ¶ fmt.Printf(\u0026quot;%b \\n\u0026quot;, a) // 10001 äºŒè¿›åˆ¶ fmt.Printf(\u0026quot;%o \\n\u0026quot;, a) // 021 å…«è¿›åˆ¶ fmt.Printf(\u0026quot;%x \\n\u0026quot;, a) // 0x11 16ç¦æ­¢ fmt.Printf(\u0026quot;%.2f \\n\u0026quot;, math.Pi) // é»˜è®¤éƒ½æ˜¯æµ®ç‚¹å‹float64 var s = \u0026quot;666\u0026quot; fmt.Printf(\u0026quot;%T \\n\u0026quot;, s) // ç±»å‹ string fmt.Printf(\u0026quot;%v \\n\u0026quot;, s) // å€¼ 666 fmt.Printf(\u0026quot;%#v \\n\u0026quot;, s) // å€¼ \u0026quot;666\u0026quot; } æ³¨:\nå¸ƒå°”ç±»å‹å˜é‡çš„é»˜è®¤å€¼ä¸ºfalseã€‚ Go è¯­è¨€ä¸­ä¸å…è®¸å°†æ•´å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¸ƒå°”å‹. å¸ƒå°”å‹æ— æ³•å‚ä¸æ•°å€¼è¿ç®—ï¼Œä¹Ÿæ— æ³•ä¸å…¶ä»–ç±»å‹è¿›è¡Œè½¬æ¢ å­—ç¬¦ä¸² å­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨\u0026quot;\ns1 := \u0026quot;ysicing\u0026quot; å¤šè¡Œå­—ç¬¦ä¸²éœ€è¦ä½¿ç”¨```\ns1 := `ç‰› ç‰› ç‰› ç‰› ` å­—ç¬¦ä¸²æ“ä½œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  package main import ( \u0026#34;fmt\u0026#34; \u0026#34;strings\u0026#34; ) func main() { a := \u0026#34;666\u0026#34; b := \u0026#34;777\u0026#34; c := a + \u0026#34;-\u0026#34; + b fmt.Println(len(a)) // len é•¿åº¦ \tfmt.Println(fmt.Sprintf(\u0026#34;%s%s\u0026#34;, a, b)) // æ‹¼æ¥ \tfmt.Println(a + b) // æ‹¼æ¥ \tfmt.Print(strings.Split(c, \u0026#34;-\u0026#34;)[0]) // åˆ†å‰² \tres := strings.Split(c, \u0026#34;-\u0026#34;) // åˆ†å‰² \tfmt.Println(res) fmt.Println(strings.HasPrefix(c, \u0026#34;6\u0026#34;), strings.HasSuffix(c, \u0026#34;6\u0026#34;)) //å‰ç¼€/åç¼€åˆ¤æ–­  s := \u0026#34;Chinaä¸‡å²\u0026#34; for i := 0; i \u0026lt; len(s); i++ { // byte \tfmt.Printf(\u0026#34;%T %v(%c) \\n\u0026#34;, s[i], s[i], s[i]) } fmt.Println() for _, j := range s { // rune \tfmt.Printf(\u0026#34;%T %v(%c) \\n\u0026#34;, j, j, j) } fmt.Println() }    uint8ç±»å‹, æˆ–è€…å« byteå‹ ä»£è¡¨äº†ASCIIç çš„ä¸€ä¸ªå­—ç¬¦. runeç±»å‹, ä»£è¡¨ä¸€ä¸ª UTF-8å­—ç¬¦(ä¸­æ–‡), å®é™…æ˜¯ä¸€ä¸ªint32. å› ä¸ºUTF8ç¼–ç ä¸‹ä¸€ä¸ªä¸­æ–‡æ±‰å­—ç”±3~4ä¸ªå­—èŠ‚ç»„æˆ,ä¸€ä¸ªruneå­—ç¬¦ç”±ä¸€ä¸ªæˆ–å¤šä¸ªbyteç»„æˆ.  æµç¨‹æ§åˆ¶ if if è¡¨è¾¾å¼1 { åˆ†æ”¯1 } else if è¡¨è¾¾å¼2 { åˆ†æ”¯2 } else{ åˆ†æ”¯3 } for 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  package main import \u0026#34;fmt\u0026#34; func main() { // åŸºæœ¬æ ¼å¼ \tfor i := 1; i \u0026lt;= 3; i++ { fmt.Println(i) } j := 1 for ; j \u0026lt;= 3; j++ { fmt.Println(j) } k := 1 for k \u0026lt;= 3 { fmt.Println(k) k++ } s := \u0026#34;HellGo\u0026#34; for i, j := range s { fmt.Printf(\u0026#34;%d---\u0026gt;%v(%T)--\u0026gt;%c\\n\u0026#34;, i, j, j, j) // rune \t} // æ­»å¾ªç¯ \t//for { \t//\tfmt.Println(\u0026#34;666\u0026#34;) \t//} }   switch case ç®€åŒ–åˆ¤æ–­\na := 4 switch a { case a \u0026lt; 1: fmt.Println(\u0026quot;1\u0026quot;) case 2,3: fmt.Println(\u0026quot;2\u0026quot;) default: fmt.Println(\u0026quot;3\u0026quot;) // 3 } b := 3 switch a { case a \u0026lt; 1: fmt.Println(\u0026quot;1\u0026quot;) case 2,3: fmt.Println(\u0026quot;2\u0026quot;) fallthrough // å¯ä»¥æ‰§è¡Œæ»¡è¶³æ¡ä»¶çš„caseçš„ä¸‹ä¸€ä¸ªcase, äº†è§£å³å¯ default: fmt.Println(\u0026quot;3\u0026quot;) } // 23 goto 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  func main() { for i := 1; i \u0026lt;= 9999; i++ { for j := 3000; j \u0026lt;= i; j++ { if j \u0026lt; i { fmt.Printf(\u0026#34;%d * %d = %d \u0026#34;, i, j, i*j) } else if j == i { fmt.Printf(\u0026#34;%d * %d = %d\\n\u0026#34;, i, j, i*j) goto breakTag } } } breakTag: // label \tfmt.Println(\u0026#34;end\u0026#34;) }   è¿ç®—ç¬¦ ç®—æ•°è¿ç®—ç¬¦: + - * / %\nå…³ç³»è¿ç®—ç¬¦: == != \u0026gt; \u0026gt;= \u0026lt; \u0026laquo; (ç»“æœä¸ºboolå€¼)\né€»è¾‘è¿ç®—ç¬¦: \u0026amp;\u0026amp; || ! (ç»“æœä¸ºboolå€¼)\nä½è¿ç®—ç¬¦: \u0026amp; (ç›¸ä¸ åŒä¸º1ä¸º1)ï½œ(ç›¸æˆ– æœ‰1ä¸º1) ^ï¼ˆç›¸å¼‚ æˆ–ä¸åŒä¸º1ï¼‰ \u0026laquo; (ä¹˜2çš„næ¬¡æ–¹) \u0026raquo; (é™¤2çš„næ¬¡æ–¹)\nèµ‹å€¼è¿ç®—ç¬¦: å…ˆå…¶ä»–è¿ç®—å†èµ‹å€¼\n5 \u0026lt;\u0026lt; 2 // 5 --- 101 å·¦ç§» 2 10100 --- 10 5 * 2^ 1 5 \u0026gt;\u0026gt; 2 // 5 --- 101 å³ç§» 2 001 --- 1 æ³¨: ++,-- å•ç‹¬è¯­å¥ï¼Œä¸æ˜¯è¿ç®—ç¬¦\næ•°ç»„ var æ•°ç»„å˜é‡å [å…ƒç´ æ•°é‡]T // ä¸€æ—¦å®šä¹‰ï¼Œé•¿åº¦ä¸èƒ½å˜ var a [3]int æ•°ç»„åˆå§‹åŒ–\nvar a1 [3]int //æ•°ç»„ä¼šåˆå§‹åŒ–ä¸ºintç±»å‹çš„é›¶å€¼ var a2 = [3]int{1,2} //ä½¿ç”¨æŒ‡å®šçš„åˆå§‹å€¼å®Œæˆåˆå§‹åŒ– var a3 = [...]int{1, 2} // è®©ç¼–è¯‘å™¨æ ¹æ®åˆå§‹å€¼çš„ä¸ªæ•°è‡ªè¡Œæ¨æ–­æ•°ç»„çš„é•¿åº¦ a4 := [...]int{1: 1, 3: 5} // æŒ‡å®šç´¢å¼•å€¼çš„æ–¹å¼æ¥åˆå§‹åŒ–æ•°ç»„ [0, 1, 0 ,3] æ•°ç»„éå†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  package main import \u0026#34;fmt\u0026#34; func main() { var a = [...]int{1, 2, 3, 4, 5} // forå¾ªç¯éå† \tfor i := 0; i \u0026lt; len(a); i++ { fmt.Println(a[i]) } // range \tfor i, j := range a { fmt.Println(i, j) } b := [...][2]int{ {1,2}, {2,1}, } for _, i := range b { for _, j := range i { fmt.Printf(\u0026#34;%d\\t\u0026#34;, j) } } }    æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œèµ‹å€¼å’Œä¼ å‚ä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ã€‚å› æ­¤æ”¹å˜å‰¯æœ¬çš„å€¼ï¼Œä¸ä¼šæ”¹å˜æœ¬èº«çš„å€¼ã€‚\n åˆ‡ç‰‡slice åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‹¥æœ‰ç›¸åŒç±»å‹å…ƒç´ çš„å¯å˜é•¿åº¦çš„åºåˆ—\nvar åˆ‡ç‰‡å []åˆ‡ç‰‡ç±»å‹ var name []string # åŠ¨æ€åˆ›å»º make([]T, size, cap) // T ç±»å‹ï¼Œsize é•¿åº¦ï¼Œ capå®¹é‡(ä»ç¬¬ä¸€ä¸ªåˆ°æœ€åå®¹é‡æ•°)ï¼Œcap å¯çœå´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  package main import \u0026#34;fmt\u0026#34; func main() { //var a []int \tvar c = []string{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;} fmt.Println(len(c), cap(c)) d := make([]int, 2, 10) fmt.Println(len(d), cap(d)) e := d[3:6] fmt.Println(len(e), cap(e)) // 3ï¼Œ 3-10 7  s1 := make([]int, 3) // [0,0,0]  s2 := s1 // æ‹·è´å‰åä¸¤ä¸ªå˜é‡å…±äº«åº•å±‚æ•°ç»„ï¼Œå¯¹ä¸€ä¸ªåˆ‡ç‰‡çš„ä¿®æ”¹ä¼šå½±å“å¦ä¸€ä¸ªåˆ‡ç‰‡çš„å†…å®¹ \ts2[0] = 100 fmt.Println(s1) fmt.Println(s2) // éå†å’Œforä¸€æ ·  for i := 0; i \u0026lt; len(s1); i++ { fmt.Printf(\u0026#34;%d\\t\u0026#34;, s1[i]) } for _, i := range s2 { fmt.Printf(\u0026#34;%d\\t\u0026#34;, i) } }    åˆ‡ç‰‡çš„æœ¬è´¨å°±æ˜¯å¯¹åº•å±‚æ•°ç»„çš„å°è£…\n append 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  package main import \u0026#34;fmt\u0026#34; func main() { var num []int for i := 0; i \u0026lt; 20; i++ { // è¿½åŠ ä¸€ä¸ªå…ƒç´  \tnum = append(num, i) fmt.Printf(\u0026#34;%v len:%d cap:%d ptr:%p\\n\u0026#34;, num, len(num), cap(num), num) } // è¿½åŠ å¤šä¸ªå…ƒç´   num = append(num, 1, 2, 3) fmt.Printf(\u0026#34;%v, \\n\u0026#34;, num) num1 := []int{99, 98} // è¿½åŠ åˆ‡ç‰‡ \tnum = append(num, num1...) fmt.Println(num) }   copy copy(ç›®æ ‡åˆ‡ç‰‡,æºåˆ‡ç‰‡) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  func main() { // copy()å¤åˆ¶åˆ‡ç‰‡ \ta := []int{1, 2, 3, 4, 5} c := make([]int, 5, 5) copy(c, a) //ä½¿ç”¨copy()å‡½æ•°å°†åˆ‡ç‰‡aä¸­çš„å…ƒç´ å¤åˆ¶åˆ°åˆ‡ç‰‡c \tfmt.Println(a) //[1 2 3 4 5] \tfmt.Println(c) //[1 2 3 4 5] \tc[0] = 1000 fmt.Println(a) //[1 2 3 4 5]  fmt.Println(c) //[1000 2 3 4 5]  var a = make([]string, 5, 10) // å·²ç»æœ‰5ä¸ªäº† \tfor i := 0; i \u0026lt; 10; i++ { a = append(a, fmt.Sprintf(\u0026#34;%v\u0026#34;, i)) } fmt.Println(a, cap(a), len(a)) // [ 0 1 2 3 4 5 6 7 8 9] 20 15 }   æŒ‡é’ˆ  å–åœ°å€ \u0026amp;a æ ¹æ®åœ°å€å–å€¼ *b  make \u0026amp; new éƒ½ç”¨æ¥ç”³è¯·å†…å­˜\nmake: sliceï¼Œmapï¼Œ chanç”³è¯·å†…å­˜ï¼Œè¿”å›ç±»å‹æœ¬èº« new: åŸºæœ¬æ•°æ®ç±»å‹ç”³è¯·å†…å­˜, è¿”å›æŒ‡é’ˆ, ä¸”å†…å­˜å¯¹åº”çš„å€¼ä¸ºç±»å‹é›¶å€¼ a := new(int) map æ•£åˆ—è¡¨(hash)å®ç°, æ— åºçš„åŸºäºkey-valueçš„æ•°æ®ç»“æ„,å¼•ç”¨ç±»å‹ï¼Œå¿…é¡»åˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨.\nmap[KeyType]ValueType make(map[keytype]valuetype, [cap]) code := make(map[string]string, 10) code[\u0026quot;a\u0026quot;] = \u0026quot;a\u0026quot; code[\u0026quot;b\u0026quot;] = \u0026quot;b\u0026quot; # åˆ¤æ–­ å€¼æ˜¯å¦å­˜åœ¨ value, ok := map[key] if ok { // å­˜åœ¨ } else { // ä¸å­˜åœ¨ } // å¾ªç¯ for k, v := range map { // k,v vå¯çœç•¥ } å‡½æ•° func å‡½æ•°å(å‚æ•°)(è¿”å›å€¼){ } ç¤ºä¾‹\nfunc sum1(x, y int) int { sum := x + y return sum } // è¿”å›å€¼å®šä¹‰äº†è¿”å›å€¼åï¼Œreturnå¯çœå´ func sum2(x, y int) (sum int) { sum = x + y return } // å¯å˜å‚æ•°ï¼Œå¯å˜å‚æ•°å¯æœ‰å¯æ—  func sum3(x int, y ...int) { fmt.Println(x) fmt.Println(y) // åˆ‡ç‰‡ } func main() { r1 := sum1(1, 2) r2 := sum2(1, 2) fmt.Println(r1, r2) sum3(1) // 1 [] sum3(1, 2) 1 [2] sum3(1, 2, 3) 1 [2,3] } defer å»¶è¿Ÿå¤„ç†, å¤šä¸ªdefer æŒ‰ç…§å…ˆè¿›åå‡ºå¤„ç†ã€‚\nå‡½æ•°returnåˆ†æˆä¸¤æ­¥\n è¿”å›å€¼èµ‹å€¼ defer return  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63  package main import \u0026#34;fmt\u0026#34; func deferdemo(name string) { fmt.Println(name) } func f1() int { x := 5 defer func() { x++ // ä¿®æ”¹xä¸æ˜¯ è¿”å›å€¼ \t}() // è¿”å›å€¼èµ‹å€¼ 5 \t// ä¿®æ”¹xå€¼ä¸º 6 \t// retrun 5 \treturn x } func f2() (x int) { defer func() { x++ }() // è¿”å›å€¼èµ‹å€¼ x=5 \t// ä¿®æ”¹xå€¼ä¸º x=6 \t// return 6  return 5 // è¿”å›å€¼ } func f3() (y int) { x := 5 defer func() { x++ }() // y = x = 5 \t// x = 6 \t// return y = 6  return x } func f4() (x int) { defer func(x int) { x++ }(x) // x = 5 \t// å‰¯æœ¬ x = 6 \t// return x \treturn 5 } func main() { deferdemo(\u0026#34;666\u0026#34;) defer deferdemo(\u0026#34;777\u0026#34;) deferdemo(\u0026#34;888\u0026#34;) defer deferdemo(\u0026#34;999\u0026#34;) fmt.Println(f1(), f2(), f3(), f4()) // 5,6,5,5  }   åŒ¿åå‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 13  // å¤šæ¬¡æ‰§è¡Œ \te1 := func(x, y int) { fmt.Println(x) fmt.Println(y) fmt.Println(x + y) } e1(2, 4) // ç«‹å³æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡ \tfunc(x, y int) { fmt.Println(x * y) }(1, 2)   é—­åŒ…  å‡½æ•°ä½œä¸ºè¿”å›å€¼ å¤–éƒ¨å˜é‡å¼•ç”¨  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  package main import \u0026#34;strings\u0026#34; import \u0026#34;fmt\u0026#34; // checkMail func checkMail(domain string) func(string) string { return func(name string) string { if strings.HasSuffix(name, domain) { return name } return name + \u0026#34;@\u0026#34; + domain } } func main() { talkFunc := checkMail(\u0026#34;@ysicing.me\u0026#34;) fmt.Println(talkFunc(\u0026#34;i\u0026#34;)) fmt.Println(talkFunc(\u0026#34;root@ysicing.me\u0026#34;)) }   panic/recover  recover()å’Œdeferä¸€èµ·ä½¿ç”¨ deferåœ¨panicè¯­å¥å‰  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  package main import \u0026#34;fmt\u0026#34; func funcA() { fmt.Println(\u0026#34;a\u0026#34;) } func funcB() { defer func() { err := recover() fmt.Println(err) }() panic(\u0026#34;error\u0026#34;) fmt.Println(\u0026#34;b\u0026#34;) } func funC() { fmt.Println(\u0026#34;c\u0026#34;) } func main() { funcA() funcB() funC() }   å ä½ç¬¦ \tm1 := make(map[string]int, 5) m1[\u0026quot;demo\u0026quot;] = 1 fmt.Printf(\u0026quot;%v\\n\u0026quot;, m1) // å€¼çš„é»˜è®¤æ ¼å¼ fmt.Printf(\u0026quot;%+v\\n\u0026quot;, m1) // ç±»ä¼¼%v, ç»“æ„ä½“ä¼šåŠ å­—æ®µå fmt.Printf(\u0026quot;%#v\\n\u0026quot;, m1)\t// map[string]int{\u0026quot;demo\u0026quot;:1} å€¼Goè¯­æ³• fmt.Printf(\u0026quot;%T\\n\u0026quot;, m1) // map[string]int æ‰“å°ç±»å‹ ç»“æ„ä½“ ","description":"GoåŸºç¡€","id":21,"section":"posts","tags":["go"],"title":"GoåŸºç¡€","uri":"https://ysicing.me/posts/go-study-ch1/"},{"content":"éƒ¨ç½²docker registry  æœ€è¿‘å¤§é™†pushé•œåƒè€æ˜¯è¶…æ—¶ï¼Œäºæ˜¯æƒ³è‡ªå»ºä¸€ä¸ªï¼Œä½¿ç”¨helmæ–¹å¼, å’Œdroneå®‰è£…æ–¹å¼ç±»ä¼¼\n éƒ¨ç½² helm pull stable/docker-registry tar xf docker-registry-1.9.1.tgz \u0026amp;\u0026amp; cd docker-registry/ # ç¼–è¾‘values.yaml,è‡ªå®šä¹‰é…ç½® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64  # æ³¨é‡Šéƒ¨åˆ†ä¸ºè°ƒæ•´replicaCount:1updateStrategy:podAnnotations:{}podLabels:{}image:repository:registrytag:2.7.1pullPolicy:IfNotPresentservice:name:registrytype:ClusterIPport:5000annotations:{}ingress:enabled:true# å¯ç”¨ingresspath:/hosts:- hub.local.godu.dev# åŸŸåannotations:nginx.ingress.kubernetes.io/proxy-body-size:\u0026#34;0\u0026#34;# k8s ingress 413nginx.org/client-max-body-size:\u0026#34;0\u0026#34;# nginxnc ingress 413labels:{}tls:- secretName:godu.dev# è¯ä¹¦hosts:- hub.local.godu.dev# åŸŸåresources:{}persistence:accessMode:\u0026#39;ReadWriteOnce\u0026#39;enabled:truesize:5GiexistingClaim:registry# åŒdronestorage:filesystemsecrets:haSharedSecret:\u0026#34;\u0026#34;htpasswd:\u0026#34;\u0026#34;configData:version:0.1log:fields:service:registrystorage:cache:blobdescriptor:inmemoryhttp:addr::5000headers:X-Content-Type-Options:[nosniff]health:storagedriver:enabled:trueinterval:10sthreshold:3securityContext:enabled:truerunAsUser:1000fsGroup:1000priorityClassName:\u0026#34;\u0026#34;podDisruptionBudget:{}nodeSelector:{}tolerations:[]extraVolumeMounts:[]extraVolumes:[]  deploy\nhelm install registry -f values.yaml stable/docker-registry ","description":"helméƒ¨ç½²docker registry","id":22,"section":"posts","tags":[""],"title":"helméƒ¨ç½²docker registry","uri":"https://ysicing.me/posts/helm-docker-registry/"},{"content":"ä½¿ç”¨Helmå®‰è£…Drone  ä¸€ä¸ªæ¯”è¾ƒçƒ­é—¨çš„è½»é‡çº§CI/CDå¼€æºå·¥å…·ï¼šDrone\n ç®€ä»‹  Droneæ˜¯ç”¨Goå¼€å‘çš„å¼€æºè½»é‡çº§CI/CDå·¥å…· ä½¿ç”¨ç®€å•çš„ YAML é…ç½®æ–‡ä»¶æ¥å®šä¹‰å’Œæ‰§è¡Œ Docker å®¹å™¨ä¸­å®šä¹‰çš„ Pipeline æ„æˆç®€å•,æœåŠ¡å ç”¨èµ„æºå°‘  Serverç«¯è´Ÿè´£èº«ä»½è®¤è¯ï¼Œä»“åº“é…ç½®ï¼Œç”¨æˆ·ã€Secrets ä»¥åŠ Webhook ç›¸å…³çš„é…ç½® Agentç«¯ç”¨äºæ¥å—æ„å»ºçš„ä½œä¸šå’ŒçœŸæ­£ç”¨äºè¿è¡Œçš„ Pipeline å·¥ä½œæµ   å®‰è£…ç®€å•ï¼Œæ”¯æŒä¸»æµGitæ‰˜ç®¡æœåŠ¡(github,giteaç­‰) å®˜æ–¹æ–‡æ¡£ä¹Ÿå¾ˆå…¨  ç¯å¢ƒ  helm v3.0.2 drone 1.6.1 k8s 1.17.0  å‡†å¤‡å·¥ä½œ æ³¨å†ŒGithub OAuthåº”ç”¨\nè·å–åˆ°github oauth Client ID,Client Secretç•™ç”¨ã€‚\nåˆ›å»ºæŒä¹…åŒ–å­˜å‚¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  # https://ysicing.me/hack/demo/pvc.yamlapiVersion:v1kind:PersistentVolumemetadata:name:dronepvspec:accessModes:- ReadWriteOncecapacity:storage:2GipersistentVolumeReclaimPolicy:DeletestorageClassName:nfs-testnfs:server:192.168.100.101path:/k8sdata/default-drone-pvc---kind:PersistentVolumeClaimapiVersion:v1metadata:name:dronepvcnamespace:defaultspec:accessModes:- ReadWriteOnceresources:requests:storage:2GistorageClassName:nfs-test  ç¤ºä¾‹\n# nfs åœ°å€éœ€è¦æŒ‰éœ€è°ƒæ•´ä¸€ä¸‹ kubectl apply -f https://ysicing.me/hack/demo/pvc.yaml kubectl get pvc å®‰è£…  æœ¬æ–‡ä½¿ç”¨helmæ–¹å¼å®‰è£…ï¼Œå› ä¸ºéœ€è¦å¯¹é…ç½®åšäº›è°ƒæ•´ï¼Œéœ€è¦è‡ªå®šä¹‰ä¸€äº›é…ç½®\n 1 2 3 4 5  helm repo update # è·å–æœ€æ–°çš„ç¦»çº¿droneåŒ… helm pull stable/drone tar xf drone-2.4.0.tgz \u0026amp;\u0026amp; cd drone # ç¼–è¾‘values.yaml   ç¤ºä¾‹values.yamlå¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102  # æœ‰æ³¨é‡Šçš„åœ°æ–¹è¯´æ˜æœ‰ä¿®æ”¹images:server:repository:\u0026#34;docker.io/drone/drone\u0026#34;tag:1.6.1pullPolicy:IfNotPresentagent:repository:\u0026#34;docker.io/drone/agent\u0026#34;tag:1.6.1pullPolicy:IfNotPresentdind:repository:\u0026#34;docker.io/library/docker\u0026#34;tag:18.06.1-ce-dindpullPolicy:IfNotPresentservice:httpPort:80type:ClusterIPexposeGRPC:falseingress:enabled:true# å¯ç”¨hosts:- drone.godu.dev# åŸŸåtls:- secretName:godu.dev# è¯ä¹¦ï¼Œé›†ç¾¤å†…å·²ç»è¯ä¹¦çš„secretäº†ï¼Œå¯ä»¥ä¸å¯ç”¨ï¼Œå› ä¸ºæˆ‘çš„devåŸŸåå¿…é¡»httpsè®¿é—®hosts:- drone.godu.dev# åŸŸåsourceControl:provider:github# githubsecret:github:clientID:xxx# github oauth id xxxclientSecretKey:clientSecretclientSecretValue:xxxx# github oauth secret xxxxserver:https://github.comgitlab:clientID:clientSecretKey:clientSecretclientSecretValue:server:gitea:clientID:clientSecretKey:clientSecretclientSecretValue:server:gogs:server:bitbucketCloud:clientID:clientSecretKey:clientSecretclientSecretValue:bitbucketServer:server:consumerKey:consumerKeyprivateKey:privateKeyusername:passwordKey:passwordserver:host:\u0026#34;drone.godu.dev\u0026#34;protocol:httpsrpcProtocol:httpadminUser:ysicing# github ç™»å½•åå°±å…·æœ‰ç®¡ç†å‘˜æƒé™alwaysAuth:falsekubernetes:enabled:true# è¿è¡Œ Drone çš„ä»»åŠ¡çš„æ—¶å€™å°±æ˜¯ç›´æ¥ä½¿ç”¨ Kubernetes çš„ Job èµ„æºå¯¹è±¡æ¥æ‰§è¡Œï¼Œè€Œä¸æ˜¯ Drone çš„ agent.env:DRONE_LOGS_DEBUG:\u0026#34;false\u0026#34;DRONE_DATABASE_DRIVER:\u0026#34;sqlite3\u0026#34;DRONE_DATABASE_DATASOURCE:\u0026#34;/var/lib/drone/drone.sqlite\u0026#34;annotations:{}resources:{}affinity:{}nodeSelector:{}tolerations:[]extraContainers:| extraVolumes: |agent:env:DRONE_LOGS_DEBUG:\u0026#34;false\u0026#34;replicas:1annotations:{}resources:{}livenessProbe:{}readinessProbe:{}affinity:{}nodeSelector:{}tolerations:[]dind:enabled:truedriver:overlay2resources:{}metrics:prometheus:enabled:truepersistence:enabled:trueexistingClaim:dronepvc# åˆšåˆšåˆ›å»ºçš„æŒä¹…åŒ– pvcrbac:create:trueapiVersion:v1serviceAccount:create:truename:  éƒ¨ç½²drone\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  $ helm install drone -f values.yaml stable/drone $ helm status drone NAME: drone LAST DEPLOYED: Sun Jan 5 20:30:00 2020 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: ********************************************************************************* *** PLEASE BE PATIENT: drone may take a few minutes to install *** ********************************************************************************* From outside the cluster, the server URL(s) are: http://drone.godu.dev   æœ€å\nroot@k8s.cn1:~/drone/drone# kubectl get pods -l app=drone NAME READY STATUS RESTARTS AGE drone-drone-server-5bffbc56df-qzk28 1/1 Running 0 35m root@k8s.cn1:~/drone/drone# kubectl get ing -l app=drone NAME HOSTS ADDRESS PORTS AGE drone-drone drone.godu.dev 80, 443 36m è§¦å‘CIæ„å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  # .drone.ymlkind:pipelinename:defaultsteps:- name:buildimage:golang:latestenvironment:GOPROXY:https://goproxy.cncommands:- CGO_ENABLED=0gobuild- name:dockerimage:plugins/dockersettings:repo:ysicing/godemouse_cache:trueusername:from_secret:dockeruserpassword:from_secret:dockertags:- latestwhen:event:pushbranch:master  ä»£ç åœ°å€: BeidouCloudPlatform/demo\nCliå·¥å…· brew install drone-cli export DRONE_SERVER=https://drone.godu.dev export DRONE_TOKEN=\u0026lt;token\u0026gt; drone info # ä¿®å¤webhookï¼Œå¦‚æœè°ƒæ•´äº†åŸŸåï¼Œå¯ä»¥é€šè¿‡æ­¤å‘½ä»¤ä¿®å¤webhook drone repo repair BeidouCloudPlatform/demo Jobæ¸…ç†é—®é¢˜ å› ä¸ºä½¿ç”¨Jobçš„æ–¹å¼è¿›è¡Œpiplineæ“ä½œï¼Œå¦‚æœä¸å¯ç”¨TTLAfterFinishedä¼šå¯¼è‡´jobä¸ä¼šè¢«è‡ªåŠ¨æ¸…ç†ã€‚ å¼€å¯featureè¯·å‚è€ƒ featureå¼€å¯\né»˜è®¤droneæ¸…ç†æ˜¯300s\n","description":"helméƒ¨ç½²drone","id":23,"section":"posts","tags":["drone"],"title":"helméƒ¨ç½²drone","uri":"https://ysicing.me/posts/helm-drone/"},{"content":"Ucloud ç½‘ç»œ ucloudé»˜è®¤mtuæ˜¯ 1454\næ‰€ä»¥calicoéœ€è¦æ”¹mtu\nkubectl patch configmap/calico-config -n kube-system --type merge -p '{\u0026quot;data\u0026quot;:{\u0026quot;veth_mtu\u0026quot;: \u0026quot;1404\u0026quot;}}' å‚è€ƒ Configure MTU to maximize network performance\n","description":"k8så®è·µä¹‹calico mtu","id":24,"section":"posts","tags":["calico"],"title":"k8så®è·µä¹‹calico mtu","uri":"https://ysicing.me/posts/k8s-calico-mtu/"},{"content":"æ¦‚å¿µç¯‡  Kubernetes åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•\n æ¶æ„ etcdä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ï¼› apiserveræä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ï¼› controller managerè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ï¼› schedulerè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šï¼› kubeletè´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCSIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†ï¼› Container runtimeè´Ÿè´£é•œåƒç®¡ç†ä»¥åŠPodå’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰ï¼› kube-proxyè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼› CoreDns é›†ç¾¤dnsè§£ææœåŠ¡ Ingress Controller åº”ç”¨å±‚è´Ÿè½½å‡è¡¡æä¾›å¯¹å¤–è®¿é—®æœåŠ¡ Kube-state-metrics é›†ç¾¤ç›‘æ§ Prometheus èµ„æºç›‘æ§ Dashboard Web UI Master(Control Plane)èŠ‚ç‚¹ Masteræ˜¯é›†ç¾¤çš„æ§åˆ¶å¹³é¢:\n è´Ÿè½½é›†ç¾¤çš„å…¨å±€å†³ç­–(å¦‚è°ƒåº¦ç­‰) æ¢æµ‹å“åº”é›†ç¾¤äº‹ä»¶(å¦‚æ¢æµ‹åº”ç”¨çš„å®ä¾‹æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ) é€šå¸¸masterèŠ‚ç‚¹ä¸è°ƒåº¦ä¸šåŠ¡æœåŠ¡  MasterèŠ‚ç‚¹ä¸»è¦åŒ…æ‹¬kube-apiserverã€kube-schedulerã€kube-controller-managerå’Œetcdå››ä¸ªç»„ä»¶ã€‚\n1 2 3 4 5  kube-apiserver: APIæœåŠ¡, Kubernetesæ§åˆ¶å¹³é¢çš„å‰ç«¯ï¼Œæ‰€æœ‰è¯·æ±‚å…¥å£ kube-scheduler: watch APIèµ„æºçŠ¶æ€ï¼Œæ ¹æ®ç›¸å…³æ¡ä»¶è°ƒåº¦åˆ°åˆé€‚çš„nodeèŠ‚ç‚¹åˆ›å»ºç›¸å…³èµ„æº kube-controller-manager: ç”Ÿå‘½å‘¨æœŸç®¡ç†å’ŒAPIä¸šåŠ¡é€»è¾‘(å¦‚: èŠ‚ç‚¹æ§åˆ¶å™¨,å‰¯æœ¬æ§åˆ¶å™¨) etcd: k8sæ•°æ®å­˜å‚¨ç»„ä»¶ cloud-controller-manager: äº‘æœåŠ¡å•†ç»„ä»¶ï¼Œå¯¹æ¥å„å®¶äº‘èµ„æº(äº‘æœåŠ¡å•†ç»´æŠ¤)   Worker(Node)èŠ‚ç‚¹ åŒ…æ‹¬kubeletã€kube-proxyå’ŒContainer Runtimeä¸‰ä¸ªç»„ä»¶ã€‚\nkubelet: è¿è¡Œåœ¨é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œéœ€è¦ç¡®ä¿ç›¸å…³å®¹å™¨è¿è¡Œåœ¨podä¸­ï¼› é€šè¿‡PodSpecsæ ‡ç­¾ï¼Œæè¿°å®¹å™¨çš„è¿è¡ŒçŠ¶æ€ï¼› kubeletåªç®¡ç†é€šè¿‡kubernetesåˆ›å»ºçš„å®¹å™¨ã€‚ kube-proxyï¼š æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨é›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹çš„ç½‘ç»œä»£ç†ç»„ä»¶,ä¸»è¦æ˜¯ç»´æŠ¤ç½‘ç»œè§„åˆ™ï¼Œä¿è¯é›†ç¾¤å†…å¤–ä¸Podé€šä¿¡ã€‚ Container Runtimeï¼š æ”¯æŒè¿è¡Œå®¹å™¨åº•å±‚ç¯å¢ƒçš„è½¯ä»¶ï¼› æ”¯æŒï¼š CRI(Container Runtime Interface) å¦‚Docker/Containerdã€‚ æ ¸å¿ƒAddons  Addons ä½¿ç”¨ Kubernetes èµ„æºï¼ˆDaemonSetã€Deploymentç­‰ï¼‰å®ç°é›†ç¾¤çš„åŠŸèƒ½ç‰¹æ€§ã€‚ç”±äºä»–ä»¬æä¾›é›†ç¾¤çº§åˆ«çš„åŠŸèƒ½ç‰¹æ€§ï¼Œaddonsä½¿ç”¨åˆ°çš„Kubernetesèµ„æºéƒ½æ”¾ç½®åœ¨ kube-systemåç§°ç©ºé—´ä¸‹ã€‚\n  CNI(Calicoç­‰) DNS(CoreDNSç­‰) UI(Dashboard) \u0026hellip;  å®˜æ–¹Addons\n","description":"k8så®è·µä¹‹åŸºç¡€æ¦‚å¿µ","id":25,"section":"posts","tags":["kubernetes"],"title":"k8så®è·µä¹‹åŸºç¡€æ¦‚å¿µ","uri":"https://ysicing.me/posts/k8s-intro-base/"},{"content":"å®‰è£…linkerd v2 å®‰è£…äºŒè¿›åˆ¶ docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir è·å–ç›¸å…³é•œåƒ 1 2 3  linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | xargs -I {} docker pull {} linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | grep \u0026#34;gcr.io/linkerd-io\u0026#34; | awk -F/ \u0026#39;{print $NF}\u0026#39; | xargs -I {} docker tag gcr.io/linkerd-io/{} ysicing/linkerd-io-{} linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | grep \u0026#34;gcr.io/linkerd-io\u0026#34; | awk -F/ \u0026#39;{print $NF}\u0026#39; | xargs -I {} docker push ysicing/linkerd-io-{}   åŒæ­¥åˆ°å†…ç½‘ç¯å¢ƒ 1 2 3  linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | grep \u0026#34;gcr.io/linkerd-io\u0026#34; | awk -F/ \u0026#39;{print $NF}\u0026#39; | xargs -I {} docker pull ysicing/linkerd-io-{} linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | grep \u0026#34;gcr.io/linkerd-io\u0026#34; | awk -F/ \u0026#39;{print $NF}\u0026#39; | xargs -I {} docker tag ysicing/linkerd-io-{} hub.godu.dev/linkerd/{} linkerd install --ignore-cluster | grep image: | sed -e \u0026#39;s/^ *//\u0026#39; | sort | uniq | awk \u0026#39;{print $2}\u0026#39; | grep \u0026#34;gcr.io/linkerd-io\u0026#34; | awk -F/ \u0026#39;{print $NF}\u0026#39; | xargs -I {} docker push hub.godu.dev/linkerd/{}   å®‰è£… 1 2 3  linkerd check --pre linkerd install --registry hub.godu.dev/linkerd | kubectl apply -f - linkerd check   å¯ç”¨ # å·²æœ‰åº”ç”¨ kubectl get -n emojivoto deploy/web -o yaml | linkerd inject - | kubectl apply -f - # go åˆ›å»ºåº”ç”¨ func (app *TalkController) CustomAnnotations() map[string]string { return map[string]string{ \u0026quot;linkerd.io/inject\u0026quot;: \u0026quot;enabled\u0026quot;, //\u0026quot;prometheus.io/port\u0026quot;: \u0026quot;12306\u0026quot;, //\u0026quot;prometheus.io/scrape\u0026quot;: \u0026quot;true\u0026quot;, } } # deploy template: metadata: annotations: linkerd.io/inject: enabled prometheus.io/port: \u0026quot;80\u0026quot; prometheus.io/scrape: \u0026quot;true\u0026quot; ","description":"k8så®è·µä¹‹å®‰è£…linkerdv2","id":26,"section":"posts","tags":["linkerd"],"title":"k8så®è·µä¹‹å®‰è£…linkerdv2","uri":"https://ysicing.me/posts/k8s-linkerd-install/"},{"content":"k8s èµ„æºç®¡ç†çš„æƒé™æ§åˆ¶ åœ¨k8sä¸­ï¼Œç”±ç³»ç»Ÿè‡ªèº«çš„æ¥å£æ¥åˆ›å»ºå’Œç®¡ç†çš„è´¦å·ç±»å‹åªæœ‰ä¸€ç§ï¼Œå«åšServiceAccountã€‚\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹ç›®å‰ç³»ç»Ÿå·²æœ‰çš„ServiceAccountï¼Œç®€å†™sa\nâœ ~ kubectl get sa NAME SECRETS AGE default 1 2d8h æŸ¥çœ‹saå…·ä½“å®šä¹‰\nâœ ~ kubectl get sa default -o yaml apiVersion: v1 kind: ServiceAccount metadata: creationTimestamp: \u0026quot;2020-01-05T06:27:59Z\u0026quot; name: default namespace: default resourceVersion: \u0026quot;428\u0026quot; selfLink: /api/v1/namespaces/default/serviceaccounts/default uid: 9881e9a3-4097-44b4-a9e3-e5a9d4e516e0 secrets: - name: default-token-8xcpl # å¼•ç”¨äº†åä¸ºdefault-token-8xcplçš„secrets âœ ~ kubectl get secrets default-token-8xcpl -o yaml apiVersion: v1 data: ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRJd01ERXdOVEEyTWpjeE5Gb1lEekl4TVRneE1qRXlNRFl5TnpFMFdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCnoyS0ttbzh2emdXWE1WR09hSy9DeWk2cGZ2T0psWUMxd1paRTdWS3IwTENFZDBQWXVKbk10NStQdVhKUkw4OFUKK2t2U0RGRm1RS3J6QUhCN0IwNGVybEwyd0NHeDZwa2FIOFBMMTJqKzdUUW5VS2doa1lHb1ZxUjNKV3NTSS9jcwo0ampGWTJyVmY3Z3pDNG9LbHlBc2VRdXFRaERPV004emtCalFYa3gyZVdnSSthRFNpOHd5SHNSNXZwK0Y4TkNOCnEreHY3bFczOERBcTB2SGlSYnBlZHVCTWpUTksyaHlYYWpyeFpWNTZxTTdnRUJWcVBjRCtUWmQySGs2SGQ2dlgKaGhTeTdUQ3lOY1kvbi9HNjRscTBUaG9JZTBWaFBncG8rU3JzRXVOVTBqWlFmRllDMDRWZlluSU0yZmxuSkY5YQpVWjkraVEza25ZR3RmSTA4cXRScjh3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFOWHdQUkRLd05yMEFzMVpiN1NWWnVQeSsKMVhtbWhWS3dVUmVROXF2QjQwWU5sTVBKMVVqbUNyVmdVRmM4WldmUEhwTmZ6Z2dXTUJUbFFrZDhOK1NhTHB3bAo0bTJtMlpmTTV6Q3R2QVg2MzhHZUVPYTViVkNHcXhudUNVOWQxb2p0M2JZSkYwZGxSMy9VY3FpaDRaeEdUL0syCkJweEZ5QXBRRUZ0elhVZmE0dTBYcFBwUU1aa2txK2hkd01mZjQ3VlBma3NUazUvN2ZaK08vUXk4SElSM00wWFEKUWZyRWpIRXRwL2VSU1hENm95ZHF4R2RKL0pOWU4rKzJYU05lRm51bDFOakh2bG1IT1JpRDI2S2Rqb24vT1Y5cgplYlp0T1oxRmJPVVVFNktJRG9CWTJIK0JCWVppNkwzajJBRkpFTFozWE5tNUdlSTB0NGduWW8zSXU0SnRmZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K namespace: ZGVmYXVsdA== token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUnBTa2RCWlZwcVMwOVdOVmxCVDJkemQySTBkRlpPVVVkRlVHOVZYMXB0VDA1Q1dXeG5UVGhhTVdjaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUprWldaaGRXeDBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbVJsWm1GMWJIUXRkRzlyWlc0dE9IaGpjR3dpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1dVlXMWxJam9pWkdWbVlYVnNkQ0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG5WcFpDSTZJams0T0RGbE9XRXpMVFF3T1RjdE5EUmlOQzFoT1dVekxXVTFZVGxrTkdVMU1UWmxNQ0lzSW5OMVlpSTZJbk41YzNSbGJUcHpaWEoyYVdObFlXTmpiM1Z1ZERwa1pXWmhkV3gwT21SbFptRjFiSFFpZlEub1NwZ0w4V3liYlJEb0tvYUpxclJ1RkxGOUN6SW1tdlo3VEtWU1RXdVpnWVpCWTRRZ092NjVCbGFLTF9qQU9DSFNyQzd6WW5pSjlXVDVCcVd2N3dfQU9XdEhURVJWSU00Y3I5LXh6LUxMRHZ6bl9qZlNIR0VoSnBPZHZnMGppRFZydi0xanJOb2g1S3VKMGw0TlNULVBnemtUQTU5bWhfNzdodFRtdzJfaDJCWHNDWDBROFg1dm5uMTBMVFJaeHRtNnZTank5dVRIcUZpa0pkU2pTX2c1SjJiS3BXVW1sZnl6OWNKTkliNWhDS0hYVEYyWGlDaG9vMlI3RmdvcHc5X1ltNWxLc2JudGh0bHA5TDUzZ2M2UV9IUkRvb05hSk04RHZndTNybXJheUhPa193RkFTbE1XZ2NkZzF0OGNjYXIwM1V0aWZ5RElDS2s1OTBMM2d2T0hR kind: Secret metadata: annotations: kubernetes.io/service-account.name: default kubernetes.io/service-account.uid: 9881e9a3-4097-44b4-a9e3-e5a9d4e516e0 creationTimestamp: \u0026quot;2020-01-05T06:27:59Z\u0026quot; name: default-token-8xcpl namespace: default resourceVersion: \u0026quot;421\u0026quot; selfLink: /api/v1/namespaces/default/secrets/default-token-8xcpl uid: 2f07379e-80bb-4c24-a3e3-8a37d1c4c9fb type: kubernetes.io/service-account-token åˆ›å»ºsa âœ ~ kubectl create sa ysicing serviceaccount/ysicing created âœ ~ kubectl get sa ysicing -o yaml apiVersion: v1 kind: ServiceAccount metadata: creationTimestamp: \u0026quot;2020-01-07T14:40:07Z\u0026quot; name: ysicing namespace: default resourceVersion: \u0026quot;134248\u0026quot; selfLink: /api/v1/namespaces/default/serviceaccounts/ysicing uid: e5f19802-a196-47d6-b194-3684642357ef secrets: - name: ysicing-token-zvgr4 # è·å–token,è¿™é‡Œtokenæ˜¯åŸå§‹tokenï¼Œæœªç»è¿‡base64åŠ å¯† kubectl describe secrets ysicing-token-zvgr4 æµ‹è¯•è¯·æ±‚k8s api,å‘ç°è¿˜æ˜¯403.\nâœ ~ curl -k https://192.168.100.101:6443/healthz/ping -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ' { \u0026quot;kind\u0026quot;: \u0026quot;Status\u0026quot;, \u0026quot;apiVersion\u0026quot;: \u0026quot;v1\u0026quot;, \u0026quot;metadata\u0026quot;: { }, \u0026quot;status\u0026quot;: \u0026quot;Failure\u0026quot;, \u0026quot;message\u0026quot;: \u0026quot;forbidden: User \\\u0026quot;system:serviceaccount:default:ysicing\\\u0026quot; cannot get path \\\u0026quot;/healthz/ping\\\u0026quot;\u0026quot;, \u0026quot;reason\u0026quot;: \u0026quot;Forbidden\u0026quot;, \u0026quot;details\u0026quot;: { }, \u0026quot;code\u0026quot;: 403 } k8så¯¹èµ„æºæ“ä½œæƒé™åˆ’åˆ†çš„æ¯”è¾ƒè¯¦ç»†:\n å†™æƒé™  create update delete patch   è¯»æƒé™  get list watch    é…ç½®sa ysicingè®¿é—®èµ„æº,å³é…ç½® .kube/config\n# é…ç½®sa ysicing tokené‰´æƒä¿¡æ¯ kubectl config set-credentials ysicing --token eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ User \u0026quot;ysicing\u0026quot; set. # é…ç½®é›†ç¾¤è®¿é—®ä¿¡æ¯ # .kube/ca.crt ä»192.168.100.101:/etc/kubernetes/pki/ca.crtè·å–çš„ âœ ~ kubectl config set-cluster local --server https://192.168.100.101:6443 --certificate-authority .kube/ca.crt --embed-certs=true Cluster \u0026quot;local\u0026quot; set. # é…ç½®context, å°†cluster \u0026amp; user ç»‘å®š âœ ~ kubectl config set-context local-ctx --cluster local --user ysicing Context \u0026quot;local-ctx\u0026quot; created. # åˆ‡æ¢ctx âœ ~ kubectl config use-context local-ctx Switched to context \u0026quot;local-ctx\u0026quot;. è¯·æ±‚æ¥å£\nâœ ~ kubectl get pods Error from server (Forbidden): pods is forbidden: User \u0026quot;system:serviceaccount:default:ysicing\u0026quot; cannot list resource \u0026quot;pods\u0026quot; in API group \u0026quot;\u0026quot; in the namespace \u0026quot;default\u0026quot; æˆæƒé…ç½®  åˆ›å»ºè§’è‰²ï¼Œå®šä¹‰èµ„æºæ“ä½œæƒé™(ClusterRole/Role) è§’è‰²ç»‘å®šï¼Œå°†è§’è‰²ä¸Saç»‘å®š(ClusterRoleBinding/RoleBinding)  # åˆ›å»ºè§’è‰² âœ ~ kubectl create role ysicing-role --resource pod,service,deployment,secret,ingress --verb create,update,delete,patch,get,list,watch role.rbac.authorization.k8s.io/ysicing-role created âœ ~ kubectl get roles NAME AGE ysicing-role 34s # è§’è‰²ç»‘å®š âœ ~ kubectl create rolebinding ysbot.ysicing-binding --role ysicing-role --serviceaccount default:ysicing rolebinding.rbac.authorization.k8s.io/ysbot.ysicing-binding created å†æ¬¡è·å–podsä¿¡æ¯\nâœ ~ kubectl config use-context local-ctx Switched to context \u0026quot;local-ctx\u0026quot;. âœ ~ kubectl get pods NAME READY STATUS RESTARTS AGE demo-deployment-6c5664f4d6-s6w8v 1/1 Running 0 2d4h å†æ¬¡è¯·æ±‚https://192.168.100.101:6443/healthz/pingå‘ç°ä¾æ—§403ï¼Œé‚£ä¹ˆç»™ysicing saé€šè¿‡ClusterRoleBinding æˆäºˆä¸€ä¸ªåä¸º cluster-admin çš„ ClusterRole\nâœ ~ kubectl config use-context kubernetes-admin@kubernetes Switched to context \u0026quot;kubernetes-admin@kubernetes\u0026quot;. âœ ~ kubectl create clusterrolebinding cluster-ysicing --clusterrole cluster-admin --serviceaccount default:ysicing clusterrolebinding.rbac.authorization.k8s.io/cluster-ysicing created âœ ~ curl -k https://192.168.100.101:6443/healthz/ping -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ' ok% # çœŸé¦™å“ˆå“ˆå“ˆå“ˆ cluster-adminæƒé™ç‰¹åˆ«å¤§,å®é™…ä½¿ç”¨è¿˜éœ€è¦è°¨æ…æ“ä½œã€‚\n# å¯ä»¥æŸ¥çœ‹å…·ä½“å®šä¹‰ kubectl get role ysicing-role ","description":"k8så®è·µä¹‹èµ„æºç®¡ç†çš„æƒé™æ§åˆ¶","id":27,"section":"posts","tags":["kubernetes"],"title":"k8så®è·µä¹‹èµ„æºç®¡ç†çš„æƒé™æ§åˆ¶","uri":"https://ysicing.me/posts/k8s-sa/"},{"content":"éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26  # https://ysicing.me/hack/demo/deploy.yamlapiVersion:apps/v1#ä¸k8sé›†ç¾¤ç‰ˆæœ¬æœ‰å…³ï¼Œä½¿ç”¨ kubectl api-versions å³å¯æŸ¥çœ‹å½“å‰é›†ç¾¤æ”¯æŒçš„ç‰ˆæœ¬kind:Deployment#è¯¥é…ç½®çš„ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Deploymentmetadata:#è¯‘åä¸ºå…ƒæ•°æ®ï¼Œå³ Deployment çš„ä¸€äº›åŸºæœ¬å±æ€§å’Œä¿¡æ¯namespace:default# å‘½åç©ºé—´name:demo-deployment#Deployment çš„åç§°labels:#æ ‡ç­¾ï¼Œå¯ä»¥çµæ´»å®šä½ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºï¼Œå…¶ä¸­keyå’Œvalueå‡å¯è‡ªå®šä¹‰ï¼Œå¯ä»¥å®šä¹‰å¤šç»„ï¼Œç›®å‰ä¸éœ€è¦ç†è§£app:demo#ä¸ºè¯¥Deploymentè®¾ç½®keyä¸ºappï¼Œvalueä¸ºdemoçš„æ ‡ç­¾spec:#è¿™æ˜¯å…³äºè¯¥Deploymentçš„æè¿°ï¼Œå¯ä»¥ç†è§£ä¸ºä½ æœŸå¾…è¯¥Deploymentåœ¨k8sä¸­å¦‚ä½•ä½¿ç”¨replicas:1#ä½¿ç”¨è¯¥Deploymentåˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹#strategy: #æ»šåŠ¨ç­–ç•¥ æœ€å¤šæ–°å¢ä¸€ä¸ªï¼Œæœ€å°ä¸‹çº¿ä¸€ä¸ª# rollingUpdate:# maxSurge: 1# maxUnavailable: 1# type: RollingUpdateselector:#æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä¸ä¸Šé¢çš„æ ‡ç­¾å…±åŒä½œç”¨ï¼Œç›®å‰ä¸éœ€è¦ç†è§£matchLabels:#é€‰æ‹©åŒ…å«æ ‡ç­¾app:demoçš„èµ„æºapp:demotemplate:#è¿™æ˜¯é€‰æ‹©æˆ–åˆ›å»ºçš„Podçš„æ¨¡æ¿metadata:#Podçš„å…ƒæ•°æ®labels:#Podçš„æ ‡ç­¾ï¼Œä¸Šé¢çš„selectorå³é€‰æ‹©åŒ…å«æ ‡ç­¾app:demoçš„Podapp:demospec:#æœŸæœ›Podå®ç°çš„åŠŸèƒ½ï¼ˆå³åœ¨podä¸­éƒ¨ç½²ï¼‰containers:#ç”Ÿæˆcontainerï¼Œä¸dockerä¸­çš„containeræ˜¯åŒä¸€ç§- name:godemo#containerçš„åç§°image:ysicing/godemo#ä½¿ç”¨é•œåƒgodemoåˆ›å»ºcontainerï¼Œè¯¥containeré»˜è®¤80ç«¯å£å¯è®¿é—®  éƒ¨ç½²åº”ç”¨\nkubectl apply -f https://ysicing.me/hack/demo/deploy.yaml deployment.apps/demo-deployment created æŸ¥çœ‹éƒ¨ç½²ç»“æœ\n# é»˜è®¤nså°±æ˜¯defaultå¯çœå´ kubectl get deployments -n default NAME READY UP-TO-DATE AVAILABLE AGE demo-deployment 1/1 1 1 2m54s kubectl get pods NAME READY STATUS RESTARTS AGE demo-deployment-59cd96d4d5-cjjwr 1/1 Running 0 3m17s Deploymentæ˜¯podæ§åˆ¶å™¨\nå¸¸è§podæ§åˆ¶å™¨\nå®ˆæŠ¤å‹: æ— çŠ¶æ€éç³»ç»Ÿçº§åº”ç”¨: Deployment (å¦‚nginx) æ— çŠ¶æ€ç³»ç»Ÿçº§åº”ç”¨: DaemonSet (å¦‚æ—¥å¿—ç›‘æ§æ”¶é›†ç«¯ï¼Œæ¯ä¸ªnodeèŠ‚ç‚¹ä»…ä¸”éœ€è¦è·‘ä¸€ä¸ªpod) æœ‰çŠ¶æ€åº”ç”¨: StatefulSet (æ•°æ®åº“ç±»åº”ç”¨å¦‚mysqlç­‰) éå®ˆæŠ¤å‹: ä¸€æ¬¡æ€§ä»»åŠ¡: Job å®šæ—¶ä»»åŠ¡: CronJob å¸¸ç”¨å‘½ä»¤ # è·å–èµ„æ–™ kubectl explain ç±»å‹(å¦‚pods) # è·å–èµ„æºä¿¡æ¯ kubectl get èµ„æºç±»å‹ kubectl get pods è·å–defaultç§Ÿæˆ·çš„æ‰€æœ‰podsèµ„æºåˆ—è¡¨ kubectl get nodes è·å–èŠ‚ç‚¹èµ„æºåˆ—è¡¨ kubectl get deploy è·å–defaultç§Ÿæˆ·ç±»å‹ä¸ºdeploymentçš„èµ„æºåˆ—è¡¨ # æ˜¾ç¤ºèµ„æºçš„è¯¦ç»†ä¿¡æ¯ kubectl describe èµ„æºç±»å‹ èµ„æºåç§° kubectl describe deploy demo-deployment è·å–defaultç§Ÿæˆ·deploymentç±»å‹ä¸”åä¸ºdemo-deploymentçš„è¯¦ç»†ä¿¡æ¯ # çœ‹podæ—¥å¿—ï¼Œç±»ä¼¼docker logs kubectl logs Podåç§° kubectl logs demo-deployment-59cd96d4d5-cjjwr æŸ¥çœ‹defaultç§Ÿæˆ·ä¸‹podåä¸ºdemo-deployment-59cd96d4d5-cjjwrçš„æ—¥å¿— # è¿›å…¥å®¹å™¨ï¼Œç±»å‹docker exec kubectl exec -it Podåç§° æ“ä½œå‘½ä»¤ kubectl exec -it demo-deployment-59cd96d4d5-cjjwr ash / # è®¿é—®éƒ¨ç½²çš„åº”ç”¨ é‚£ä¹ˆï¼Œéƒ¨ç½²å®Œç¬¬ä¸€ä¸ªåº”ç”¨åˆè¯¥å¦‚ä½•è®¿é—®?\nKubernetes ä¸­çš„ Serviceï¼ˆæœåŠ¡ï¼‰ æä¾›äº†è¿™æ ·çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå®ƒé€‰æ‹©å…·å¤‡æŸäº›ç‰¹å¾çš„ Podï¼ˆå®¹å™¨ç»„ï¼‰å¹¶ä¸ºå®ƒä»¬å®šä¹‰ä¸€ä¸ªè®¿é—®æ–¹å¼ã€‚\nåœ¨åˆ›å»ºServiceçš„æ—¶å€™ï¼Œé€šè¿‡è®¾ç½®é…ç½®æ–‡ä»¶ä¸­çš„ spec.type å­—æ®µçš„å€¼ï¼Œå¯ä»¥ä»¥ä¸åŒæ–¹å¼å‘å¤–éƒ¨æš´éœ²åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œä»‹ç»å¸¸ç”¨çš„3ç§ï¼š\nClusterIP(é»˜è®¤): é›†ç¾¤å†…éƒ¨å¯è®¿é—® NodePort: NATæ–¹å¼,å¯ä»¥é€šè¿‡è®¿é—®é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹+ç«¯å£å·çš„æ–¹å¼è®¿é—®æœåŠ¡ \u0026lt;NodeIP\u0026gt;:\u0026lt;NodePort\u0026gt;,æ­¤æ—¶ClusterIPçš„è®¿é—®æ–¹å¼ä»ç„¶å¯ç”¨ã€‚ LoadBalancer: è´Ÿè½½å‡è¡¡(ä¾èµ–äº‘è®¿é—®)ã€‚æ­¤æ—¶ ClusterIP å’Œ NodePort çš„è®¿é—®æ–¹å¼ä»ç„¶å¯ç”¨ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  kubectlexplainsvc# https://ysicing.me/hack/demo/svc.yamlapiVersion:v1kind:Servicemetadata:name:demo-service#Service çš„åç§°labels:#Service è‡ªå·±çš„æ ‡ç­¾app:demo#ä¸ºè¯¥ Service è®¾ç½® key ä¸º appï¼Œvalue ä¸º demo çš„æ ‡ç­¾spec:#è¿™æ˜¯å…³äºè¯¥ Service çš„å®šä¹‰ï¼Œæè¿°äº† Service å¦‚ä½•é€‰æ‹© Podï¼Œå¦‚ä½•è¢«è®¿é—®selector:#æ ‡ç­¾é€‰æ‹©å™¨app:demo#é€‰æ‹©åŒ…å«æ ‡ç­¾ app:demo çš„ Podports:- name:demo-port#ç«¯å£çš„åå­—protocol:TCP#åè®®ç±»å‹ TCP/UDPport:80#é›†ç¾¤å†…çš„å…¶ä»–å®¹å™¨ç»„å¯é€šè¿‡ 80 ç«¯å£è®¿é—® ServicenodePort:32600#é€šè¿‡ä»»æ„èŠ‚ç‚¹çš„ 32600 ç«¯å£è®¿é—® ServicetargetPort:80#å°†è¯·æ±‚è½¬å‘åˆ°åŒ¹é… Pod çš„ 80 ç«¯å£type:NodePort#Seriveçš„ç±»å‹ï¼ŒClusterIP/NodePort/LoaderBalancer  ç”Ÿæ•ˆ\nkubectl apply -f https://ysicing.me/hack/demo/svc.yaml service/demo-service created æŸ¥çœ‹serviceï¼Œé€šè¿‡ä¹‹å‰çš„æ–‡æ¡£\nkubectl get svc -l app=demo NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE demo-service NodePort 10.96.37.87 \u0026lt;none\u0026gt; 80:32600/TCP 55s --- kubectl describe svc/demo-service Name: demo-service Namespace: default Labels: app=demo Annotations: kubectl.kubernetes.io/last-applied-configuration: {\u0026quot;apiVersion\u0026quot;:\u0026quot;v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;Service\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;labels\u0026quot;:{\u0026quot;app\u0026quot;:\u0026quot;demo\u0026quot;},\u0026quot;name\u0026quot;:\u0026quot;demo-service\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;default\u0026quot;},\u0026quot;spe... Selector: app=demo Type: NodePort IP: 10.96.37.87 Port: demo-port 80/TCP TargetPort: 80/TCP NodePort: demo-port 32600/TCP Endpoints: 172.16.219.5:80 Session Affinity: None External Traffic Policy: Cluster Events: \u0026lt;none\u0026gt; æµ‹è¯•æœåŠ¡è®¿é—®\n# åœ¨é›†ç¾¤èŠ‚ç‚¹ root@k8s1:~# curl 10.96.37.87 {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} root@k8s1:~# curl 172.16.219.5 {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} root@k8s1:~# curl 192.168.100.101:32600 {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} root@k8s1:~# curl 192.168.100.102:32600 {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæƒ³é€šè¿‡clusteripæ–¹å¼æä¾›å¯¹å¤–æœåŠ¡ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ\n# https://ysicing.me/hack/demo/ing.yaml apiVersion: networking.k8s.io/v1beta1 kind: Ingress metadata: labels: app: demo name: demo-ingress # ingresså namespace: default spec: rules: - host: godemo.slb.k7s.xyz # åŸŸå http: paths: - backend: serviceName: demo-service # godemoçš„ serviceå servicePort: demo-port # godemoçš„serviceå®šä¹‰çš„port path: / #è·¯å¾„ ç”Ÿæ•ˆ\nkubectl apply -f https://ysicing.me/hack/demo/ing.yaml ingress.networking.k8s.io/demo-ingress created kubectl get ing NAME HOSTS ADDRESS PORTS AGE demo-ingress godemo.slb.k7s.xyz 80 91s éªŒè¯ingress\ncurl godemo.slb.k7s.xyz {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} è¿™æ—¶å€™æµé‡å¢åŠ ï¼Œæ€ä¹ˆå¿«é€Ÿä¼¸ç¼©åº”ç”¨ã€‚\nä¼¸ç¼©åº”ç”¨ ä¼¸ç¼© çš„å®ç°å¯ä»¥é€šè¿‡æ›´æ”¹ deploy.yaml æ–‡ä»¶ä¸­éƒ¨ç½²çš„ replicasï¼ˆå‰¯æœ¬æ•°ï¼‰æ¥å®Œæˆ\n# replicas: 1 ---\u0026gt; replicas: 4 # æ”¹å®Œç”Ÿæ•ˆ kubectl apply -f https://ysicing.me/hack/demo/deploy2.yaml deployment.apps/demo-deployment configured # æŸ¥çœ‹pod kubectl get pods -l app=demo NAME READY STATUS RESTARTS AGE demo-deployment-59cd96d4d5-78v28 1/1 Running 0 16s demo-deployment-59cd96d4d5-cjjwr 1/1 Running 0 15m demo-deployment-59cd96d4d5-mn7r8 1/1 Running 0 16s demo-deployment-59cd96d4d5-mvxk2 1/1 Running 0 16s # ä¿®æ”¹äº† Deployment çš„ replicas ä¸º 4 åï¼ŒKubernetes åˆä¸ºè¯¥ Deployment åˆ›å»ºäº† 3 æ–°çš„ Podï¼Œè¿™ 4 ä¸ª Pod æœ‰ç›¸åŒçš„æ ‡ç­¾ã€‚å› æ­¤nginx Service é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨ä¸æ–°çš„ Podå»ºç«‹äº†å¯¹åº”å…³ç³»ï¼Œå°†è®¿é—®æµé‡é€šè¿‡è´Ÿè½½å‡è¡¡åœ¨ 4 ä¸ª Pod ä¹‹é—´è¿›è¡Œè½¬å‘ Name: demo-service Namespace: default Labels: app=demo Annotations: kubectl.kubernetes.io/last-applied-configuration: {\u0026quot;apiVersion\u0026quot;:\u0026quot;v1\u0026quot;,\u0026quot;kind\u0026quot;:\u0026quot;Service\u0026quot;,\u0026quot;metadata\u0026quot;:{\u0026quot;annotations\u0026quot;:{},\u0026quot;labels\u0026quot;:{\u0026quot;app\u0026quot;:\u0026quot;demo\u0026quot;},\u0026quot;name\u0026quot;:\u0026quot;demo-service\u0026quot;,\u0026quot;namespace\u0026quot;:\u0026quot;default\u0026quot;},\u0026quot;spe... Selector: app=demo Type: NodePort IP: 10.96.37.87 Port: demo-port 80/TCP TargetPort: 80/TCP NodePort: demo-port 32600/TCP Endpoints: 172.16.109.71:80,172.16.109.72:80,172.16.219.5:80 + 1 more... Session Affinity: None External Traffic Policy: Cluster Events: \u0026lt;none\u0026gt; éªŒè¯æ•ˆæœ,æµé‡æ˜¯è´Ÿè½½åˆ°åç«¯ä¸åŒpodä¸Š\nroot@k8s1:~# curl godemo.slb.k7s.xyz {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-mn7r8\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.109.71/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} root@k8s1:~# curl godemo.slb.k7s.xyz {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-cjjwr\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.5/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} root@k8s1:~# curl godemo.slb.k7s.xyz {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-59cd96d4d5-78v28\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.219.6/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} æœ€å 1 2 3 4 5  é™ˆè¿°å¼ï¼škubectlcreate-fxx.yamlç”³æ˜å¼ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰ï¼škubectlapply-fxx.yaml   podå®¹å™¨å¦‚æœæœªå‘ç”Ÿè°ƒåº¦ï¼Œé‡å¯å®¹å™¨ipæ˜¯ä¸ä¼šæ”¹å˜çš„  å¦å¤–é™¤äº†Serviceè¿™ç§ç½‘ç»œï¼Œè¿˜æœ‰hostPort,hostNetwork\nhostPortï¼šç›´æ¥å°†å®¹å™¨çš„ç«¯å£ä¸æ‰€è°ƒåº¦çš„èŠ‚ç‚¹ä¸Šçš„ç«¯å£è·¯ç”±ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„IPåŠ ä¸Šæ¥è®¿é—®Podäº†, Ingresså°±æ˜¯è¿™æ ·çš„ hostNetworkï¼šå…±äº«å®¿ä¸»æœºçš„ç½‘ç»œåç§°ç©ºé—´ è¿™é‡Œå¯ä»¥è¿™ä¹ˆæµ‹è¯•ä½¿ç”¨hostPort\nkubectl apply -f https://ysicing.me/hack/demo/deploy3.yaml kubectl get pods -l app=demo -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES demo-deployment-6c5664f4d6-s6w8v 1/1 Running 0 112s 172.16.109.68 k8s2 \u0026lt;none\u0026gt; \u0026lt;none\u0026gt; curl 666.slb.k7s.xyz:28080 {\u0026quot;hostname\u0026quot;:\u0026quot;demo-deployment-6c5664f4d6-s6w8v\u0026quot;,\u0026quot;ip\u0026quot;:{\u0026quot;eth0\u0026quot;:\u0026quot;172.16.109.68/32\u0026quot;,\u0026quot;lo\u0026quot;:\u0026quot;127.0.0.1/8\u0026quot;}} ","description":"k8så®è·µä¹‹éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨","id":28,"section":"posts","tags":["kubernetes"],"title":"k8så®è·µä¹‹éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨","uri":"https://ysicing.me/posts/k8s-intro-deploy/"},{"content":" æ‰©å±•äº†Kubernetesçš„åŠŸèƒ½\n éƒ¨ç½²kuboard kubectl apply -f https://ysicing.me/hack/k7s/install/kuboard/deploy.yml # å› ä¸ºingresséƒ¨ç½²å…³ç³»ï¼Œæ‰€ä»¥é…ç½®è§£æåŸŸåä¸ºui.slb.k7s.xyz # ç®¡ç†èŠ‚ç‚¹æ‰§è¡Œï¼Œè·å–token kbtoken éƒ¨ç½²metrics-server kubectl apply -f https://ysicing.me/hack/k7s/install/metrics-server/deploy.yaml éƒ¨ç½²Dashboard sealos install --pkg-url https://github.com/sealstore/dashboard/releases/download/v2.0.0-bata5/dashboard.tar kdtoken ","description":"k8så¸¸ç”¨æ‰©å±•ç»„ä»¶","id":29,"section":"posts","tags":["kubernetes"],"title":"k8så¸¸ç”¨æ‰©å±•ç»„ä»¶","uri":"https://ysicing.me/posts/k8s-addons/"},{"content":"æ ¼å¼è¦æ±‚ï¼š\næœ‰æ•ˆæ ‡ç­¾å€¼å¿…é¡»ä¸º 63 ä¸ªå­—ç¬¦æˆ–æ›´å°‘ï¼Œå¹¶ä¸”å¿…é¡»ä¸ºç©ºæˆ–ä»¥å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆ[a-z0-9A-Z]ï¼‰å¼€å¤´å’Œç»“å°¾ï¼Œä¸­é—´å¯ä»¥åŒ…å«ç ´æŠ˜å·ï¼ˆ-ï¼‰ã€ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ã€ç‚¹ï¼ˆ.ï¼‰å’Œå­—æ¯æˆ–æ•°å­— èŠ‚ç‚¹è°ƒåº¦nodeSelector 1 2 3 4  # æ‰“label kubectl label nodes \u0026lt;node-name\u0026gt; \u0026lt;label-key\u0026gt;=\u0026lt;label-value\u0026gt; # æ˜¾ç¤ºlabel kubectl get node --show-labels   podè°ƒåº¦åˆ°èŠ‚ç‚¹\n1 2 3 4 5 6 7 8 9 10 11 12 13  apiVersion:v1kind:Podmetadata:name:nginxlabels:env:testspec:containers:- name:nginximage:nginximagePullPolicy:IfNotPresentnodeSelector:disktype:ssd  ","description":"k8sæ ‡ç­¾å’Œé€‰æ‹©å™¨","id":30,"section":"posts","tags":["kubernetes"],"title":"k8sæ ‡ç­¾å’Œé€‰æ‹©å™¨","uri":"https://ysicing.me/posts/k8s-labels/"},{"content":" é…ç½®é»˜è®¤å­˜å‚¨\n # é›†ç¾¤å·²æœ‰å­˜å‚¨ç±»å‹ï¼ˆStorageClassï¼‰ï¼Œæ‰§è¡Œ kubectl get scçœ‹ä¸‹å½“å‰æ˜¯å¦è®¾ç½®äº†é»˜è®¤çš„ storageclass kubectl get sc kubectl patch storageclass nfs-data -p '{\u0026quot;metadata\u0026quot;: {\u0026quot;annotations\u0026quot;:{\u0026quot;storageclass.kubernetes.io/is-default-class\u0026quot;:\u0026quot;true\u0026quot;}}}' ","description":"k8sé…ç½®é»˜è®¤å­˜å‚¨","id":31,"section":"posts","tags":["å­˜å‚¨"],"title":"k8sé…ç½®é»˜è®¤å­˜å‚¨","uri":"https://ysicing.me/posts/k8s-default-sc/"},{"content":"kubectl pluginæ’ä»¶æœºåˆ¶åˆä½“éªŒä¹‹krew æ’ä»¶æœºåˆ¶ è¿™ä¸ªæ—©å°±å·²ç»GAäº†ï¼Œå…¶ä½œç”¨å…è®¸å¼€å‘è€…ä»¥ç‹¬ç«‹çš„äºŒè¿›åˆ¶æˆ–è„šæœ¬å½¢å¼å‘å¸ƒè‡ªå®šä¹‰çš„kubectlå­å‘½ä»¤, çµæ´»å¿«é€Ÿæ“ä½œk8s\næ’ä»¶ä¸é™åˆ¶è¯­è¨€ï¼Œåªéœ€å°†è„šæœ¬æˆ–äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ä»¥kubectl-çš„å‰ç¼€æ”¾åˆ°PATHä¸­å³å¯.\nå®˜æ–¹ç¤ºä¾‹ å®˜æ–¹Goç¤ºä¾‹è¾…åŠ©åº“ https://github.com/kubernetes/cli-runtime.git\nä¸å¤ªç®€å•çš„å®˜æ–¹ç¤ºä¾‹æ’ä»¶ https://github.com/kubernetes/sample-cli-plugin\nç¤ºä¾‹æ’ä»¶ mkdir /usr/local/k8s export PATH=$PATH:/usr/local/k8s ç¤ºä¾‹æ’ä»¶å¦‚ä¸‹ï¼š\nroot@k8s1:~# cat /usr/local/k8s/kubectl-demo #!/bin/bash echo $1 èµ‹äºˆæ‰§è¡Œæƒé™\nchmod +x /usr/local/k8s/kubectl-demo è¿è¡Œæµ‹è¯•:\nroot@k8s1:~# kubectl demo 666 666 root@k8s1:~# kubectl plugin list The following compatible plugins are available: /usr/local/k8s/kubectl-demo kubectl plugin list å¯ä»¥æŸ¥çœ‹PATHä¸­æŸ¥çœ‹æœ‰å“ªäº›æ’ä»¶\nkrew Package manager for kubectl plugins \u0026ndash; krew\nå®‰è£…krew # Bash and ZSH ( set -x; cd \u0026quot;$(mktemp -d)\u0026quot; \u0026amp;\u0026amp; curl -fsSLO \u0026quot;https://github.com/kubernetes-sigs/krew/releases/download/v0.3.4/krew.{tar.gz,yaml}\u0026quot; \u0026amp;\u0026amp; tar zxvf krew.tar.gz \u0026amp;\u0026amp; KREW=./krew-linux_amd64 \u0026amp;\u0026amp; \u0026quot;$KREW\u0026quot; install --manifest=krew.yaml --archive=krew.tar.gz \u0026amp;\u0026amp; \u0026quot;$KREW\u0026quot; update ) # .bashrc/.zshrc export PATH=$PATH:/usr/local/k8s:${KREW_ROOT:-$HOME/.krew}/bin æŸ¥çœ‹å½“å‰å¯ç”¨çš„kubectl pluginï¼Œå‘ç°å¤šäº†ä¸€ä¸ªkubect-krew\nroot@k8s1:~# kubectl plugin list The following compatible plugins are available: /usr/local/k8s/kubectl-demo /root/.krew/bin/kubectl-krew krewä½¿ç”¨ kubectl krew krew is the kubectl plugin manager. You can invoke krew through kubectl: \u0026quot;kubectl krew [command]...\u0026quot; Usage: krew [command] Available Commands: help Help about any command info Show information about a kubectl plugin install Install kubectl plugins list List installed kubectl plugins search Discover kubectl plugins uninstall Uninstall plugins update Update the local copy of the plugin index upgrade Upgrade installed plugins to newer versions version Show krew version and diagnostics Flags: -h, --help help for krew -v, --v Level number for the log level verbosity Use \u0026quot;krew [command] --help\u0026quot; for more information about a command. åˆä½“éªŒ root@k8s1:~# kubectl get pods No resources found in default namespace. root@k8s1:~# kubectl krew install change-ns Installing plugin: change-ns Installed plugin: change-ns root@k8s1:~# kubectl krew list PLUGIN VERSION change-ns v1.0.0 krew v0.3.3 root@k8s1:~# kubectl change-ns nginx-ingress namespace changed to \u0026quot;nginx-ingress\u0026quot; root@k8s1:~# kubectl get pod root@k8s1:~# kubectl get pod NAME READY STATUS RESTARTS AGE nginx-ingress-rfswh 1/1 Running 0 2m6s nginx-ingress-v6c4l 1/1 Running 0 2m6s ","description":"kubectl pluginæ’ä»¶æœºåˆ¶åˆä½“éªŒä¹‹krew","id":32,"section":"posts","tags":["krew"],"title":"kubectl pluginæ’ä»¶æœºåˆ¶åˆä½“éªŒä¹‹krew","uri":"https://ysicing.me/posts/k8s-kubectl-plugins/"},{"content":"minikubeå®‰è£…k8s MacOSå®‰è£… 1  brew install minikube   1 2  # PROXYå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®ï¼Œå¯ä¸è®¾ç½® minikube start --cpus=2 --memory 4g --disk-size=40g --driver=virtualbox --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --nodes=2 --docker-env HTTP_PROXY=http://192.168.99.1:7890 --docker-env HTTPS_PROXY=http://192.168.99.1:7890 --docker-env NO_PROXY=127.0.0.1/32,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost   ","description":"minikubeå®‰è£…k8s","id":33,"section":"posts","tags":["kubernetes","å®‰è£…"],"title":"minikubeå®‰è£…k8s","uri":"https://ysicing.me/posts/k8s-minikube-install/"},{"content":"NFSå­˜å‚¨ Debian # å®‰è£… apt update apt install -y nfs-kernel-server # é…ç½® mkdir /k8sdata echo \u0026quot;/k8sdata/ *(insecure,rw,sync,no_root_squash,no_subtree_check)\u0026quot; \u0026gt; /etc/exports # å¯åŠ¨nfs systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r # æµ‹è¯• showmount -e 127.0.0.1 CentOS # å®‰è£…nfs yum install -y nfs-utils # é…ç½®å…±äº«ç›®å½• mkdir /k8sdata echo \u0026quot;/k8sdata *(insecure,rw,sync,no_root_squash)\u0026quot; \u0026gt; /etc/exports # å¯åŠ¨nfs systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r # æµ‹è¯• showmount -e 127.0.0.1 ä¸€é”®éƒ¨ç½²nfsä¸”é…ç½®é»˜è®¤å­˜å‚¨ # æœªå®‰è£…å­˜å‚¨ curl https://ysicing.me/hack/k7s/install/nfs/deploy.sh | bash # å·²æœ‰å­˜å‚¨ wget https://ysicing.me/hack/k7s/install/nfs/deploy_exist_nfs.sh ./deploy_exist_nfs.sh \u0026lt;ip\u0026gt; \u0026lt;path\u0026gt; ","description":"NFSå­˜å‚¨","id":34,"section":"posts","tags":["kubernetes","å®‰è£…"],"title":"NFSå­˜å‚¨","uri":"https://ysicing.me/posts/nfs-install-k8s/"},{"content":" nginx ingress é…ç½®åŸŸåè¯ä¹¦(é»˜è®¤ä»¥ingress-nginxä¸ºä¾‹)\n åˆ›å»ºè¯ä¹¦ é»˜è®¤å·²ç»ç­¾å‘è¯ä¹¦\nåˆ›å»º secret åˆ›å»ºå¥½è¯ä¹¦ä»¥åï¼Œéœ€è¦å°†è¯ä¹¦å†…å®¹æ”¾åˆ° secret ä¸­ï¼Œsecret ä¸­å…¨éƒ¨å†…å®¹éœ€è¦ base64 ç¼–ç \n1 2 3 4 5 6 7 8 9 10  # ingress-secret.ymlapiVersion:v1kind:Secretmetadata:name:ingress-secret-promnamespace:monitoringtype:kubernetes.io/tlsdata:tls.crt:\u0026lt;base64encodedcert\u0026gt; tls.key: \u0026lt;base64 encoded key\u0026gt;  å®Œæˆåˆ›å»º\n1 2 3 4  ~# kubectl apply -f ingress-secret.yml -n monitoring secret/ingress-secret created ~# kubectl apply -f ingress-secret.yml -n kube-system secret/ingress-secret created   æˆ–è€…é€šè¿‡å¦‚ä¸‹æ–¹å¼\n1  kubectl create secret tls ingress-secret --key tls.key.pem --cert tls.pem   é…ç½®ingress 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  apiVersion:networking.k8s.io/v1beta1kind:Ingressmetadata:annotations:kubernetes.io/ingress.class:nginxname:promnamespace:monitoringspec:tls:- hosts:- prom.k7s.xyz- grafana.k7s.xyz- alter.k7s.xyzsecretName:ingress-secretrules:- host:prom.k7s.xyzhttp:paths:- backend:serviceName:prometheus-k8sservicePort:9090- host:grafana.k7s.xyzhttp:paths:- backend:serviceName:grafanaservicePort:3000- host:alter.k7s.xyzhttp:paths:- backend:serviceName:alertmanager-mainservicePort:9093  ","description":"nginx ingress é…ç½®åŸŸåè¯ä¹¦","id":35,"section":"posts","tags":["ingress","kubernetes"],"title":"nginx ingress é…ç½®åŸŸåè¯ä¹¦","uri":"https://ysicing.me/posts/k8s-ingress-tls-config/"},{"content":"OpenLDAPå®‰è£…åˆä½“éªŒ  ç®€ä»‹è¿™é‡Œä¸åœ¨æè¿°ï¼Œgoogleå³å¯\n dockeå¿«é€Ÿéƒ¨ç½² 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40  version:\u0026#39;2\u0026#39;services:openldap:image:osixia/openldap:1.3.0container_name:openldapenvironment:LDAP_LOG_LEVEL:\u0026#34;256\u0026#34;LDAP_ORGANISATION:\u0026#34;Godu Inc.\u0026#34;LDAP_DOMAIN:\u0026#34;ysicing.me\u0026#34;LDAP_BASE_DN:\u0026#34;\u0026#34;LDAP_ADMIN_PASSWORD:\u0026#34;meadmin\u0026#34;LDAP_CONFIG_PASSWORD:\u0026#34;meconfig\u0026#34;LDAP_READONLY_USER:\u0026#34;true\u0026#34;LDAP_READONLY_USER_USERNAME:\u0026#34;readonly\u0026#34;LDAP_READONLY_USER_PASSWORD:\u0026#34;readonly\u0026#34;LDAP_RFC2307BIS_SCHEMA:\u0026#34;false\u0026#34;LDAP_BACKEND:\u0026#34;mdb\u0026#34;LDAP_TLS:\u0026#34;false\u0026#34;LDAP_REPLICATION:\u0026#34;false\u0026#34;KEEP_EXISTING_CONFIG:\u0026#34;false\u0026#34;LDAP_REMOVE_CONFIG_AFTER_SETUP:\u0026#34;true\u0026#34;LDAP_SSL_HELPER_PREFIX:\u0026#34;ldap\u0026#34;tty:truestdin_open:trueports:- \u0026#34;389:389\u0026#34;- \u0026#34;636:636\u0026#34;domainname:\u0026#34;ldap.ysicing.me\u0026#34;# important: same as hostname# hostname: \u0026#34;ldap.ysicing.me\u0026#34;command:[\u0026#34;--copy-service\u0026#34;,\u0026#34;--loglevel\u0026#34;,\u0026#34;debug\u0026#34;]phpldapadmin:image:osixia/phpldapadmin:latestcontainer_name:phpldapadminenvironment:PHPLDAPADMIN_LDAP_HOSTS:\u0026#34;openldap\u0026#34;PHPLDAPADMIN_HTTPS:\u0026#34;false\u0026#34;ports:- \u0026#34;8080:80\u0026#34;depends_on:- openldap  éªŒè¯ din openldap ldapsearch -x -H ldap://localhost -b dc=ysicing,dc=me -D 'cn=admin,dc=ysicing,dc=me' -w meadmin æˆ–è€…è®¿é—®127.0.0.1:8080\n","description":"OpenLDAPå®‰è£…åˆä½“éªŒ","id":36,"section":"posts","tags":["ldap"],"title":"OpenLDAPå®‰è£…åˆä½“éªŒ","uri":"https://ysicing.me/posts/openldap-install/"},{"content":"å®šæ—¶ä»»åŠ¡ï¼Œå¦‚æ¯65åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ crontab å®šæ—¶ä»»åŠ¡ 65 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œæ€ä¹ˆå†™ï¼Ÿ\nè¿™ä¸ªæ—¶å€™ï¼Œç”¨ç³»ç»Ÿè‡ªå¸¦çš„crontabå°±ä¸å¥½å®ç°äº†,è¿™æ—¶å€™å°±æ˜¯systemdè¯¥ä¸Šåœºäº†\nå‚è€ƒSystemd å®šæ—¶å™¨æ•™ç¨‹\ncat /etc/systemd/system/example.timer [Unit] Description=example timer [Timer] OnUnitActiveSec=1h Unit=example.service [Install] WantedBy=multi-user.target cat /etc/systemd/system/example.service [Unit] Description=example [Service] ExecStart=\u0026lt;ç›¸å…³å‘½ä»¤\u0026gt; [Install] WantedBy=multi-user.target å®šåˆ¶å®šæ—¶å™¨\nOnActiveSecï¼šå®šæ—¶å™¨ç”Ÿæ•ˆåï¼Œå¤šå°‘æ—¶é—´å¼€å§‹æ‰§è¡Œä»»åŠ¡ OnBootSecï¼šç³»ç»Ÿå¯åŠ¨åï¼Œå¤šå°‘æ—¶é—´å¼€å§‹æ‰§è¡Œä»»åŠ¡ OnStartupSecï¼šSystemd è¿›ç¨‹å¯åŠ¨åï¼Œå¤šå°‘æ—¶é—´å¼€å§‹æ‰§è¡Œä»»åŠ¡ OnUnitActiveSecï¼šè¯¥å•å…ƒä¸Šæ¬¡æ‰§è¡Œåï¼Œç­‰å¤šå°‘æ—¶é—´å†æ¬¡æ‰§è¡Œ OnUnitInactiveSecï¼š å®šæ—¶å™¨ä¸Šæ¬¡å…³é—­åå¤šå°‘æ—¶é—´ï¼Œå†æ¬¡æ‰§è¡Œ OnCalendarï¼šåŸºäºç»å¯¹æ—¶é—´ï¼Œè€Œä¸æ˜¯ç›¸å¯¹æ—¶é—´æ‰§è¡Œ AccuracySecï¼šå¦‚æœå› ä¸ºå„ç§åŸå› ï¼Œä»»åŠ¡å¿…é¡»æ¨è¿Ÿæ‰§è¡Œï¼Œæ¨è¿Ÿçš„æœ€å¤§ç§’æ•°ï¼Œé»˜è®¤æ˜¯60ç§’ Unitï¼šçœŸæ­£è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œé»˜è®¤æ˜¯åŒåçš„å¸¦æœ‰.serviceåç¼€çš„å•å…ƒ Persistentï¼šå¦‚æœè®¾ç½®äº†è¯¥å­—æ®µï¼Œå³ä½¿å®šæ—¶å™¨åˆ°æ—¶æ²¡æœ‰å¯åŠ¨ï¼Œä¹Ÿä¼šè‡ªåŠ¨æ‰§è¡Œç›¸åº”çš„å•å…ƒ WakeSystemï¼šå¦‚æœç³»ç»Ÿä¼‘çœ ï¼Œæ˜¯å¦è‡ªåŠ¨å”¤é†’ç³»ç»Ÿ Timerå’ŒServiceå¤§ä½“ç”¨æ³•ä¸€è‡´\n","description":"Systemd å®šæ—¶å™¨æ•™ç¨‹","id":37,"section":"posts","tags":["å†·çŸ¥è¯†"],"title":"Systemd å®šæ—¶å™¨æ•™ç¨‹","uri":"https://ysicing.me/posts/systemd-timers/"},{"content":"å®‰è£…vim plug curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim å†™é…ç½® å‘~/.vimrcå†™å…¥\n\u0026quot; autocmd BufWritePost $MYVIMRC source $MYVIMRC \u0026quot; å…³é—­å…¼å®¹æ¨¡å¼ set nocompatible \u0026quot; è®¾ç½®è¡Œå· set nu \u0026quot;çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ,åˆ— set cursorline set cursorcolumn \u0026quot;æ˜¾ç¤ºæ‹¬å·åŒ¹é… set showmatch \u0026quot; tab ç¼©è¿› set tabstop=4 \u0026quot; è®¾ç½®Tabé•¿åº¦ä¸º4ç©ºæ ¼ set shiftwidth=4 \u0026quot; è®¾ç½®è‡ªåŠ¨ç¼©è¿›é•¿åº¦ä¸º4ç©ºæ ¼ set autoindent \u0026quot; ç»§æ‰¿å‰ä¸€è¡Œçš„ç¼©è¿›æ–¹å¼ï¼Œé€‚ç”¨äºå¤šè¡Œæ³¨é‡Š \u0026quot; å®šä¹‰å¿«æ·é”®çš„å‰ç¼€ï¼Œå³\u0026lt;Leader\u0026gt; let mapleader=\u0026quot;;\u0026quot; \u0026quot; ==== ç³»ç»Ÿå‰ªåˆ‡æ¿å¤åˆ¶ç²˜è´´ ==== \u0026quot; v æ¨¡å¼ä¸‹å¤åˆ¶å†…å®¹åˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ vmap \u0026lt;Leader\u0026gt;c \u0026quot;+yy \u0026quot; n æ¨¡å¼ä¸‹å¤åˆ¶ä¸€è¡Œåˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿ nmap \u0026lt;Leader\u0026gt;c \u0026quot;+yy \u0026quot; n æ¨¡å¼ä¸‹ç²˜è´´ç³»ç»Ÿå‰ªåˆ‡æ¿çš„å†…å®¹ nmap \u0026lt;Leader\u0026gt;v \u0026quot;+p \u0026quot; å¼€å¯å®æ—¶æœç´¢ set incsearch \u0026quot; æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ set ignorecase syntax enable syntax on \u0026quot; å¼€å¯æ–‡ä»¶ç±»å‹ä¾¦æµ‹ filetype plugin indent on \u0026quot; å¯ç”¨è‡ªåŠ¨è¡¥å…¨ \u0026quot; é€€å‡ºæ’å…¥æ¨¡å¼æŒ‡å®šç±»å‹çš„æ–‡ä»¶è‡ªåŠ¨ä¿å­˜ au InsertLeave *.go,*.sh,*.php write \u0026quot; æ’ä»¶ call plug#begin('~/.vim/plugged') \u0026quot; å¯ä»¥å¿«é€Ÿå¯¹é½çš„æ’ä»¶ Plug 'junegunn/vim-easy-align' \u0026quot; ç”¨æ¥æä¾›ä¸€ä¸ªå¯¼èˆªç›®å½•çš„ä¾§è¾¹æ  Plug 'scrooloose/nerdtree' \u0026quot; å¯ä»¥åœ¨å¯¼èˆªç›®å½•ä¸­çœ‹åˆ° git ç‰ˆæœ¬ä¿¡æ¯ Plug 'Xuyuanp/nerdtree-git-plugin' \u0026quot; è‡ªåŠ¨è¡¥å…¨æ‹¬å·çš„æ’ä»¶ï¼ŒåŒ…æ‹¬å°æ‹¬å·ï¼Œä¸­æ‹¬å·ï¼Œä»¥åŠèŠ±æ‹¬å· Plug 'jiangmiao/auto-pairs' \u0026quot; å¯ä»¥åœ¨ vim ä¸­ä½¿ç”¨ tab è¡¥å…¨ Plug 'vim-scripts/SuperTab' Plug 'majutsushi/tagbar' \u0026quot; go ä¸»è¦æ’ä»¶ Plug 'fatih/vim-go', { 'tag': '*' } \u0026quot; go ä¸­çš„ä»£ç è¿½è¸ªï¼Œè¾“å…¥ gd å°±å¯ä»¥è‡ªåŠ¨è·³è½¬ Plug 'dgryski/vim-godef' call plug#end() å®‰è£…æ’ä»¶ vim ~/.vimrc # å®‰è£…æ’ä»¶ :PlugInstall # æ›´æ–°æ’ä»¶ :PlugUpdate ","description":"vimé…ç½®","id":38,"section":"posts","tags":["vim"],"title":"vimé…ç½®","uri":"https://ysicing.me/posts/vim-config/"},{"content":"vscodeé…ç½® å®‰è£…å¥½Goç›¸å…³æ’ä»¶ï¼Œé…ç½®å·¥å…·åŒ… ä½¿ç”¨command+shift+På¿«æ·é”®,ç„¶åé”®å…¥Go: Install/Update Toolsé€‰ä¸­å…¨éƒ¨(æ ¹æ®éœ€è¦),ç¨ç­‰ç‰‡åˆ»ï¼Œå°±ä¼šå®‰è£…å®Œæˆã€‚\nè‡ªå®šä¹‰é…ç½®é¡¹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  { \u0026#34;git.autofetch\u0026#34;: true, \u0026#34;files.autoSave\u0026#34;: \u0026#34;onWindowChange\u0026#34;, \u0026#34;workbench.colorTheme\u0026#34;: \u0026#34;Go - Sources\u0026#34;, \u0026#34;terminal.integrated.shell.osx\u0026#34;: \u0026#34;/bin/zsh\u0026#34;, \u0026#34;go.autocompleteUnimportedPackages\u0026#34;: true, \u0026#34;go.gocodeAutoBuild\u0026#34;: true, \u0026#34;go.useLanguageServer\u0026#34;: true, \u0026#34;goOutliner.enableDebugChannel\u0026#34;: true, \u0026#34;goOutliner.extendExplorerTab\u0026#34;: true, \u0026#34;go.inferGopath\u0026#34;: true, \u0026#34;go.docsTool\u0026#34;: \u0026#34;godoc\u0026#34;, \u0026#34;go.gocodePackageLookupMode\u0026#34;: \u0026#34;go\u0026#34;, \u0026#34;go.gotoSymbol.includeImports\u0026#34;: true, \u0026#34;go.useCodeSnippetsOnFunctionSuggest\u0026#34;: true, //ä½¿ç”¨ä»£ç ç‰‡æ®µæç¤º \u0026#34;go.useCodeSnippetsOnFunctionSuggestWithoutType\u0026#34;: true, \u0026#34;go.formatTool\u0026#34;: \u0026#34;goimports\u0026#34;, //ä»£ç æ ¼å¼åŒ– // \u0026#34;go.buildOnSave\u0026#34;: true, //ä¿å­˜ä»£ç æ—¶è‡ªåŠ¨ç¼–è¯‘ \u0026#34;go.lintOnSave\u0026#34;: \u0026#34;file\u0026#34;, //ä¿å­˜ä»£ç æ—¶ä¼˜åŒ– \u0026#34;go.vetOnSave\u0026#34;: \u0026#34;package\u0026#34;, //ä¿å­˜ä»£ç æ—¶æ£€æŸ¥æ½œåœ¨é”™è¯¯ \u0026#34;go.coverOnSave\u0026#34;: false //ä¿å­˜ä»£ç æ—¶æ‰§è¡Œæµ‹è¯• }   ","description":"vscodeé…ç½®","id":39,"section":"posts","tags":["vscode","go"],"title":"vscodeé…ç½®","uri":"https://ysicing.me/posts/vscode-config/"},{"content":"ä½¿ç”¨nvmè¿›è¡Œnodeç‰ˆæœ¬ç®¡ç† å®‰è£…nvm 1 2 3 4 5 6 7 8 9 10 11 12 13  # å®‰è£… curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash # é»˜è®¤ä¼šå†™.zshrc ### .zshrc nvm start export NVM_DIR=\u0026#34;$HOME/.nvm\u0026#34; [ -s \u0026#34;$NVM_DIR/nvm.sh\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/nvm.sh\u0026#34; # This loads nvm [ -s \u0026#34;$NVM_DIR/bash_completion\u0026#34; ] \u0026amp;\u0026amp; \\. \u0026#34;$NVM_DIR/bash_completion\u0026#34; # This loads nvm bash_completion ### .zshrc nvm end source .zshrc nvm install node # \u0026#34;node\u0026#34; is an alias for the latest version   ","description":"ä½¿ç”¨nvmè¿›è¡Œnodeç‰ˆæœ¬ç®¡ç†","id":40,"section":"posts","tags":["nodejs"],"title":"ä½¿ç”¨nvmè¿›è¡Œnodeç‰ˆæœ¬ç®¡ç†","uri":"https://ysicing.me/posts/nodejs-install/"},{"content":" å†…ç½‘ç©¿é€ä¹‹wireguard\n å®‰è£… Debian # Debian Bullseye ä¹‹å‰ç‰ˆæœ¬éƒ½éœ€è¦å¯ç”¨backportsæºæ¥æ”¯æŒå®‰è£… apt install wireguard -y macOS brew install wireguard-tools é…ç½®æœåŠ¡ç«¯ cd /etc/wireguard # åˆ›å»ºæœåŠ¡ç«¯å¯†é’¥å¯¹ umask 077 wg genkey | tee privatekey | wg pubkey \u0026gt; publickey # åˆ›å»ºwg0.conf cat \u0026gt; /etc/wireguard/wg0.conf \u0026lt;\u0026lt;EOF [Interface] PrivateKey = \u0026lt;Private Key\u0026gt; Address = 10.0.0.1/24, fd86:ea04:1115::1/64 ListenPort = 51820 PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE SaveConfig = true EOF # å¯åŠ¨ wg-quick up wg0 # å¼€æœºå¯åŠ¨ systemctl enable wg-quick@wg0 # æ£€æŸ¥ wg show é…ç½®å®¢æˆ·ç«¯ umask 077 wg genkey | tee privatekey | wg pubkey \u0026gt; publickey cat \u0026gt; /etc/wireguard/wg0.conf \u0026lt;\u0026lt;EOF [Interface] PrivateKey = \u0026lt;Output of privatekey file that contains your private key\u0026gt; Address = 10.0.0.2/24, fd86:ea04:1115::5/64 EOF è¿æ¥å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ æ³•ä¸€ å®¢æˆ·ç«¯æ“ä½œ  wg-quick down wg0 ç›´æ¥ç¼–è¾‘å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ å¯åŠ¨wg-quick up wg0;systemctl enable wg-quick@wg0  # /etc/wireguard/wg0.conf æ–°å¢ [Peer] PublicKey = \u0026lt;Server Public key\u0026gt; Endpoint = \u0026lt;Server Public IP\u0026gt;:51820 AllowedIPs = 10.0.0.2/24, fd86:ea04:1115::5/64 æ³•äºŒ æœåŠ¡ç«¯æ“ä½œ wg set wg0 peer \u0026lt;Client Public Key\u0026gt; endpoint \u0026lt;Client IP address\u0026gt;:51820 allowed-ips 203.0.113.12/24,fd86:ea04:1115::5/64 é—®é¢˜è§£å†³ # 1. å†…æ ¸æ¨¡å—æ²¡æœ‰ lsmod | grep wireguard \u0026amp;\u0026amp; echo yes || echo no no modprobe wireguard modprobe: FATAL: Module wireguard not found in directory /lib/modules/5.4.0-0.bpo.4-amd64 dkms status wireguard, 0.0.20200318, 4.19.0-8-amd64, x86_64: installed uname -a Linux cn3 5.4.0-0.bpo.4-amd64 #1 SMP Debian 5.4.19-1~bpo10+1 (2020-03-09) x86_64 GNU/Linux dkms autoinstall Error! Your kernel headers for kernel 5.4.0-0.bpo.4-amd64 cannot be found. Please install the linux-headers-5.4.0-0.bpo.4-amd64 package # è§£å†³æ–¹å¼ apt install -y linux-headers-5.4.0-0.bpo.4-amd64 # ipv6 RTNETLINK answers: Permission denied å¯ç”¨ipv6å³å¯ net.ipv6.conf.all.disable_ipv6=0 ","description":"å†…ç½‘ç©¿é€ä¹‹wireguard","id":41,"section":"posts","tags":["wireguard","å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€ä¹‹wireguard","uri":"https://ysicing.me/posts/wireguard-install/"},{"content":"ttlSecondsAfterFinished è‡ªåŠ¨æ¸…ç†å®Œæˆå’Œå¤±è´¥çš„Jobï¼Œç›®å‰è¯¥ç‰¹æ€§é»˜è®¤ä¸å¯ç”¨ã€‚å¦‚ä½•åˆ¤æ–­æœªå¯ç”¨,æŸ¥çœ‹jobèµ„æºï¼Œåœ¨specé‡Œæœªå‘ç°ttlSecondsAfterFinishedå®šä¹‰åˆ™è¡¨ç¤ºæœªå¯ç”¨ã€‚\nå¯ç”¨ æˆ‘çš„é›†ç¾¤ä½¿ç”¨sealoså®‰è£…çš„ï¼Œå…¶é…ç½®æ–‡ä»¶åœ¨ /etc/kubernetes/manifestsä¸‹,åˆ†åˆ«è°ƒæ•´ kube-apiserver.yaml,kube-controller-manager.yaml,kube-scheduler.yamlé…ç½®ï¼Œæ–°å¢\n# ç¤ºä¾‹ spec: containers: - command: - kube-scheduler - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf - --bind-address=127.0.0.1 - --kubeconfig=/etc/kubernetes/scheduler.conf - --leader-elect=true - --feature-gates=TTLAfterFinished=true # æ–°å¢é…ç½® image: k8s.gcr.io/kube-scheduler:v1.17.0 è°ƒæ•´å®Œæˆåç¨ç­‰ç‰‡åˆ»,ç›¸å…³podä¼šé‡å»ºã€‚\n","description":"å¼€å¯é›†ç¾¤feature","id":42,"section":"posts","tags":["kubernetes"],"title":"å¼€å¯é›†ç¾¤featureå¼€å¯é›†ç¾¤feature","uri":"https://ysicing.me/posts/k8s-feature/"},{"content":"docker npmå®‰è£…é—®é¢˜ npm config set unsafe-perm true gitæ“ä½œ # æ”¹å´©äº† git fetch --all git reset --hard origin/master # æ”¾å¼ƒæœ¬åœ°å…¨éƒ¨/å•ä¸ª git checkout . git checkout -- filename ","description":"çŸ¥è¯†ç‚¹","id":43,"section":"posts","tags":["å†·çŸ¥è¯†"],"title":"çŸ¥è¯†ç‚¹","uri":"https://ysicing.me/posts/faq/"},{"content":" å§‘ä¸”ç®—æˆ‘çš„åšå®¢å§ï¼ŒğŸ¶!\n æ‰˜ç®¡ ç›®å‰åšå®¢éƒ¨ç½²åœ¨Ucloud ğŸ‡­ğŸ‡° k8sé›†ç¾¤ä¸Š\né›†ç¾¤  *.godu.dev å¤§é™†ğŸ‡¨ğŸ‡³k8sé›†ç¾¤ *.ysicing.me é¦™æ¸¯ğŸ‡­ğŸ‡°k8sé›†ç¾¤ *.k7s.xyz æœ¬åœ°k8sé›†ç¾¤  ","description":"å…³äº","id":44,"section":"","tags":null,"title":"å…³äº","uri":"https://ysicing.me/about/"},{"content":"macOS å¸¸ç”¨å·¥å…·  ä¸ªäººå¸¸ç”¨å·¥å…·åˆ—è¡¨\n  iTerm2(ç»ˆç«¯) Sourcetree(gitå·¥å…·) Dash(æ–‡æ¡£å·¥å…·) iHosts(hostsç¼–è¾‘å™¨) Microsoft To Do(Todo) pap.er(å£çº¸) ZeroTier(å†…ç½‘ç©¿é€) Xmind Pixiu(è®°è´¦)  ","description":"è®°å½•è‡ªç”¨macOSå¸¸ç”¨å·¥å…·","id":47,"section":"links","tags":[""],"title":"macOSå¸¸ç”¨å·¥å…·","uri":"https://ysicing.me/links/macos-apps/"},{"content":" ç”¨äºè®°å½•å‘ç°çš„æœ‰ç”¨/æœ‰è¶£çš„Githubé¡¹ç›®\n 20191219  book prometheus  20191208  kubewatch Watch k8s events and trigger Handlers Go  20191121  overlay networking tool slackhq/nebula  20191104  KubeOperator ä¸€é”®éƒ¨ç½²å’Œç®¡ç†ç”Ÿäº§çº§åˆ«çš„ Kubernetes é›†ç¾¤  20191010  Status Page statusfy NodeJS  20191009  Status Page statping Go  20191006  iptv  20190927  Collection of Prometheus alerting rules  20190926  listen1 å¬æ­Œç¥å™¨  20190925  ä¸€ä¸ªåŸºäºGoçš„Telegram RSS Botæœºå™¨äººï¼Œæ”¯æŒåº”ç”¨å†…é˜…è¯»é¢„è§ˆ kubernetes app kubeapp  20190924  octant k8s Go  20190920  gopub å‘å¸ƒç³»ç»Ÿ(ä¸ç»´æŠ¤) PrometheusAlert Go  20190919  felix SSH and RESTful scaffold for Backend and DevOps engineers Go kplcloudåŸºäºKubernetesçš„åº”ç”¨ç®¡ç†å¹³å° Go GitæœåŠ¡webhook Go  20190916  ğŸ•µï¸â€â™€ï¸ ç›‘è§†æˆ‘çš„æ‰‹æœºï¼šæ•°æ®éƒ½å»å“ªå„¿äº†ï¼Ÿ Python  20190915  ğŸ­ é›†åˆå¤šå®¶ API çš„æ–°ä¸€ä»£å›¾åºŠauxpi Go  20190913  TeaWeb-å¯è§†åŒ–çš„Webä»£ç†æœåŠ¡ Go  20190912  SmartPing ä¸€æ¬¾å¼€æºã€é«˜æ•ˆã€ä¾¿æ·çš„ç½‘ç»œè´¨é‡ç›‘æ§ç¥å™¨ï¼Go  20190911  Mysql webç«¯sqlå®¡æ ¸å¹³å°Yearning Go ç®€å•å¯ä¿¡èµ–çš„ä»»åŠ¡ç®¡ç†å·¥å…· Go  20190908  Linuxé€æ˜ä»£ç† è¿ç»´ç®¡ç†å¹³å°flask Python  20190906  kubernetesé«˜å¯ç”¨å®‰è£…å·¥å…·sealos GO åŸºäºVueæ¡†æ¶æ„å»ºçš„githubæ•°æ®å¯è§†åŒ–å¹³å°GitDataV VUE  20190904  nging åŸºäºcaddyçš„ç½‘ç«™æœåŠ¡ç¨‹åºï¼Œå¸¦å›¾å½¢åŒ–ç®¡ç†ç•Œé¢  20190903  Aria2-AriaNg-X docker-compose  20190823  trivy å®¹å™¨çš„ç®€å•è€Œå…¨é¢çš„æ¼æ´æ‰«æç¨‹åº Go  20190813  anytunnel å¼€æºå†…ç½‘ç©¿é€å•†ç”¨å¹³å°ç³»ç»Ÿ Go æ‰©å±•ä¼ä¸šå®‰å…¨æµ‹è¯•ä¸»åŠ¨è¯±å¯¼å‹èœœç½æ¡†æ¶ç³»ç»Ÿ Go  ","description":"ç”¨äºè®°å½•å‘ç°çš„æœ‰ç”¨/æœ‰è¶£çš„Githubé¡¹ç›®","id":48,"section":"links","tags":[""],"title":"æœ‰è¶£çš„Githubé¡¹ç›®","uri":"https://ysicing.me/links/links/"},{"content":" ä¸Šå‘¨æœ‰é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ awk '{print $$1}' è¿™ä¸ª$$æ˜¯ä»€ä¹ˆç”¨æ³•å‘¢\n é—´æ¥å­—æ®µå¯»å€,å…¶ç±»ä¼¼\nawk '{print $$1}' ===\u0026gt; awk '{print $($1)}' ===\u0026gt; awk '{Nr=$1; print $Nr}' ç¤ºä¾‹:\n$ echo -e \u0026quot;1 b c d\\n2 b c d\\n3 b c d\\n4 b c d\u0026quot; 1 b c d 2 b c d 3 b c d 4 b c d $ echo -e \u0026quot;1 b c d\\n2 b c d\\n3 b c d\\n4 b c d\u0026quot; | awk '{print $$1}' 1 # since filed #1=1 result print first field b # since filed #1=2 result print secondfield c # since filed #1=3 result print third field d # since filed #1=4 result print fourth field ç±»ä¼¼$å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤š\nawk '{print $$$1}' ===\u0026gt; awk '{print $$($1)}' ===\u0026gt; awk '{print $($($1))}' ","description":"awk ä¸­å…³äºå¤šä¸ª$çš„ç”¨æ³•","id":49,"section":"posts","tags":["shell"],"title":"awk ä¸­å…³äºå¤šä¸ª$çš„ç”¨æ³•","uri":"https://ysicing.me/posts/awk-func/"},{"content":"Macå®‰è£… å¦‚æœå·²ç»å®‰è£…äº†brewï¼Œå°±å¯ä»¥å¿«é€Ÿå®‰è£…äº†\n# å®‰è£…git brew install git # å®‰è£…go brew install go # add GOBIN path to your PATH in ~/.zshrc export GO111MODULE=on export GOPROXY=https://goproxy.cn export GOPATH=\u0026quot;/Users/ysicing/go\u0026quot; # ç¤ºä¾‹ export GOBIN=\u0026quot;$GOPATH/bin\u0026quot; export PATH=$HOME/bin:/usr/local/bin:/usr/local/opt/mysql-client/bin:$GOBIN:$PATH é…ç½®Visual Studio Code Editor å¿«æ·é”®cmd+shift+p é”®å…¥: go install é€‰æ‹© \u0026quot;Go: Install/Update Tools\u0026quot; Check all the checkboxes Linuxå®‰è£… è®¿é—® golangä¸­å›½ è·å–æœ€æ–°goç‰ˆæœ¬\n1 2 3 4 5 6 7 8 9 10 11 12 13  # ä¸‹è½½ wget https://dl.google.com/go/go1.14.3.linux-amd64.tar.gz # è§£å‹ tar -C /usr/local -xzf go1.14.3.linux-amd64.tar.gz # é…ç½® .bashrc export GO111MODULE=on export GOPROXY=https://goproxy.cn export GOPATH=\u0026#34;/root/go\u0026#34; export GOBIN=\u0026#34;$GOPATH/bin\u0026#34; export PATH=$PATH:$GOBIN:/usr/local/go/bin source .bashrc # éªŒè¯ go env   ä¸€é”®è„šæœ¬ 1  curl https://ysicing.me/hack/install/go.sh | bash   ","description":"å®‰è£…golang","id":50,"section":"posts","tags":["go"],"title":"å®‰è£…golang","uri":"https://ysicing.me/posts/go-install/"},{"content":"é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨å‡çº§å†…æ ¸  å‡çº§æœ‰é£é™©è¯·æ…é‡å“¦\n é…ç½®è¯´æ˜  é˜¿é‡Œäº‘HK 1æ ¸1G1TB30Mbps Â¥24/m\nDebian 9.9\n æ›´æ–°æº  éœ€è¦ç§»é™¤é»˜è®¤æºï¼Œä½¿ç”¨å¦‚ä¸‹æº\n # éœ€è¦æ·»åŠ buster-backportsæº sed -i \u0026quot;s#stretch#buster#g\u0026quot; /etc/apt/sources.list # ç¤ºä¾‹ deb http://mirrors.a li yun c/debian/ buster main contrib non-free deb http://mirrors.aliyun.com/debian/ buster-updates main contrib non-free deb http://mirrors.aliyun.com/debian/ buster-proposed-updates main non-free contrib deb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib deb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib æ›´æ–°å‡çº§\n1 2  apt-get update apt-get dist-upgrade -y   å‡çº§åˆ°æœ€æ–°å†…æ ¸ apt-get install -t buster-backports linux-image-amd64 -y update-grub apt autoclean apt autoremove -y reboot å‡çº§å®Œæˆådockeræ— æ³•å¯åŠ¨ prior storage driver aufs failed: driver not supported åˆ é™¤/var/lib/dockerï¼Œdockerå­˜å‚¨ç”±aufså˜æˆoverlay2\n","description":"é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨å‡çº§å†…æ ¸","id":51,"section":"posts","tags":["debian",""],"title":"é˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨å‡çº§å†…æ ¸","uri":"https://ysicing.me/posts/aliyun-debian-upgrade-kernel/"},{"content":" AdGuard Homeä½¿ç”¨Golangå¼€å‘ï¼Œå› æ­¤å®‰è£…éå¸¸ç®€å•ï¼Œè¿™é‡Œä»¥å®¹å™¨çš„æ–¹å¼éƒ¨ç½²ä¸ºä¾‹ï¼Œå…¶å®ƒæ–¹å¼å¯å‚è€ƒå®˜æ–¹å¸®åŠ©æ–‡æ¡£ã€‚\n ä¸»è¦åŠŸèƒ½  æ‹¦æˆªAD å·ç§°éšç§ä¿æŠ¤ å®¶åº­ä¿æŠ¤æ¨¡å¼ è‡ªå®šä¹‰è¿‡æ»¤(åŠ«æŒ) (ğŸ˜‚æˆ‘ç”¨çš„æœ€å¤šçš„æ˜¯è¿™ä¸ª)  éƒ¨ç½² äºŒè¯ä¸è¯´ç›´æ¥ä¸Š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  # docker-compose.yamlversion:\u0026#39;2.1\u0026#39;services:caddy:image:spanda/caddycontainer_name:caddyvolumes:- ./ssl:/root/.caddy- /var/log/caddy:/var/log/caddy- ./Caddyfile:/etc/Caddyfilenetwork_mode:hostrestart:alwaysdns:image:adguard/adguardhomecontainer_name:dnsvolumes:- ./ad/conf:/opt/adguardhome/conf- ./ad/work:/opt/adguardhome/worknetwork_mode:hostrestart:always# Caddyfiledns.ysicing.net{gziptlsroot@ysicing.netlog//var/log/caddy/dns.ysicing.net.log\u0026#34;{remote} {when} {method} {uri} {proto} {status} {size} {\u0026gt;User-Agent} {latency}\u0026#34;{rotate_size50rotate_age90rotate_keep20rotate_compress}header/{Strict-Transport-Security\u0026#34;max-age=31536000;includeSubDomains;preload\u0026#34;Access-Control-Allow-Origin*Access-Control-Allow-Methods\u0026#34;GET, POST, OPTIONS\u0026#34;-Server}proxy/127.0.0.1:7070{transparentwebsocket}}  è®¿é—®å…¬ç½‘IP:3000,æŒ‰ç€æ— è„‘ä¸€é¡¿çŒ›æ“ä½œã€‚ä¿®æ”¹é»˜è®¤webç›‘å¬ç«¯å£ä¸º127.0.0.1:7070,53ç«¯å£é»˜è®¤ç›‘å¬å…¨éƒ¨ã€‚\nä½¿ç”¨ Windows  æ‰“å¼€ç½‘ç»œå’ŒInternetè®¾ç½® æ‰“å¼€ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ æ‰“å¼€ä»¥å¤ªç½‘ æ‰“å¼€å±æ€§ ç¼–è¾‘TCP/IPV4 ä½¿ç”¨ä¸‹é¢çš„DNSæœåŠ¡å™¨ é¦– 59.110.220.53 å¤‡ 8.8.8.8  Mac è·³è¿‡å¾ˆç®€å•\nå®‰å“ è‡ªå·±æŠ˜è…¾å§ï¼Œç§æœ‰dnsæä¸å®šï¼Œå®˜æ–¹APPå¯ä»¥\n","description":"AdGuardä½¿ç”¨å§¿åŠ¿","id":52,"section":"posts","tags":["dns"],"title":"AdGuardä½¿ç”¨å§¿åŠ¿","uri":"https://ysicing.me/posts/dns-adguard-install/"},{"content":" ä¸ä¼šå…·ä½“è®²æ€ä¹ˆéƒ¨ç½²ï¼ŒåŸç†éƒ½ç±»ä¼¼,å°†åŸå…ˆamd64æ¢æˆmips64el\n ä¸­æ ‡éº’éºŸé¾™èŠ¯CPUæº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21  # /etc/yum.repos.d/ns7-mips.repo [ns7-mips64el-os] name=NeoKylin Linux Advanced Server 7 - $basearch - Os baseurl=http://download.cs2c.com.cn/neokylin/server/releases/7.0/ls_64/ gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release enabled=1 [ns7-mips64el-extras] name=NeoKylin Linux Advanced Server 7 - Addons baseurl=http://download.cs2c.com.cn/neokylin/server/everything/7.0/ls_64/ gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release enabled=0 [ns7-mips64el-updates] name=NeoKylin Linux Advanced Server 7 - Updates baseurl=http://download.cs2c.com.cn/neokylin/server/updates/7.0/ls_64/ gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release enabled=1   è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯é¾™èŠ¯è‡ªå·±çš„ä»“åº“æ¯”è¾ƒè¿·ï¼Œä½†æ˜¯è½¯ä»¶åŒ…æ¯”è¾ƒæ–°\n1  http://ftp.loongnix.org/os/loongnix/1.0/   åŸºç¡€é•œåƒ neokylinåŸºç¡€é•œåƒ 1 2 3 4 5 6 7  wget https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-yum.sh chmod +x ./mkimage-yum.sh ./mkimage-yum.sh -y /etc/yum.conf nk-base wget http://list.isoftos.win/script/create_docker_image.loogson chmod +x create_docker_image.loogson ./create_docker_image.loogson nk-base   debianåŸºç¡€é•œåƒ å¯ä»¥é€šè¿‡å¼‚æ„æ„å»ºé•œåƒæ–¹å¼\nå¯ä»¥å‚è€ƒå¤§ä½¬é¡¹ç›® debian-debootstrap\nk8sç¼–è¯‘ å®¿ä¸»æœºç¼–è¯‘  4æ ¸16G,æ€§èƒ½å¤ªå·®,æºç ç¼–è¯‘å®‰è£…goæ–°ç‰ˆæœ¬å·®ä¸å¤šä¸¤å°æ—¶\n é€šè¿‡å¼‚æ„é•œåƒç¼–è¯‘ å¤§æ¦‚ä¿®æ”¹å°è±¡:\n1 2 3 4 5 6 7 8 9 10 11 12 13  # ç¬¬ä¸€å¤„ mips64*) host_arch=mips64le ;; # ç¬¬äºŒå¤„ \u0026#34;linux/mips64le\u0026#34;) export CGO_ENABLED=1 export CC=mips64el-linux-gnu-gcc ;; # ç¬¬ä¸‰å¤„ linux/mips64le # ç¬¬å››å¤„ uint64è½¬æ¢ä¸€ä¸‹   å…·ä½“å¯ä»¥é€šè¿‡make \u0026lt;xxxç»„ä»¶å\u0026gt;\npauseé•œåƒ è¿™ä¸ªå¾—æ³¨æ„ä¸€ä¸‹, ä¸èƒ½ç”¨ç©ºé•œåƒï¼Œå¯ä»¥ä½¿ç”¨åŸºç¡€é•œåƒ\n","description":"é¾™èŠ¯Mips64elå¹³å°ä¸Šéƒ¨ç½²K8s","id":53,"section":"posts","tags":[""],"title":"é¾™èŠ¯Mips64elå¹³å°ä¸Šéƒ¨ç½²K8s","uri":"https://ysicing.me/posts/mips64el-loongson-k8s/"},{"content":"åˆ›å»ºDebianè™šæ‹Ÿæœº 1 2 3 4 5 6 7 8 9 10  Usage: ergo vm create [flags] Flags: -h, --help help for create --path string Vagrantfileæ‰€åœ¨ç›®å½•, $HOME/vm --vmcpus string è™šæ‹ŸæœºCPUæ•° (default \u0026#34;2\u0026#34;) --vmmem string è™šæ‹ŸæœºMem MBæ•° (default \u0026#34;4096\u0026#34;) --vmname string è™šæ‹Ÿæœºå --vmnum string è™šæ‹Ÿæœºå‰¯æœ¬æ•° (default \u0026#34;1\u0026#34;)   é»˜è®¤ä½¿ç”¨ergoåˆ›å»ºè™šæ‹Ÿæœº\n1  ergo vm create --vmcpus 4 --vmmem 8192 --vmname debian   æˆ–è€…è‡ªè¡Œä½¿ç”¨Vagrantfile\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30  # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\u0026#34;2\u0026#34;) do |config| config.vm.box_check_update = false config.vm.provider \u0026#39;virtualbox\u0026#39; do |vb| vb.customize [ \u0026#34;guestproperty\u0026#34;, \u0026#34;set\u0026#34;, :id, \u0026#34;/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\u0026#34;, 1000 ] end $num_instances = 1 (1..$num_instances).each do |i| config.vm.define \u0026#34;debian#{i}\u0026#34; do |node| node.vm.box = \u0026#34;ysicing/debian\u0026#34; node.vm.hostname = \u0026#34;debian#{i}\u0026#34; node.vm.network \u0026#34;public_network\u0026#34;, use_dhcp_assigned_default_route: true, bridge: \u0026#39;en0: Wi-Fi (Wireless)\u0026#39; # node.vm.provision \u0026#34;shell\u0026#34;, run: \u0026#34;always\u0026#34;, inline: \u0026#34;ntpdate ntp.api.bz\u0026#34; node.vm.network \u0026#34;private_network\u0026#34;, ip: \u0026#34;11.11.11.11#{i}\u0026#34; node.vm.provision \u0026#34;shell\u0026#34;, run: \u0026#34;always\u0026#34;, inline: \u0026#34;echo hello from debian#{i}\u0026#34; node.vm.provider \u0026#34;virtualbox\u0026#34; do |vb| vb.gui = false vb.memory = 8192 vb.cpus = 4 vb.name = \u0026#34;debian#{i}\u0026#34; vb.customize [\u0026#34;modifyvm\u0026#34;, :id, \u0026#34;--natdnshostresolver1\u0026#34;, \u0026#34;on\u0026#34;] vb.customize [\u0026#34;modifyvm\u0026#34;, :id, \u0026#34;--ioapic\u0026#34;, \u0026#34;on\u0026#34;] # cpu ä½¿ç”¨ç‡50% vb.customize [\u0026#34;modifyvm\u0026#34;, :id, \u0026#34;--cpuexecutioncap\u0026#34;, \u0026#34;50\u0026#34;] end end end end   åˆå§‹åŒ–Debian ergo vm init --ip 11.11.11.111 --docker # é»˜è®¤ä¼šä½¿ç”¨ysicing/ansibleé•œåƒï¼Œæ‰§è¡Œansibleè„šæœ¬åˆå§‹åŒ–debianï¼Œ--dockerå‚æ•°é»˜è®¤è¡¨ç¤ºå®‰è£…docker æ‰‹åŠ¨æ‰§è¡Œä¹‹å®¿ä¸»æœºåˆå§‹åŒ– git clone https://github.com/ysicing/play-ansible.git cd play-ansible # å®‰è£…ansible,å¦‚æœå·²å®‰è£…å¯è·³è¿‡ ./install.sh # é…ç½®åˆå§‹åŒ–æœºå™¨ cp inventory.ini.example inventory.ini # æ‰§è¡Œåˆå§‹åŒ– ansible-playbook init.yml æ‰‹åŠ¨æ‰§è¡Œä¹‹å®¹å™¨åŒ–æ–¹å¼åˆå§‹åŒ– 1 2 3 4 5 6  docker pull ysicing/ansible docker run -it --rm ysicing/ansible bash cp inventory.ini.example inventory.ini # åˆå§‹åŒ–ç³»ç»Ÿ ansible-playbook init.yml exit   Debianå‡çº§å†…æ ¸  æ·»åŠ buster-backportsæºï¼Œå¦‚æœä½ ä½¿ç”¨ysicin/debiané•œåƒå¯è·³è¿‡\n # é»˜è®¤ cat \u0026gt;/etc/apt/sources.list \u0026lt;\u0026lt;EOF deb http://mirrors.aliyun.com/debian buster-backports main contrib non-free deb http://mirrors.aliyun.com/debian-security buster/updates main contrib non-free EOF # Ucloud cat \u0026gt;/etc/apt/sources.list \u0026lt;\u0026lt;EOF deb http://mirrors.ucloud.cn/debian/ buster-backports main contrib non-free deb http://mirrors.ucloud.cn/debian-security/ buster/updates main contrib non-free EOF æ›´æ–°å‡çº§\n1 2 3 4 5 6 7  apt update apt dist-upgrade -y apt-get install -t buster-backports linux-image-amd64 -y update-grub apt autoclean apt autoremove -y reboot   ","description":"Debianå¸¸ç”¨æ“ä½œæŒ‡å—","id":54,"section":"posts","tags":["debian"],"title":"Debianä¸ªäººå¸¸ç”¨æ“ä½œæŒ‡å—","uri":"https://ysicing.me/posts/debian-op/"},{"content":"å¼€å§‹ä¹‹å‰ åœ¨é˜…è¯»æœ¬ä¹¦ä¹‹å‰å¸Œæœ›æ‚¨æŒæ¡ä»¥ä¸‹çŸ¥è¯†å’Œå‡†å¤‡ä»¥ä¸‹ç¯å¢ƒï¼š\n Debian å¸¸ç”¨å‘½ä»¤ Docker åŸºæœ¬æ“ä½œ Mac/Linux çš†å¯  ç³»åˆ—ä¸»é¢˜  Kubernetes(1.18.3)å®è·µ Go(1.14+)å¼€å‘å®è·µ è¿ç»´å®è·µ(ä¸»è¦æ˜¯åŸºäºDebian(buster)å‘è¡Œç‰ˆ)  ï¼Ÿ æ¬¢è¿äº¤æµ, ä¸€èµ·åŠªåŠ›.\nå¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–é”™è¯¯ï¼Œæ¬¢è¿åœ¨ issues è¿›è¡Œæé—®æˆ–ç»™äºˆä¿®æ­£æ„è§\nå¦‚æœå–œæ¬¢æˆ–å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ Starï¼Œå¯¹æˆ‘æ˜¯ä¸€ç§é¼“åŠ±å’Œæ¨è¿› ğŸ˜€\n","description":"ä½ å¥½,æˆ‘çš„åšå®¢","id":55,"section":"posts","tags":["ç«™ç‚¹"],"title":"README","uri":"https://ysicing.me/posts/blog-notice/"}]