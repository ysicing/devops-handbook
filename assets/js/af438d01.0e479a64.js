"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[8115],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),s=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,f=d["".concat(i,".").concat(m)]||d[m]||u[m]||l;return n?a.createElement(f,o(o({ref:t},c),{},{components:n})):a.createElement(f,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var p={};for(var i in t)hasOwnProperty.call(t,i)&&(p[i]=t[i]);p.originalType=e,p.mdxType="string"==typeof e?e:r,o[1]=p;for(var s=2;s<l;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},10771:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return p},metadata:function(){return s},toc:function(){return u}});var a=n(83117),r=n(80102),l=(n(67294),n(3905)),o=["components"],p={title:"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE",date:new Date("2022-04-09T13:46:48.000Z"),description:"\u4e0a\u6b21\u817e\u8baf\u9001\u7684\u4e0a\u6d77\u8f7b\u91cf\u4e00\u76f4\u5403\u7070\uff0c\u8dd1\u4e2apve\u73a9\u73a9.",tags:["lighthouse","qcloud","pve"]},i=void 0,s={permalink:"/posts/lighthouse-pve",source:"@site/blog/posts/lighthouse-pve.md",title:"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE",description:"\u4e0a\u6b21\u817e\u8baf\u9001\u7684\u4e0a\u6d77\u8f7b\u91cf\u4e00\u76f4\u5403\u7070\uff0c\u8dd1\u4e2apve\u73a9\u73a9.",date:"2022-04-09T13:46:48.000Z",formattedDate:"2022\u5e744\u67089\u65e5",tags:[{label:"lighthouse",permalink:"/tags/lighthouse"},{label:"qcloud",permalink:"/tags/qcloud"},{label:"pve",permalink:"/tags/pve"}],readingTime:1.96,hasTruncateMarker:!0,authors:[],frontMatter:{title:"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE",date:"2022-04-09T13:46:48.000Z",description:"\u4e0a\u6b21\u817e\u8baf\u9001\u7684\u4e0a\u6d77\u8f7b\u91cf\u4e00\u76f4\u5403\u7070\uff0c\u8dd1\u4e2apve\u73a9\u73a9.",tags:["lighthouse","qcloud","pve"]},prevItem:{title:"minipc\u6298\u817e\u5b89\u88c5pve",permalink:"/posts/minipc-pve"},nextItem:{title:"\u5728k8s\u4e2d\u90e8\u7f72Tailscale\u79c1\u6709\u4e2d\u7ee7\u670d\u52a1\u5668Derper",permalink:"/posts/tailscale-custom-derper-server"}},c={authorsImageUrls:[]},u=[{value:"\u51c6\u5907\u5de5\u4f5c",id:"\u51c6\u5907\u5de5\u4f5c",level:2},{value:"\u914d\u7f6e\u7f51\u7edc",id:"\u914d\u7f6e\u7f51\u7edc",level:3},{value:"\u914d\u7f6e\u4e3b\u673a\u540d",id:"\u914d\u7f6e\u4e3b\u673a\u540d",level:3},{value:"\u5b89\u88c5Proxmox VE",id:"\u5b89\u88c5proxmox-ve",level:2},{value:"\u6dfb\u52a0\u8f6f\u4ef6\u6e90",id:"\u6dfb\u52a0\u8f6f\u4ef6\u6e90",level:3},{value:"\u5b89\u88c5PVE",id:"\u5b89\u88c5pve",level:3},{value:"\u914d\u7f6ePVE",id:"\u914d\u7f6epve",level:2},{value:"\u7f51\u7edc",id:"\u7f51\u7edc",level:3},{value:"\u5f00\u5c0f\u9e21",id:"\u5f00\u5c0f\u9e21",level:2},{value:"\u914d\u7f6eLXC\u5bb9\u5668",id:"\u914d\u7f6elxc\u5bb9\u5668",level:3},{value:"\u521b\u5efa\u5bb9\u5668",id:"\u521b\u5efa\u5bb9\u5668",level:3},{value:"\u914d\u7f6e\u5bb9\u5668NAT\u8bbf\u95ee",id:"\u914d\u7f6e\u5bb9\u5668nat\u8bbf\u95ee",level:3},{value:"\u5176\u4ed6",id:"\u5176\u4ed6",level:3}],d={toc:u};function m(e){var t=e.components,p=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},d,p,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u51c6\u5907\u5de5\u4f5c"},"\u51c6\u5907\u5de5\u4f5c"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u9ed8\u8ba4\u4f7f\u7528Debian 11")),(0,l.kt)("h3",{id:"\u914d\u7f6e\u7f51\u7edc"},"\u914d\u7f6e\u7f51\u7edc"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8f7b\u91cf\u4e91\u9632\u706b\u5899\u653e\u884c 8006\u7aef\u53e3 \u548c 30000-40000\u7aef\u53e3\u7ed9\u5c0f\u9e21\u7528\u3002")),(0,l.kt)("h3",{id:"\u914d\u7f6e\u4e3b\u673a\u540d"},"\u914d\u7f6e\u4e3b\u673a\u540d"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# \u66f4\u6539\u4e3b\u673a\u540d\nhostname pve\necho pve > /etc/hostname\n# vim /etc/hosts\n127.0.1.1 localhost.localdomain VM-16-11-debian\n127.0.0.1 localhost\n\n10.0.16.11 pve # \u65b0\u589e\u4e3b\u673a\u540d\n\n::1 ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\nff02::3 ip6-allhosts\n")),(0,l.kt)("p",null,"\u8bbe\u7f6e\u5b8c\u6210\u540e\u53ef\u4ee5\u9a8c\u8bc1"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"hostname --ip-address\n10.0.16.11\n")),(0,l.kt)("h2",{id:"\u5b89\u88c5proxmox-ve"},"\u5b89\u88c5Proxmox VE"),(0,l.kt)("h3",{id:"\u6dfb\u52a0\u8f6f\u4ef6\u6e90"},"\u6dfb\u52a0\u8f6f\u4ef6\u6e90"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u5b98\u65b9\u6e90\u6bd4\u8f83\u6162\uff0c\u8fd9\u91cc\u4f7f\u7528\u6e05\u534e\u955c\u50cf\u6e90")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo "deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription" > /etc/apt/sources.list.d/pve-install-repo.list\n# \u6dfb\u52a0\u4ed3\u5e93key\nwget https://enterprise.proxmox.com/debian/proxmox-release-bullseye.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bullseye.gpg \n')),(0,l.kt)("p",null,"\u66f4\u65b0\u7cfb\u7edf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"apt remove -y exim*\napt update && apt full-upgrade\n")),(0,l.kt)("h3",{id:"\u5b89\u88c5pve"},"\u5b89\u88c5PVE"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"apt install proxmox-ve postfix open-iscsi -y\n")),(0,l.kt)("p",null,"\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9700\u8981\u914d\u7f6epostfix\uff0c\u9009\u62e9no configuration"),(0,l.kt)("p",null,"\u7b49\u5f85\u5b89\u88c5\u5b8c\u6210\uff0c\u8bbf\u95ee ",(0,l.kt)("inlineCode",{parentName:"p"},"https://<\u516c\u7f51ip>:8006"),", \u4f7f\u7528linux\u8d26\u6237\u767b\u9646",(0,l.kt)("inlineCode",{parentName:"p"},"root/<password>")),(0,l.kt)("h2",{id:"\u914d\u7f6epve"},"\u914d\u7f6ePVE"),(0,l.kt)("h3",{id:"\u7f51\u7edc"},"\u7f51\u7edc"),(0,l.kt)("p",null,"\u914d\u7f6e\u7f51\u7edc"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"\u7f51\u7edc",src:n(49194).Z,width:"758",height:"392"}),"\n",(0,l.kt)("img",{alt:"\u7f51\u7edc",src:n(85239).Z,width:"637",height:"275"})),(0,l.kt)("p",null,"\u67e5\u770b\u5bbf\u4e3b\u673a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cat /etc/network/interfaces.new\nauto lo\niface lo inet loopback\n\niface eth0 inet manual\n\nauto vmbr0\niface vmbr0 inet static\n    address 10.10.10.1/24\n    gateway 10.10.10.1\n    bridge-ports eth0\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n    bridge-vids 2-4094\n\nsource /etc/network/interfaces.d/*\n")),(0,l.kt)("p",null,"\u8c03\u6574\u7f51\u7edc\u914d\u7f6e\uff0c\u6dfb\u52a0nat\u8f6c\u53d1, \u66f4\u591a\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863",(0,l.kt)("a",{parentName:"p",href:"https://pve.proxmox.com/wiki/Network_Configuration"},"Network Configuration")),(0,l.kt)("p",null,'{{< alert theme="danger" >}}\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u9700\u8981\u5c06eth0\u6539\u6210dhcp\u6216\u8005static\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u673a\u5668\u79bb\u7ebf\u3002\n{{< /alert >}}'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"auto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet dhcp # \u8fd9\u91cc\n\nauto vmbr0\niface vmbr0 inet static\n    address 10.10.10.1/24\n    gateway 10.10.10.1\n    bridge-ports eth0\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n    bridge-vids 2-4094\n\n    post-up   echo 1 > /proc/sys/net/ipv4/ip_forward\n    post-up   iptables -t nat -A POSTROUTING -s '10.10.10.0/24' -o eth0  -j MASQUERADE\n    post-down iptables -t nat -D POSTROUTING -s '10.10.10.0/24' -o eth0  -j MASQUERADE\n\nsource /etc/network/interfaces.d/*\n")),(0,l.kt)("h2",{id:"\u5f00\u5c0f\u9e21"},"\u5f00\u5c0f\u9e21"),(0,l.kt)("h3",{id:"\u914d\u7f6elxc\u5bb9\u5668"},"\u914d\u7f6eLXC\u5bb9\u5668"),(0,l.kt)("p",null,"\u9ed8\u8ba4CT Template\u4e0b\u8f7d\u901f\u5ea6\u5f88\u6162\uff0c\u8fd9\u91cc\u9009\u62e9\u6e05\u534e\u955c\u50cf\u6e90"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back\nsed -i 's|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm\n")),(0,l.kt)("p",null,"\u91cd\u542f\u751f\u6548\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"CT\u6a21\u7248",src:n(13438).Z,width:"650",height:"279"})),(0,l.kt)("h3",{id:"\u521b\u5efa\u5bb9\u5668"},"\u521b\u5efa\u5bb9\u5668"),(0,l.kt)("p",null,"\u4e0b\u8f7dDebian\u7b49CT\u6a21\u7248\u4f7f\u7528\u3002"),(0,l.kt)("p",null,"\u57fa\u4e8eDebian CT\u6a21\u7248\u521b\u5efa\u4e00\u4e2aLXC\u5bb9\u5668"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"\u521b\u5efa\u5bb9\u5668",src:n(26402).Z,width:"642",height:"296"})),(0,l.kt)("p",null,"\u7b49\u5f85\u5bb9\u5668\u542f\u52a8\u4e4b\u540e"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"ping 10.10.10.100\nPING 10.10.10.100 (10.10.10.100) 56(84) bytes of data.\n64 bytes from 10.10.10.100: icmp_seq=1 ttl=64 time=0.064 ms\n64 bytes from 10.10.10.100: icmp_seq=2 ttl=64 time=0.056 ms\n")),(0,l.kt)("h3",{id:"\u914d\u7f6e\u5bb9\u5668nat\u8bbf\u95ee"},"\u914d\u7f6e\u5bb9\u5668NAT\u8bbf\u95ee"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"iptables -t nat -I PREROUTING -p tcp -m tcp --dport 30022 -j DNAT --to-destination 10.10.10.100:22\niptables -t nat -I PREROUTING -p tcp -m multiport --dports 80,443 -j DNAT --to-destination 10.10.10.100\n\n# \u67e5\u770b nat PREROUTING \u7aef\u53e3\u6620\u5c04\u89c4\u5219\niptables -t nat -nvL PREROUTING\n\n# \u6e05\u7a7a nat PREROUTING \u7aef\u53e3\u6620\u5c04\u89c4\u5219\n# iptables -t nat -F PREROUTING\n")),(0,l.kt)("h3",{id:"\u5176\u4ed6"},"\u5176\u4ed6"),(0,l.kt)("p",null,"\u8fd8\u53ef\u4ee5\u518d\u6b21\u5957\u5a03\uff0c\u5728Debian LXC\u4e2d\u5b89\u88c5docker"))}m.isMDXComponent=!0},13438:function(e,t,n){t.Z=n.p+"assets/images/ct-003-d9a1d96708a45ad5b70f4f590b20da27.png"},26402:function(e,t,n){t.Z=n.p+"assets/images/ct-004-4c07122affa63b2ea4b61a8ae0eb7a5c.png"},49194:function(e,t,n){t.Z=n.p+"assets/images/network-001-94f3a8c58e380b22c9241d4e576c2c8a.png"},85239:function(e,t,n){t.Z=n.p+"assets/images/network-002-2fa0f953fe4eef27eaa8a2090e7da7b4.png"}}]);