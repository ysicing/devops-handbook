"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9450],{16029:function(n){n.exports=JSON.parse('{"blogPosts":[{"id":"/posts/gitea-flux-install","metadata":{"permalink":"/posts/gitea-flux-install","source":"@site/blog/posts/gitea-flux-install.md","title":"\u57fa\u4e8egitea\u5b89\u88c5flux","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5b89\u88c5flux","date":"2023-02-25T14:55:18.000Z","formattedDate":"2023\u5e742\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"gitops","permalink":"/tags/gitops"},{"label":"flux","permalink":"/tags/flux"}],"readingTime":0.3466666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u57fa\u4e8egitea\u5b89\u88c5flux","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5b89\u88c5flux","date":"2023-02-25T14:55:18.000Z","tags":["k8s","gitops","flux"]},"nextItem":{"title":"debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","permalink":"/posts/debian-swap"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u51c6\u5907\u5de5\u4f5c\\n\\n- \u5b89\u88c5flux\\n- \u540c\u6b65\u955c\u50cf\u5230\u817e\u8baf\u4e91\u955c\u50cf\u4ed3\u5e93\\n\\n## \u5b89\u88c5\\n\\n```bash\\nflux bootstrap git --url=ssh://git@git.ysicing.net/cloud/fluxcd.git --registry ccr.ccs.tencentyun.com/k7scn --private-key-file ~/.ssh/id_rsa\\n```\\n\\n## \u6821\u9a8c\\n\\n```bash\\nflux check\\n\u25ba checking prerequisites\\n\u2714 Kubernetes 1.24.10+k3s1 >=1.20.6-0\\n\u25ba checking controllers\\n\u2714 helm-controller: deployment ready\\n\u25ba ccr.ccs.tencentyun.com/k7scn/helm-controller:v0.29.0\\n\u2714 kustomize-controller: deployment ready\\n\u25ba ccr.ccs.tencentyun.com/k7scn/kustomize-controller:v0.33.0\\n\u2714 notification-controller: deployment ready\\n\u25ba ccr.ccs.tencentyun.com/k7scn/notification-controller:v0.31.0\\n\u2714 source-controller: deployment ready\\n\u25ba ccr.ccs.tencentyun.com/k7scn/source-controller:v0.34.0\\n\u25ba checking crds\\n\u2714 alerts.notification.toolkit.fluxcd.io/v1beta2\\n\u2714 buckets.source.toolkit.fluxcd.io/v1beta2\\n\u2714 gitrepositories.source.toolkit.fluxcd.io/v1beta2\\n\u2714 helmcharts.source.toolkit.fluxcd.io/v1beta2\\n\u2714 helmreleases.helm.toolkit.fluxcd.io/v2beta1\\n\u2714 helmrepositories.source.toolkit.fluxcd.io/v1beta2\\n\u2714 kustomizations.kustomize.toolkit.fluxcd.io/v1beta2\\n\u2714 ocirepositories.source.toolkit.fluxcd.io/v1beta2\\n\u2714 providers.notification.toolkit.fluxcd.io/v1beta2\\n\u2714 receivers.notification.toolkit.fluxcd.io/v1beta2\\n\u2714 all checks passed\\n```"},{"id":"/posts/debian-swap","metadata":{"permalink":"/posts/debian-swap","source":"@site/blog/posts/debian-swap.md","title":"debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5728Debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","date":"2023-02-01T08:55:18.000Z","formattedDate":"2023\u5e742\u67081\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":1.04,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5728Debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","date":"2023-02-01T08:55:18.000Z","tags":["debian"]},"prevItem":{"title":"\u57fa\u4e8egitea\u5b89\u88c5flux","permalink":"/posts/gitea-flux-install"},"nextItem":{"title":"debian\u5347\u7ea7\u5185\u6838","permalink":"/posts/debian-upgrade"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u51c6\u5907\u5de5\u4f5c\\n\\n\u9996\u5148\uff0c\u68c0\u67e5\u4f60\u7684\u7cfb\u7edf\u662f\u5426\u5df2\u7ecf\u6709 Swap \u5206\u533a\uff1a\\n\\n```bash\\nswapon -s\\n# \u6216\\nfree -m\\n```\\n\\n## \u64cd\u4f5c\\n\\n### \u521b\u5efaSWAP\u5206\u533a\\n\\n```bash\\nfallocate -l 1G /swapfile\\n# \u5982\u679c\u63d0\u793a\u547d\u4ee4\u4e0d\u5b58\u5728\\napt install util-linux\\n\\nchmod 600 /swapfile\\n\\n# \u6fc0\u6d3bSWAP\u5206\u533a\\nmkswap /swapfile\\nswapon /swapfile\\n\\n# \u518d\u6b21\u67e5\u770b\\n~$ swapon -s\\nFilename    Type  Size Used Priority\\n/swapfile                               file     1048572 291536 -2\\n~$ free -m\\n               total        used        free      shared  buff/cache   available\\nMem:            1725        1008         249           1         467         533\\nSwap:           1023         284         739\\n```\\n\\n### \u5f00\u673a\u81ea\u542f\\n\\n\u9700\u8981\u7f16\u8f91 `/etc/fstab` \u8fd9\u4e2a\u6587\u4ef6\uff0c\u6dfb\u52a0\u52a0\u4e0b\u9762\u7684\u5185\u5bb9\u5373\u53ef\uff1a\\n\\n```bash\\necho \\"/swapfile swap swap defaults 0 0\\" >> /etc/fstab\\n```\\n\\n### \u8c03\u6574\u7cfb\u7edf\u5185\u6838 Swappiness \u503c\\n\\nSwapiness \u662f Linux \u5185\u6838\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5b9a\u4e49\u4e86\u7cfb\u7edf\u4f7f\u7528\u4ea4\u6362\u7a7a\u95f4\u7684\u9891\u7387\uff0cSwapiness \u7684\u503c\u5728 0 \u5230 100 \u4e4b\u95f4\uff08\u9ed8\u8ba4\u662f 60\uff09\uff0c\u4e00\u4e2a\u4f4e\u7684\u503c\u4f1a\u4f7f\u5185\u6838\u5c3d\u53ef\u80fd\u5730\u907f\u514d\u4ea4\u6362\uff0c\u800c\u4e00\u4e2a\u9ad8\u7684\u503c\u4f1a\u4f7f\u5185\u6838\u66f4\u79ef\u6781\u5730\u4f7f\u7528\u4ea4\u6362\u7a7a\u95f4\u3002\\n\\n\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u662f 60\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 `cat /proc/sys/vm/swappiness` \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u503c\u3002\\n\\n\u4e00\u822c\u6211\u4eec\u53ef\u4ee5\u7ed9\u4ed6\u6539\u6210 10\uff1a\\n\\n```bash\\n# \u793a\u4f8b, \u6839\u636e\u5177\u4f53\u60c5\u51b5\u64cd\u4f5c\\necho \\"vm.swappiness=10\\" >> /etc/sysctl.conf\\nsysctl -p\\n# \u6216\u8005\u5b9e\u65f6\u751f\u6548\\nsysctl -w vm.swappiness=10\\n```\\n\\n## \u5173\u95edswap\\n\\n```\\nswapoff -v /swapfile\\n# \u5220\u9664 /etc/fstab \u5173\u4e8e /swapfile \u6302\u8f7d\u90e8\u5206\\nrm -rf /swapfile\\n```"},{"id":"/posts/debian-upgrade","metadata":{"permalink":"/posts/debian-upgrade","source":"@site/blog/posts/debian-upgrade.md","title":"debian\u5347\u7ea7\u5185\u6838","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5347\u7ea7Debian\u5185\u6838","date":"2023-02-01T08:55:18.000Z","formattedDate":"2023\u5e742\u67081\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":0.23666666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"debian\u5347\u7ea7\u5185\u6838","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5347\u7ea7Debian\u5185\u6838","date":"2023-02-01T08:55:18.000Z","tags":["debian"]},"prevItem":{"title":"debian\u624b\u5de5\u6dfb\u52a0Swap\u5206\u533a","permalink":"/posts/debian-swap"},"nextItem":{"title":"\u8f7b\u91cf\u4e91debian\u6302\u8f7d\u6570\u636e\u76d8","permalink":"/posts/qcloud-disk-mount"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u914d\u7f6e\u5e76\u66f4\u65b0\u8f6f\u4ef6\u6e90\\n\\n```bash\\ncat > /etc/apt/sources.list <<EOF\\ndeb http://mirrors.tencent.com/debian/ bullseye main contrib non-free\\ndeb http://mirrors.tencent.com/debian/ bullseye-updates main contrib non-free\\ndeb http://mirrors.tencent.com/debian/ bullseye-backports main contrib non-free\\ndeb http://mirrors.tencent.com/debian-security bullseye-security main contrib non-free\\nEOF\\napt update\\n```\\n\\n## \u5347\u7ea7\\n\\n```bash\\napt dist-upgrade -y\\napt install -t bullseye-backports linux-image-amd64 -y\\n```\\n\\n## \u66f4\u65b0\u5f15\u5bfc\u5e76\u91cd\u542f\\n\\n```bash\\nupdate-grub\\nreboot\\n```"},{"id":"/posts/qcloud-disk-mount","metadata":{"permalink":"/posts/qcloud-disk-mount","source":"@site/blog/posts/qcloud-disk-mount.md","title":"\u8f7b\u91cf\u4e91debian\u6302\u8f7d\u6570\u636e\u76d8","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5728Debian\u6302\u8f7d\u786c\u76d8","date":"2023-01-29T08:55:18.000Z","formattedDate":"2023\u5e741\u670829\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"},{"label":"\u8f7b\u91cf\u4e91","permalink":"/tags/\u8f7b\u91cf\u4e91"},{"label":"qcloud","permalink":"/tags/qcloud"}],"readingTime":1.2533333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u8f7b\u91cf\u4e91debian\u6302\u8f7d\u6570\u636e\u76d8","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u672c\u4eba\u5728Debian\u6302\u8f7d\u786c\u76d8","date":"2023-01-29T08:55:18.000Z","tags":["debian","\u8f7b\u91cf\u4e91","qcloud"]},"prevItem":{"title":"debian\u5347\u7ea7\u5185\u6838","permalink":"/posts/debian-upgrade"},"nextItem":{"title":"2022\u5e74\u5ea6\u603b\u7ed3","permalink":"/posts/2022"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u4ee5\u817e\u8baf\u4e91\u8f7b\u91cf\u793a\u4f8b\\n\\n:::info\\n\u9ed8\u8ba4\u5728\u63a7\u5236\u53f0\u5df2\u7ecf\u6302\u8f7d\\n:::\\n\\n## \u64cd\u4f5c\\n\\n```bash\\n# \u67e5\u770b\u78c1\u76d8\u540d\u79f0, \u6709\u4e24\u5757\u4e00\u4e2a\u662f\u7cfb\u7edf\u76d8\uff0c\u4e00\u4e2a\u662f\u6570\u636e\u76d8\\n> fdisk -l\\nDisk /dev/vda: 40 GiB, 42949672960 bytes, 83886080 sectors\\nUnits: sectors of 1 * 512 = 512 bytes\\nSector size (logical/physical): 512 bytes / 512 bytes\\nI/O size (minimum/optimal): 512 bytes / 512 bytes\\nDisklabel type: dos\\nDisk identifier: 0xbcfcb5cb\\n\\nDevice     Boot Start      End  Sectors Size Id Type\\n/dev/vda1  *     2048 83886046 83883999  40G 83 Linux\\n\\n\\nDisk /dev/vdb: 100 GiB, 107374182400 bytes, 209715200 sectors\\nUnits: sectors of 1 * 512 = 512 bytes\\nSector size (logical/physical): 512 bytes / 512 bytes\\nI/O size (minimum/optimal): 512 bytes / 512 bytes\\n\\n# \u683c\u5f0f\u5316ext4\\nmkfs -t ext4 /dev/vdb\\nmke2fs 1.46.2 (28-Feb-2021)\\nCreating filesystem with 26214400 4k blocks and 6553600 inodes\\nFilesystem UUID: 5430aae0-55fa-4695-b8c9-7989035663f3\\nSuperblock backups stored on blocks:\\n\\t32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,\\n\\t4096000, 7962624, 11239424, 20480000, 23887872\\n\\nAllocating group tables: done\\nWriting inode tables: done\\nCreating journal (131072 blocks):\\ndone\\nWriting superblocks and filesystem accounting information: done\\n\\n# \u4e34\u65f6\u6302\u8f7d\\nmount /dev/vdb /data\\n# \u9a8c\u8bc1\\ndf -h\\nFilesystem      Size  Used Avail Use% Mounted on\\nudev            965M     0  965M   0% /dev\\ntmpfs           199M  448K  198M   1% /run\\n/dev/vda1        40G  2.5G   36G   7% /\\ntmpfs           991M   24K  991M   1% /dev/shm\\ntmpfs           5.0M     0  5.0M   0% /run/lock\\ntmpfs           199M     0  199M   0% /run/user/0\\n/dev/vdb         98G   24K   93G   1% /data\\n```\\n\\n:::info\\n\u7528`fdisk`\u8fdb\u884c\u5206\u533a\u6302\u8f7d\u4e5f\u53ef\u4ee5\u54c8\uff0c\u4e5f\u6bd4\u8f83\u7b80\u5355`fdisk /dev/vdb`\u6309\u6b65\u9aa4\u6765\u5373\u53ef\\n:::\\n\\n## \u8bbe\u7f6e\u5f00\u673a\u6302\u8f7d\\n\\n:::info\\n\\n\u5c06\u6302\u8f7d\u4fe1\u606f\u6dfb\u52a0\u5230`fstab`\u91cc\u5373\u53ef, \u64cd\u4f5c\u524d\u5148\u5907\u4efd\\n\\n```bash\\ncp -r /etc/fstab /etc/fstab.20220927\\n```\\n\\n:::\\n\\n### UUID\u65b9\u5f0f(\u5e38\u89c1)\\n\\n```bash\\n# \u67e5\u770bID\\nblkid /dev/vdb\\n/dev/vdb: UUID=\\"5430aae0-55fa-4695-b8c9-7989035663f3\\" BLOCK_SIZE=\\"4096\\" TYPE=\\"ext4\\"\\n# fstab\u65b0\u589e\\nUUID=5430aae0-55fa-4695-b8c9-7989035663f3 /data ext4 defaults 0 0\\n```\\n\\n### \u4e91\u786c\u76d8(\u8f7b\u91cf\u63a8\u8350)\\n\\n```bash\\n# \u67e5\u770bID\\nls /dev/disk/by-id/virtio-disk-*\\n# fstab\u65b0\u589e\\n/dev/disk/by-id/virtio-disk-<ID> /data ext4 defaults 0 0\\n```"},{"id":"/posts/2022","metadata":{"permalink":"/posts/2022","source":"@site/blog/posts/2022.md","title":"2022\u5e74\u5ea6\u603b\u7ed3","description":"2022\u5e74\u5ea6\u603b\u7ed3","date":"2022-12-31T15:59:59.000Z","formattedDate":"2022\u5e7412\u670831\u65e5","tags":[{"label":"\u5e74\u5ea6\u603b\u7ed3","permalink":"/tags/\u5e74\u5ea6\u603b\u7ed3"}],"readingTime":1.6966666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"2022\u5e74\u5ea6\u603b\u7ed3","date":"2022-12-31T15:59:59.000Z","description":"2022\u5e74\u5ea6\u603b\u7ed3","tags":["\u5e74\u5ea6\u603b\u7ed3"]},"prevItem":{"title":"\u8f7b\u91cf\u4e91debian\u6302\u8f7d\u6570\u636e\u76d8","permalink":"/posts/qcloud-disk-mount"},"nextItem":{"title":"\u535a\u5ba2\u66f4\u65b0\u8bf4\u660e","permalink":"/posts/docs"}},"content":"> \u8ddd\u79bb2022\u5e74\u7ed3\u675f\u4e0d\u52301\u5c0f\u65f6\uff0c\u56de\u60f3\u8fd9\u4e00\u5e74\uff0c\u771f\u7684\u662f\u53d1\u751f\u4e86\u592a\u591a\u7684\u4e8b\u60c5\u3002\\n\\n\x3c!-- truncate --\x3e\\n\\n## \u56de\u987e2022\\n\\n\u56de\u60f3\u4e00\u4e0b\uff0c\u4e0d\u582a\u56de\u9996\u5c31\u4e0d\u56de\u9996\u4e86\u3002\\n\\n### \u8bfb\u4e66\\n\\n\u5e74\u521d\u7684\u65f6\u5019\u51b3\u5b9a\u8bb0\u5f55\u4eca\u5e74\u7684\u9605\u8bfb\u60c5\u51b5\uff0c\u8bb0\u5f55\u8bfb\u4e86\u4ec0\u4e48\u4e66\uff0c\u4ee5\u53ca\u7b80\u5355\u7684\u8bfb\u540e\u611f\u3002\u53e6\u5916\u611f\u8c22\u516c\u53f8\u7684\u6bcf\u65e5\u8bfb\u4e66\u6311\u6218\u8d5b\uff0c\u989d\u5916\u4e30\u5bcc\u4e86\u6211\u7684\u9605\u8bfb\u3002\\n\\n\u4eca\u5e74\u9605\u8bfb\u4e86\u63a5\u8fd1800\u5c0f\u65f6\u3002\u770b\u5b8c\u4e86\u5927\u698260\u672c\u4e66\uff0c\u7559\u4e0b\u4e86128\u6761\u7b14\u8bb0\u548c\u603b\u7ed3\u3002\u8fd9\u91cc\u7b80\u5355\u5217\u4e0b\uff0c\u6211\u89c9\u5f97\u503c\u5f97\u63a8\u8350\u7684\u4e66\u7c4d\\n\\n#### 2022\u8bfb\u4e66\\n\\n- \u4eba\u6708\u795e\u8bdd\\n- \u7231\u4f60\u5c31\u50cf\u7231\u751f\u547d\\n- \u7528\u535a\u5f08\u7684\u601d\u7ef4\u770b\u4e16\u754c\\n- \u6cd5\u6cbb\u7684\u7ec6\u8282\\n- \u5927\u660e\u738b\u671d1566\\n\\n### \u89c2\u5f71\\n\\n> \u4e3b\u8981B\u7ad9/youtube\u4e3a\u4e3b\\n\\n- \u7535\u5f7123\u90e8, \u5176\u4e2d\u7535\u5f71\u96624\u90e8\\n- \u7535\u89c6\u52676\u90e8\\n- \u8bb0\u5f55\u72478\u90e8\uff0c\u4e3b\u8981\u662f\u4eba\u6587\u793e\u79d1\uff0c\u5386\u53f2\uff0c\u6587\u5b66\\n\\n\u8fd9\u91cc\u7279\u522b\u611f\u8c22\\n\\n- B\u7ad9UP\u4e3b: \u5b59\u609f\u7a77, \u5200\u9a6c\u523b\u68ee, \u6b21\u7ea7\u82f1\u96c4\u5a04\u4e0d\u51e1, \u5c0f\u7ea6\u7ff0\u53ef\u6c57\\n- Youtube: \u79d1\u5e7bFANS, \u6237\u5916\u5c0f\u5317\u54e5, CCTV\u79d1\u6559\\n\\n### \u6280\u672f\\n\\n> \u4ec5\u4ece\u4e2a\u4eba\u65b9\u9762\\n\\n- \u9020\u4e86\u51e0\u4e2a\u8f6e\u5b50, \u7ed9\u81ea\u5df1\u8282\u7701\u4e86\u5f88\u591a\u65f6\u95f4\uff0c\u54c8\u54c8\u54c8\u8fd9\u53ef\u80fd\u662f\u552f\u4e00\u6bd4\u8f83\u503c\u5f97\u7684\\n- \u5728\u5f00\u6e90\u793e\u533a\u65b9\u9762,\u7ed9\u51e0\u4e2a\u5f00\u6e90\u9879\u76ee\u6c34\u4e86\u51e0\u4e2apatch, \u770b\u7684\u4ee3\u7801\u8d8a\u591a\u8d8a\u6df1\u5165\u5c31\u8d8a\u8ba4\u8bc6\u5230\u81ea\u5df1\u7684\u4e0d\u8db3\\n\\n> \u4e0a\u8ff0\u6570\u636e\u6765\u81ea\u4f17\u591aAPP\u5e74\u5ea6\u603b\u7ed3\\n\\n## \u5176\u4ed6\\n\\n\u5728\u6f2b\u957f\u800c\u53c8\u77ed\u6682\u7684\u4e00\u5e74\u4e2d,\u751f\u6d3b\u4e0d\u8fc7\u591a\u4e86\u4e00\u4e9b\u8270\u96be\u5ea6\u8fc7\u7684\u574e\u5777\u4e0e\u6ce2\u6298\u3002\\n\\n> \u8def\u9014\u6f2b\u6f2b\u7ec8\u6709\u4e00\u65e5\uff0c\u5e78\u4e0e\u4e0d\u5e78\u90fd\u6709\u5c3d\u5934\u3002\\n\\n## \u5373\u5c06\u5f00\u59cb\u76842023\u5e74\\n\\n- [ ] \u751f\u6d3b\u5065\u5eb7\u81ea\u5f8b\uff0c2022\u5e74\u610f\u8bc6\u5230\u5065\u5eb7\u5341\u5206\u65e0\u6bd4\u91cd\u8981\\n  - [ ] \u65e9\u7761\u89c9, \u4e0d\u71ac\u591c: \u7531\u4e8e\u4e4b\u524d\u90fd\u7761\u5f97\u6bd4\u8f83\u665a\uff0c\u65e0\u7279\u6b8a\u60c5\u51b5\uff0c\u6bcf\u5468\u6700\u591a\u4e00\u5929\u665a\u7761(12\u70b9\u4e4b\u540e\u7761\u89c9)\\n  - [ ] \u575a\u6301\u953b\u70bc: \u53bb\u5e74\u7d2f\u8ba1\u953b\u70bc\u4e86121\u5929\\n  - [ ] \u5065\u5eb7\u996e\u98df\u3001\u63a7\u5236\u4f53\u91cd: \u4fdd\u6301\u572860-65KG\\n- [ ] \u77e5\u8bc6\u56fe\u8c31\u6784\u5efa\\n\\nFlag \u5c31\u5148\u7acb\u8fd9\u4e48\u591a\uff0c\u9884\u795d\u5927\u5bb6\u65b0\u5e74\u5feb\u4e50 :-)"},{"id":"/posts/docs","metadata":{"permalink":"/posts/docs","source":"@site/blog/posts/docs.md","title":"\u535a\u5ba2\u66f4\u65b0\u8bf4\u660e","description":"\u540e\u9762\u4e3b\u8981\u66f4\u65b0[\u6587\u6863](/docs/)","date":"2022-09-07T14:09:20.000Z","formattedDate":"2022\u5e749\u67087\u65e5","tags":[{"label":"site","permalink":"/tags/site"}],"readingTime":0.15666666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u535a\u5ba2\u66f4\u65b0\u8bf4\u660e","date":"2022-09-07T14:09:20.000Z","description":"\u540e\u9762\u4e3b\u8981\u66f4\u65b0[\u6587\u6863](/docs/)","tags":["site"]},"prevItem":{"title":"2022\u5e74\u5ea6\u603b\u7ed3","permalink":"/posts/2022"},"nextItem":{"title":"\u914d\u7f6eAWS Load Balancer Controller \u9644\u52a0\u7ec4\u4ef6","permalink":"/posts/eks-add-alb"}},"content":"\u540e\u9762\u4e3b\u8981\u66f4\u65b0[\ud83d\udcd2\u7b14\u8bb0\ud83d\udd25](/docs/intro), \u535a\u5ba2\u4ec5\u4e3a\u5b58\u6863\u3002\\n\\n\x3c!-- truncate --\x3e\\n\\n## \u7231\u53d1\u7535\\n\\n> \u5982\u679c\u4f60\u89c9\u5f97\u9879\u76ee\u5bf9\u4f60\u53ef\u80fd\u6709\u7528\uff0c\u90a3\u4e48\u6765\u652f\u6301\u4e00\u4e0b\u5427\uff01[\u7231\u53d1\u7535@ysicing](https://afdian.net/@ysicing)"},{"id":"/posts/eks-add-alb","metadata":{"permalink":"/posts/eks-add-alb","source":"@site/blog/posts/eks-add-alb.md","title":"\u914d\u7f6eAWS Load Balancer Controller \u9644\u52a0\u7ec4\u4ef6","description":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"eks","permalink":"/tags/eks"}],"readingTime":0.6133333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u914d\u7f6eAWS Load Balancer Controller \u9644\u52a0\u7ec4\u4ef6","date":"2022-05-25T14:55:18.000Z","description":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","tags":["k8s","eks"]},"prevItem":{"title":"\u535a\u5ba2\u66f4\u65b0\u8bf4\u660e","permalink":"/posts/docs"},"nextItem":{"title":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","permalink":"/posts/eks-add-master"}},"content":"AWS Load Balancer Controller \u7ba1\u7406\u9002\u7528\u4e8e Kubernetes \u96c6\u7fa4\u7684 AWS \u5f39\u6027\u8d1f\u8f7d\u5747\u8861\u5668\\n\\n\x3c!-- truncate --\x3e\\n\\n- \u652f\u6301\u5e94\u7528\u8d1f\u8f7d\u5747\u8861ALB\\n- \u652f\u6301\u7f51\u7edc\u8d1f\u8f7d\u5747\u8861NLB\\n\\n## \u5b89\u88c5\\n\\n:::info\\n\u9ed8\u8ba4\u96c6\u7fa4\u540d: `demo-us-eks-prod-01`, \u9700\u8981\u81ea\u884c\u66ff\u6362\\n:::\\n\\n### \u521b\u5efaIAM Policy\\n\\n```bash\\ncurl -o iam_policy.json https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.4.3/docs/install/iam_policy.json\\n\\naws iam create-policy \\\\\\n    --policy-name AWSLoadBalancerControllerIAMPolicy \\\\\\n    --policy-document file://iam_policy.json\\n```\\n\\n### \u521b\u5efaIAM\u89d2\u8272\\n\\n```bash\\neksctl create iamserviceaccount \\\\\\n  --cluster=demo-us-eks-prod-01 \\\\\\n  --namespace=kube-system \\\\\\n  --name=aws-load-balancer-controller \\\\\\n  --role-name \\"AmazonEKSLoadBalancerControllerRole\\" \\\\\\n  --attach-policy-arn=arn:aws:iam::<\u6839ID>:policy/AWSLoadBalancerControllerIAMPolicy \\\\\\n  --approve\\n```\\n\\n### \u5b89\u88c5cert-manager\\n\\n```bash\\nkubectl apply \\\\\\n    --validate=false \\\\\\n    -f https://github.com/jetstack/cert-manager/releases/download/v1.5.4/cert-manager.yaml\\n```\\n\\n### \u5b89\u88c5\u63a7\u5236\u5668\\n\\n```bash\\ncurl -Lo v2_4_3_full.yaml https://github.com/kubernetes-sigs/aws-load-balancer-controller/releases/download/v2.4.3/v2_4_3_full.yaml\\n# \u53bb\u9664\u9ed8\u8ba4\u8d26\u6237, \u4e0a\u9762\u521b\u5efa\u89d2\u8272\u65f6\u5df2\u7ecf\u751f\u6210\\nsed -i.bak -e \'480,488d\' ./v2_4_3_full.yaml\\n# \u4fee\u6539\u81ea\u5df1\u96c6\u7fa4\u540d\\nsed -i.bak -e \'s|your-cluster-name|demo-us-eks-prod-01|\' ./v2_4_3_full.yaml\\n# \u751f\u6548\\nkubectl apply -f v2_4_3_full.yaml\\n# \u8bbe\u7f6eingresclass\\ncurl -Lo v2_4_3_ingclass.yaml https://github.com/kubernetes-sigs/aws-load-balancer-controller/releases/download/v2.4.3/v2_4_3_ingclass.yaml\\nkubectl apply -f v2_4_3_ingclass.yaml\\n```"},{"id":"/posts/eks-add-master","metadata":{"permalink":"/posts/eks-add-master","source":"@site/blog/posts/eks-add-master.md","title":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","description":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"eks","permalink":"/tags/eks"},{"label":"eksctl","permalink":"/tags/eksctl"}],"readingTime":0.08,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","date":"2022-05-25T14:55:18.000Z","description":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","tags":["k8s","eks","eksctl"]},"prevItem":{"title":"\u914d\u7f6eAWS Load Balancer Controller \u9644\u52a0\u7ec4\u4ef6","permalink":"/posts/eks-add-alb"},"nextItem":{"title":"\u914d\u7f6eExternal DNS\u9644\u52a0\u7ec4\u4ef6\u652f\u6301DNSPod","permalink":"/posts/eks-dnspod-external-dns"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u6dfb\u52a0\u7ba1\u7406\u5458\\n\\n```bash\\neksctl create iamidentitymapping     --cluster demo-us-eks-prod-01     --region=us-east-1     --arn arn:aws:iam::<\u6839ID>:user/demo --group system:masters     --no-duplicate-arns\\n```"},{"id":"/posts/eks-dnspod-external-dns","metadata":{"permalink":"/posts/eks-dnspod-external-dns","source":"@site/blog/posts/eks-dnspod-external-dns.md","title":"\u914d\u7f6eExternal DNS\u9644\u52a0\u7ec4\u4ef6\u652f\u6301DNSPod","description":"eks\u96c6\u7fa4\u57fa\u4e8ednspod\u914d\u7f6eExternal DNS","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"eks","permalink":"/tags/eks"},{"label":"dns","permalink":"/tags/dns"},{"label":"dnspod","permalink":"/tags/dnspod"}],"readingTime":1.5066666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u914d\u7f6eExternal DNS\u9644\u52a0\u7ec4\u4ef6\u652f\u6301DNSPod","date":"2022-05-25T14:55:18.000Z","description":"eks\u96c6\u7fa4\u57fa\u4e8ednspod\u914d\u7f6eExternal DNS","tags":["k8s","eks","dns","dnspod"]},"prevItem":{"title":"eks\u96c6\u7fa4\u6dfb\u52a0\u7ba1\u7406\u5458","permalink":"/posts/eks-add-master"},"nextItem":{"title":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","permalink":"/posts/eks-eksctl-deploy"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u6bd4\u8f83\u7b80\u5355\u76f4\u63a5\u4e0a\u4ee3\u7801\\n\\n:::info\\n\u793a\u4f8b\u57df\u540d`example.com`\\n:::\\n\\n## \u5b89\u88c5\\n\\n```yaml\\n# e-dns.yaml\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: external-dns\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRole\\nmetadata:\\n  name: external-dns\\nrules:\\n- apiGroups: [\\"\\"]\\n  resources: [\\"services\\",\\"endpoints\\",\\"pods\\"]\\n  verbs: [\\"get\\",\\"watch\\",\\"list\\"]\\n- apiGroups: [\\"extensions\\",\\"networking.k8s.io\\"]\\n  resources: [\\"ingresses\\"]\\n  verbs: [\\"get\\",\\"watch\\",\\"list\\"]\\n- apiGroups: [\\"\\"]\\n  resources: [\\"nodes\\"]\\n  verbs: [\\"list\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: ClusterRoleBinding\\nmetadata:\\n  name: external-dns-viewer\\nroleRef:\\n  apiGroup: rbac.authorization.k8s.io\\n  kind: ClusterRole\\n  name: external-dns\\nsubjects:\\n- kind: ServiceAccount\\n  name: external-dns\\n  namespace: kube-system\\n---\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  name: external-dns\\ndata:\\n  tencent-cloud.json: |\\n    {\\n      \\"regionId\\": \\"ap-shanghai\\",\\n      \\"secretId\\": \\"...\u81ea\u884c\u66ff\u6362...\\",\\n      \\"secretKey\\": \\"...\u81ea\u884c\u66ff\u6362...\\",\\n      \\"internetEndpoint\\": true\\n    }\\n---\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: external-dns\\nspec:\\n  strategy:\\n    type: Recreate\\n  selector:\\n    matchLabels:\\n      app: external-dns\\n  template:\\n    metadata:\\n      labels:\\n        app: external-dns\\n    spec:\\n      containers:\\n      - args:\\n        - --source=service\\n        - --source=ingress\\n        - --domain-filter=example.com # \u5c06\u4f7f ExternalDNS \u4ec5\u770b\u5230\u4e0e\u63d0\u4f9b\u7684\u57df\u5339\u914d\u7684\u6258\u7ba1\u533a\u57df\uff0c\u7701\u7565\u4ee5\u5904\u7406\u6240\u6709\u53ef\u7528\u7684\u6258\u7ba1\u533a\u57df\\n        - --provider=tencentcloud\\n        - --policy=sync # \u8bbe\u7f6e\u201cupsert-only\u201d\u5c06\u963b\u6b62 ExternalDNS \u5220\u9664\u4efb\u4f55\u8bb0\u5f55\\n        - --tencent-cloud-zone-type=public # \u4ec5\u7ba1\u7406\u79c1\u6709\u6258\u7ba1\u533a\u57df\u3002\u8bbe\u7f6e\u201cpublic\u201d\u4ee5\u4f7f\u7528\u516c\u7f51 DNS \u670d\u52a1\\n        - --tencent-cloud-config-file=/etc/kubernetes/tencent-cloud.json\\n        - --log-level=debug\\n        image: ysicing/dnspod-external-dns:v1.1.0\\n        imagePullPolicy: Always\\n        name: external-dns\\n        resources:\\n          limits:\\n            cpu: 500m\\n            memory: 512Mi\\n          requests:\\n            cpu: 100m\\n            memory: 128Mi\\n        terminationMessagePath: /dev/termination-log\\n        terminationMessagePolicy: File\\n        volumeMounts:\\n        - mountPath: /etc/kubernetes\\n          name: config-volume\\n          readOnly: true\\n      dnsPolicy: ClusterFirst\\n      restartPolicy: Always\\n      schedulerName: default-scheduler\\n      securityContext: {}\\n      serviceAccount: external-dns\\n      serviceAccountName: external-dns\\n      terminationGracePeriodSeconds: 30\\n      volumes:\\n      - configMap:\\n          defaultMode: 420\\n          items:\\n          - key: tencent-cloud.json\\n            path: tencent-cloud.json\\n          name: external-dns\\n        name: config-volume\\n```\\n\\n\u751f\u6548\\n\\n```bash\\nkubectl apply -f e-dns.yaml -n kube-system\\n```\\n\\n## \u6d4b\u8bd5\\n\\n```yaml\\n---\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: whoami\\nspec:\\n  selector:\\n    matchLabels:\\n      app.kubernetes.io/name: whoami\\n  replicas: 5\\n  template:\\n    metadata:\\n      labels:\\n        app.kubernetes.io/name: whoami\\n    spec:\\n      containers:\\n      - image: ysicing/whoami:2022\\n        imagePullPolicy: Always\\n        name: whoami\\n        resources:\\n          requests:\\n            cpu: 100m\\n            memory: 100Mi\\n          limits:\\n            cpu: 100m\\n            memory: 100Mi\\n        ports:\\n        - containerPort: 32379\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: whoami\\nspec:\\n  ports:\\n    - port: 80\\n      targetPort: 32379\\n      protocol: TCP\\n  selector:\\n    app.kubernetes.io/name: whoami\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: whoami-01\\n  annotations:\\n    alb.ingress.kubernetes.io/scheme: internet-facing\\n    alb.ingress.kubernetes.io/target-type: ip\\n    alb.ingress.kubernetes.io/group.name: whoami\\n    alb.ingress.kubernetes.io/listen-ports: \'[{\\"HTTP\\": 80},{\\"HTTPS\\": 443}]\'\\n    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:<\u6839ID>:certificate/<cid>\\n    external-dns.alpha.kubernetes.io/hostname: 02.whoami.example.com\\nspec:\\n  ingressClassName: alb\\n  rules:\\n    - host: 02.whoami.example.com\\n      http:\\n        paths:\\n        - path: /\\n          pathType: Prefix\\n          backend:\\n            service:\\n              name: whoami\\n              port:\\n                number: 80\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: whoami-02\\n  annotations:\\n    alb.ingress.kubernetes.io/scheme: internet-facing\\n    alb.ingress.kubernetes.io/target-type: ip\\n    alb.ingress.kubernetes.io/group.name: whoami\\n    alb.ingress.kubernetes.io/listen-ports: \'[{\\"HTTP\\": 80},{\\"HTTPS\\": 443}]\'\\n    external-dns.alpha.kubernetes.io/hostname: 01.whoami.example.com\\n    # alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-east-1:<\u6839ID>:certificate/<cid>\\nspec:\\n  ingressClassName: alb\\n  rules:\\n    - host: 01.whoami.example.com\\n      http:\\n        paths:\\n        - path: /\\n          pathType: Prefix\\n          backend:\\n            service:\\n              name: whoami\\n              port:\\n                number: 80\\n```"},{"id":"/posts/eks-eksctl-deploy","metadata":{"permalink":"/posts/eks-eksctl-deploy","source":"@site/blog/posts/eks-eksctl-deploy.md","title":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","description":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"eks","permalink":"/tags/eks"},{"label":"eksctl","permalink":"/tags/eksctl"}],"readingTime":2.73,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","date":"2022-05-25T14:55:18.000Z","description":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","tags":["k8s","eks","eksctl"]},"prevItem":{"title":"\u914d\u7f6eExternal DNS\u9644\u52a0\u7ec4\u4ef6\u652f\u6301DNSPod","permalink":"/posts/eks-dnspod-external-dns"},"nextItem":{"title":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","permalink":"/posts/headscale-caddy-derper-proxy"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u6240\u6709\u64cd\u4f5c\u5747\u5728\u5883\u5916\u73af\u5883\u64cd\u4f5c\uff0c\u907f\u514d\u8c03\u7528aws api\u8d85\u65f6\u5bfc\u81f4\u5931\u8d25\u3002\\n\\n## \u751f\u6210aws secrets\\n\\n\u521b\u5efa\u4e00\u4e2a\u5b50\u8d26\u53f7\u751f\u6210secrets, \u7ed9\u4e88\u7ba1\u7406\u5458\u6743\u9650\\n\\n```bash\\ncat ~/.aws/credentials\\n\\n[default]\\naws_access_key_id=<id>\\naws_secret_access_key=<key>\\n```\\n\\n## \u5b89\u88c5 aws-iam-authenticator\\n\\n```bash\\n# \u4e0b\u8f7daws-iam-authenticator\\ncurl -o aws-iam-authenticator https://s3.us-west-2.amazonaws.com/amazon-eks/1.21.2/2021-07-05/bin/linux/amd64/aws-iam-authenticator\\n# \u4e0b\u8f7d\u6821\u9a8c\u6587\u4ef6\\ncurl -o aws-iam-authenticator.sha256 https://s3.us-west-2.amazonaws.com/amazon-eks/1.21.2/2021-07-05/bin/linux/amd64/aws-iam-authenticator.sha256\\n# \u6821\u9a8c\\nopenssl sha1 -sha256 aws-iam-authenticator\\n# \u5b89\u88c5\u5230path\u76ee\u5f55\u4e0b\\nmv aws-iam-authenticator /usr/local/bin/aws-iam-authenticator\\nchmod +x /usr/local/bin/aws-iam-authenticator\\n# \u6d4b\u8bd5\\naws-iam-authenticator --help\\n```\\n\\n## \u5b89\u88c5aws\\n\\n```bash\\ncurl \\"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip\\" -o \\"awscliv2.zip\\"\\nunzip awscliv2.zip\\n./aws/install\\n```\\n\\n## \u5b89\u88c5kubectl\u547d\u4ee4\\n\\n\u5b89\u88c5\u96c6\u7fa4\u4e2d\u4f1a\u8c03\u7528kubectl\u547d\u4ee4\\n\\n```bash\\n# \u4ece\u5b98\u65b9\u4e0b\u8f7d\\nwget https://dl.k8s.io/v1.22.12/kubernetes-client-linux-amd64.tar.gz\\ntar xzvfC kubernetes-client-linux-amd64.tar.gz /tmp\\nmv /tmp/kubernetes/client/bin/kubectl /usr/local/bin\\nrm -rf kubernetes-client-linux-amd64.tar.gz\\nrm -rf /tmp/kubernetes\\n# \u6216\u8005\u4eceaws\u4e0b\u8f7d\uff0c\u4e24\u8005\u5dee\u522b\u4e0d\u5927\uff0c\u6700\u597d\u4e0d\u8981\u8de8\u591a\u4e2a\u7248\u672c\\ncurl -o /usr/local/bin/kubectl https://s3.us-west-2.amazonaws.com/amazon-eks/1.22.6/2022-03-09/bin/linux/amd64/kubectl\\nchmod +x /usr/local/bin/kubectl\\n# \u9a8c\u8bc1\\nkubectl version | grep Client | cut -d : -f 5\\n```\\n\\n## \u5b89\u88c5helm\\n\\n```bash\\ncurl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\\nchmod 700 get_helm.sh\\n./get_helm.sh\\n```\\n\\n## \u5b89\u88c5eksctl\\n\\n```bash\\ncurl --silent --location \\"https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz\\" | tar xz -C /tmp\\n mv /tmp/eksctl /usr/local/bin\\n# \u6d4b\u8bd5\\neksctl version\\n0.108.0\\n```\\n\\n## \u521b\u5efaaws eks\u96c6\u7fa4\\n\\n> \u4ec5\u4f9b\u53c2\u8003\\n\\n```yaml\\napiVersion: eksctl.io/v1alpha5\\nkind: ClusterConfig\\n\\nmetadata:\\n  # eks\u96c6\u7fa4\u540d\\n  name: demo-us-eks-prod-01\\n  # eks\u96c6\u7fa4\u6240\u5728region\\n  region: us-east-1\\n  # eks \u7248\u672c\\n  # version: \\"1.22\\"\\n\\n# \u5b9a\u4e49ipv4, \u652f\u6301ipv6\\n# kubernetesNetworkConfig:\\n#   ipFamily: IPv4\\n\\nvpc:\\n  # \u6307\u5b9a\u5b50\u7f51\\n  cidr: 10.10.0.0/16\\n  # \u9650\u5236public api\u8bbf\u95ee\\n  # publicAccessCIDRs: [\\"1.2.3.4/32\\"]\\n  # \u5f00\u542fapi\u8bbf\u95ee\\n  clusterEndpoints:\\n    publicAccess: true\\n    privateAccess: true\\n  # nat gateway\\n  nat:\\n    gateway: Single  #HighlyAvailable\\n\\n# \u96c6\u7fa4\u63d2\u4ef6\\naddons:\\n  - name: vpc-cni\\n  - name: coredns\\n  - name: kube-proxy\\n\\niam:\\n  withOIDC: true\\n\\n# \u5168\u5c40\u53ef\u7528\u533a\uff0c\u4e5f\u53ef\u4ee5\u9488\u5bf9\u67d0\u4e2anodegroup\u5355\u72ec\u8bbe\u7f6e\\navailabilityZones: [\\"us-east-1a\\", \\"us-east-1b\\"]\\n\\n# \u8282\u70b9\u6c60\\nnodeGroups:\\n    # \u7cfb\u7edf\u8282\u70b9\\n  - name: system-1-a    # worker nodegroup\u540d\u5b57\\n    labels: { nodetype: system }  # worker \u8282\u70b9\u7684labels\\n    instanceType: c6g.2xlarge   # \u8ba1\u5212\u4f7f\u7528\u7684EC2\u7c7b\u578b\\n    minSize: 1      # autoscaling \u6700\u5c0f\u503c\\n    desiredCapacity: 1  # autoscaling \u5e38\u89c4\u503c\\n    maxSize: 2 # autoscaling \u6700\u5927\u503c\\n    volumeSize: 200 ##\u7cfb\u7edf\u7cfb\u7edf\u76d8\u5927\u5c0f\\n    volumeType: gp3 ##\u7cfb\u7edf\u76d8\u7c7b\u578b\\n    # availabilityZones: [\\"us-east-1a\\", \\"us-east-1b\\"] ##nodegroup\u6240\u5728AZ\\n    privateNetworking: true ##\u662f\u5426\u4f7f\u7528\u79c1\u6709\u7f51\u7edc\\n    amiFamily: AmazonLinux2\\n    containerRuntime: containerd\\n    securityGroups: ##\u662f\u5426\u4f7f\u7528\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\\n      withShared: true\\n      withLocal: true\\n      # attachIDs: [\\"sg-xxxx\\"]   ##\u81ea\u5b9a\u4e49\u5b89\u5168\u7ec4\u7684\u540d\u5b57\u521b\u5efa\u4e00\u4e2a\u9ed8\u8ba4\u7684\u5b89\u5168\u7ec4\\n    ssh:\\n      publicKeyPath: /root/.ssh/id_rsa.pub  ##\u53ef\u4ee5ssh\u5230worker\u7684key\u540d\u5b57\\n    tags:\\n      \'Project\': \'Demo\' ##\u5b9a\u4e49\u4e00\u4e2atag\uff0c\u8ba1\u8d39\u4f7f\u7528\\n      \'k8s.io/cluster-autoscaler/enabled\': \'true\'   ##\u5b9a\u4e49\u81ea\u52a8\u6269\u5bb9\u7684tag\\n      \'k8s.io/cluster-autoscaler/nuclearport-ohio-eks-prod\': \'owned\'    ##\u5b9a\u4e49\u81ea\u52a8\u6269\u5bb9\u7684tag\\n    taints:\\n        uessystem: \\"true:NoSchedule\\"    ## \u5b9a\u4e49\u4e2a\u6c61\u70b9\\n    iam:\\n      withAddonPolicies:    ##\u9009\u62e9eks\u9700\u8981\u4f7f\u7528\u7684iam\u6743\u9650\\n        #imageBuilder: true\\n        autoScaler: true\\n        externalDNS: true\\n        certManager: true\\n        #appMesh: true\\n        ebs: true\\n        #fsx: true\\n        efs: true\\n        albIngress: true\\n        #xRay: true\\n        cloudWatch: true\\n\\n # worker\u8282\u70b9(\u4e00\u4e2a\u4ece0\u5f00\u59cb\u7684\u5f39\u6027\u96c6\u7fa4)\\n  - name: worker-1-a    ##worker nodegroup\u540d\u5b57\\n    labels:\\n      nodetype: worker\\n    instanceType: c6g.2xlarge   ##\u8ba1\u5212\u4f7f\u7528\u7684EC2\u7c7b\u578b\\n    minSize: 0      ##autoscaling \u6700\u5c0f\u503c\\n    desiredCapacity: 0  ##autoscaling \u5e38\u89c4\u503c\\n    maxSize: 5 ##autoscaling \u6700\u5927\u503c\\n    volumeSize: 200 ##\u7cfb\u7edf\u7cfb\u7edf\u76d8\u5927\u5c0f\\n    volumeType: gp3 ##\u7cfb\u7edf\u76d8\u7c7b\u578b\\n    privateNetworking: true\\n    amiFamily: AmazonLinux2\\n    containerRuntime: containerd\\n    securityGroups:\\n      withShared: true\\n      withLocal: true\\n      # attachIDs: [\\"sg-xxxx\\"]\\n    ssh:\\n      # publicKeyName: \'xxxxx\'  ##\u53ef\u4ee5ssh\u5230worker\u7684key\u540d\u5b57\\n      publicKeyPath: /root/.ssh/id_rsa.pub\\n    tags:\\n      \'Project\': \'Demo\' ##tag\\n      \'k8s.io/cluster-autoscaler/enabled\': \'true\'\\n      \'k8s.io/cluster-autoscaler/nuclearport-ohio-eks-prod\': \'owned\'\\n      k8s.io/cluster-autoscaler/node-template/label/nodetype: worker\\n      k8s.io/cluster-autoscaler/node-template/taint/feaster: \\"true:NoSchedule\\"\\n    taints:\\n      useworker: \\"true:NoSchedule\\"\\n    iam:\\n      withAddonPolicies:\\n        #imageBuilder: true\\n        autoScaler: true\\n        externalDNS: true\\n        certManager: true\\n        #appMesh: true\\n        ebs: true\\n        #fsx: true\\n        efs: true\\n        albIngress: true\\n        #xRay: true\\n        cloudWatch: true\\n\\n# \u65e5\u5fd7\u6536\u96c6\u7ec4\u4ef6\uff0c\u7c7b\u578bcls\u65e5\u5fd7\u6536\u96c6\\ncloudWatch:\\n  clusterLogging:\\n    # enable specific types of cluster control plane logs\\n    enableTypes: [\\"audit\\", \\"authenticator\\", \\"controllerManager\\"]\\n    # all supported types: \\"api\\", \\"audit\\", \\"authenticator\\", \\"controllerManager\\", \\"scheduler\\"\\n    # supported special values: \\"*\\" and \\"all\\"\\n```\\n\\n\u521b\u5efa\u96c6\u7fa4\\n\\n```bash\\n# \u5927\u6982\u8017\u65f630-40\u5206\u949f\\neksctl create cluster -f demo.yaml --auto-kubeconfig\\n```\\n\\n## \u9500\u6bc1\u96c6\u7fa4\\n\\n```bash\\neksctl delete cluster -f demo.yaml --force\\n```"},{"id":"/posts/headscale-caddy-derper-proxy","metadata":{"permalink":"/posts/headscale-caddy-derper-proxy","source":"@site/blog/posts/headscale-caddy-derper-proxy.md","title":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","description":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"headscale","permalink":"/tags/headscale"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"derper","permalink":"/tags/derper"},{"label":"caddy","permalink":"/tags/caddy"}],"readingTime":0.72,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","date":"2022-05-25T14:55:18.000Z","description":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","tags":["headscale","tailscale","derper","caddy"]},"prevItem":{"title":"\u901a\u8fc7eksctl\u521b\u5efaeks\u96c6\u7fa4","permalink":"/posts/eks-eksctl-deploy"},"nextItem":{"title":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","permalink":"/posts/headscale-derper"}},"content":"\x3c!-- truncate --\x3e\\n\\n:::warning\\n\u6839\u636e\u6211\u4e2a\u4eba\u6700\u8fd1\u7684\u5b9e\u8df5caddy + derper \u8c8c\u4f3c\u4e0d\u53ef\u7528.\\n:::\\n\\n## \u573a\u666f\\n\\n\u901a\u5e38derper\u8282\u70b9\u4e0a\u4e5f\u9700\u8981\u8dd1\u4e00\u4e9bweb\u670d\u52a1\uff0c\u9700\u8981\u590d\u7528443\u7aef\u53e3\\n\\n## Caddy\\n\\n:::info\\ncaddy2 \u5728 v2.5.0 \u7248\u672c\u4e4b\u540e\u96c6\u6210tailscale\u63d2\u4ef6\\n\\n\u540e\u7eed\u4f7f\u7528`derper.domain.com`\u793a\u4f8b\\n\\n:::\\n\\n### \u5982\u4f55\u9a8c\u8bc1\u662f\u5426\u5305\u542btailscale\u63d2\u4ef6\\n\\n```bash\\ndin caddy2 ash\\n# \u8fdb\u5bb9\u5668\u67e5\u770bmodules\uff0c\u6709\u6ca1\u6709\u9700\u8981\\"tls.get_certificate.tailscale\\"\\ncaddy list-modules\\n```\\n\\n### Caddyfile\\n\\n```bash\\n# Caddyfile\\nderper.domain.com {\\n        tls {\\n                get_certificate tailscale\\n        }\\n        reverse_proxy / 10.0.4.11:77 {\\n        }\\n}\\n```\\n\\n### derper\\n\\n> \u5386\u53f2\u539f\u56e0\u61d2\u5f97\u8c03\u6574,\u53ef\u4ee5\u6539\u6210\u5bb9\u5668\u90e8\u7f72\u54c8\\n\\n```bash\\n# /etc/systemd/system/derper.service\\n[Unit]\\nDescription=derper\\n\\n[Service]\\nStartLimitInterval=5\\nStartLimitBurst=10\\nExecStart=/usr/local/bin/derper -hostname derper.domain.com -a \\":77\\" -verify-clients\\nRestart=always\\nRestartSec=15\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n## \u90e8\u7f72\\n\\n```yaml\\n# docker-compose.yml\\nversion: \\"3\\"\\n\\nservices:\\n  caddy2:\\n    image: caddy\\n    container_name: caddy2\\n    ports:\\n      - \\"2019:2019\\"\\n      - \\"80:80\\"\\n      - \\"443:443\\"\\n    restart: always\\n    volumes:\\n      - $PWD/Caddyfile:/etc/caddy/Caddyfile\\n      - caddy_data:/data\\n      - caddy_config:/config\\n    networks:\\n      - service\\n\\nnetworks:\\n  service:\\n    external: false\\n\\nvolumes:\\n  caddy_data:\\n    driver: local\\n  caddy_config:\\n    driver: local\\n```\\n\\n\u8fd0\u884c\u542f\u52a8\u5c31ok\u4e86\\n\\n```bash\\ndocker compose -f docker-compose.yml up -d\\n```"},{"id":"/posts/headscale-derper","metadata":{"permalink":"/posts/headscale-derper","source":"@site/blog/posts/headscale-derper.md","title":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","description":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"headscale","permalink":"/tags/headscale"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"derper","permalink":"/tags/derper"}],"readingTime":1.3033333333333332,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","date":"2022-05-25T14:55:18.000Z","description":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","tags":["headscale","tailscale","derper"]},"prevItem":{"title":"\u57fa\u4e8e Caddy2 \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","permalink":"/posts/headscale-caddy-derper-proxy"},"nextItem":{"title":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","permalink":"/posts/headscale-dsm7"}},"content":"> \u672c\u6587\u5c06\u4f1a\u4ecb\u7ecd\u5982\u4f55\u8ba9 Headscale  \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 DERP Servers\\n\\n\x3c!-- truncate --\x3e\\n\\n## Derper \u662f\u4ec0\u4e48\uff1f\\n\\n\u53ef\u4ee5\u9605\u8bfb [\u7c73\u5f00\u6717\u57fa\u6768 - \u4e2d\u7ee7\u534f\u8bae\u7b80\u4ecb](https://icloudnative.io/posts/custom-derp-servers/#\u4e2d\u7ee7\u534f\u8bae\u7b80\u4ecb)\\n\\n## \u5b9e\u64cd\\n\\n### \u6784\u5efaderper\\n\\n:::info\\n\u6700\u65b0\u7248\u672c\u9700\u8981go1.19\u7248\u672c\\n\\ngo\u73af\u5883:\\n\\n```bash\\nwget https://golang.google.cn/dl/go1.19.linux-amd64.tar.gz\\ntar -C /usr/local -xzf go1.19.linux-amd64.tar.gz\\nexport PATH=$PATH:/usr/local/go/bin\\ngo env -w GOPROXY=https://goproxy.cn,direct\\ngo install tailscale.com/cmd/derper@latest\\n# \u9ed8\u8ba4derper\u4e8c\u8fdb\u5236\u5728 /root/go/bin/derper\\n```\\n\\n:::\\n\\n### \u542f\u52a8derper\\n\\n\\n```bash\\n# /etc/systemd/system/derper.service\\n[Unit]\\nDescription=derper\\n\\n[Service]\\nStartLimitInterval=5\\nStartLimitBurst=10\\nExecStart=/root/go/bin/derper -hostname <\u4f60\u7684\u57df\u540d> -a \\":443\\" -certdir /root/.cache/tailscale/derper-certs -verify-clients\\nRestart=always\\nRestartSec=15\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n\u542f\u52a8derper\\n\\n```bash\\nsystemctl enable derper.service --now\\n```\\n\\n\u521b\u5efa\u5b9a\u65f6\u91cd\u542fderper\\n\\n```\\n# /etc/systemd/system/derper.timer\\n[Unit]\\nDescription=derper timer\\n\\n[Timer]\\n# \u6bcf\u5c0f\u65f6\u6267\u884c\u4e00\u6b21\\nOnActiveSec=1h\\n# \u9519\u8fc7\u6267\u884c, \u7acb\u523b\u6267\u884c\\nPersistent=true\\n\\n[Install]\\nWantedBy=timers.target\\n```\\n\\n\u542f\u52a8derper.timer\\n\\n```bash\\n# \u5982\u679cwantedby\u4e3atimers.target, \u4e0d\u9700\u8981\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8, \u9ed8\u8ba4\u5c31\u662f\u5f00\u673a\u542f\u52a8\\nsystemctl start derper.timer\\n# \u5176\u4ed6\u60c5\u51b5\\nsystemctl enable derper.timer --now\\n```\\n\\n\u67e5\u770b\u751f\u6548\\n\\n```bash\\nsystemctl list-timers --no-pager\\nNEXT                        LEFT          LAST                        PASSED        UNIT                         ACTIVATES\\nMon 2022-09-05 23:21:29 CST 59min left    Mon 2022-09-05 22:15:12 CST 6min ago      derper.timer                 derper.service\\n```\\n\\n### \u914d\u7f6eHeadscale\\n\\n\u53ef\u4ee5\u53c2\u8003\\n\\n```\\n# https://github.com/juanfont/headscale/blob/main/derp-example.yaml\\n# If you plan to somehow use headscale, please deploy your own DERP infra: https://tailscale.com/kb/1118/custom-derp-servers/\\nregions:\\n  900:\\n    regionid: 900\\n    regioncode: custom\\n    regionname: My Region\\n    nodes:\\n      - name: 900a\\n        regionid: 900\\n        hostname: myderp.mydomain.no\\n        ipv4: 123.123.123.123\\n        ipv6: \\"2604:a880:400:d1::828:b001\\"\\n        stunport: 0\\n        stunonly: false\\n        derpport: 0\\n```\\n\\n\u6211\u7684\u53c2\u8003\u793a\u4f8b\\n\\n```bash\\n# /etc/headscale/derp.yaml\\nregions:\\n  900:\\n    regionid: 900\\n    regioncode: dev\\n    regionname: china\\n    nodes:\\n      - name: 900a\\n        regionid: 900\\n        hostname: <\u81ea\u5b9a\u4e49\u57df\u540d>\\n        stunport: 0\\n        stunonly: false\\n        derpport: 0\\n```\\n\\n\u4fee\u6539\u914d\u7f6e\\n\\n```\\n# /etc/headscale/config.yaml \u53d8\u66f4\u5982\u4e0b\\n  paths:\\n    - /etc/headscale/derp.yaml\\n  # paths: []\\n```\\n\\n\u91cd\u542f\u670d\u52a1\\n\\n```bash\\nsystemctl restart headscale\\n```\\n\\n### \u6d4b\u8bd5\\n\\n```bash\\ntailscale netcheck\\n\\n\\t* Nearest DERP: bj\\n\\t* DERP latency:\\n\\t\\t-  bj: 32.9ms  (bj)\\n```\\n\\n:::danger\\n\u8bf7\u52ff\u5347\u7ea7\u5230`0.17.0-alpha2`, \u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u670d\u52a1\u65e0\u6cd5\u6b63\u5e38\u542f\u52a8\\n:::"},{"id":"/posts/headscale-dsm7","metadata":{"permalink":"/posts/headscale-dsm7","source":"@site/blog/posts/headscale-dsm7.md","title":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","description":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"headscale","permalink":"/tags/headscale"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"\u5185\u7f51\u7a7f\u900f","permalink":"/tags/\u5185\u7f51\u7a7f\u900f"},{"label":"\u7fa4\u6656","permalink":"/tags/\u7fa4\u6656"}],"readingTime":0.45,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","date":"2022-05-25T14:55:18.000Z","description":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","tags":["headscale","tailscale","\u5185\u7f51\u7a7f\u900f","\u7fa4\u6656"]},"prevItem":{"title":"Headscale \u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668","permalink":"/posts/headscale-derper"},"nextItem":{"title":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","permalink":"/posts/headscale-intro"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u53ef\u4ee5\u5148\u770b\u770b\u8fd9\u4e2a[\u7fa4\u6656\u65b0\u5957\u4ef6\uff1aTailscale\u6781\u901f\u7ec4\u7f51](/posts/tailscale-working-nas-dsm7)\\n\\n## \u7fa4\u6656\u63a5\u5165Headscale\\n\\n\u8981\u6c42(\u6211\u7684\u6d4b\u8bd5\u73af\u5883):\\n\\n- \u53ef\u4ee5ssh\u767b\u5f55\u5230\u7fa4\u6656\\n- \u6700\u65b0\u7248\u672ctailscale 1.30(\u9ed8\u8ba4\u5df2\u7ecf\u66f4\u65b0\u5230\u5f53\u524d\u6700\u65b0\u7248\u672c)\\n- \u7fa4\u6656DS218+\\n\\n## \u64cd\u4f5c\\n\\n```bash\\n# \u505a\u4e86\u5982\u4e0b\u64cd\u4f5c, \u5176\u4ed6\u8282\u70b9\u90fd\u6ca1\u6cd5ping\u901a\u7fa4\u6656ip\\nsudo setcap cap_net_admin+eip /var/packages/Tailscale/target/bin/tailscaled\\nsudo mkdir -p /dev/net\\nsudo mknod /dev/net/tun c 10 200\\nsudo chmod 0666 /dev/net/tun\\n# \u64cd\u4f5c\u5982\u4e0b\u65b9\u5f0f\u5c31\u53ef\u4ee5\u4e86\\nsudo /var/packages/Tailscale/target/bin/tailscale configure-host\\nsudo synosystemctl restart pkgctl-Tailscale.service\\n```\\n\\n\u53c2\u8003\u6587\u6863[Access Synology NAS from anywhere](https://tailscale.com/kb/1131/synology/#enabling-synology-outbound-connections)"},{"id":"/posts/headscale-intro","metadata":{"permalink":"/posts/headscale-intro","source":"@site/blog/posts/headscale-intro.md","title":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","description":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"headscale","permalink":"/tags/headscale"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"\u5185\u7f51\u7a7f\u900f","permalink":"/tags/\u5185\u7f51\u7a7f\u900f"}],"readingTime":3.0866666666666664,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","date":"2022-05-25T14:55:18.000Z","description":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","tags":["headscale","tailscale","\u5185\u7f51\u7a7f\u900f"]},"prevItem":{"title":"\u7fa4\u6656\u4e0a\u57fa\u4e8eHeadscale\u5185\u7f51\u7a7f\u900f","permalink":"/posts/headscale-dsm7"},"nextItem":{"title":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","permalink":"/posts/tke-cordon-node"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u76ee\u7684\u6253\u901a\u6240\u6709\u73af\u5883, \u7ec4\u5efa\u5927\u5c40\u57df\u7f51\\n\\n## WireGuard\u662f\u4ec0\u4e48\\n\\n> `WireGuard`\u662f\u4e00\u4e2a\u6613\u4e8e\u914d\u7f6e\u3001\u5feb\u901f\u4e14\u5b89\u5168\u7684\u5f00\u6e90VPN\u6280\u672f, \u4e3b\u8981\u4f18\u70b9\u914d\u7f6e\u548c\u90e8\u7f72 WireGuard \u5c31\u50cf\u914d\u7f6e\u548c\u4f7f\u7528SSH\u4e00\u6837\u5bb9\u6613\u3002\\n\\n\u4e3b\u8981\u7528\u9014\u53d6\u4ee3`OpenVPN`\u7b49\u4f20\u7edf\u7ec4\u7f51\u5de5\u5177\u3002\\n\\n## Tailscale\u662f\u4ec0\u4e48\\n\\nTailscale \u662f\u4e00\u6b3e\u57fa\u4e8e WireGuard \u7684\u865a\u62df\u7ec4\u7f51\u5de5\u5177, \u7b80\u5316\u4e86WireGuard\u90e8\u7f72\u6d41\u7a0b\uff0c\u5f00\u7bb1\u5373\u7528\u3002\\nTailscale \u662f\u4e00\u6b3e\u5546\u4e1a\u4ea7\u54c1\uff0c\u4f46\u4e2a\u4eba\u7528\u6237\u662f\u53ef\u4ee5\u767d\u5ad6\u7684, \u57fa\u672c\u53ef\u4ee5\u6ee1\u8db3\u4f7f\u7528\u9700\u6c42\u3002\\n\\n## Headscale\u662f\u4ec0\u4e48\\n\\n\u5b9e\u73b0\u4e86 Tailscale \u63a7\u5236\u670d\u52a1\u5668\u7684\u6240\u6709\u4e3b\u8981\u529f\u80fd, **\u81ea\u4e3b\u53ef\u63a7**\\n\\n## Headscale \u90e8\u7f72\\n\\n> \u90e8\u7f72\u6bd4\u8f83\u7b80\u5355, \u8fd9\u91cc\u7b80\u5355\u8bb0\u5f55\u4e00\u4e0b\\n\\n### \u4e0b\u8f7d\u4e8c\u8fdb\u5236\\n\\n```bash\\nwget https://ghproxy.com/https://github.com/juanfont/headscale/releases/download/v0.17.0-alpha1/headscale_0.17.0-alpha1_linux_amd64\\nchmod +x headscale_0.17.0-alpha1_linux_amd64\\nmv headscale_0.17.0-alpha1_linux_amd64 /usr/local/bin/headscale\\n```\\n\\n### \u51c6\u5907\u76f8\u5173\u76ee\u5f55\u6216\u8005\u6587\u4ef6\\n\\n```bash\\n# \u521b\u5efa\u914d\u7f6e\u76ee\u5f55\\nmkdir -p /etc/headscale\\n# \u521b\u5efa\u76ee\u5f55\u7528\u6765\u5b58\u50a8\u6570\u636e\u4e0e\u8bc1\u4e66\\nmkdir -p /var/lib/headscale\\n# \u521b\u5efa\u7a7a\u7684 SQLite \u6570\u636e\u5e93\u6587\u4ef6\\ntouch /var/lib/headscale/db.sqlite\\n# \u4e0b\u8f7d Headscale \u914d\u7f6e\u6587\u4ef6\\nwget https://github.com/juanfont/headscale/raw/main/config-example.yaml -O /etc/headscale/config.yaml\\n# \u521b\u5efa\u7528\u6237\\nuseradd headscale -d /home/headscale -m\\nchown -R headscale:headscale /var/lib/headscale\\n```\\n\\n### \u7f16\u8f91\u914d\u7f6e\\n\\n```yaml\\n---\\nserver_url: https://<headscale.knj01.ysicing.net>:443\\nlisten_addr: 0.0.0.0:443\\nmetrics_listen_addr: 127.0.0.1:9090\\ngrpc_listen_addr: 0.0.0.0:50443\\ngrpc_allow_insecure: false\\nprivate_key_path: /var/lib/headscale/private.key\\nnoise:\\n  private_key_path: /var/lib/headscale/noise_private.key\\nip_prefixes:\\n  - 10.77.0.0/24\\nderp:\\n  server:\\n    enabled: false\\n    region_id: 999\\n    region_code: \\"headscale\\"\\n    region_name: \\"Headscale Embedded DERP\\"\\n    stun_listen_addr: \\"0.0.0.0:3478\\"\\n  urls:\\n    - https://controlplane.tailscale.com/derpmap/default\\n  paths: []\\n  auto_update_enabled: true\\n  update_frequency: 2h\\ndisable_check_updates: false\\nephemeral_node_inactivity_timeout: 30m\\nnode_update_check_interval: 10s\\ndb_type: sqlite3\\ndb_path: /var/lib/headscale/db.sqlite\\nacme_url: https://acme-v02.api.letsencrypt.org/directory\\nacme_email: \\"root@ysicing.net\\"\\ntls_letsencrypt_hostname: \\"<\u81ea\u5df1\u7684\u57df\u540d>\\"\\ntls_client_auth_mode: relaxed\\ntls_letsencrypt_cache_dir: /var/lib/headscale/cache\\ntls_letsencrypt_challenge_type: HTTP-01\\ntls_letsencrypt_listen: \\":http\\"\\ntls_cert_path: \\"\\"\\ntls_key_path: \\"\\"\\nlog_level: info\\nacl_policy_path: \\"\\"\\ndns_config:\\n  nameservers:\\n    - 1.1.1.1\\n  domains: []\\n  magic_dns: false\\n  base_domain: example.com\\nunix_socket: /var/run/headscale/headscale.sock\\nunix_socket_permission: \\"0770\\"\\nlogtail:\\n  enabled: false\\nrandomize_client_port: false\\n```\\n\\n### \u542f\u52a8HeadScale\\n\\n```bash\\n# cat /etc/systemd/system/headscale.service\\n[Unit]\\nDescription=headscale controller\\nAfter=syslog.target\\nAfter=network.target\\n\\n[Service]\\nType=simple\\nUser=headscale\\nGroup=headscale\\nExecStart=/usr/local/bin/headscale serve\\nRestart=always\\nRestartSec=5\\n\\n# Optional security enhancements\\nNoNewPrivileges=yes\\nPrivateTmp=yes\\nProtectSystem=strict\\nProtectHome=yes\\nReadWritePaths=/var/lib/headscale /var/run/headscale\\nAmbientCapabilities=CAP_NET_BIND_SERVICE\\nRuntimeDirectory=headscale\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n\u5f00\u542f\u542f\u52a8\\n\\n```bash\\nsystemctl enable --now headscale\\nsystemctl status headscale\\n```\\n\\n\u67e5\u770b\u7aef\u53e3\u60c5\u51b5\\n\\n```bash\\nss -tulnp|grep headscale\\ntcp   LISTEN 0      32768      127.0.0.1:9090       0.0.0.0:*    users:((\\"headscale\\",pid=4426,fd=15))\\ntcp   LISTEN 0      32768              *:50443            *:*    users:((\\"headscale\\",pid=4426,fd=10))\\ntcp   LISTEN 0      32768              *:80               *:*    users:((\\"headscale\\",pid=4426,fd=13))\\ntcp   LISTEN 0      32768              *:443              *:*    users:((\\"headscale\\",pid=4426,fd=14))\\n```\\n\\n\u7a0d\u7b49\u7247\u523b\u8bbf\u95ee\u8bbe\u7f6e\u7684\u57df\u540d\u663e\u793ahttps\u5373\u53ef\\n\\n### \u547d\u540d\u7a7a\u95f4\u7ba1\u7406\\n\\nTailscale \u4e2d\u6709\u4e00\u4e2a\u6982\u5ff5\u53eb tailnet\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u6210\u79df\u6237\uff0c\u79df\u6237\u4e0e\u79df\u6237\u4e4b\u95f4\u662f\u76f8\u4e92\u9694\u79bb\u7684\uff0c\u5177\u4f53\u770b\u53c2\u8003 Tailscale \u7684\u5b98\u65b9\u6587\u6863\uff1a [What is a tailnet](https://tailscale.com/kb/1136/tailnet/)\u3002Headscale \u4e5f\u6709\u7c7b\u4f3c\u7684\u5b9e\u73b0\u53eb namespace\uff0c\u5373\u547d\u540d\u7a7a\u95f4\u3002\u6211\u4eec\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a namespace\uff0c\u4ee5\u4fbf\u540e\u7eed\u5ba2\u6237\u7aef\u63a5\u5165\\n\\n```bash\\n# \u521b\u5efa\u547d\u540d\u7a7a\u95f4\\nheadscale namespaces create default\\n# \u67e5\u770b\u547d\u540d\u7a7a\u95f4\\nheadscale namespaces list\\nID | Name    | Created\\n1  | default | 2022-09-02 13:00:37\\n```\\n\\n### \u591a\u7aef\u63a5\u5165\\n\\n```bash\\ntailscale up --login-server=https://<\u81ea\u5b9a\u4e49\u57df\u540d> --accept-routes=true --accept-dns=false\\n```\\n\\n\u6267\u884c\u5b8c\u4e0a\u9762\u7684\u547d\u4ee4\u540e\uff0c\u4f1a\u51fa\u73b0\u4e0b\u9762\u7684\u4fe1\u606f\\n\\n```bash\\nTo authenticate, visit:\\n\\nhttps://xxxxxx:443/register/de703e5f2e326cfa4b95c866ce13397433b81fcc22de6cf4e39770095facf921\\n\\n```\\n\\n\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u8be5\u94fe\u63a5, \u5c06\u9875\u9762\u7684\u547d\u4ee4\u590d\u5236\u7c98\u8d34\u5230 headscale \u6240\u5728\u673a\u5668\u7684\u7ec8\u7aef\u4e2d\uff0c\u5e76\u5c06 NAMESPACE \u66ff\u6362\u4e3a\u524d\u9762\u6240\u521b\u5efa\u7684 namespace, \u7c7b\u4f3c\u5982\u4e0b:\\n\\n```bash\\n headscale -n default nodes register --key de703e5f2e326cfa4b95c866ce13397433b81fcc22de6cf4e39770095facf921\\n```\\n\\n\u5982\u679c\u8282\u70b9\u6bd4\u8f83\u591a:\\n\\n```bash\\n#!/bin/bash\\nheadscale -n default nodes register --key $1\\nheadscale node list\\n```\\n\\n#### macOS\u5b89\u88c5\\n\\n\u53ef\u4ee5\u53c2\u8003[macOS\u914d\u7f6e](https://icloudnative.io/posts/how-to-set-up-or-migrate-headscale/#macos)\\n\\n#### \u7fa4\u6656DS218+\u5b89\u88c5\\n\\n\u4e0b\u8f7d\u5ba2\u6237\u7aef\u5e76\u5b89\u88c5[tailscale-x86_64-dsm7](https://pkgs.tailscale.com/stable/tailscale-x86_64-1.30.0-300007-dsm7.spk)\\n\\nssh\u767b\u5f55\u7fa4\u6656\\n\\n```bash\\nsudo tailscale down\\nsudo tailscale up --login-server=https://\u81ea\u5b9a\u4e49\u57df\u540d --accept-dns=false\\n# \u540e\u7eed\u540c\\n```\\n\\n#### \u5bb9\u5668\u63a5\u5165\\n\\n```bash\\n# \u670d\u52a1\u7aef\u751f\u6210\u53ef\u590d\u7528 preauthkey \u7684 token\uff0c\u6709\u6548\u671f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 72 \u5c0f\u65f6\\nheadscale preauthkeys create -e 72h --reusable --namespace default\\n# \u67e5\u770b\u5df2\u7ecf\u751f\u6210\u7684 key\\nheadscale -n default preauthkeys list\\n```\\n\\n:::danger\\n<del>\u6253\u901ak8s, cilium\u5bb9\u5668\u7f51\u7edc\u5c31\u6302\u4e86\u3002\\n\u6682\u65f6\u4e0d\u6253\u901a</del>\\n:::\\n\\n:::info\\n\u8c03\u6574\u6210\u9ed8\u8ba4\u7f51\u7edc\u5c31\u597d\u4e86\\n:::\\n\\n### \u5c40\u57df\u7f51\u6253\u901a\\n\\n```bash\\n# \u6dfb\u52a0route\\ntailscale up --login-server=https://<\u81ea\u5b9a\u4e49\u57df\u540d> --accept-routes=true --accept-dns=false --advertise-routes=10.80.0.0/16,10.90.0.0/16\\n# \u5f00\u542f\u8def\u7531\\nheadscale routes enable -i 6 -r \\"10.90.0.0/16,10.80.0.0/16\\"\\n# \u8def\u7531\u5217\u8868\\nheadscale routes list -i 6\\nRoute        | Enabled\\n10.80.0.0/16 | true\\n10.90.0.0/16 | true\\n```\\n\\n\u6d4b\u8bd5\\n\\n```bash\\n# \u67e5\u770b\u8def\u7531\\nip route show table 52 | grep 10.80.0.0/16\\n10.80.0.0/16 dev tailscale0\\n# \u6d4b\u8bd5\u8bbf\u95eek3s coredns\\n\\n```"},{"id":"/posts/tke-cordon-node","metadata":{"permalink":"/posts/tke-cordon-node","source":"@site/blog/posts/tke-cordon-node.md","title":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","description":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","date":"2022-05-25T14:55:18.000Z","formattedDate":"2022\u5e745\u670825\u65e5","tags":[{"label":"k8s","permalink":"/tags/k-8-s"},{"label":"tke","permalink":"/tags/tke"}],"readingTime":0.44333333333333336,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","date":"2022-05-25T14:55:18.000Z","description":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","tags":["k8s","tke"]},"prevItem":{"title":"Headscale \u7684\u90e8\u7f72\u65b9\u6cd5\u548c\u4f7f\u7528\u6559\u7a0b","permalink":"/posts/headscale-intro"},"nextItem":{"title":"\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","permalink":"/posts/bigcat-ergo"}},"content":"\x3c!-- truncate --\x3e\\n\\n## tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879\\n\\n\u8282\u70b9\u7981\u6b62\u8c03\u5ea6\u524d\uff0c\u9700\u8981\u786e\u5b9a\u6709\u6ca1\u6709svc\u662flb\u6a21\u5f0f\u4e14`ExternalTrafficPolicy`\u4e3a`Local`\u7684\u8282\u70b9\uff0c\u5982\u679c\u6709\uff0c\u9700\u8981\u5148\u5c06\u5176\u8c03\u6574\u4e3a`Cluster`\u6a21\u5f0f\u3002\\n\\n\u539f\u56e0:\\n\\n> TKE Service Controller \u9ed8\u8ba4\u4e0d\u4f1a\u5c06\u4ee5\u4e0b\u8282\u70b9\u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u540e\u7aef\uff1a\\n\\n- Master \u8282\u70b9\uff08\u4e0d\u5141\u8bb8 Master \u8282\u70b9\u53c2\u4e0e\u7f51\u7edc\u63a5\u5165\u5c42\u7684\u8d1f\u8f7d\uff09\u3002\\n- \u8282\u70b9\u72b6\u6001\u4e3a NotReady \u6216\u8282\u70b9\u88ab\u8bbe\u7f6e\u4e3a Unschedulable\uff08\u8282\u70b9\u4e0d\u5065\u5eb7\u6216\u4e0d\u53ef\u8c03\u5ea6\uff09\u3002\\n\\n## \u53c2\u8003\u6587\u6863\\n\\n- [\u817e\u8baf\u4e91Service\u540e\u7aef\u9009\u62e9](https://cloud.tencent.com/document/product/457/45492)"},{"id":"/posts/bigcat-ergo","metadata":{"permalink":"/posts/bigcat-ergo","source":"@site/blog/posts/bigcat-ergo.md","title":"\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","date":"2022-05-10T14:09:20.000Z","formattedDate":"2022\u5e745\u670810\u65e5","tags":[{"label":"site","permalink":"/tags/site"}],"readingTime":0.51,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","date":"2022-05-10T14:09:20.000Z","description":"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","tags":["site"]},"prevItem":{"title":"tke\u96c6\u7fa4\u7981\u6b62\u8c03\u5ea6\u6ce8\u610f\u4e8b\u9879","permalink":"/posts/tke-cordon-node"},"nextItem":{"title":"\u4f7f\u7528 chartmuseum \u7ba1\u7406 Helm Chart","permalink":"/posts/chartmuseum-deploy"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u4ee5\u524d\u517b\u4e86\u4e00\u53ea\u72d7\u53eb\u5927\u732b\uff0c\u4e00\u53ea\u732b\u53eb\u4e8c\u72d7.\\n\\n## \u5927\u732b(BigCat)\\n\\n> \u5e73\u53f0\u9879\u76ee, \u7b80\u5355\u7406\u89e3\u5e94\u8be5\u662f\u4e2a\u4eba\u7248\u7684\u8f7b\u91cf\u5316\u5bb9\u5668\u5e73\u53f0\u3002\\n\\n[\u8fd8\u672a\u5f00\u6e90](https://github.com/ysicing/next)\\n\\n### \u529f\u80fd\u4ecb\u7ecd\\n\\n- \u5f85\u5b9a\\n\\n## \u4e8c\u72d7(ErGo)\\n\\n> \u547d\u4ee4\u884c\u5de5\u5177, \u96c6\u6210\u5e38\u89c1\u7684\u8fd0\u7ef4\u529f\u80fd\u3002\\n\\n[ysicing/ergo](https://github.com/ysicing/ergo)\\n\\n### \u529f\u80fd\u4ecb\u7ecd\\n\\n- \u521b\u5efak3s\u96c6\u7fa4, \u5927\u732b\u5c31\u5b8c\u5168\u4f9d\u6258k8s(k3s)\u96c6\u7fa4\\n- \u5b89\u88c5\u5e38\u89c1\u670d\u52a1\uff0c\u5982docker/containerd\\n- Debian\u7cfb\u7684\u521d\u59cb\u5316\uff0c\u91cd\u88c5\u7b49\u64cd\u4f5c\\n- \u8fd8\u6709\u4e00\u4e9b\u8fd0\u7ef4\u547d\u4ee4\\n\\n## \u7231\u53d1\u7535\\n\\n> \u5982\u679c\u4f60\u89c9\u5f97\u9879\u76ee\u5bf9\u4f60\u53ef\u80fd\u6709\u7528\uff0c\u90a3\u4e48\u6765\u652f\u6301\u4e00\u4e0b\u5427\uff01[\u7231\u53d1\u7535@ysicing](https://afdian.net/@ysicing)"},{"id":"/posts/chartmuseum-deploy","metadata":{"permalink":"/posts/chartmuseum-deploy","source":"@site/blog/posts/chartmuseum-deploy.md","title":"\u4f7f\u7528 chartmuseum \u7ba1\u7406 Helm Chart","description":"\u8bb0\u5f55\u4e00\u4e0b\u90e8\u7f72chartmuseum\u53ca\u7b80\u5355\u4f7f\u7528","date":"2022-04-21T01:23:55.000Z","formattedDate":"2022\u5e744\u670821\u65e5","tags":[{"label":"helm","permalink":"/tags/helm"},{"label":"chartmuseum","permalink":"/tags/chartmuseum"}],"readingTime":0.6333333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4f7f\u7528 chartmuseum \u7ba1\u7406 Helm Chart","date":"2022-04-21T01:23:55.000Z","description":"\u8bb0\u5f55\u4e00\u4e0b\u90e8\u7f72chartmuseum\u53ca\u7b80\u5355\u4f7f\u7528","tags":["helm","chartmuseum"]},"prevItem":{"title":"\u5927\u732b\u4e8c\u72d7\u5f00\u53d1\u8005\u8ba1\u5212","permalink":"/posts/bigcat-ergo"},"nextItem":{"title":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","permalink":"/posts/macOS-make-windows-bootable-iso"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u5f88\u65e9\u4e4b\u524d\u5c31\u5199\u4e86\u54c8\\n\\n## \u4ec0\u4e48\u662fchartmuseum\\n\\n> `chartmuseum` \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 Helm Chart Repository\uff0c\u652f\u6301\u591a\u79cd\u540e\u7aef\u5b58\u50a8(s3\u7b49). \\n\\nchartmuseum \u63d0\u4f9b\u82e5\u5e72 API \u4ee5\u5b9e\u73b0 Helm Chart Repository \u7684\u80fd\u529b\u3002\\n\\n## \u90e8\u7f72chartmuseum\\n\\n```yaml\\n# .ergo/data/charts.yaml\\nversion: \'2.1\'\\nservices:\\n  charts-pass:\\n    image: ccr.ccs.tencentyun.com/k7scn/chartmuseum:v0.14.0\\n    container_name: charts-pass\\n    restart: always\\n    volumes:\\n      - ./chartspass:/charts\\n    ports:\\n      - \\"9080:9080\\"\\n    environment:\\n      - PORT=9080\\n      - DEBUG=1\\n      - STORAGE=local\\n      - STORAGE_LOCAL_ROOTDIR=/charts\\n      - AUTH_ANONYMOUS_GET=true\\n      - BASIC_AUTH_PASS=aituZie3eex5fiDongoShairiangae6o\\n      - BASIC_AUTH_USER=ysicing\\n  charts-noauth:\\n    image: ccr.ccs.tencentyun.com/k7scn/chartmuseum:v0.14.0\\n    container_name: charts-noauth\\n    restart: always\\n    volumes:\\n      - ./chartsnoauth:/charts\\n    ports:\\n      - \\"9081:9081\\"\\n    environment:\\n      - PORT=9081\\n      - DEBUG=1\\n      - STORAGE=local\\n      - STORAGE_LOCAL_ROOTDIR=/charts\\n      - AUTH_ANONYMOUS_GET=true\\n```\\n\\n\u542f\u52a8chartmuseum\\n\\n```bash\\nergo repo init\\nergo addons install ysicing/compose\\nergo compose -f .ergo/data/charts.yaml up -d\\n```\\n\\n\u6d4b\u8bd5\\n\\n```bash\\n# linux ergo addons install ysicing/helm\\nhelm repo add d1 http://127.0.0.1:9080\\nhelm repo add d2 http://127.0.0.1:9081\\n```\\n\\n## \u7b80\u5355\u4f7f\u7528\\n\\n### cm-push\u4f7f\u7528\\n\\n```bash\\n# \u5927\u9646\u5b89\u88c5\\nhelm plugin install https://gitee.com/ysbot/helm-push\\nhelm cm-push -h\\n```\\n\\n### Drone CI\u4f7f\u7528\\n\\n\u5728CI\u4e2d\u63a8\u9001charts\u53ef\u4ee5\u53c2\u8003 [drone-stack/drone-plugin-helm-release](https://github.com/drone-stack/drone-plugin-helm-release)"},{"id":"/posts/macOS-make-windows-bootable-iso","metadata":{"permalink":"/posts/macOS-make-windows-bootable-iso","source":"@site/blog/posts/macOS-make-windows-bootable-iso.md","title":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","description":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","date":"2022-04-18T15:27:49.000Z","formattedDate":"2022\u5e744\u670818\u65e5","tags":[{"label":"macOS","permalink":"/tags/mac-os"},{"label":"windows","permalink":"/tags/windows"}],"readingTime":0.6233333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","date":"2022-04-18T15:27:49.000Z","description":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","tags":["macOS","windows"]},"prevItem":{"title":"\u4f7f\u7528 chartmuseum \u7ba1\u7406 Helm Chart","permalink":"/posts/chartmuseum-deploy"},"nextItem":{"title":"minipc\u6298\u817e\u5b89\u88c5pve","permalink":"/posts/minipc-pve"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u7b80\u5355\u8bb0\u5f55\u4e00\u4e0b\\n\\n## 1. \u4e0b\u8f7dwin11\u955c\u50cf\\n\\n\u76f4\u63a5\u4ece[\u5b98\u7f51](https://www.microsoft.com/en-us/software-download/windows11)\u4e0b\u8f7d\u5c31\u597d\u4e86, \u6839\u636e\u81ea\u5df1\u7684\u60c5\u51b5\u9009\u62e9\u3002\\n\\n## 2. \u51c6\u5907\u4e00\u4e2a\u81f3\u5c118GB\u7684U\u76d8\\n\\n\u6211\u51c6\u5907\u4e86\u4e00\u4e2a32G\u7684\\n\\n## 3. \u5b9e\u64cd\\n\\n```bash\\n# \u5217\u51fa\u78c1\u76d8\\ndiskutil list\\n\\n\\n/dev/disk4 (external, physical):\\n   #:                       TYPE NAME                    SIZE       IDENTIFIER\\n   0:     FDisk_partition_scheme                        *31.0 GB    disk4\\n   1:                 DOS_FAT_32 WIN10                   31.0 GB    disk4s1\\n\\n# \u5c06U\u76d8\u683c\u5f0f\u5316\u4e3aWINDOWS FAT32\u683c\u5f0f\\ndiskutil eraseDisk MS-DOS \\"WIN11\\" GPT /dev/disk4\\n\\n# \u6302\u8f7dwin11\u955c\u50cf\\nhdiutil mount ~/Downloads/Win11_Chinese\\\\(Simplified\\\\)_x64v1.iso\\n\\n# \u590d\u5236\u955c\u50cf\u5230u\u76d8, \u5ffd\u7565install.wim\u6587\u4ef6\uff0c\u592a\u5927\u5355\u72ec\u5904\u7406\\nrsync -vha --exclude=sources/install.wim  /Volumes/CCCOMA_X64FRE_ZH-CN_DV9/* /Volumes/WIN11\\n# \u5904\u7406wim\u6587\u4ef6, \u4f7f\u7528 wimlib \u5c06 install.wim \u6587\u4ef6\u62c6\u5206\u4e3a 2 \u4e2a\u6587\u4ef6\uff0c\u6bcf\u4e2a\u6587\u4ef6\u6700\u59273.8G\\nbrew install wimlib\\nwimlib-imagex split /Volumes/CCCOMA_X64FRE_ZH-CN_DV9/sources/install.wim /Volumes/WIN11/sources/install.swm 3800\\n# \u5b8c\u6210\uff0c\u63a8\u51fa\\n```\\n\\n## 4. \u91cd\u88c5\u7cfb\u7edf\\n\\nU\u76d8\u542f\u52a8\u5373\u53ef"},{"id":"/posts/minipc-pve","metadata":{"permalink":"/posts/minipc-pve","source":"@site/blog/posts/minipc-pve.md","title":"minipc\u6298\u817e\u5b89\u88c5pve","description":"\u5728minipc\u4e0a\u6298\u817e\u5b89\u88c5pve","date":"2022-04-18T15:27:49.000Z","formattedDate":"2022\u5e744\u670818\u65e5","tags":[{"label":"pve","permalink":"/tags/pve"},{"label":"debian","permalink":"/tags/debian"},{"label":"minipc","permalink":"/tags/minipc"}],"readingTime":1.54,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"minipc\u6298\u817e\u5b89\u88c5pve","date":"2022-04-18T15:27:49.000Z","description":"\u5728minipc\u4e0a\u6298\u817e\u5b89\u88c5pve","tags":["pve","debian","minipc"]},"prevItem":{"title":"\u5728macOS\u4e0a\u5236\u4f5cwin11\u542f\u52a8\u76d8","permalink":"/posts/macOS-make-windows-bootable-iso"},"nextItem":{"title":"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE","permalink":"/posts/lighthouse-pve"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u51c6\u5907\u5de5\u4f5c\\n\\n- USB\u79fb\u52a8\u5b58\u50a8\u8bbe\u5907\\n- PVE\u955c\u50cf\\n- MacOS M1\\n- MiniPC\\n\\n### \u4e0b\u8f7dpve\u955c\u50cf\\n\\n[\u5b98\u7f51](https://www.proxmox.com/en/downloads/category/iso-images-pve)\\n\\n\u7b49\u5f85\u4e0b\u8f7d\u5b8c\u6210,\u5c06iso\u6587\u4ef6\u8f6c\u4e3admg\u6587\u4ef6\\n\\n```bash\\nhdiutil convert -format UDRW -o proxmox-ve_7.1-2.dmg  proxmox-ve_7.1-2.iso\\n```\\n\\n### \u5236\u4f5c\u542f\u52a8\u76d8\\n\\n> \u5728macos\u4e0a\u5236\u4f5cPVE\u542f\u52a8\u76d8\\n\\n```bash\\n# u\u76d8\u5df2\u63d2\u5165, \u786e\u5b9a\u5206\u914d\u7684\u8bbe\u5907\u540d(\u76d8\u7b26)\uff0c\u6211\u8fd9\u91cc\u662fdisk5\\n\u279c  ~ diskutil list\\n\\n/dev/disk5 (external, physical):\\n   #:                       TYPE NAME                    SIZE       IDENTIFIER\\n   0:     FDisk_partition_scheme                        *31.0 GB    disk5\\n   1:               Windows_NTFS U\u76d8\u88c5\u673a\u5927\u5e08             29.9 GB    disk5s1\\n   2:             Windows_FAT_32 UDSEFI                  1.1 GB     disk5s2\\n\\n# \u79fb\u9664disk5\u4e0a\u7684\u5377\u5b97,\u53d6\u6d88\u6302\u8f7d\\n\u279c  ~ diskutil unmountDisk /dev/disk5\\nUnmount of all volumes on disk5 was successful\\n\\n# dd\\nsudo dd if=/Users/ysicing/hack/iso/proxmox-ve_7.1-2.dmg of=/dev/rdisk5 bs=1m\\n```\\n\\n\u7b49\u5f85dd\u5b8c\u6210, \u5c31\u70e7\u5f55\u597d\u4e86pve\u542f\u52a8\u76d8\uff0c\u7b49\u5f85minipc\u4e86\u3002\\n\\n## \u5b89\u88c5pve\\n\\ndebian\u7cfb\u5b89\u88c5\u90fd\u6bd4\u8f83\u7b80\u5355\uff0c\u53c2\u8003\u6211\u5728\u8f7b\u91cf\u4e0a\u7684\u64cd\u4f5c\u6b65\u9aa4 [\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE](/posts/lighthouse-pve/)\\n\\n## \u914d\u7f6e\u65e0\u7ebf\u7f51\u5361\\n\\n> \u9ed8\u8ba4\u6e90\u5565\u7684\u90fd\u6539\u4e86\u54e6\\n\\n```bash\\napt full-upgrade\\nmv /usr/share/proxmox-ve/pve-apt-hook /usr/share/proxmox-ve/pve-apt-hook.old\\necho \\"exit 0\\" > /usr/share/proxmox-ve/pve-apt-hook\\nchmod +x /usr/share/proxmox-ve/pve-apt-hook\\n# \u5b89\u88c5\u7f51\u5361\u76f8\u5173\u5de5\u5177\u5305\\napt install -y firmware-iwlwifi wireless-tools wpasupplicant\\n# \u5b89\u88c5\u5176\u4ed6\u5de5\u5177\\napt install -y net-tools\\n# \u67e5\u770b\u7f51\u5361\u578b\u53f7\\n\u279c  ~  lsmod | grep iw\\niwlmvm                421888  0\\nmac80211             1015808  1 iwlmvm\\niwlwifi               376832  1 iwlmvm\\ncfg80211              888832  3 iwlmvm,iwlwifi,mac80211\\niw_cm                  49152  1 rdma_cm\\nib_core               360448  4 rdma_cm,iw_cm,ib_iser,ib_cm\\n# \u67e5\u770b\u7f51\u5361\u4fe1\u606f \\n\u279c  ~ iwconfig\\nlo        no wireless extensions.\\n\\nenp3s0    no wireless extensions.\\n\\nwlp1s0    IEEE 802.11  ESSID:off/any\\n          Mode:Managed  Access Point: Not-Associated   Tx-Power=-2147483648 dBm\\n          Retry short limit:7   RTS thr:off   Fragment thr:off\\n          Encryption key:off\\n          Power Management:on\\n\\nvmbr0     no wireless extensions.\\n# \u542f\u7528\u7f51\u5361\\nifconfig wlp1s0 up \u6216 ifup wlp1s0\\n# \u626b\u63cfwifi\\niwlist wlp1s0 scan\\n# \u9009\u62e9wifi,\u751f\u6210\u914d\u7f6e\\nwpa_passphrase <wifi> <password> > /etc/wpa_supplicant/wlp1s0.conf\\n# \u7f16\u8f91\u7f51\u5361 /etc/network/interfaces, \u65b0\u589e\\nallow-hotplug wlp1s0\\niface wlp1s0 inet dhcp\\n  wpa-conf /etc/wpa_supplicant/wlp1s0.conf\\n\\n# \u91cd\u542f\u7f51\u7edc\\nsystemctl restart networking.service\\n\\n# \u67e5\u770bip r, \u67e5\u770b\u5df2\u5206\u914dip\u4e86\uff0c\u5b8c\u6210\u3002\\n```\\n\\n### \u5176\u4ed6\\n\\n> \u5931\u8d25\u53ef\u53c2\u8003\uff0c\u672c\u4eba\u672a\u9047\u5230\u95ee\u9898\uff0c\u6545\u6ca1\u6709\u6d4b\u8bd5\u5982\u4e0b\u547d\u4ee4\u3002\\n\\n```bash\\nkillall -9 wpa_supplicant\\nifconfig wlan0 down\\niwconfig wlan0 mode Managed\\nifconfig wlan0 up\\nwpa_supplicant -B -dwext -iwlan0 -c /etc/wpa_supplicant/wireless.conf -dd\\n```"},{"id":"/posts/lighthouse-pve","metadata":{"permalink":"/posts/lighthouse-pve","source":"@site/blog/posts/lighthouse-pve.md","title":"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE","description":"\u4e0a\u6b21\u817e\u8baf\u9001\u7684\u4e0a\u6d77\u8f7b\u91cf\u4e00\u76f4\u5403\u7070\uff0c\u8dd1\u4e2apve\u73a9\u73a9.","date":"2022-04-09T13:46:48.000Z","formattedDate":"2022\u5e744\u67089\u65e5","tags":[{"label":"lighthouse","permalink":"/tags/lighthouse"},{"label":"qcloud","permalink":"/tags/qcloud"},{"label":"pve","permalink":"/tags/pve"}],"readingTime":1.96,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE","date":"2022-04-09T13:46:48.000Z","description":"\u4e0a\u6b21\u817e\u8baf\u9001\u7684\u4e0a\u6d77\u8f7b\u91cf\u4e00\u76f4\u5403\u7070\uff0c\u8dd1\u4e2apve\u73a9\u73a9.","tags":["lighthouse","qcloud","pve"]},"prevItem":{"title":"minipc\u6298\u817e\u5b89\u88c5pve","permalink":"/posts/minipc-pve"},"nextItem":{"title":"\u5728k8s\u4e2d\u90e8\u7f72Tailscale\u79c1\u6709\u4e2d\u7ee7\u670d\u52a1\u5668Derper","permalink":"/posts/tailscale-custom-derper-server"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u51c6\u5907\u5de5\u4f5c\\n\\n> \u9ed8\u8ba4\u4f7f\u7528Debian 11\\n\\n### \u914d\u7f6e\u7f51\u7edc\\n\\n> \u8f7b\u91cf\u4e91\u9632\u706b\u5899\u653e\u884c 8006\u7aef\u53e3 \u548c 30000-40000\u7aef\u53e3\u7ed9\u5c0f\u9e21\u7528\u3002\\n\\n### \u914d\u7f6e\u4e3b\u673a\u540d\\n\\n```bash\\n# \u66f4\u6539\u4e3b\u673a\u540d\\nhostname pve\\necho pve > /etc/hostname\\n# vim /etc/hosts\\n127.0.1.1 localhost.localdomain VM-16-11-debian\\n127.0.0.1 localhost\\n\\n10.0.16.11 pve # \u65b0\u589e\u4e3b\u673a\u540d\\n\\n::1 ip6-localhost ip6-loopback\\nfe00::0 ip6-localnet\\nff00::0 ip6-mcastprefix\\nff02::1 ip6-allnodes\\nff02::2 ip6-allrouters\\nff02::3 ip6-allhosts\\n```\\n\\n\u8bbe\u7f6e\u5b8c\u6210\u540e\u53ef\u4ee5\u9a8c\u8bc1\\n\\n```bash\\nhostname --ip-address\\n10.0.16.11\\n```\\n\\n## \u5b89\u88c5Proxmox VE\\n\\n### \u6dfb\u52a0\u8f6f\u4ef6\u6e90\\n\\n> \u5b98\u65b9\u6e90\u6bd4\u8f83\u6162\uff0c\u8fd9\u91cc\u4f7f\u7528\u6e05\u534e\u955c\u50cf\u6e90\\n\\n```bash\\necho \\"deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription\\" > /etc/apt/sources.list.d/pve-install-repo.list\\n# \u6dfb\u52a0\u4ed3\u5e93key\\nwget https://enterprise.proxmox.com/debian/proxmox-release-bullseye.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bullseye.gpg \\n```\\n\\n\u66f4\u65b0\u7cfb\u7edf\\n\\n```bash\\napt remove -y exim*\\napt update && apt full-upgrade\\n```\\n\\n### \u5b89\u88c5PVE\\n\\n```bash\\napt install proxmox-ve postfix open-iscsi -y\\n```\\n\\n\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9700\u8981\u914d\u7f6epostfix\uff0c\u9009\u62e9no configuration\\n\\n\u7b49\u5f85\u5b89\u88c5\u5b8c\u6210\uff0c\u8bbf\u95ee `https://<\u516c\u7f51ip>:8006`, \u4f7f\u7528linux\u8d26\u6237\u767b\u9646`root/<password>`\\n\\n## \u914d\u7f6ePVE\\n\\n### \u7f51\u7edc\\n\\n\u914d\u7f6e\u7f51\u7edc\\n\\n![\u7f51\u7edc](/images/pve/0409/network-001.png)\\n![\u7f51\u7edc](/images/pve/0409/network-002.png)\\n\\n\u67e5\u770b\u5bbf\u4e3b\u673a\\n\\n```bash\\ncat /etc/network/interfaces.new\\nauto lo\\niface lo inet loopback\\n\\niface eth0 inet manual\\n\\nauto vmbr0\\niface vmbr0 inet static\\n\\taddress 10.10.10.1/24\\n\\tgateway 10.10.10.1\\n\\tbridge-ports eth0\\n\\tbridge-stp off\\n\\tbridge-fd 0\\n\\tbridge-vlan-aware yes\\n\\tbridge-vids 2-4094\\n\\nsource /etc/network/interfaces.d/*\\n```\\n\\n\u8c03\u6574\u7f51\u7edc\u914d\u7f6e\uff0c\u6dfb\u52a0nat\u8f6c\u53d1, \u66f4\u591a\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863[Network Configuration](https://pve.proxmox.com/wiki/Network_Configuration)\\n\\n{{< alert theme=\\"danger\\" >}}\\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u9700\u8981\u5c06eth0\u6539\u6210dhcp\u6216\u8005static\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u673a\u5668\u79bb\u7ebf\u3002\\n{{< /alert >}}\\n\\n```bash\\nauto lo\\niface lo inet loopback\\n\\nauto eth0\\niface eth0 inet dhcp # \u8fd9\u91cc\\n\\nauto vmbr0\\niface vmbr0 inet static\\n\\taddress 10.10.10.1/24\\n\\tgateway 10.10.10.1\\n\\tbridge-ports eth0\\n\\tbridge-stp off\\n\\tbridge-fd 0\\n\\tbridge-vlan-aware yes\\n\\tbridge-vids 2-4094\\n\\n\\tpost-up   echo 1 > /proc/sys/net/ipv4/ip_forward\\n    post-up   iptables -t nat -A POSTROUTING -s \'10.10.10.0/24\' -o eth0  -j MASQUERADE\\n    post-down iptables -t nat -D POSTROUTING -s \'10.10.10.0/24\' -o eth0  -j MASQUERADE\\n\\nsource /etc/network/interfaces.d/*\\n```\\n\\n## \u5f00\u5c0f\u9e21\\n\\n### \u914d\u7f6eLXC\u5bb9\u5668\\n\\n\u9ed8\u8ba4CT Template\u4e0b\u8f7d\u901f\u5ea6\u5f88\u6162\uff0c\u8fd9\u91cc\u9009\u62e9\u6e05\u534e\u955c\u50cf\u6e90\\n\\n```bash\\ncp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back\\nsed -i \'s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g\' /usr/share/perl5/PVE/APLInfo.pm\\n```\\n\\n\u91cd\u542f\u751f\u6548\u3002\\n\\n![CT\u6a21\u7248](/images/pve/0409/ct-003.png)\\n\\n### \u521b\u5efa\u5bb9\u5668\\n\\n\u4e0b\u8f7dDebian\u7b49CT\u6a21\u7248\u4f7f\u7528\u3002\\n\\n\u57fa\u4e8eDebian CT\u6a21\u7248\u521b\u5efa\u4e00\u4e2aLXC\u5bb9\u5668\\n\\n![\u521b\u5efa\u5bb9\u5668](/images/pve/0409/ct-004.png)\\n\\n\u7b49\u5f85\u5bb9\u5668\u542f\u52a8\u4e4b\u540e\\n\\n```bash\\nping 10.10.10.100\\nPING 10.10.10.100 (10.10.10.100) 56(84) bytes of data.\\n64 bytes from 10.10.10.100: icmp_seq=1 ttl=64 time=0.064 ms\\n64 bytes from 10.10.10.100: icmp_seq=2 ttl=64 time=0.056 ms\\n```\\n\\n### \u914d\u7f6e\u5bb9\u5668NAT\u8bbf\u95ee\\n\\n```bash\\niptables -t nat -I PREROUTING -p tcp -m tcp --dport 30022 -j DNAT --to-destination 10.10.10.100:22\\niptables -t nat -I PREROUTING -p tcp -m multiport --dports 80,443 -j DNAT --to-destination 10.10.10.100\\n\\n# \u67e5\u770b nat PREROUTING \u7aef\u53e3\u6620\u5c04\u89c4\u5219\\niptables -t nat -nvL PREROUTING\\n\\n# \u6e05\u7a7a nat PREROUTING \u7aef\u53e3\u6620\u5c04\u89c4\u5219\\n# iptables -t nat -F PREROUTING\\n```\\n\\n### \u5176\u4ed6\\n\\n\u8fd8\u53ef\u4ee5\u518d\u6b21\u5957\u5a03\uff0c\u5728Debian LXC\u4e2d\u5b89\u88c5docker"},{"id":"/posts/tailscale-custom-derper-server","metadata":{"permalink":"/posts/tailscale-custom-derper-server","source":"@site/blog/posts/tailscale-custom-derper-server.md","title":"\u5728k8s\u4e2d\u90e8\u7f72Tailscale\u79c1\u6709\u4e2d\u7ee7\u670d\u52a1\u5668Derper","description":"\u4ecb\u7ecd\u5982\u4f55\u8ba9Tailscale\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 DERP Servers","date":"2022-04-01T12:55:19.000Z","formattedDate":"2022\u5e744\u67081\u65e5","tags":[{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":1.4066666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5728k8s\u4e2d\u90e8\u7f72Tailscale\u79c1\u6709\u4e2d\u7ee7\u670d\u52a1\u5668Derper","date":"2022-04-01T12:55:19.000Z","description":"\u4ecb\u7ecd\u5982\u4f55\u8ba9Tailscale\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 DERP Servers","tags":["tailscale","kubernetes"]},"prevItem":{"title":"\u817e\u8baf\u4e91Lighthouse\u4e0a\u6d77Debian11\u5b89\u88c5Proxmox VE","permalink":"/posts/lighthouse-pve"},"nextItem":{"title":"CaddyV1\u5347\u7ea7\u5230V2\u7248\u672c","permalink":"/posts/caddy-v1-upgrade-v2"}},"content":"\x3c!-- truncate --\x3e\\n\\n## DERP \u7b80\u4ecb\\n\\n`Detoured Encrypted Routing Protocol`\uff0c\u8fd9\u662f Tailscale \u81ea\u7814\u534f\u8bae\uff0c\u7528\u4e8e\u5728\u79c1\u6709\u7f51\u7edc\u4e2d\u5b9e\u73b0\u8def\u7531\u8f6c\u53d1\u3002\u6240\u6709\u5ba2\u6237\u7aef\u4e4b\u95f4\u7684\u8fde\u63a5\u90fd\u662f\u5148\u9009\u62e9 DERP \u6a21\u5f0f\uff08\u4e2d\u7ee7\u6a21\u5f0f\uff09\uff0c\u8fd9\u610f\u5473\u7740\u8fde\u63a5\u7acb\u5373\u5c31\u80fd\u5efa\u7acb\uff08\u4f18\u5148\u7ea7\u6700\u4f4e\u4f46 100% \u80fd\u6210\u529f\u7684\u6a21\u5f0f\uff09\uff0c\u7528\u6237\u4e0d\u7528\u4efb\u4f55\u7b49\u5f85\u3002\u7136\u540e\u5f00\u59cb\u5e76\u884c\u5730\u8fdb\u884c\u8def\u5f84\u53d1\u73b0\uff0c\u901a\u5e38\u51e0\u79d2\u949f\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u80fd\u53d1\u73b0\u4e00\u6761\u66f4\u4f18\u8def\u5f84\uff0c\u7136\u540e\u5c06\u73b0\u6709\u8fde\u63a5\u900f\u660e\u5347\u7ea7\uff08upgrade\uff09\u8fc7\u53bb\uff0c\u53d8\u6210\u70b9\u5bf9\u70b9\u8fde\u63a5\u3002\\n\\n\u66f4\u591a\u53ef\u4ee5\u9605\u8bfb [Tailscale \u57fa\u7840\u6559\u7a0b\uff1a\u90e8\u7f72\u79c1\u6709 DERP \u4e2d\u7ee7\u670d\u52a1\u5668](https://fuckcloudnative.io/posts/custom-derp-servers)\\n\\n## \u90e8\u7f72\\n\\n### Dockerfile\\n\\n> \u9700\u8981\u8c03\u6574\u4e00\u4e0bDockerfile\\n\\n```Dockerfile\\nFROM ghcr.io/yangchuansheng/ip_derper\\n\\nENV DERP_ADDR=\\":12345\\"\\n\\n# build self-signed certs && start derper\\nCMD bash /app/build_cert.sh $DERP_HOST $DERP_CERTS /app/san.conf && \\\\\\n    /app/derper --hostname=$DERP_HOST \\\\\\n    --certmode=manual \\\\\\n    --certdir=$DERP_CERTS \\\\\\n    --stun  \\\\\\n    --a=$DERP_ADDR \\\\\\n    --verify-clients=$DERP_VERIFY_CLIENTS\\n```\\n\\n\u6784\u5efa\u51fa\u955c\u50cf\u793a\u4f8b\uff1a `ysicing/ip_derper:latest`\\n\\n### \u96c6\u7fa4\u4e2d\u90e8\u7f72\\n\\n```yaml\\n---\\napiVersion: apps/v1\\nkind: DaemonSet\\nmetadata:\\n  name: derper\\n  namespace: ergo-system\\n  labels:\\n    mode.ysicing.me/workload: node\\n    k8s.ysicing.me/name: derper\\nspec:\\n  selector:\\n    matchLabels:\\n      mode.ysicing.me/workload: node\\n      k8s.ysicing.me/name: derper\\n  template:\\n    metadata:\\n      labels:\\n        mode.ysicing.me/workload: node\\n        k8s.ysicing.me/name: derper\\n    spec:\\n      containers:\\n      - name: derper\\n        image: ysicing/ip_derper\\n        resources:\\n          requests:\\n            cpu: 10m\\n            memory: 20Mi\\n      terminationGracePeriodSeconds: 30\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: derper\\n  namespace: ergo-system\\nspec:\\n  selector:\\n    mode.ysicing.me/workload: node\\n    k8s.ysicing.me/name: derper\\n  type: ClusterIP\\n  ports:\\n  - name: stun\\n    protocol: UDP\\n    port: 3478\\n    targetPort: 3478\\n  - name: http\\n    protocol: TCP\\n    port: 12345\\n    targetPort: 12345\\n---\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  name: tcp-services\\n  namespace: kube-system\\ndata:\\n  12345: \\"ergo-system/derper:12345\\"\\n---\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  name: udp-services\\n  namespace: kube-system\\ndata:\\n  3478: \\"ergo-system/derper:3478\\"\\n```\\n\\n\u751f\u6548\u4e4b\u540e\u914d\u7f6e\u5728tailscale\u540e\u53f0\u914d\u7f6e:\\n\\n```json\\n{\\n  \\"Regions\\": {\\n    \\"901\\": {\\n      \\"RegionID\\": 901,\\n      \\"RegionCode\\": \\"tx-bj\\",\\n      \\"RegionName\\": \\"Qcloud Beijing\\",\\n      \\"Nodes\\": [\\n        {\\n          \\"Name\\": \\"901a\\",\\n          \\"RegionID\\": 901,\\n          \\"DERPPort\\": 12345,\\n          \\"HostName\\": \\"xxxx\\",\\n          \\"IPv4\\": \\"xxxx\\",\\n          \\"InsecureForTests\\": true\\n        },\\n        {\\n          \\"Name\\": \\"901b\\",\\n          \\"RegionID\\": 901,\\n          \\"DERPPort\\": 12345,\\n          \\"HostName\\": \\"xxxx\\",\\n          \\"IPv4\\": \\"xxxx\\",\\n          \\"InsecureForTests\\": true\\n        }\\n      ]\\n    }\\n  }\\n}\\n```\\n\\n\u6ce8\u610f:\\n\\n1. `HostName`\u548c`IPv4`\u586b\u5b9e\u9645ip\\n2. \u5ffd\u7565\u8bc1\u4e66\u6821\u9a8c\\n\\n### \u91cd\u542f\\n\\n\u4f9d\u6b21\u91cd\u542ftailscaled, \u7136\u540e\u68c0\u67e5\\n\\n```bash\\ntailscale netcheck\\n```"},{"id":"/posts/caddy-v1-upgrade-v2","metadata":{"permalink":"/posts/caddy-v1-upgrade-v2","source":"@site/blog/posts/caddy-v1-upgrade-v2.md","title":"CaddyV1\u5347\u7ea7\u5230V2\u7248\u672c","description":"\u4e3b\u8981\u8bb2\u8ff0caddy v1\u5347\u7ea7\u5230v2\u7248\u672c\u7684\u8fc7\u7a0b","date":"2022-02-26T12:18:08.000Z","formattedDate":"2022\u5e742\u670826\u65e5","tags":[{"label":"caddy","permalink":"/tags/caddy"}],"readingTime":0.9433333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"CaddyV1\u5347\u7ea7\u5230V2\u7248\u672c","date":"2022-02-26T12:18:08.000Z","description":"\u4e3b\u8981\u8bb2\u8ff0caddy v1\u5347\u7ea7\u5230v2\u7248\u672c\u7684\u8fc7\u7a0b","tags":["caddy"]},"prevItem":{"title":"\u5728k8s\u4e2d\u90e8\u7f72Tailscale\u79c1\u6709\u4e2d\u7ee7\u670d\u52a1\u5668Derper","permalink":"/posts/tailscale-custom-derper-server"},"nextItem":{"title":"\u5728TKE\u4e0a\u4f7f\u7528Traefik Ingress","permalink":"/posts/tke-traefik-ingress"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u80cc\u666f\\n\\n> \u60f3\u5347\u7ea7\u5230v2\u7248\u672c\u8e29\u8e29\u5751\\n\\n## \u5347\u7ea7\u8e29\u5751\\n\\n\u76ee\u524dcaddy v1\u7248\u672c\u7684\u5b89\u88c5\u548c\u4f7f\u7528\u65b9\u5f0f\u548cv2\u7248\u672c\u76f8\u540c\uff0c\u4f46\u662fv2\u7248\u672c\u4f7f\u7528\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\u3002\\n\\n\u4e4b\u524d\u4e5f\u5199\u8fc7[Caddy2\u7684\u4f7f\u7528](/posts/caddy2/), \u8fd9\u91cc\u4e0d\u8be6\u7ec6\u4e86\uff0c\u76f4\u63a5\u8df3\u8fc7\u4e86\u3002\\n\\n### systemd\\n\\n- v1\\n\\n```bash\\n[Service]\\nRestart=on-abnormal\\nUser=www-data\\nGroup=www-data\\nEnvironment=CADDYPATH=/etc/ssl/caddy\\nExecStart=/usr/local/bin/caddy -log stdout -agree=true -conf=/etc/caddy/Caddyfile -root=/var/tmp\\nExecReload=/bin/kill -USR1 $MAINPID\\nKillMode=mixed\\nKillSignal=SIGQUIT\\nTimeoutStopSec=5s\\nLimitNOFILE=1048576\\nLimitNPROC=512\\nPrivateTmp=true\\nPrivateDevices=false\\nProtectHome=true\\nProtectSystem=full\\nReadWritePaths=/etc/ssl/caddy\\nReadWriteDirectories=/etc/ssl/caddy\\n```\\n\\n- v2\\n\\n```bash\\n[Service]\\nType=notify\\nUser=www-data\\nGroup=www-data\\nEnvironment=CADDYPATH=/etc/ssl/caddy\\nExecStart=/usr/local/bin/caddy2 run --environ --watch  --config /etc/caddy2/Caddyfile\\nExecReload=/usr/local/bin/caddy2 reload --config /etc/caddy2/Caddyfile\\nTimeoutStopSec=5s\\nLimitNOFILE=1048576\\nLimitNPROC=512\\nPrivateTmp=true\\nProtectSystem=full\\nAmbientCapabilities=CAP_NET_BIND_SERVICE\\n```\\n\\n### \u4ee3\u7406\u5206\u6d41\\n\\n- v1\\n\\n```bash\\ncao.buhuibaidu.me {\\n    gzip\\n    timeouts none\\n    proxy / https://www.baidu.com {\\n        except /bing\\n    }\\n    proxy /bing https://127.0.0.1:40000 {\\n        header_upstream Host {host}\\n        header_upstream X-Forwarded-Proto {scheme}\\n        insecure_skip_verify\\n    }\\n}\\n```\\n\\n- v2\\n\\n```bash\\ncao.buhuibaidu.me {\\n    import GZIP\\n    @noproxy {\\n        not path \\"/bing\\"\\n    }\\n    reverse_proxy @noproxy https://www.baidu.com\\n    reverse_proxy /bing https://127.0.0.1:40000 {\\n        header_up Host {host}\\n        header_up X-Forwarded-Proto {scheme}\\n        transport http {\\n            tls_insecure_skip_verify\\n       }\\n    }\\n}\\n```\\n\\n### \u672a\u586b\u5b8c\u7684\u5751\\n\\n\u4e4b\u524dv1\u7248\u672c\u90e8\u7f72\u8fc7caddy\u548ctailscale\u4ee5\u53caergo\u7684\u955c\u50cf\u4ee3\u7406\uff0c\u8c8c\u4f3cv2\u4e0d\u597d\u4f7f\u4e86\\n\\n- v1\\n\\n```bash\\ndebian.ysicing.me {\\n   gzip\\n   log stdout\\n   tls root@ysicing.net\\n   proxy / https://debian.cdn.ysicing.me/apt/\\n}\\n\\nm.deb.ysicing.me {\\n   gzip\\n   log stdout\\n   tls root@ysicing.net\\n   proxy /tailscale/ https://pkgs.tailscale.com/ {\\n     without /tailscale\\n   }\\n   proxy /caddy/ https://dl.cloudsmith.io/public/caddy {\\n    without /caddy\\n  }\\n}\\n\\nm.yum.ysicing.me {\\n   gzip\\n   log stdout\\n   tls root@ysicing.net\\n   proxy /tailscale/ https://pkgs.tailscale.com/ {\\n     without /tailscale\\n   }\\n}\\n```\\n\\n- v2\\n\\n\u5f85\u7eed"},{"id":"/posts/tke-traefik-ingress","metadata":{"permalink":"/posts/tke-traefik-ingress","source":"@site/blog/posts/tke-traefik-ingress.md","title":"\u5728TKE\u4e0a\u4f7f\u7528Traefik Ingress","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u5728tke\u4e0a\u90e8\u7f72traefik ingress","date":"2022-01-10T13:08:31.000Z","formattedDate":"2022\u5e741\u670810\u65e5","tags":[{"label":"ingress","permalink":"/tags/ingress"},{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"tke","permalink":"/tags/tke"},{"label":"traefik","permalink":"/tags/traefik"}],"readingTime":4.59,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5728TKE\u4e0a\u4f7f\u7528Traefik Ingress","date":"2022-01-10T13:08:31.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u5728tke\u4e0a\u90e8\u7f72traefik ingress","tags":["ingress","kubernetes","tke","traefik"]},"prevItem":{"title":"CaddyV1\u5347\u7ea7\u5230V2\u7248\u672c","permalink":"/posts/caddy-v1-upgrade-v2"},"nextItem":{"title":"Tke\u96c6\u7fa4\u57fa\u4e8eCFS\u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684pvc","permalink":"/posts/tke-cfs-nfs-client"}},"content":"\x3c!-- truncate --\x3e\\n\\n> Traefik\u662f\u4e00\u6b3e\u4f18\u79c0\u7684\u8fb9\u7f18\u8def\u7531\u5de5\u5177\uff0c\u517c\u5bb9\u6240\u6709\u4e3b\u6d41\u7684\u96c6\u7fa4\u6280\u672f\u3002\\n\\n\u5177\u4f53\u5982\u4e0b\u7279\u6027:\\n\\n- \u539f\u751f\u652f\u6301\u670d\u52a1\u53d1\u73b0\u3001\u52a8\u6001\u914d\u7f6e\uff0c\u53ef\u4ee5\u81ea\u52a8watch\u540e\u7aef\u53d8\u5316\u540c\u6b65\u5230\u8d1f\u8f7d\u5747\u8861\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\\n\\n- \u652f\u6301\u7075\u6d3b\u914d\u7f6e\u53ef\u89c2\u6027`logs`\u3001`metrics`\u3001`tracing`\\n\\n- \u63d0\u4f9bdashboard\u529f\u80fd\\n\\n- \u62e5\u6709\u4e30\u5bcc\u7684\u9ad8\u7ea7\u7279\u6027: \u7070\u5ea6\u53d1\u5e03\u3001\u6d41\u91cf\u590d\u5236\u3001\u4e2d\u95f4\u4ef6\u3001https\u7b49\u3002\\n\\n> \u672c\u6587\u4e3b\u8981\u5df2\u6700\u65b0\u7a33\u5b9a\u7248\u672c `2.5.6`\u4e3a\u4f8b\u8bb2\u8ff0\u5728tke\u96c6\u7fa4\u4e2d\u5b89\u88c5traefik\uff0c\u540e\u7eed\u5173\u4e8etraefik\u90fd\u5df2\u672c\u7248\u672c\u4e3a\u4f8b\\n\\n## \u524d\u63d0\u6761\u4ef6\\n\\n- \u5df2\u7ecfready\u96c6\u7fa4\u7684tke\u96c6\u7fa4\u6216\u8005k3s\u96c6\u7fa4,(\u540e\u9762\u4f1a\u7b80\u5355\u8bf4\u4e0bk3s\u5355\u8282\u70b9\u96c6\u7fa4\u5b89\u88c5)\\n- \u5df2\u914d\u7f6e\u597d`kubectl`\\n- \u5df2\u5b89\u88c5`helm`\\n- \u5df2\u5b89\u88c5 [ergo](https://github.com/ysicing/ergo)\\n\\n### \u5b89\u88c5traefik\\n\\n1. \u6dfb\u52a0traefik helm\u4ed3\u5e93\\n\\n```bash\\nhelm repo add traefik https://helm.traefik.io/traefik\\nhelm repo update\\n# \u4e0b\u8f7dhelm\u5305\u5e76\u89e3\u538b\\nhelm pull traefik/traefik --untar \\n```\\n\\n2. tke\u96c6\u7fa4\u51c6\u5907\u4e00\u4e2a\u95f2\u7f6e\u7684slb\uff0c\u83b7\u53d6slbid\u5f85\u7528\\n\\n3. \u5b89\u88c5`jaeger-operator`\\n\\n```bash\\nkubectl create namespace observability\\nergo ops wget  https://github.com/jaegertracing/jaeger-operator/releases/download/v1.29.0/jaeger-operator.yaml\\nkubectl create -f /root/.ergo/tmp/jaeger-operator.yaml -n observability\\n```\\n\\n4. \u5b89\u88c5`jaegertracing` all-in-one\\n\\n> \u6d4b\u8bd5\u4f7f\u7528\uff0c\u751f\u4ea7\u4f7f\u7528\u53ef\u8003\u8651\u9ad8\u53ef\u7528\u90e8\u7f72\\n\\n```yaml\\napiVersion: jaegertracing.io/v1\\nkind: Jaeger\\nmetadata:\\n  name: simplest\\n  namespace: observability\\nspec:\\n  strategy: allInOne\\n  allInOne:\\n    image: jaegertracing/all-in-one:latest\\n  ingress:\\n    enabled: true\\n    hosts:\\n      - jaeger-x.external.ysicing.me\\n    annotations:\\n      kubernetes.io/ingress.class: traefik\\n      traefik.ingress.kubernetes.io/router.entrypoints: websecure\\n      traefik.ingress.kubernetes.io/router.tls: \\"true\\"\\n      traefik.ingress.kubernetes.io/router.tls.certresolver: myresolver\\n```\\n\\n\u5c06\u4e0a\u8ff0yaml\u4fdd\u5b58\u4e3a`jaeger.yaml`\\n\\n```bash\\nkubectl apply -n observability -f ./observability/jaeger.yaml\\n```\\n\\n5. \u5b89\u88c5gateway api\\n\\n\u542f\u7528\u5b9e\u9a8c\u6027 Kubernetes \u7f51\u5173,\u9700\u8981\u63d0\u524d\u5b89\u88c5\u3002\u5177\u4f53\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u6587\u6863[Traefik & Kubernetes with Gateway API](https://doc.traefik.io/traefik/providers/kubernetes-gateway/),\u540e\u9762\u4e5f\u4f1a\u4e13\u95e8\u4ecb\u7ecd.\\n\\n```bash\\nkubectl kustomize \\"github.com/kubernetes-sigs/gateway-api/config/crd?ref=v0.3.0\\" \\\\\\n| kubectl apply -f -\\n```\\n\\n6. \u914d\u7f6etraefik value.yaml\\n\\n```yaml\\nimage:\\n  name: traefik\\n  tag: \\"\\"\\n  pullPolicy: IfNotPresent\\ndeployment:\\n  enabled: true\\n  kind: Deployment\\n  replicas: 1\\n  terminationGracePeriodSeconds: 60\\n  minReadySeconds: 0\\n  podAnnotations: \\n    tke.cloud.tencent.com/networks: \\"tke-route-eni\\" # \u5728 VPC-CNI \u4e0e Global Router \u4e24\u79cd\u7f51\u7edc\u6a21\u5f0f\u6df7\u7528\u7684\u60c5\u51b5\u4e0b\uff0c\u663e\u793a\u58f0\u660e Pod \u8981\u4f7f\u7528\u5f39\u6027\u7f51\u5361\uff0c\u4e0e\u4ee5\u4e0b eni-ip \u7684 request \u4e0e limit \u4e00\u8d77\u914d\u5408\u4f7f\u7528\\n\\ningressClass:\\n  enabled: true\\n  isDefaultClass: true\\n\\npilot:\\n  enabled: false\\n\\nexperimental:\\n  plugins:\\n    enabled: true\\n  kubernetesGateway:\\n    enabled: true\\n    appLabelSelector: \\"traefik\\"\\n\\ningressRoute:\\n  dashboard:\\n    enabled: true\\n    annotations:\\n      kubernetes.io/ingress.class: traefik\\n\\nrollingUpdate:\\n  maxUnavailable: 1\\n  maxSurge: 1\\n\\n\\n#\\n# Configure providers\\n#\\nproviders:\\n  kubernetesCRD:\\n    enabled: true\\n    allowCrossNamespace: true\\n    allowExternalNameServices: true\\n    ingressClass: traefik\\n\\n  kubernetesIngress:\\n    enabled: true\\n    allowExternalNameServices: true\\n    publishedService:\\n      enabled: true # \u8ba9 Ingress \u7684\u5916\u90e8 IP \u5730\u5740\u72b6\u6001\u663e\u793a\u4e3a Traefik \u7684 LB IP \u5730\u5740\\nlogs:\\n  general:\\n    level: ERROR\\n  access:\\n    enabled: true\\n    filters: \\n      # statuscodes: \\"200,300-302\\" #\u8bbe\u7f6e\u53ea\u4fdd\u7559\u6307\u5b9a\u72b6\u6001\u7801\u8303\u56f4\u5185\u7684\u8bbf\u95ee\u65e5\u5fd7\\n      retryattempts: true # \u8bbe\u7f6e\u4ee3\u7406\u8bbf\u95ee\u91cd\u8bd5\u5931\u8d25\u65f6\uff0c\u4fdd\u7559\u8bbf\u95ee\u65e5\u5fd7\\n      minduration: 10ms # \u8bbe\u7f6e\u4fdd\u7559\u8bf7\u6c42\u65f6\u95f4\u8d85\u8fc7\u6307\u5b9a\u6301\u7eed\u65f6\u95f4\u7684\u8bbf\u95ee\u65e5\u5fd7\\n    fields:\\n      general:\\n        defaultmode: keep # \u8bbe\u7f6e\u9ed8\u8ba4\u65e5\u5fd7\u8f93\u51fa\u6a21\u5f0f\uff0ckeep\u8868\u793a\u4fdd\u7559\u6240\u6709\u65e5\u5fd7\u5b57\u6bb5\uff0cdrop\u8868\u793a\u4e0d\u4fdd\u7559\u65e5\u5fd7\u5b57\u6bb5\\n        names: \\n          ClientUsername: drop\\n      headers:\\n        defaultmode: keep # \u8bbe\u7f6e Header \u4e2d\u5b57\u6bb5\u662f\u5426\u4fdd\u7559\\n        names: \\n          User-Agent: redact\\n          Authorization: drop\\n          Content-Type: keep\\n\\nmetrics:\\n  prometheus:\\n    entryPoint: metrics\\n\\nglobalArguments:\\n  - \\"--global.checknewversion\\"\\n  - \\"--global.sendanonymoususage\\"\\n\\nadditionalArguments: \\n   - \\"--providers.kubernetesingress.ingressclass=traefik\\"\\n   - \\"--entryPoints.web.proxyProtocol.insecure\\"\\n   - \\"--api=true\\"\\n   - \\"--certificatesresolvers.myresolver.acme.email=ysicing@you.mail\\"\\n   - \\"--certificatesresolvers.myresolver.acme.storage=/data/acme.json\\"\\n  #- \\"--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory\\"\\n   - \\"--certificatesresolvers.myresolver.acme.tlschallenge=true\\"\\n   - \\"--certificatesresolvers.myresolver.acme.httpchallenge=true\\"\\n   - \\"--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web\\"\\n  #- \\"--certificatesresolvers.myresolver.acme.dnschallenge=false\\"\\n   - \\"--tracing.jaeger=true\\"\\n   - \\"--tracing.jaeger.samplingServerURL=http://simplest-agent.observability.svc:5778/sampling\\"\\n   - \\"--tracing.jaeger.localAgentHostPort=simplest-agent.observability.svc:6831\\"\\n   - \\"--tracing.jaeger.collector.endpoint=http://simplest-collector.observability.svc:14268/api/traces?format=jaeger.thrift\\"\\n  #- \\"--log.level=DEBUG\\"\\n\\nports:\\n  # The name of this one can\'t be changed as it is used for the readiness and\\n  # liveness probes, but you can adjust its config to your liking\\n  traefik:\\n    port: 9000\\n    expose: false\\n    exposedPort: 9000\\n    protocol: TCP\\n  web:\\n    port: 8000\\n    expose: true\\n    exposedPort: 80\\n    protocol: TCP\\n    redirectTo: websecure # http\u91cd\u5b9a\u5411https, \u5185\u7f6e\u4e2d\u95f4\u4ef6\\n  websecure:\\n    port: 8443\\n    expose: true\\n    exposedPort: 443\\n    protocol: TCP\\n    tls: #\u5f00\u542f\u9ed8\u8ba4tls\\n      enabled: false\\n      # this is the name of a TLSOption definition\\n      options: \\"\\"\\n      certResolver: \\"\\"\\n      domains: []\\n  metrics:\\n    port: 9100\\n    expose: false\\n    exposedPort: 9100\\n    protocol: TCP\\n\\nservice:\\n  enabled: true\\n  type: LoadBalancer\\n  annotations: \\n    service.kubernetes.io/tke-existed-lbid: lb-xxx # \u95f2\u7f6eslb id\\n    service.cloud.tencent.com/direct-access: \\"true\\" # \u7f51\u5173\u7c7b\u7684\u5e94\u7528\u5efa\u8bae\u4f7f\u7528 LB \u76f4\u901a Pod (\u7ed5\u8fc7 NodePort)\u3002\u82e5\u4f7f\u7528 VPC-CNI \u4e0e Global Router \u4e24\u79cd\u7f51\u7edc\u6a21\u5f0f\u6df7\u7528\uff0c\u7528\u6b64\u6ce8\u89e3\u6765\u663e\u793a\u58f0\u660e LB \u76f4\u7ed1 Pod (\u7ed5\u8fc7 NodePort); \u82e5\u521b\u5efa\u96c6\u7fa4\u65f6\u5c31\u9009\u7684 VPC-CNI \u7f51\u7edc\u6a21\u5f0f\uff0c\u5219\u4e0d\u9700\u8981\u663e\u793a\u58f0\u660e (\u9ed8\u8ba4 LB \u76f4\u901a Pod)\u3002\u8be6\u60c5\u8bf7\u53c2\u89c1\u5b98\u65b9\u6587\u6863 https://cloud.tencent.com/document/product/457/48793\\n    service.cloud.tencent.com/enable-grace-shutdown: \\"true\\"  # \u8868\u793a\u4f7f\u7528\u4f18\u96c5\u505c\u673a\\n\\npersistence:\\n  enabled: true\\n  name: data\\n#  existingClaim: \\"\\"\\n  accessMode: ReadWriteOnce\\n  size: 128Mi\\n  # storageClass: \\"\\"\\n  path: /data\\n  annotations: {}\\n  # subPath: \\"\\" # only mount a subpath of the Volume into the pod\\n\\nrbac:\\n  enabled: true\\n  namespaced: false\\npodSecurityPolicy:\\n  enabled: false\\nresources: \\n  requests:\\n    cpu: \\"100m\\"\\n    memory: \\"50Mi\\"\\n    tke.cloud.tencent.com/eni-ip: \\"1\\"\\n  limits:\\n    cpu: \\"1000m\\"\\n    memory: \\"1500Mi\\"\\n    tke.cloud.tencent.com/eni-ip: \\"1\\"\\naffinity: {}\\n\\n# host\u9ed8\u8ba4\u9700\u8981\u914d\u7f6e\uff0c\u9ed8\u8ba4\u4e0d\u9700\u8981\\nsecurityContext:\\n  capabilities:\\n    drop: [ALL]\\n    # add: [NET_BIND_SERVICE]\\n  readOnlyRootFilesystem: true\\n  runAsGroup: 65532 #0\\n  runAsNonRoot: true #false\\n  runAsUser: 65532 #0\\n\\npodSecurityContext:\\n  fsGroup: 65532 #0\\n```\\n\\n\u5b89\u88c5traefik\\n\\n```bash\\n# \u7f16\u8f91\u9ed8\u8ba4\u7684values.yaml\\nkubectl create ns traefik-v2\\nhelm upgrade -i  --namespace=traefik-v2 traefik ./traefik\\n```\\n\\n## \u4f7f\u7528\\n\\n```yaml\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name:  whoami\\n  namespace: traefik-v2\\n  labels:\\n    app:  whoami\\nspec:\\n  selector:\\n    matchLabels:\\n      app: whoami\\n  replicas: 2\\n  strategy:\\n    rollingUpdate:\\n      maxSurge: 25%\\n      maxUnavailable: 25%\\n    type: RollingUpdate\\n  template:\\n    metadata:\\n      labels:\\n        app: whoami\\n    spec:\\n      # initContainers:\\n        # Init containers are exactly like regular containers, except:\\n          # - Init containers always run to completion.\\n          # - Each init container must complete successfully before the next one starts.\\n      containers:\\n      - name:  whoami\\n        image:  traefik/whoami\\n        resources:\\n          requests:\\n            cpu: 100m\\n            memory: 100Mi\\n          limits:\\n            cpu: 100m\\n            memory: 100Mi\\n        livenessProbe:\\n          tcpSocket:\\n            port: 80\\n          initialDelaySeconds: 5\\n          timeoutSeconds: 5\\n          successThreshold: 1\\n          failureThreshold: 3\\n          periodSeconds: 10\\n        readinessProbe:\\n          httpGet:\\n            path: /_status/healthz\\n            port: 80\\n          initialDelaySeconds: 5\\n          timeoutSeconds: 2\\n          successThreshold: 1\\n          failureThreshold: 3\\n          periodSeconds: 10\\n        ports:\\n        - containerPort:  80\\n          name:  whoami\\n      restartPolicy: Always\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: whoami\\n  namespace: traefik-v2\\nspec:\\n  selector:\\n    app: whoami\\n  type: ClusterIP\\n  ports:\\n  - name: whoami\\n    protocol: TCP\\n    port: 80\\n    targetPort: 80\\n---\\napiVersion: traefik.containo.us/v1alpha1\\nkind: IngressRoute\\nmetadata:\\n  name: whoami\\n  namespace: traefik-v2\\n  annotations:\\n    kubernetes.io/ingress.class: traefik\\nspec:\\n  entryPoints:\\n    - websecure\\n  routes:\\n  - match: Host(`whoami.internal-pre.ysicing.me`)\\n    kind: Rule\\n    services:\\n    - name: whoami\\n      port: 80\\n  tls:\\n    certResolver: myresolver\\n    # secretName: self-tls\\n    # \u81ea\u7b7e\u8bc1\u4e66\\n    # openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj \\"/CN=whoami.internal-pre.ysicing.me\\"\\n    # kubectl create secret tls self-tls --cert=tls.crt --key=tls.key -n traefik-v2\\n---\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  name: whoami\\n  namespace: traefik-v2\\n  annotations:\\n    kubernetes.io/ingress.class: traefik\\n    traefik.ingress.kubernetes.io/router.entrypoints: websecure\\n    traefik.ingress.kubernetes.io/router.tls: \\"true\\"\\n    traefik.ingress.kubernetes.io/router.tls.certresolver: myresolver\\n    # traefik.ingress.kubernetes.io/router.middlewares: traefik-v2-http2https@kubernetescrd\\nspec:\\n  rules:\\n  - host: whoami2.internal-pre.ysicing.me\\n    http:\\n      paths:\\n      - path: /\\n        pathType: Prefix\\n        backend:\\n          service:\\n            name: whoami\\n            port:\\n              number: 80\\n```\\n\\napply\u5230\u96c6\u7fa4\u8bbf\u95ee\u6d4b\u8bd5\\n\\n```http\\nHostname: whoami-57fd8795c-4s55f\\nIP: 127.0.0.1\\nIP: 10.52.37.48\\nRemoteAddr: 10.0.16.12:37954\\nGET / HTTP/1.1\\nHost: whoami2.internal-pre.ysicing.me\\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.35 Safari/537.36 Edg/96.0.1054.13\\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\\nAccept-Encoding: gzip, deflate, br\\nAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6\\nDnt: 1\\nSec-Ch-Ua: \\" Not A;Brand\\";v=\\"99\\", \\"Chromium\\";v=\\"96\\", \\"Microsoft Edge\\";v=\\"96\\"\\nSec-Ch-Ua-Mobile: ?0\\nSec-Ch-Ua-Platform: \\"macOS\\"\\nSec-Fetch-Dest: document\\nSec-Fetch-Mode: navigate\\nSec-Fetch-Site: cross-site\\nSec-Fetch-User: ?1\\nUber-Trace-Id: 2310a2ad4e9d5245:5b38aa949db62245:2310a2ad4e9d5245:1\\nUpgrade-Insecure-Requests: 1\\nX-Forwarded-For: 101.35.53.4\\nX-Forwarded-Host: whoami2.internal-pre.ysicing.me\\nX-Forwarded-Port: 443\\nX-Forwarded-Proto: https\\nX-Forwarded-Server: sh-pre\\nX-Real-Ip: 101.35.53.4\\n```"},{"id":"/posts/tke-cfs-nfs-client","metadata":{"permalink":"/posts/tke-cfs-nfs-client","source":"@site/blog/posts/tke-cfs-nfs-client.md","title":"Tke\u96c6\u7fa4\u57fa\u4e8eCFS\u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684pvc","description":"\u4f7f\u7528 nfs-client-provisioner \u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684 pvc","date":"2021-11-26T07:31:49.000Z","formattedDate":"2021\u5e7411\u670826\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"qcloud","permalink":"/tags/qcloud"},{"label":"csi","permalink":"/tags/csi"}],"readingTime":1.0533333333333332,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Tke\u96c6\u7fa4\u57fa\u4e8eCFS\u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684pvc","date":"2021-11-26T07:31:49.000Z","description":"\u4f7f\u7528 nfs-client-provisioner \u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684 pvc","tags":["kubernetes","qcloud","csi"]},"prevItem":{"title":"\u5728TKE\u4e0a\u4f7f\u7528Traefik Ingress","permalink":"/posts/tke-traefik-ingress"},"nextItem":{"title":"\u57fa\u4e8eDNSPOD\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","permalink":"/posts/tke-dnspod-cert-manager-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5e8f\\n\\n\u7531\u4e8eTKE\u96c6\u7fa4CSI\u529f\u80fd\u76f8\u5bf9ACK\u6bd4\u8f83\u9e21\u808b, \u76f8\u5bf9\u963f\u91cc\u4e91NAS CSI. \u6211\u4eec\u53ea\u9700\u8981SC\u81ea\u52a8\u6539\u521b\u5efaCFS\u7c7b\u578b\u7684PV\u548cPVC.\\n\u6211\u4eec\u7684\u4f7f\u7528\u573a\u666f\u662f\u4e0d\u540cPV\u4f7f\u7528\u540c\u4e00\u4e2aCFS\u4e0d\u540c\u8def\u5f84, \u6216\u8005\u4e0d\u540cCFS\u53ef\u4ee5\u5171\u4eab\u8d44\u6e90\u5305(\u6210\u672c\u95ee\u9898,\u521b\u5efaPV\u6570\u76ee\u6bd4\u8f83\u591a), \u6070\u6070\u8fd9\u4e24\u70b9TKE\u90fd\u4e0d\u652f\u6301\u3002 \u5bf9\u6b64\u4f7f\u7528\u793e\u533a\u7684 nfs-client-provisioner \u9879\u76ee\u6765\u5b9e\u73b0\u52a8\u6001\u521b\u5efa CFS \u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5b50\u8def\u5f84\\n\\n## \u90e8\u7f72\\n\\n1. \u521b\u5efaCFS\u5b9e\u4f8b\u5e76\u914d\u7f6e\u597d\u8d44\u6e90\u5305\\n2. \u5b89\u88c5`nfs-subdir-external-provisioner`\\n\\n```bash\\nhelm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\\nhelm repo update\\nhelm upgrade -i nfs-subdir-external-provisioner -n kube-system nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\\\\\n    --set image.repository=ccr.ccs.tencentyun.com/k7scn/nfs-subdir-external-provisioner \\\\\\n    --set image.tag=v4.0.2 \\\\\\n    --set nfs.server=<cfs.ip> \\\\\\n    --set nfs.path=/ \\\\\\n    --set storageClass.defaultClass=true \\\\\\n    --set storageClass.name=opencfs\\n```\\n\\n3. \u67e5\u770b\u52a8\u6001\u5b58\u50a8\u7c7b\\n\\n```bash\\nkubectl get sc\\nNAME                PROVISIONER                                     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\\ncbs                 com.tencent.cloud.csi.cbs                       Delete          Immediate           false                  6d22h\\ncce                 com.tencent.cloud.csi.cfs                       Retain          Immediate           false                  3d21h\\nopencfs (default)   cluster.local/nfs-subdir-external-provisioner   Delete          Immediate           true                   4s\\n```\\n\\n4. \u6d4b\u8bd5\\n\\n```yaml\\nkind: PersistentVolumeClaim\\napiVersion: v1\\nmetadata:\\n  name: whoami\\nspec:\\n  storageClassName: opencfs\\n  accessModes:\\n    - ReadWriteMany\\n  resources:\\n    requests:\\n      storage: 1Mi\\n---      \\napiVersion: apps.kruise.io/v1alpha1\\nkind: CloneSet\\nmetadata:\\n  labels:\\n    app: whoami\\n  name: whoami\\nspec:\\n  replicas: 5\\n  selector:\\n    matchLabels:\\n      app: whoami\\n  template:\\n    metadata:\\n      labels:\\n        app: whoami\\n    spec:\\n      containers:\\n      - name: whoami\\n        image: traefik/whoami\\n        volumeMounts:\\n        - name: data-vol\\n          mountPath: /data\\n  volumes:\\n  - name: data\\n    persistentVolumeClaim:\\n      claimName: whoami\\n---\\napiVersion: apps.kruise.io/v1alpha1\\nkind: SidecarSet\\nmetadata:\\n  name: whoami\\nspec:\\n  selector:\\n    matchLabels:\\n      app: whoami\\n  updateStrategy:\\n    type: RollingUpdate\\n    maxUnavailable: 1\\n  containers:\\n  - name: sidecar\\n    image: ysicing/debian\\n    podInjectPolicy: AfterAppContainer\\n    shareVolumePolicy:\\n      type: enabled\\n    command: [\\"sleep\\", \\"999d\\"]\\n```"},{"id":"/posts/tke-dnspod-cert-manager-install","metadata":{"permalink":"/posts/tke-dnspod-cert-manager-install","source":"@site/blog/posts/tke-dnspod-cert-manager-install.md","title":"\u57fa\u4e8eDNSPOD\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","description":"k8s\u4e0a\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1 TLS \u8bc1\u4e66","date":"2021-11-22T02:51:42.000Z","formattedDate":"2021\u5e7411\u670822\u65e5","tags":[{"label":"cert-manager","permalink":"/tags/cert-manager"},{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"qcloud","permalink":"/tags/qcloud"}],"readingTime":1.1966666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u57fa\u4e8eDNSPOD\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","date":"2021-11-22T02:51:42.000Z","description":"k8s\u4e0a\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1 TLS \u8bc1\u4e66","tags":["cert-manager","kubernetes","qcloud"]},"prevItem":{"title":"Tke\u96c6\u7fa4\u57fa\u4e8eCFS\u52a8\u6001\u521b\u5efa\u4e0d\u540c\u5b50\u76ee\u5f55\u7684pvc","permalink":"/posts/tke-cfs-nfs-client"},"nextItem":{"title":"Drone\u914d\u7f6e\u7ba1\u7406\u5458\u8d26\u53f7","permalink":"/posts/drone-config-admin"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5e8f\\n\\n\u6700\u8fd1\u5728\u4f7f\u7528tke\u96c6\u7fa4\u548cdnspod, \u8bb0\u5f55\u4e00\u4e0b\u57fa\u4e8ednspod\u90e8\u7f72cert-manager\\n\\n## \u5b89\u88c5cert-manager\\n\\n> \u8fd9\u91cc\u4f7f\u7528bitnami\u63d0\u4f9b\u7684cert-manager\\n\\n```bash\\nkubectl create namespace cert-manager\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\nhelm repo update\\nhelm upgrade -i cert-manager -n cert-manager --set installCRDs=true --set leaderElection.namespace=cert-manager bitnami/cert-manager\\n```\\n\\n## \u5b89\u88c5dnspod webhook\\n\\n\u521b\u5efa\u817e\u8baf\u4e91API token\\n\\n```\\nhelm repo add roc https://charts.imroc.cc\\nhelm repo update\\nhelm upgrade -i  cert-manager-webhook-dnspod roc/cert-manager-webhook-dnspod \\\\\\n    --namespace cert-manager \\\\\\n    --set clusterIssuer.secretId=<SECRET_ID> \\\\\\n    --set clusterIssuer.secretKey=<SECRET_KEY> \\n```\\n\\n## \u521b\u5efaClusterIssuer\\n\\n> \u7531\u4e8e\u4e0a\u9762\u914d\u7f6e\u4e86\u9ed8\u8ba4\u521b\u5efa, \u9ed8\u8ba4ClusterIssuer\u4e3a`dnspod`\\n\\n### \u521b\u5efa Certificate\\n\\n```yaml\\napiVersion: cert-manager.io/v1\\nkind: Certificate\\nmetadata:\\n  name: tls-ops-default-ops-com-prod\\n  namespace: default\\nspec:\\n  secretName: tls-ops-default-ops-com-prod # \u8bc1\u4e66\u4fdd\u5b58\u7684 secret \u540d\\n  dnsNames:\\n  - \\"*.default.ops.com\\"\\n  issuerRef:\\n    name: dnspod\\n    kind: ClusterIssuer\\n    group: cert-manager.io\\n```\\n\\n\u901a\u8fc7dns\u9a8c\u8bc1\u53ef\u4ee5\u521b\u5efa\u6cdb\u57df\u540d\u8bc1\u4e66\u3002\\n\\n## \u90e8\u7f72\\n\\n1. \u5728ingress\u91cc\u4f7f\u7528\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    kubernetes.io/ingress.class: nginx\\n    nginx.ingress.kubernetes.io/whitelist-source-range: 10.0.0.0/8\\n  labels:\\n    app: cce\\n  name: cce\\n  namespace: cce-system\\nspec:\\n  rules:\\n  - host: api.cce-system.internal.ysicing.net\\n    http:\\n      paths:\\n      - backend:\\n          service:\\n            name: cce\\n            port:\\n              number: 8080\\n        path: /\\n        pathType: Prefix\\n  tls:\\n  - hosts:\\n    - api.cce-system.internal.ysicing.net\\n    secretName: cce-tls\\n```\\n\\n2. \u5728istio ingressgateway\u4e2d\u4f7f\u7528\\n\\n```yaml\\napiVersion: networking.istio.io/v1alpha3\\nkind: Gateway\\nmetadata:\\n  name: example-gw\\n  namespace: istio-system\\nspec:\\n  selector:\\n    app: istio-ingressgateway\\n    istio: ingressgateway\\n  servers:\\n  - port:\\n      number: 80\\n      name: HTTP-80\\n      protocol: HTTP\\n    hosts:\\n    - example.com\\n    - \\"*.example.com\\"\\n    tls:\\n      httpsRedirect: true # http \u91cd\u5b9a\u5411 https (\u5f3a\u5236 https)\\n  - port:\\n      number: 443\\n      name: HTTPS-443\\n      protocol: HTTPS\\n    hosts:\\n    - example.com\\n    - \\"*.example.com\\"\\n    tls:\\n      mode: SIMPLE\\n      credentialName: example-crt-secret # \u5f15\u7528\u8bc1\u4e66 secret\\n---\\napiVersion: networking.istio.io/v1beta1\\nkind: VirtualService\\nmetadata:\\n  name: example-vs\\n  namespace: test\\nspec:\\n  gateways:\\n  - istio-system/example-gw # \u8f6c\u53d1\u89c4\u5219\u7ed1\u5b9a\u5230 ingressgateway\uff0c\u5c06\u670d\u52a1\u66b4\u9732\u51fa\u53bb\\n  hosts:\\n  - \'test.example.com\'\\n  http:\\n  - route:\\n    - destination:\\n        host: example\\n        port:\\n          number: 80\\n```\\n\\n## \u53c2\u8003\\n\\nhttps://imroc.cc/k8s/trick/cert-manager-webhook-dnspod/\\n\\n[k8s\u4e0a\u5229\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66](/posts/cert-manager-install/)"},{"id":"/posts/drone-config-admin","metadata":{"permalink":"/posts/drone-config-admin","source":"@site/blog/posts/drone-config-admin.md","title":"Drone\u914d\u7f6e\u7ba1\u7406\u5458\u8d26\u53f7","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u4e00\u4e0bdrone\u8c03\u6574\u7ba1\u7406\u5458","date":"2021-11-11T15:17:02.000Z","formattedDate":"2021\u5e7411\u670811\u65e5","tags":[{"label":"drone","permalink":"/tags/drone"},{"label":"devops","permalink":"/tags/devops"}],"readingTime":0.39,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Drone\u914d\u7f6e\u7ba1\u7406\u5458\u8d26\u53f7","date":"2021-11-11T15:17:02.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u4e00\u4e0bdrone\u8c03\u6574\u7ba1\u7406\u5458","tags":["drone","devops"]},"prevItem":{"title":"\u57fa\u4e8eDNSPOD\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","permalink":"/posts/tke-dnspod-cert-manager-install"},"nextItem":{"title":"Brew Cask\u65e5\u5e38\u4f7f\u7528","permalink":"/posts/brew-cask-usage"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u9ed8\u8ba4\u5df2\u7ecf\u5c06drone\u6570\u636e\u6301\u4e45\u5316\u51fa\u6765\u4e86\\n\\n```yaml\\n    spec:\\n      containers:\\n      - envFrom:\\n        - configMapRef:\\n            name: drone\\n        image: registry.cn-beijing.aliyuncs.com/k7scn/drone:2\\n        imagePullPolicy: Always\\n        name: drone\\n        volumeMounts:\\n        - mountPath: /data\\n          name: data\\n      restartPolicy: Always\\n      volumes:\\n      - hostPath:\\n          path: /data/drone\\n          type: DirectoryOrCreate\\n        name: data\\n```\\n\\n## debian\u5b89\u88c5sqlite3\\n\\n```bash\\napt update\\napt install sqlite3 -y\\n```\\n\\n## \u4fee\u6539\u6570\u636e\\n\\n```bash\\nsqlite3 database.sqlite\\n.header on #\u5f00\u542f\u5934\u90e8\u663e\u793a\u3002\\n.mode column # \u5217\u8f93\u51fa\\n.tables\\nselect * from users;\\nupdate users set user_admin = 1;\\n```\\n\\n## \u9a8c\u8bc1\\n\\n```bash\\ndrone user info ysicing\\nUser: ysicing\\nEmail: i@ysicing.me\\nAdmin: true\\nActive: true\\nMachine: false\\n```"},{"id":"/posts/brew-cask-usage","metadata":{"permalink":"/posts/brew-cask-usage","source":"@site/blog/posts/brew-cask-usage.md","title":"Brew Cask\u65e5\u5e38\u4f7f\u7528","description":"\u8bb0\u5f55brew cask\u4f7f\u7528\u5c0f\u6280\u5de7","date":"2021-10-19T01:57:40.000Z","formattedDate":"2021\u5e7410\u670819\u65e5","tags":[{"label":"macOS","permalink":"/tags/mac-os"},{"label":"tools","permalink":"/tags/tools"}],"readingTime":0.12666666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Brew Cask\u65e5\u5e38\u4f7f\u7528","date":"2021-10-19T01:57:40.000Z","description":"\u8bb0\u5f55brew cask\u4f7f\u7528\u5c0f\u6280\u5de7","tags":["macOS","tools"]},"prevItem":{"title":"Drone\u914d\u7f6e\u7ba1\u7406\u5458\u8d26\u53f7","permalink":"/posts/drone-config-admin"},"nextItem":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b\u4e4bnerdctl","permalink":"/posts/containerd-nerdctl"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u8bb0\u5f55\u4e00\u4e0b, \u5982\u4f55\u5347\u7ea7brew cask\u5b89\u88c5\u7684\u8f6f\u4ef6\u3002\\n\\n## \u5b89\u88c5cu\\n\\n```bash\\nbrew tap buo/cask-upgrade\\n```\\n\\n## \u81ea\u52a8\u5347\u7ea7\\n\\n\\n```bash\\nbrew update\\nbrew cu -a\\n```"},{"id":"/posts/containerd-nerdctl","metadata":{"permalink":"/posts/containerd-nerdctl","source":"@site/blog/posts/containerd-nerdctl.md","title":"Containerd \u4f7f\u7528\u6559\u7a0b\u4e4bnerdctl","description":"\u672c\u6587\u4e3b\u8981\u63cf\u8ff0Containerd Cli\u7684\u5b89\u88c5\u53ca\u4f7f\u7528\u59ff\u52bf\u3002","date":"2021-10-07T09:16:45.000Z","formattedDate":"2021\u5e7410\u67087\u65e5","tags":[{"label":"containerd","permalink":"/tags/containerd"},{"label":"nerdctl","permalink":"/tags/nerdctl"}],"readingTime":0.6433333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b\u4e4bnerdctl","date":"2021-10-07T09:16:45.000Z","description":"\u672c\u6587\u4e3b\u8981\u63cf\u8ff0Containerd Cli\u7684\u5b89\u88c5\u53ca\u4f7f\u7528\u59ff\u52bf\u3002","tags":["containerd","nerdctl"]},"prevItem":{"title":"Brew Cask\u65e5\u5e38\u4f7f\u7528","permalink":"/posts/brew-cask-usage"},"nextItem":{"title":"Openkruise\u5feb\u901f\u5b89\u88c5","permalink":"/posts/openkruise-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u9ed8\u8ba4\u672c\u6587\u6f14\u793a\u73af\u5883\u4e3a`Debian GNU/Linux 11 (bullseye)`\\n\\n## \u5b89\u88c5\\n\\nnerdctl\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e24\u4e2a\u538b\u7f29\u5305\\n\\n- `nerdctl-0.12.1-linux-amd64.tar.gz`, \u4ec5\u5305\u542bnerdctl\\n- `nerdctl-full-0.12.1-linux-amd64.tar.gz`, \u5305\u542b\u4e86runc\u548c\u4f5c\u4e3ak8s\u5bb9\u5668\u8fd0\u884c\u65f6\u6240\u9700\u7684cni\u6587\u4ef6\\n\\n\u9ed8\u8ba4\u6211\u4eec\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u538b\u7f29\u5305`nerdctl-full-0.12.1-linux-amd64.tar.gz`,\u9664\u975e\u672c\u5730\u5df2\u5b89\u88c5\u4f7f\u7528containerd\\n\\n```bash\\n# \u4ecegithub\u4e0b\u8f7d\\nwget https://github.techoc.workers.dev/https://github.com/containerd/nerdctl/releases/download/v0.12.1/nerdctl-full-0.12.1-linux-amd64.tar.gz\\n# \u89e3\u538b\\ntar Cxzvvf /usr/local nerdctl-full-0.12.1-linux-amd64.tar.gz\\n# \u5f00\u542f\u542f\u52a8\\nsystemctl enable containerd.service --now\\n```\\n\\n## \u914d\u7f6e\\n\\nContainerd \u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a `/etc/containerd/config.toml`, \u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u751f\u6210\u9ed8\u8ba4\u914d\u7f6e\\n\\n```bash\\ncontainerd config default > /etc/containerd/config.toml\\n```\\n\\n#### \u751f\u6210docker\u6267\u884c\u6587\u4ef6\\n\\n```\\ncat > /usr/local/bin/docker <<EOF\\n#!/bin/bash\\n/usr/local/bin/nerdctl $@\\nEOF\\nchmod +x /usr/local/bin/docker\\n```\\n\\n#### \u5b89\u88c5docker\u5e38\u7528\u6269\u5c55\u63d2\u4ef6\\n\\n```docker\\ndocker run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools tar zxf /pkg.tgz -C /sysdir\\n```\\n\\n#### \u5176\u4ed6\\n\\n\u5feb\u901f\u5b89\u88c5containerd\u811a\u672c [containerd-install](https://sh.ysicing.me/k8s/cri/containerd-install)"},{"id":"/posts/openkruise-install","metadata":{"permalink":"/posts/openkruise-install","source":"@site/blog/posts/openkruise-install.md","title":"Openkruise\u5feb\u901f\u5b89\u88c5","description":"\u672c\u6587\u4ecb\u7ecdOpenkruise\u5b89\u88c5\u90e8\u7f72","date":"2021-10-06T03:01:17.000Z","formattedDate":"2021\u5e7410\u67086\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"openkruise","permalink":"/tags/openkruise"}],"readingTime":0.39666666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Openkruise\u5feb\u901f\u5b89\u88c5","date":"2021-10-06T03:01:17.000Z","description":"\u672c\u6587\u4ecb\u7ecdOpenkruise\u5b89\u88c5\u90e8\u7f72","tags":["kubernetes","openkruise"]},"prevItem":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b\u4e4bnerdctl","permalink":"/posts/containerd-nerdctl"},"nextItem":{"title":"Tailscale\u5185\u7f51\u7a7f\u900f\u65b0\u59ff\u52bf","permalink":"/posts/tailscale-k8s-mesh-network"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u7b80\u4ecb\\n\\n> OpenKruise \u662f\u4e00\u4e2a\u57fa\u4e8e Kubernetes \u7684\u6269\u5c55\u5957\u4ef6\uff0c\u4e3b\u8981\u805a\u7126\u4e8e\u4e91\u539f\u751f\u5e94\u7528\u7684\u81ea\u52a8\u5316\uff0c\u6bd4\u5982\u90e8\u7f72\u3001\u53d1\u5e03\u3001\u8fd0\u7ef4\u4ee5\u53ca\u53ef\u7528\u6027\u9632\u62a4\u3002\\n\\n### \u6838\u5fc3\u529f\u80fd\\n\\n- \u589e\u5f3a\u7248\u672c\u7684 Workloads, \u5982\u539f\u5730\u5347\u7ea7\u7b49\\n\\n## helm\u5b89\u88c5\\n\\n### \u65b0\u589e\u5f00\u542f\u7279\u6027\\n\\n- PreDownloadImageForInPlaceUpdate \u539f\u5730\u5347\u7ea7\u955c\u50cf\u9884\u70ed\\n- ResourcesDeletionProtection \u8d44\u6e90\u5220\u9664\u4fdd\u62a4\\n- PodUnavailableBudgetUpdateGate pod\u539f\u5730\u5347\u7ea7\\n- WorkloadSpread WorkloadSpread \u7ba1\u7406\u5e94\u7528\u591a\u5206\u533a\u5f39\u6027\u4e0e\u62d3\u6251\u90e8\u7f72\\n\\n```bash\\nhelm upgrade -i kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz  --set featureGates=\\"ResourcesDeletionProtection=true\\\\,PreDownloadImageForInPlaceUpdate=true\\\\,PodUnavailableBudgetUpdateGate=true\\\\,WorkloadSpread=true\\"\\n```"},{"id":"/posts/tailscale-k8s-mesh-network","metadata":{"permalink":"/posts/tailscale-k8s-mesh-network","source":"@site/blog/posts/tailscale-k8s-mesh-network.md","title":"Tailscale\u5185\u7f51\u7a7f\u900f\u65b0\u59ff\u52bf","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0tailscale\u5982\u4f55\u6253\u901apodip,svcip","date":"2021-10-02T02:39:15.000Z","formattedDate":"2021\u5e7410\u67082\u65e5","tags":[{"label":"wireguard","permalink":"/tags/wireguard"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.2966666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Tailscale\u5185\u7f51\u7a7f\u900f\u65b0\u59ff\u52bf","date":"2021-10-02T02:39:15.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0tailscale\u5982\u4f55\u6253\u901apodip,svcip","tags":["wireguard","tailscale","kubernetes"]},"prevItem":{"title":"Openkruise\u5feb\u901f\u5b89\u88c5","permalink":"/posts/openkruise-install"},"nextItem":{"title":"\u7fa4\u6656\u65b0\u5957\u4ef6\uff1aTailscale\u6781\u901f\u7ec4\u7f51","permalink":"/posts/tailscale-working-nas-dsm7"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u5f88\u4e45\u5c31\u7528\u4e0a\u4e86,\u7528\u4e8e\u66ff\u4ee3\u4e4b\u524d\u81ea\u884c\u90e8\u7f72\u7684`wireguard mesh`\u7ec4\u7f51\\n\\n## Token\u7533\u8bf7\\n\\n\u7533\u8bf7\u4e24\u4e2atoken, \u4e00\u4e2a\u7528\u4e8epod,\u4e00\u4e2a\u7528\u4e8esvc\\n\\n![](/images/other/tailscale-token.jpg)\\n\\n## helm \u5b89\u88c5\\n\\n```bash\\nhelm repo add mvisonneau https://charts.visonneau.fr\\nhelm repo update\\n\\nhelm upgrade -i  \\\\\\n  tailscale-relay-svc \\\\\\n  mvisonneau/tailscale-relay \\\\\\n  --set config.authKey=<your_auth_key>\\n  -n kube-system\\n\\nkubectl get cm/tailscale-relay-svc-config  -n kube-system -o yaml \\n\\napiVersion: v1\\ndata:\\n  TAILSCALE_ADVERTISE_ROUTES: 10.42.0.0/16\\nkind: ConfigMap\\n```\\n\\n## \u914d\u7f6eroute\\n\\n![](/images/other/tailscale-route.jpg)"},{"id":"/posts/tailscale-working-nas-dsm7","metadata":{"permalink":"/posts/tailscale-working-nas-dsm7","source":"@site/blog/posts/tailscale-working-nas-dsm7.md","title":"\u7fa4\u6656\u65b0\u5957\u4ef6\uff1aTailscale\u6781\u901f\u7ec4\u7f51","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u7fa4\u6656\u5b89\u88c5Tailscale","date":"2021-10-02T02:36:07.000Z","formattedDate":"2021\u5e7410\u67082\u65e5","tags":[{"label":"wireguard","permalink":"/tags/wireguard"},{"label":"tailscale","permalink":"/tags/tailscale"}],"readingTime":0.8433333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u7fa4\u6656\u65b0\u5957\u4ef6\uff1aTailscale\u6781\u901f\u7ec4\u7f51","date":"2021-10-02T02:36:07.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u7fa4\u6656\u5b89\u88c5Tailscale","tags":["wireguard","tailscale"]},"prevItem":{"title":"Tailscale\u5185\u7f51\u7a7f\u900f\u65b0\u59ff\u52bf","permalink":"/posts/tailscale-k8s-mesh-network"},"nextItem":{"title":"k3s\u4f7f\u7528Cilium\u66ff\u6362\u9ed8\u8ba4Flannel","permalink":"/posts/how-to-use-cilium-to-replace-k3s-flannel"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u6700\u8fd1\u7fa4\u6656\u5347\u7ea7\u5230DSM7\u4e86,\u51b3\u5b9a\u4f7f\u7528`Tailscale`\u66ff\u4ee3\u4e4b\u524d\u81ea\u884c\u90e8\u7f72\u7684`wireguard mesh`\u7ec4\u7f51\\n\\n## \u7b80\u4ecb\\n\\nTailscale\u5c5e\u4e8e\u4e00\u79cd\u865a\u62df\u7ec4\u7f51\u5de5\u5177\uff0c\u57fa\u4e8eWireGuard, \u57fa\u672c\u96f6\u914d\u7f6e\uff0c\u79d2\u63a5\u5165, \u964d\u4f4e\u5b66\u4e60\u6210\u672c\uff0c\u8d85\u7ea7\u7b80\u5355\uff0c\u8bbf\u95ee\u901f\u5ea6\u4e5f\u5f88\u4e0d\u9519\uff0c\u800c\u4e14\u652f\u6301\u5168\u5e73\u53f0\u3002\\n\\n## \u6ce8\u610f\u4e8b\u9879\\n\\n- \u5343\u4e07\u4e0d\u8981\u4f7f\u7528gmail\u9a8c\u8bc1/Google\u767b\u5f55\uff0c\u5426\u5219\u79fb\u52a8\u7aef\u9a8c\u8bc1\u5f88\u86cb\u75bc\u7684\u3002\\n\\n## \u5b89\u88c5\\n\\n\u9ed8\u8ba4\u5b89\u88c5\u53c2\u8003 [tailscale](https://tailscale.com/download), \u4e2d\u56fd\u5927\u9646\u8bbf\u95ee\u5883\u5916\u955c\u50cf\u7ad9\u53ef\u80fd\u6bd4\u8f83\u6162\uff0c\u8fd9\u91cc\u6211\u63d0\u4f9bdebian\u7cfb\u7edf\u4e0b\u7684\u5b89\u88c5\u5305\u3002\\n\\n```bash\\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/debcache\\ndocker run -it --rm -v /root:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/debcache cp $(docker run --rm registry.cn-beijing.aliyuncs.com/k7scn/debcache ls -l | grep deb | awk \'{print $NF}\') /sysdir/\\n\\n# \u5df2\u7ecf\u5b89\u88c5ysicing/tools\u7684\u53ef\u4ee5\u4f7f\u7528\\nergoget tailscaleget\\n```\\n\\n### \u7fa4\u6656\u5ba2\u6237\u7aef\u5b89\u88c5\\n\\n\u6211\u7684\u7fa4\u6656\u662fDS218+,\u67b6\u6784\u662f`apollolake/amd64`, \u5982\u679c\u4f60\u4e0d\u6e05\u695a\u4f60\u7684\u67b6\u6784\uff0c\u53ef\u4ee5\u53c2\u8003 [\u7fa4\u6656\u7b49\u67b6\u6784\u4fe1\u606f](https://github.com/tailscale/tailscale-synology/blob/main/docs/platforms.md)\\n\\n\u4e0b\u8f7d [tailscale-x86_64-1.14.6-2010-dsm7.spk](https://github.com/tailscale/tailscale-synology/releases/download/v1.14.6/tailscale-x86_64-1.14.6-2010-dsm7.spk),\u4e0d\u8981\u4ece\u5b98\u65b9\u4e0b\u8f7d\u7248\u672c\u6bd4\u8f83\u8001\u3002\\n\\n\u624b\u52a8\u5b89\u88c5\\n\\n![](/images/nas/nas-202110021101.jpg)\\n\\n![](/images/nas/nas-1633147949452.jpg)\\n\\n\u767b\u5f55\u67e5\u770b\u72b6\u6001\\n\\n![](/images/nas/nas-conn.jpg)"},{"id":"/posts/how-to-use-cilium-to-replace-k3s-flannel","metadata":{"permalink":"/posts/how-to-use-cilium-to-replace-k3s-flannel","source":"@site/blog/posts/how-to-use-cilium-to-replace-k3s-flannel.md","title":"k3s\u4f7f\u7528Cilium\u66ff\u6362\u9ed8\u8ba4Flannel","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0k3s\u4f7f\u7528cilium\u7f51\u7edc","date":"2021-09-24T10:35:25.000Z","formattedDate":"2021\u5e749\u670824\u65e5","tags":[{"label":"k3s","permalink":"/tags/k-3-s"},{"label":"cilium","permalink":"/tags/cilium"}],"readingTime":1.3033333333333332,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k3s\u4f7f\u7528Cilium\u66ff\u6362\u9ed8\u8ba4Flannel","date":"2021-09-24T10:35:25.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0k3s\u4f7f\u7528cilium\u7f51\u7edc","tags":["k3s","cilium"]},"prevItem":{"title":"\u7fa4\u6656\u65b0\u5957\u4ef6\uff1aTailscale\u6781\u901f\u7ec4\u7f51","permalink":"/posts/tailscale-working-nas-dsm7"},"nextItem":{"title":"\u90e8\u7f72\u4e00\u7ad9\u5f0f\u8f7b\u76d1\u63a7\u8f7b\u8fd0\u7ef4\u7cfb\u7edf\u54ea\u5412\u76d1\u63a7\u9b54\u6539\u7248\u91d1\u5412\u76d1\u63a7","permalink":"/posts/nezha-ops-monitor"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u7cfb\u7edf\u8981\u6c42\\n\\n- k3s >= 1.16,(\u9ed8\u8ba4v1.21.5+k3s1)\\n- Debian 11\uff0c(\u9ed8\u8ba45.10)\\n\\n## \u4fee\u6539k3s\u914d\u7f6e\\n\\n```bash\\ncat /etc/systemd/system/k3s.service\\n\\n    --flannel-backend none \\\\\\n```\\n\\n\u5c06\u7f51\u7edc\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a`none`\\n\\n## \u79fb\u9664\u7f51\u7edc\u76f8\u5173\u8bbe\u7f6e\\n\\n```bash\\n# \u79fb\u9664cni\u547d\u540d\u7a7a\u95f4\\nip netns show 2>/dev/null | grep cni- | xargs -r -t -n 1 ip netns delete\\n# \u79fb\u9664cnio\u7f51\u5361\\nip link show 2>/dev/null | grep \'master cni0\' | while read ignore iface ignore; do\\n    iface=${iface%%@*}\\n    [ -z \\"$iface\\" ] || ip link delete $iface\\ndone\\nip link delete cni0\\nip link delete flannel.1\\nrm -rf /var/lib/cni/\\n# \u6e05\u7406iptables\\niptables-save | grep -v KUBE- | grep -v CNI- | iptables-restore\\n```\\n\\n## \u5b89\u88c5cilium\\n\\n### helm\u5b89\u88c5\\n\\n```helm\\nhelm repo add cilium https://helm.cilium.io/\\nhelm install cilium cilium/cilium --version 1.10.4 \\\\\\n   --namespace kube-system\\\\\\n   --set hubble.relay.enabled=true \\\\\\n   --set hubble.ui.enabled=true\\n```\\n\\n### cilium\u5b89\u88c5\\n\\n> \u9ed8\u8ba4 [ysicig/tools](https://github.com/ysicing/tools)\u5df2\u5185\u7f6e\\n\\n```bash\\n# \u6307\u5b9apod ip\u6bb5\\ncilium install --config cluster-pool-ipv4-cidr=\\"10.42.0.0/16\\"\\n# \u5b89\u88c5hubble\u7f51\u7edc\u62d3\u6251\\ncilium hubble enable --ui\\n```\\n\\n### \u9a8c\u8bc1cilium\\n\\n```\\nroot@k3s:~# cilium status\\n    /\xaf\xaf\\\\\\n /\xaf\xaf\\\\__/\xaf\xaf\\\\    Cilium:         OK\\n \\\\__/\xaf\xaf\\\\__/    Operator:       OK\\n /\xaf\xaf\\\\__/\xaf\xaf\\\\    Hubble:         OK\\n \\\\__/\xaf\xaf\\\\__/    ClusterMesh:    OK\\n    \\\\__/\\n\\nDeployment        hubble-ui                Desired: 1, Ready: 1/1, Available: 1/1\\nDeployment        clustermesh-apiserver    Desired: 1, Ready: 1/1, Available: 1/1\\nDaemonSet         cilium                   Desired: 2, Ready: 2/2, Available: 2/2\\nDeployment        cilium-operator          Desired: 1, Ready: 1/1, Available: 1/1\\nDeployment        hubble-relay             Desired: 1, Ready: 1/1, Available: 1/1\\nContainers:       cilium                   Running: 2\\n                  cilium-operator          Running: 1\\n                  hubble-relay             Running: 1\\n                  hubble-ui                Running: 1\\n                  clustermesh-apiserver    Running: 1\\nCluster Pods:     12/17 managed by Cilium\\nImage versions    cilium                   quay.io/cilium/cilium:v1.10.4: 2\\n                  cilium-operator          quay.io/cilium/operator-generic:v1.10.4: 1\\n                  hubble-relay             quay.io/cilium/hubble-relay:v1.10.4: 1\\n                  hubble-ui                quay.io/cilium/hubble-ui:v0.7.9@sha256:e0e461c680ccd083ac24fe4f9e19e675422485f04d8720635ec41f2ba9e5562c: 1\\n                  hubble-ui                quay.io/cilium/hubble-ui-backend:v0.7.9@sha256:632c938ef6ff30e3a080c59b734afb1fb7493689275443faa1435f7141aabe76: 1\\n                  hubble-ui                docker.io/envoyproxy/envoy:v1.18.2@sha256:e8b37c1d75787dd1e712ff389b0d37337dc8a174a63bed9c34ba73359dc67da7: 1\\n                  clustermesh-apiserver    quay.io/coreos/etcd:v3.4.13: 1\\n                  clustermesh-apiserver    quay.io/cilium/clustermesh-apiserver:v1.10.4: 1\\n```\\n\\n### \u8bbf\u95eeHubble\u67e5\u770b\u7f51\u7edc\u8fde\u63a5\\n\\n![](/images/k8s/hubble-ui.png)\\n\\n#### \u7ed1\u5b9aingress\\n\\n```yaml\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    k8s.ysicing.me: hubble-ui\\n  labels:\\n    k8s-app: hubble-ui\\n  name: hubble-ui\\n  namespace: kube-system\\nspec:\\n  rules:\\n  - host: hubble-ui.internal.ysicing.net\\n    http:\\n      paths:\\n      - backend:\\n          service:\\n            name: hubble-ui\\n            port:\\n              number: 80\\n        path: /\\n        pathType: ImplementationSpecific\\n  tls:\\n  - hosts:\\n    - hubble-ui.internal.ysicing.net\\n    secretName: tls-ysicing.net\\n```\\n\\n\u6d4f\u89c8\u5668\u8bbf\u95ee `https://hubble-ui.internal.ysicing.net`\\n\\n#### port-forward\u8f6c\u53d1\\n\\n```bash\\nkubectl port-forward --namespace kube-system  service/hubble-ui 38888:80\\n```\\n\\n\u6d4f\u89c8\u5668\u8bbf\u95ee `http://127.0.0.1:38888`"},{"id":"/posts/nezha-ops-monitor","metadata":{"permalink":"/posts/nezha-ops-monitor","source":"@site/blog/posts/nezha-ops-monitor.md","title":"\u90e8\u7f72\u4e00\u7ad9\u5f0f\u8f7b\u76d1\u63a7\u8f7b\u8fd0\u7ef4\u7cfb\u7edf\u54ea\u5412\u76d1\u63a7\u9b54\u6539\u7248\u91d1\u5412\u76d1\u63a7","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u90e8\u7f72\u91d1\u5412\u76d1\u63a7","date":"2021-09-22T05:09:03.000Z","formattedDate":"2021\u5e749\u670822\u65e5","tags":[{"label":"tools","permalink":"/tags/tools"}],"readingTime":0.8066666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u90e8\u7f72\u4e00\u7ad9\u5f0f\u8f7b\u76d1\u63a7\u8f7b\u8fd0\u7ef4\u7cfb\u7edf\u54ea\u5412\u76d1\u63a7\u9b54\u6539\u7248\u91d1\u5412\u76d1\u63a7","date":"2021-09-22T05:09:03.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u90e8\u7f72\u91d1\u5412\u76d1\u63a7","tags":["tools"]},"prevItem":{"title":"k3s\u4f7f\u7528Cilium\u66ff\u6362\u9ed8\u8ba4Flannel","permalink":"/posts/how-to-use-cilium-to-replace-k3s-flannel"},"nextItem":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b","permalink":"/posts/getting-started-with-containerd"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5e8f\\n\\n\u9b54\u6539\u7248\u672c, \u4ec5\u652f\u6301\u8d44\u6e90\u5c55\u793a\u3002\u5982\u679c\u9700\u8981\u5b9a\u65f6\u4efb\u52a1\u6216\u8005\u76d1\u63a7\u62a5\u8b66\uff0c\u8bf7\u4f7f\u7528 [\u54ea\u5412\u76d1\u63a7](https://github.com/naiba/nezha)\\n\\n> \u672c\u9b54\u6539\u76ee\u524d\u4ec5\u4f53\u73b0\u8d44\u6e90\u76f8\u5173\u4fe1\u606f\\n\\n### \u9b54\u6539\u529f\u80fd\\n\\n- \u652f\u6301\u88ab\u52a8\u6ce8\u518c\u548c\u4e3b\u52a8\u6ce8\u518c\\n- \u63a8\u8350\u4f7f\u7528\u5bb9\u5668\u5316\u90e8\u7f72\\n\\n## \u670d\u52a1\u7aef\\n\\n### \u914d\u7f6e\u8bf4\u660e\\n\\n```yaml\\ndebug: true\\nhttpport: 80\\ngrpcport: 5555\\nadmin: # \u672c\u5730\u7ba1\u7406\u5458\u8d26\u53f7\\n  user: ysicing\\n  pass: 12345678\\noauth2:\\n  type: \\"github\\" #gitee/github\\n  admin: \\"ysicing\\" #\u7ba1\u7406\u5458\u5217\u8868\uff0c\u534a\u89d2\u9017\u53f7\u9694\u5f00\\n  clientid: \\"\\" # \u5728 https://github.com/settings/developers \u521b\u5efa\uff0c\u65e0\u9700\u5ba1\u6838 Callback \u586b http(s)://\u57df\u540d\u6216IP/oauth2/callback\\n  clientsecret: \\"\\"\\nsite:\\n  brand: \\"\u91d1\u5412\u76d1\u63a7\\"\\n  cookiename: \\"nezha-dashboard\\" #\u6d4f\u89c8\u5668 Cookie \u5b57\u6bb5\u540d\uff0c\u53ef\u4e0d\u6539\\n  theme: \\"default\\"\\ndb:\\n  type: sqlite\\n  dsn: \\"nezha.sqlite\\"\\n#  type: mysql\\n#  dsn: root:rootpass@tcp(db.k8s.ysicing.local:3306)/bjdb?charset=utf8mb4&parseTime=True&loc=Local\\n  debug: true\\n  metrics:\\n    name: nezha-api\\n    enable: true\\n```\\n\\n```bash\\nkubectl apply -f https://sh.ysicing.me/k8s/nezha/dash.yml\\n```\\n\\n\\n## \u5ba2\u6237\u7aef\\n\\n\u4e3b\u52a8\u6ce8\u518c\u9700\u8981\u6301\u4e45\u5316`/var/lib/nezha` \\n\\n```yaml\\nversion: \'2\'\\nservices:\\n  nezha-agent:\\n    image: ghcr.io/ysicing/nezha-agent:edge\\n    container_name: nezha-agent\\n    network_mode: \\"host\\"\\n    pid: \\"host\\"\\n    privileged: true\\n    volumes:\\n      - ./agentdata:/var/lib/nezha\\n    # command:\\n    # - \\"--p=cdxxxxxxx\\" # \u88ab\u52a8\u6ce8\u518c\\n```\\n\\n\\n## \u6f14\u793a\\n\\n[\u91d1\u5412\u76d1\u63a7](https://nezha.external.ysicing.net/)\\n\\n## \u81f4\u8c22\\n\\n[naiba/nezha](https://github.com/naiba/nezha)"},{"id":"/posts/getting-started-with-containerd","metadata":{"permalink":"/posts/getting-started-with-containerd","source":"@site/blog/posts/getting-started-with-containerd.md","title":"Containerd \u4f7f\u7528\u6559\u7a0b","description":"\u672c\u6587\u4e3b\u8981\u63cf\u8ff0Containerd\u7684\u5b89\u88c5\u53ca\u4f7f\u7528\u59ff\u52bf\u3002","date":"2021-09-13T09:16:45.000Z","formattedDate":"2021\u5e749\u670813\u65e5","tags":[{"label":"containerd","permalink":"/tags/containerd"},{"label":"cri","permalink":"/tags/cri"}],"readingTime":1.3566666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b","date":"2021-09-13T09:16:45.000Z","description":"\u672c\u6587\u4e3b\u8981\u63cf\u8ff0Containerd\u7684\u5b89\u88c5\u53ca\u4f7f\u7528\u59ff\u52bf\u3002","tags":["containerd","cri"]},"prevItem":{"title":"\u90e8\u7f72\u4e00\u7ad9\u5f0f\u8f7b\u76d1\u63a7\u8f7b\u8fd0\u7ef4\u7cfb\u7edf\u54ea\u5412\u76d1\u63a7\u9b54\u6539\u7248\u91d1\u5412\u76d1\u63a7","permalink":"/posts/nezha-ops-monitor"},"nextItem":{"title":"\u90e8\u7f72Kubernetes Dashboard","permalink":"/posts/k8s-kubernetes-dashboard-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u9ed8\u8ba4\u672c\u6587\u6f14\u793a\u73af\u5883\u4e3a`Debian GNU/Linux 11 (bullseye)`\\n\\n## \u5b89\u88c5\\n\\ncontainerd\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e24\u4e2a\u538b\u7f29\u5305\\n\\n- `containerd-1.5.5-linux-amd64.tar.gz`\\n- `cri-containerd-cni-1.5.5-linux-amd64.tar.gz`, \u5305\u542b\u4e86runc\u548c\u4f5c\u4e3ak8s\u5bb9\u5668\u8fd0\u884c\u65f6\u6240\u9700\u7684cni\u6587\u4ef6\\n\\n\u9ed8\u8ba4\u6211\u4eec\u4f7f\u7528\u7b2c\u4e8c\u4e2a\u538b\u7f29\u5305`cri-containerd-cni-1.5.5-linux-amd64.tar.gz`,\u9664\u975e\u672c\u5730\u6d4b\u8bd5\u4f7f\u7528\u7b2c\u4e00\u4e2a\\n\\n```bash\\n# \u4ecegithub\u4e0b\u8f7d\\nwget https://github.com/containerd/containerd/releases/download/v1.5.5/cri-containerd-cni-1.5.5-linux-amd64.tar.gz\\n# \u89e3\u538b\\ntar -C / -xzf cri-containerd-cni-1.5.5-linux-amd64.tar.gz\\n# \u5f00\u542f\u542f\u52a8\\nsystemctl enable containerd.service\\n# \u542f\u52a8\\nsystemctl start containerd\\n```\\n\\n\u67e5\u770b\u7248\u672c\u4fe1\u606f\\n\\n```bash\\nctr version\\nClient:\\n  Version:  v1.5.5\\n  Revision: 72cec4be58a9eb6b2910f5d10f1c01ca47d231c0\\n  Go version: go1.16.6\\n\\nServer:\\n  Version:  v1.5.5\\n  Revision: 72cec4be58a9eb6b2910f5d10f1c01ca47d231c0\\n  UUID: 6a851001-a5f3-4722-94c4-38e2916eb44c\\n```\\n\\n## \u914d\u7f6e\u6587\u4ef6\\n\\nContainerd \u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a `/etc/containerd/config.toml`, \u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u751f\u6210\u9ed8\u8ba4\u914d\u7f6e\\n\\n```bash\\ncontainerd config default > /etc/containerd/config.toml\\n```\\n\\n### \u9ad8\u7ea7\u914d\u7f6e\\n\\n> \u5229\u7528containerd\u63d2\u4ef6\u673a\u5236\\n\\n\u67e5\u770b\u76ee\u524d\u652f\u6301\u7684\u63d2\u4ef6 `ctr plugins ls`\\n\\n```bash\\nctr plugins ls\\nTYPE                            ID                       PLATFORMS      STATUS\\nio.containerd.content.v1        content                  -              ok\\nio.containerd.snapshotter.v1    aufs                     linux/amd64    skip\\nio.containerd.snapshotter.v1    btrfs                    linux/amd64    skip\\nio.containerd.snapshotter.v1    devmapper                linux/amd64    error\\nio.containerd.snapshotter.v1    native                   linux/amd64    ok\\nio.containerd.snapshotter.v1    overlayfs                linux/amd64    ok\\nio.containerd.snapshotter.v1    zfs                      linux/amd64    skip\\nio.containerd.metadata.v1       bolt                     -              ok\\nio.containerd.differ.v1         walking                  linux/amd64    ok\\nio.containerd.gc.v1             scheduler                -              ok\\nio.containerd.service.v1        introspection-service    -              ok\\nio.containerd.service.v1        containers-service       -              ok\\nio.containerd.service.v1        content-service          -              ok\\nio.containerd.service.v1        diff-service             -              ok\\nio.containerd.service.v1        images-service           -              ok\\nio.containerd.service.v1        leases-service           -              ok\\nio.containerd.service.v1        namespaces-service       -              ok\\nio.containerd.service.v1        snapshots-service        -              ok\\nio.containerd.runtime.v1        linux                    linux/amd64    ok\\nio.containerd.runtime.v2        task                     linux/amd64    ok\\nio.containerd.monitor.v1        cgroups                  linux/amd64    ok\\nio.containerd.service.v1        tasks-service            -              ok\\nio.containerd.internal.v1       restart                  -              ok\\nio.containerd.grpc.v1           containers               -              ok\\nio.containerd.grpc.v1           content                  -              ok\\nio.containerd.grpc.v1           diff                     -              ok\\nio.containerd.grpc.v1           events                   -              ok\\nio.containerd.grpc.v1           healthcheck              -              ok\\nio.containerd.grpc.v1           images                   -              ok\\nio.containerd.grpc.v1           leases                   -              ok\\nio.containerd.grpc.v1           namespaces               -              ok\\nio.containerd.internal.v1       opt                      -              ok\\nio.containerd.grpc.v1           snapshots                -              ok\\nio.containerd.grpc.v1           tasks                    -              ok\\nio.containerd.grpc.v1           version                  -              ok\\nio.containerd.grpc.v1           cri                      linux/amd64    ok\\n```\\n\\n#### \u955c\u50cf\u52a0\u901f\\n\\n```toml\\n# \u53c2\u8003\u6587\u6863 https://github.com/containerd/containerd/blob/main/docs/cri/registry.md\\n[plugins.\\"io.containerd.grpc.v1.cri\\".registry]\\n  [plugins.\\"io.containerd.grpc.v1.cri\\".registry.mirrors]\\n    [plugins.\\"io.containerd.grpc.v1.cri\\".registry.mirrors.\\"docker.io\\"]\\n      endpoint = [\\"https://registry-1.docker.io\\"]\\n    [plugins.\\"io.containerd.grpc.v1.cri\\".registry.mirrors.\\"test.https-registry.io\\"]\\n      endpoint = [\\"https://HostIP1:Port1\\"]\\n    [plugins.\\"io.containerd.grpc.v1.cri\\".registry.mirrors.\\"test.http-registry.io\\"]\\n      endpoint = [\\"http://HostIP2:Port2\\"]\\n    # wildcard matching is supported but not required.\\n    [plugins.\\"io.containerd.grpc.v1.cri\\".registry.mirrors.\\"*\\"]\\n      endpoint = [\\"https://HostIP3:Port3\\"]\\n  [plugins.\\"io.containerd.grpc.v1.cri\\".registry.configs]\\n    [plugins.\\"io.containerd.grpc.v1.cri\\".registry.configs.\\"gcr.io\\".auth]\\n      username = \\"_json_key\\"\\n      password = \'paste output from jq\'\\n```\\n\\n#### \u5176\u4ed6\\n\\n\u793a\u4f8bcontainerd\u914d\u7f6e\u6587\u4ef6 [config.toml](https://sh.ysicing.me/k8s/cri/containerd.config.toml)"},{"id":"/posts/k8s-kubernetes-dashboard-install","metadata":{"permalink":"/posts/k8s-kubernetes-dashboard-install","source":"@site/blog/posts/k8s-kubernetes-dashboard-install.md","title":"\u90e8\u7f72Kubernetes Dashboard","description":"\u5b89\u88c5\u90e8\u7f72k8s Dashboard","date":"2021-09-08T04:59:51.000Z","formattedDate":"2021\u5e749\u67088\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.4266666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u90e8\u7f72Kubernetes Dashboard","date":"2021-09-08T04:59:51.000Z","description":"\u5b89\u88c5\u90e8\u7f72k8s Dashboard","tags":["kubernetes"]},"prevItem":{"title":"Containerd \u4f7f\u7528\u6559\u7a0b","permalink":"/posts/getting-started-with-containerd"},"nextItem":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e8c","permalink":"/posts/lima-vm-on-macOS-M1"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u7b80\u5355\u8bb0\u5f55\u4e00\u4e0b\u5feb\u901f\u5b89\u88c5dashboard\\n\\n### \u5b89\u88c5\\n\\n```bash\\nkubectl apply -f https://sh.ysicing.me/k8s/dashboard/recommended.yaml\\n```\\n\\n### \u6388\u6743\\n\\n\u6388\u6743\u96c6\u7fa4\u7ba1\u7406\u5458\u6743\u9650, \u9ed8\u8ba4\u7528\u6237\u4e3a`super-kd-user`\\n\\n```bash\\nkubectl apply -f https://sh.ysicing.me/k8s/dashboard/admin.yaml\\n```\\n\\n### \u83b7\u53d6token\\n\\n\u83b7\u53d6\u6388\u6743\u7528\u6237`super-kd-user`token\\n\\n```\\nkdtoken # \u53ef\u4ee5\u4eceysicing/tools\u5904\u83b7\u53d6\\n```\\n\\n\u6216\u8005\\n\\n```\\n# \u6cd5\u4e00\\nkubectl get secret -n kubernetes-dashboard $(kubectl get secret -n kubernetes-dashboard|grep super-kd-user |awk \'{print $1}\') -o jsonpath=\'{.data.token}\'  | base64 --decode\\n\\n# \u6cd5\u4e8c\\nkubectl -n kubernetes-dashboard describe secret super-kd-user-token | grep \'^token\'\\n```\\n\\n### \u8bbf\u95ee\\n\\n```\\nkubectl proxy\\n```\\n\\n\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee`http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/`\\n\u767b\u5f55\u4f7f\u7528`super-kd-user`Bearer Token\\n\\n### \u9644\u5f55\\n\\n[ysicing/toos](https://github.com/ysicing/tools)"},{"id":"/posts/lima-vm-on-macOS-M1","metadata":{"permalink":"/posts/lima-vm-on-macOS-M1","source":"@site/blog/posts/lima-vm-on-macOS-M1.md","title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e8c","description":"M1 Mac\u4e0a\u4f7f\u7528Lima\u8fd0\u884cDebian\u865a\u62df\u673a","date":"2021-09-05T12:16:57.000Z","formattedDate":"2021\u5e749\u67085\u65e5","tags":[{"label":"vm","permalink":"/tags/vm"},{"label":"debian","permalink":"/tags/debian"},{"label":"macOS","permalink":"/tags/mac-os"}],"readingTime":0.9733333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e8c","date":"2021-09-05T12:16:57.000Z","description":"M1 Mac\u4e0a\u4f7f\u7528Lima\u8fd0\u884cDebian\u865a\u62df\u673a","tags":["vm","debian","macOS"]},"prevItem":{"title":"\u90e8\u7f72Kubernetes Dashboard","permalink":"/posts/k8s-kubernetes-dashboard-install"},"nextItem":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e00","permalink":"/posts/lima-vm-on-macOS"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u63a5\u4e0a\u6587[Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e00](/posts/lima-vm-on-macos/)\u5728M1\u4e0a\u73a9\u8f6cLima\\n\\n## \u5feb\u901f\u5f00\u59cb\\n\\n### M1\u7cfb\u7edf\u4fe1\u606f\\n\\n```macOS M1\\n# brew install m-cli\\n\u279c  ~ m info\\nProductName:\\tmacOS\\nProductVersion:\\t11.5.2\\nBuildVersion:\\t20G95\\n```\\n\\n### m1 patch \\n\\n```\\n# \u5b89\u88c5\u6784\u5efa\u4f9d\u8d56\\nbrew update\\nbrew install libffi gettext glib pkg-config autoconf automake pixman ninja\\n# \u4e0b\u8f7d\u6e90\u7801\\ngit clone https://github.com/qemu/qemu\\ncd qemu\\ngit checkout 3c93dfa42c394fdd55684f2fbf24cf2f39b97d47\\ncurl https://patchwork.kernel.org/series/485309/mbox/ | git am\\n# build\\nmkdir build && cd build\\n../configure --target-list=aarch64-softmmu --enable-hvf --disable-gnutls\\nmake -j8 \\n# \u5b89\u88c5\\nsudo make install\\n```\\n\\n\u6ce8\u610f\u4e00\u70b9:\\n\\n> \u53ef\u80fd\u901a\u8fc7brew\u5b89\u88c5\u7684qemu\uff0c\u4f1a\u8bc6\u522b\u9ed8\u8ba4\u8be5\u8def\u5f84\u4e0b\u7684`/opt/homebrew/bin/qemu-system-aarch64`, \u800cpatch\u751f\u6210\u7684\u5219\u5728`/usr/local/bin/qemu-system-aarch64`\u3002\\n\\n```\\nrm /opt/homebrew/bin/qemu-system-aarch64\\n```\\n\\n### \u6d4b\u8bd5patch\\n\\n```bash\\nwget https://mirrors.tuna.tsinghua.edu.cn/debian-cd/current/arm64/iso-cd/debian-11.0.0-arm64-netinst.iso\\n\\nqemu-img create -f qcow2 virtual-disk.qcow2 8G\\n\\ncp $(dirname $(which qemu-img))/../share/qemu/edk2-aarch64-code.fd .\\n\\ndd if=/dev/zero conv=sync bs=1m count=64 of=ovmf_vars.fd\\n\\n/usr/local/bin/qemu-system-aarch64 \\\\\\n  -machine virt,accel=hvf,highmem=off \\\\\\n  -cpu cortex-a72 -smp 4 -m 4G \\\\\\n  -device virtio-gpu-pci \\\\\\n  -device virtio-keyboard-pci \\\\\\n  -drive \\"format=raw,file=edk2-aarch64-code.fd,if=pflash,readonly=on\\" \\\\\\n  -drive \\"format=raw,file=ovmf_vars.fd,if=pflash\\" \\\\\\n  -drive \\"format=qcow2,file=virtual-disk.qcow2\\" \\\\\\n  -cdrom debian-11.0.0-arm64-netinst.iso\\n```\\n\\n\u6210\u529f\u542f\u52a8\u865a\u62df\u673a\u8868\u793apatch\u6210\u529f\u4e86\uff0c\u53ef\u4ee5\u901a\u8fc7lima\u542f\u52a8\u7ba1\u7406\u865a\u62df\u673a\u4e86\\n\\n### \u5b89\u88c5Lima\u5e76\u542f\u52a8\\n\\n\u5b89\u88c5lima\\n\\n```bash\\nbrew install lima\\n```\\n\\n\u542f\u52a8lima\\n\\n```bash\\n# \u4e0b\u8f7d\u4e13\u7528debian\u914d\u7f6e\\nwget https://sh.ysicing.me/lima/debian.yml\\n# \u542f\u52a8debian\u865a\u62df\u673a\\nlimactl start ./debian.yml\\n```\\n\\n## \u9644\u5f55\u9605\u8bfb\\n\\n- [Github - Create Virtual Machines using QEMU on Silicon based Apple Macs](https://gist.github.com/nrjdalal/e70249bb5d2e9d844cc203fd11f74c55)\\n- [Github - Running Linux and Windows on M1 with QEMU](https://gist.github.com/citruz/9896cd6fb63288ac95f81716756cb9aa#gistcomment-3629192)"},{"id":"/posts/lima-vm-on-macOS","metadata":{"permalink":"/posts/lima-vm-on-macOS","source":"@site/blog/posts/lima-vm-on-macOS.md","title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e00","description":"Intel Mac\u4e0a\u4f7f\u7528Lima\u8fd0\u884cDebian\u865a\u62df\u673a","date":"2021-09-05T02:16:57.000Z","formattedDate":"2021\u5e749\u67085\u65e5","tags":[{"label":"vm","permalink":"/tags/vm"},{"label":"debian","permalink":"/tags/debian"},{"label":"macOS","permalink":"/tags/mac-os"}],"readingTime":5.39,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e00","date":"2021-09-05T02:16:57.000Z","description":"Intel Mac\u4e0a\u4f7f\u7528Lima\u8fd0\u884cDebian\u865a\u62df\u673a","tags":["vm","debian","macOS"]},"prevItem":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e8c","permalink":"/posts/lima-vm-on-macOS-M1"},"nextItem":{"title":"Debian11\u914d\u7f6eLocales","permalink":"/posts/debian11-locales"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u4ec0\u4e48\u662fLima\\n\\n> Linux virtual machines on macOS\\n\\n\u5373\u4e13\u6ce8\u4e8e\u5728macOS\u4e0a\u652f\u6301\u6587\u4ef6\u5171\u4eab\u3001\u7aef\u53e3\u8f6c\u53d1\u548c\u4f7f\u7528 containerd \u7684 Linux \u865a\u62df\u673a, \u5176\u8bde\u751f\u7684\u521d\u8877\u662f\u63a8\u5e7f\u5728macOS\u4e0a\u4f7f\u7528`containerd`\u548c`nerdctl`\\n\\n#### \u529f\u80fd\\n\\n- \u652f\u6301\u81ea\u52a8\u6587\u4ef6\u5171\u4eab\\n- \u652f\u6301\u7aef\u53e3\u8f6c\u53d1\\n- \u5185\u7f6e\u652f\u6301`containerd`\\n- \u57fa\u4e8eQEMU\u652f\u6301 `Intel on Intel`, `ARM on Intel`, `ARM on ARM`, `Intel on ARM`\\n- \u652f\u6301Linux\u53d1\u884c\u7248\u5e38\u89c1\u90fd\u53ef\u4ee5,\u5982`Debian`\\n\\n## \u5feb\u901f\u5f00\u59cb\\n\\n#### \u5b89\u88c5\\n\\n```bash\\n# Intel Mac\\nbrew install lima\\n```\\n\\n#### Debian\u81ea\u5b9a\u4e49\u914d\u7f6e\\n\\n\u751f\u6210debian\u914d\u7f6e\\n\\n```yaml\\ncat > ./debian.yml<<EOF\\narch: \\"default\\"\\nimages:\\n  - location: \\"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2\\"\\n    arch: \\"x86_64\\"\\n  - location: \\"https://cloud.debian.org/images/cloud/bullseye/20210814-734/debian-11-generic-amd64-20210814-734.qcow2\\"\\n    arch: \\"x86_64\\"\\ncpus: 2\\nmemory: \\"4GiB\\"\\ndisk: \\"100GiB\\"\\nmounts:\\n  - location: \\"~\\"\\n    writable: false\\n  - location: \\"/tmp/lima\\"\\n    writable: true\\nssh:\\n  localPort: 60024\\nprovision:\\n  - mode: system\\n    script: |\\n      #!/bin/bash\\n      echo \\"/usr/local/bin/nerdctl \\\\$@\\" > /usr/local/bin/docker\\n      chmod +x /usr/local/bin/docker\\n  - mode: system\\n    script: |\\n      #!/bin/bash\\n      nerdctl run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools tar zxf /pkg.tgz -C /sysdir\\nprobes:\\n- script: |\\n    #!/bin/bash\\n    set -eux -o pipefail\\n    if ! timeout 120s bash -c \\"until test -f /usr/local/bin/dps; do sleep 3; done\\"; then\\n            echo >&2 \\"tools is not installed yet\\"\\n            exit 0\\n    fi\\nEOF\\n```\\n\\n\u6216\u8005\\n\\n```bash\\nwget https://sh.ysicing.me/lima/debian.yml\\n```\\n\\n#### \u542f\u52a8lima\u865a\u62df\u673a\\n\\n```bash\\nlimactl start ./debian.yml\\n\\n? Creating an instance \\"debian\\"  [Use arrows to move, type to filter]\\n> Proceed with the default configuration\\n  Open an editor to override the configuration\\n  Exit\\n\\n? Creating an instance \\"debian\\" Proceed with the default configuration\\nINFO[0000] Downloading \\"https://github.com/containerd/nerdctl/releases/download/v0.11.1/nerdctl-full-0.11.1-linux-amd64.tar.gz\\" (sha256:ce7a6e119b03c3fb8ded3d46d929962fd17417bea1d5bbc07e0fce49494d8a09)\\nINFO[0000] Using cache \\"/Users/ysicing/Library/Caches/lima/download/by-url-sha256/3304d173f1e1824e5be6cf84bf2f78825cf0db416c4c975dbb2458776942629e/data\\"\\nINFO[0001] Attempting to download the image from \\"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2\\"\\nINFO[0002] Downloaded image from \\"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2\\"\\nINFO[0002] [hostagent] Starting QEMU (hint: to watch the boot progress, see \\"/Users/ysicing/.lima/debian/serial.log\\")\\nINFO[0002] SSH Local Port: 60024\\nINFO[0002] [hostagent] Waiting for the essential requirement 1 of 4: \\"ssh\\"\\nINFO[0020] [hostagent] The essential requirement 1 of 4 is satisfied\\nINFO[0020] [hostagent] Waiting for the essential requirement 2 of 4: \\"sshfs binary to be installed\\"\\nINFO[0029] [hostagent] The essential requirement 2 of 4 is satisfied\\nINFO[0029] [hostagent] Waiting for the essential requirement 3 of 4: \\"/etc/fuse.conf to contain \\\\\\"user_allow_other\\\\\\"\\"\\nINFO[0044] [hostagent] The essential requirement 3 of 4 is satisfied\\nINFO[0044] [hostagent] Waiting for the essential requirement 4 of 4: \\"the guest agent to be running\\"\\nINFO[0044] [hostagent] The essential requirement 4 of 4 is satisfied\\nINFO[0044] [hostagent] Mounting \\"/Users/ysicing\\"\\nINFO[0044] [hostagent] Mounting \\"/tmp/lima\\"\\nINFO[0045] [hostagent] Waiting for the optional requirement 1 of 2: \\"systemd must be available\\"\\nINFO[0045] [hostagent] Forwarding \\"/run/user/501/lima-guestagent.sock\\" (guest) to \\"/Users/ysicing/.lima/debian/ga.sock\\" (host)\\nINFO[0045] [hostagent] The optional requirement 1 of 2 is satisfied\\nINFO[0045] [hostagent] Waiting for the optional requirement 2 of 2: \\"containerd binaries to be installed\\"\\nINFO[0045] [hostagent] Not forwarding TCP [::]:22\\nINFO[0045] [hostagent] Not forwarding TCP 0.0.0.0:22\\nINFO[0045] [hostagent] The optional requirement 2 of 2 is satisfied\\nINFO[0045] READY. Run `limactl shell debian` to open the shell.\\n```\\n\\n\u5982\u679c\u8fc7\u7a0b\u5931\u8d25\u4e86, \u8bf7\u68c0\u67e5yaml\u4e2d\u7684\u7aef\u53e3\u914d\u7f6e `ssh.localPort`, \u8f83\u5927\u6982\u7387\u662f\u7aef\u53e3\u51b2\u7a81\u4e86\\n\u5982\u679c\u63d0\u793a`READY`, \u5219\u8868\u793a\u865a\u62df\u673a\u5df2\u7ecfok\\n\\n```bash\\n08:08 \u279c  hack limactl shell debian\\ndebian\\nysicing@lima-debian:/Users/ysicing/hack$\\n```\\n\\n```bash\\nlimactl shell debian uname -a\\nLinux lima-debian 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-08-03) x86_64 GNU/Linux\\n```\\n\\n## \u5bb9\u5668\u4f7f\u7528\\n\\n> \u5b9a\u5236\u540e\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u65e0\u7f1d\u4f7f\u7528docker\u547d\u4ee4\\n\\n#### \u8fd0\u884c\u5bb9\u5668\\n\\n```bash\\n# \u7c7b\u4f3cdocker run\\nlimactl shell debian nerdctl run -d --name nginx -p 127.0.0.1:8080:80 nginx:alpine\\n# \u7c7b\u578bdocker ps\\nlimactl shell debian nerdctl ps                                                    \\nCONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES\\n8b877fa8e942    docker.io/library/nginx:alpine    \\"/docker-entrypoint.\u2026\\"    10 seconds ago    Up        127.0.0.1:8080->80/tcp    nginx\\n```\\n\\n\u6216\u8005\\n\\n```\\nlimactl shell debian docker run -d --name nginx -p 127.0.0.1:8080:80 nginx:alpine\\nlimactl shell debian docker ps                                                    \\nCONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES\\n8b877fa8e942    docker.io/library/nginx:alpine    \\"/docker-entrypoint.\u2026\\"    10 seconds ago    Up        127.0.0.1:8080->80/tcp    nginx\\nlimactl shell debian dps                                                \\nCONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES\\n8b877fa8e942    docker.io/library/nginx:alpine    \\"/docker-entrypoint.\u2026\\"    10 seconds ago    Up        127.0.0.1:8080->80/tcp    nginx\\n```\\n\\n\u6d4f\u89c8\u5668\u8bbf\u95eehttp://127.0.0.1:8080\u663e\u793anginx\u9ed8\u8ba4\u9759\u6001\u9875\\n\\n## \u5176\u4ed6\\n\\n1. \u4f7f\u7528root\u7528\u6237\\n\\n```\\nsudo password root\\nsu root\\n```\\n\\n## \u9644\u5f55\\n\\n#### \u914d\u7f6e\u8bf4\u660e\\n\\nlima\u9ed8\u8ba4\u914d\u7f6e, \u9ed8\u8ba4\u5728\u5f53\u524d\u7528\u6237`~/.lima/default/lima.yaml`\\n\\n```yaml\\n# /Users/ysicing/.lima/default/lima.yaml\\n# ===================================================================== #\\n# BASIC CONFIGURATION\\n# ===================================================================== #\\n\\n# Arch: \\"default\\", \\"x86_64\\", \\"aarch64\\".\\n# \\"default\\" corresponds to the host architecture.\\narch: \\"default\\"\\n\\n# An image must support systemd and cloud-init.\\n# Ubuntu and Fedora are known to work.\\n# Default: none (must be specified)\\nimages:\\n  # Try to use a local image first.\\n  - location: \\"~/Downloads/hirsute-server-cloudimg-amd64.img\\"\\n    arch: \\"x86_64\\"\\n  - location: \\"~/Downloads/hirsute-server-cloudimg-arm64.img\\"\\n    arch: \\"aarch64\\"\\n\\n  # Download the file from the internet when the local file is missing.\\n  # Hint: run `limactl prune` to invalidate the \\"current\\" cache\\n  - location: \\"https://cloud-images.ubuntu.com/hirsute/current/hirsute-server-cloudimg-amd64.img\\"\\n    arch: \\"x86_64\\"\\n  - location: \\"https://cloud-images.ubuntu.com/hirsute/current/hirsute-server-cloudimg-arm64.img\\"\\n    arch: \\"aarch64\\"\\n\\n# CPUs: if you see performance issues, try limiting cpus to 1.\\n# Default: 4\\ncpus: 2\\n\\n# Memory size\\n# Default: \\"4GiB\\"\\nmemory: \\"4GiB\\"\\n\\n# Disk size\\n# Default: \\"100GiB\\"\\ndisk: \\"100GiB\\"\\n\\n# Expose host directories to the guest\\n# Default: none\\nmounts:\\n  - location: \\"~\\"\\n    # CAUTION: `writable` SHOULD be false for the home directory.\\n    # Setting `writable` to true is possible, but untested and dangerous.\\n    writable: false\\n  - location: \\"/tmp/lima\\"\\n    writable: true\\n\\nssh:\\n  # A localhost port of the host. Forwarded to port 22 of the guest.\\n  # Currently, this port number has to be specified manually.\\n  # Default: none\\n  localPort: 60022\\n  # Load ~/.ssh/*.pub in addition to $LIMA_HOME/_config/user.pub .\\n  # This option is useful when you want to use other SSH-based\\n  # applications such as rsync with the Lima instance.\\n  # If you have an insecure key under ~/.ssh, do not use this option.\\n  # Default: true\\n  loadDotSSHPubKeys: true\\n\\n# ===================================================================== #\\n# ADVANCED CONFIGURATION\\n# ===================================================================== #\\n\\ncontainerd:\\n  # Enable system-wide (aka rootful)  containerd and its dependencies (BuildKit, Stargz Snapshotter)\\n  # Default: false\\n  system: false\\n  # Enable user-scoped (aka rootless) containerd and its dependencies\\n  # Default: true\\n  user: true\\n\\n# Provisioning scripts need to be idempotent because they might be called\\n# multiple times, e.g. when the host VM is being restarted.\\n# provision:\\n#   # `system` is executed with the root privilege\\n#   - mode: system\\n#     script: |\\n#       #!/bin/bash\\n#       set -eux -o pipefail\\n#       export DEBIAN_FRONTEND=noninteractive\\n#       apt-get install -y vim\\n#   # `user` is executed without the root privilege\\n#   - mode: user\\n#     script: |\\n#       #!/bin/bash\\n#       set -eux -o pipefail\\n#       cat <<EOF > ~/.vimrc\\n#       set number\\n#       EOF\\n\\n# probes:\\n#  # Only `readiness` probes are supported right now.\\n#  - mode: readiness\\n#    description: vim to be installed\\n#    script: |\\n#       #!/bin/bash\\n#       set -eux -o pipefail\\n#       if ! timeout 30s bash -c \\"until command -v vim; do sleep 3; done\\"; then\\n#         echo >&2 \\"vim is not installed yet\\"\\n#         exit 1\\n#       fi\\n#    hint: |\\n#      vim was not installed in the guest. Make sure the package system is working correctly.\\n#      Also see \\"/var/log/cloud-init-output.log\\" in the guest.\\n\\n# ===================================================================== #\\n# FURTHER ADVANCED CONFIGURATION\\n# ===================================================================== #\\n\\nfirmware:\\n  # Use legacy BIOS instead of UEFI.\\n  # Default: false\\n  legacyBIOS: false\\n\\nvideo:\\n  # QEMU display, e.g., \\"none\\", \\"cocoa\\", \\"sdl\\".\\n  # As of QEMU v5.2, enabling this is known to have negative impact\\n  # on performance on macOS hosts: https://gitlab.com/qemu-project/qemu/-/issues/334\\n  # Default: \\"none\\"\\n  display: \\"none\\"\\n\\nnetwork:\\n  # The instance can get routable IP addresses from the vmnet framework using\\n  # https://github.com/lima-vm/vde_vmnet. Both vde_switch and vde_vmnet\\n  # daemons must be running before the instance is started. The interface type\\n  # (host, shared, or bridged) is configured in vde_vmnet and not lima.\\n  vde:\\n    # vnl (virtual network locator) points to the vde_switch socket directory,\\n    # optionally with vde:// prefix\\n    # - vnl: \\"vde:///var/run/vde.ctl\\"\\n    #   # VDE Switch port number (not TCP/UDP port number). Set to 65535 for PTP mode.\\n    #   # Default: 0\\n    #   switchPort: 0\\n    #   # MAC address of the instance; lima will pick one based on the instance name,\\n    #   # so DHCP assigned ip addresses should remain constant over instance restarts.\\n    #   macAddress: \\"\\"\\n    #   # Interface name, defaults to \\"vde0\\", \\"vde1\\", etc.\\n    #   name: \\"\\"\\n\\n# Port forwarding rules. Forwarding between ports 22 and ssh.localPort cannot be overridden.\\n# Rules are checked sequentially until the first one matches.\\n# portForwards:\\n#   - guestPort: 443\\n#     hostIP: \\"0.0.0.0\\" # overrides the default value \\"127.0.0.1\\"; allows privileged port forwarding\\n#   # default: hostPort: 443 (same as guestPort)\\n#   # default: guestIP: \\"127.0.0.1\\" (also matches bind addresses \\"0.0.0.0\\", \\"::\\", and \\"::1\\")\\n#   # default: proto: \\"tcp\\" (only valid value right now)\\n#   - guestPortRange: [4000, 4999]\\n#     hostIP:  \\"0.0.0.0\\" # overrides the default value \\"127.0.0.1\\"\\n#   # default: hostPortRange: [4000, 4999] (must specify same number of ports as guestPortRange)\\n#   - guestPort: 80\\n#     hostPort: 8080 # overrides the default value 80\\n#   - guestIP: \\"127.0.0.2\\" # overrides the default value \\"127.0.0.1\\"\\n#     hostIP: \\"127.0.0.2\\" # overrides the default value \\"127.0.0.1\\"\\n#   # default: guestPortRange: [1024, 65535]\\n#   # default: hostPortRange: [1024, 65535]\\n#   - guestPort: 8888\\n#     ignore: true (don\'t forward this port)\\n#   # Lima internally appends this fallback rule at the end:\\n#   - guestIP: \\"127.0.0.1\\"\\n#     guestPortRange: [1024, 65535]\\n#     hostIP: \\"127.0.0.1\\"\\n#     hostPortRange: [1024, 65535]\\n#   # Any port still not matched by a rule will not be forwarded (ignored)\\n```"},{"id":"/posts/debian11-locales","metadata":{"permalink":"/posts/debian11-locales","source":"@site/blog/posts/debian11-locales.md","title":"Debian11\u914d\u7f6eLocales","description":"\u5347\u7ea7Debian11\u540e\u53c8\u9047\u5230locales\u62a5\u9519","date":"2021-09-01T02:24:49.000Z","formattedDate":"2021\u5e749\u67081\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":0.6266666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Debian11\u914d\u7f6eLocales","date":"2021-09-01T02:24:49.000Z","description":"\u5347\u7ea7Debian11\u540e\u53c8\u9047\u5230locales\u62a5\u9519","tags":["debian"]},"prevItem":{"title":"Lima\u865a\u62df\u673a\u521d\u4f53\u9a8c\u4e00","permalink":"/posts/lima-vm-on-macOS"},"nextItem":{"title":"Caddy2\u63d2\u4ef6Geocn","permalink":"/posts/caddy2-plugin-geocn"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u524d\u51e0\u5929\u5347\u7ea7Debian11\u540e, \u4f7f\u7528iTerm\u767b\u5f55\u673a\u5668\u63d0\u793a:\\n\\n```\\nperl: warning: Setting locale failed.\\nperl: warning: Please check that your locale settings:\\n\\tLANGUAGE = \\"en_US.utf8\\",\\n\\tLC_ALL = \\"en_US.UTF-8\\",\\n\\tLC_TERMINAL = \\"iTerm2\\",\\n\\tLANG = \\"en_US.utf8\\"\\n    are supported and installed on your system.\\nperl: warning: Falling back to the standard locale (\\"C\\").\\nlocale: Cannot set LC_CTYPE to default locale: No such file or directory\\nlocale: Cannot set LC_MESSAGES to default locale: No such file or directory\\nlocale: Cannot set LC_ALL to default locale: No such file or directory\\n/usr/bin/locale: Cannot set LC_CTYPE to default locale: No such file or directory\\n/usr/bin/locale: Cannot set LC_MESSAGES to default locale: No such file or directory\\n/usr/bin/locale: Cannot set LC_ALL to default locale: No such file or directory\\n```\\n\\n\u8fd9\u4e0d\u80fd\u5fcd\uff0c\u4e00\u68ad\u5b50`dpkg-reconfigure`\u89e3\u51b3\\n\\n```\\ndpkg-reconfigure locales\\n# \u52fe\u9009\u4e0a\\nen_US.UTF-8\\nzh_CN.UTF-8\\n# ok, \u9009\u62e9\u9ed8\u8ba4\\nen_US.UTF-8\\n# \u6700\u7ec8\u7ed3\u679c\\nGenerating locales (this might take a while)...\\n  en_HK.UTF-8... done\\n  en_US.UTF-8... done\\n  zh_CN.UTF-8... done\\nGeneration complete.\\n```\\n\\n\u6ce8\u610f:\\n- \u9700\u8981\u4f7f\u7528root\u7528\u6237"},{"id":"/posts/caddy2-plugin-geocn","metadata":{"permalink":"/posts/caddy2-plugin-geocn","source":"@site/blog/posts/caddy2-plugin-geocn.md","title":"Caddy2\u63d2\u4ef6Geocn","description":"Caddy2\u63d2\u4ef6Geocn\u76f8\u5173\u4fe1\u606f","date":"2021-08-31T08:00:25.000Z","formattedDate":"2021\u5e748\u670831\u65e5","tags":[{"label":"caddy","permalink":"/tags/caddy"},{"label":"caddy-plugin","permalink":"/tags/caddy-plugin"}],"readingTime":2.35,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Caddy2\u63d2\u4ef6Geocn","date":"2021-08-31T08:00:25.000Z","description":"Caddy2\u63d2\u4ef6Geocn\u76f8\u5173\u4fe1\u606f","tags":["caddy","caddy-plugin"]},"prevItem":{"title":"Debian11\u914d\u7f6eLocales","permalink":"/posts/debian11-locales"},"nextItem":{"title":"Debian 11\u5b89\u88c5k3s","permalink":"/posts/k3s-install-bullseye"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u4e3a\u4ec0\u4e48\u8981Geocn\\n\\n\u5927\u90e8\u5206\u573a\u666f\u4e0b,\u6211\u4eec\u7f51\u7ad9\u5141\u8bb8\u4efb\u4f55\u4eba\u8bbf\u95ee, \u67d0\u4e9b\u7279\u6b8a\u573a\u666f\u4e0b\u6211\u4eec\u9700\u8981\u9650\u5236\u5927\u9646ip\u8bbf\u95ee\u3002\\n\u4f46\u662f\u5df2\u6709\u63d2\u4ef6`caddy-maxmind-geolocation`\u4e3a\u5565\u4e0d\u7528\u3002\\n\\n\u9ed8\u8ba4\u4f7f\u7528\u7684 GeoIP2 \u6570\u636e\u5e93\u662f\u6765\u81ea\u4e8e MaxMind \u7684 GeoLite2 \u514d\u8d39\u6570\u636e\u5e93\u3002\u8fd9\u4e2a\u6570\u636e\u5e93\u76ee\u524d\u5b58\u5728\u4e00\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a\\n\\n- \u83b7\u53d6\u4e0d\u4fbf\uff1a\u4ece 2019 \u5e74 12 \u6708 30 \u65e5\u8d77\uff0c\u5fc5\u987b\u6ce8\u518c\u540e\u624d\u80fd\u4e0b\u8f7d\\n- \u6570\u636e\u91cf\u5927\uff1a\u6570\u636e\u5e93\u5e9e\u5927\uff0c\u5305\u542b\u5168\u7403\u7684 IP \u5730\u5740\u6bb5\uff0c\u7ea6 4 MB\\n- \u51c6\u786e\u5ea6\u4f4e\uff1a\u5bf9\u4e2d\u56fd\u5927\u9646\u7684 IP \u5730\u5740\u5224\u5b9a\u4e0d\u51c6\uff0c\u5982\uff1a\u9999\u6e2f\u963f\u91cc\u4e91\u7684 IP \u88ab\u5224\u5b9a\u4e3a\u65b0\u52a0\u5761\u3001\u4e2d\u56fd\u5927\u9646\u7b49\\n\\n\u65b0\u7684\u653f\u7b56\u8981\u6c42\u6ce8\u518c\u624d\u80fd\u4e0b\u8f7d\u4f1a\u589e\u52a0\u65f6\u95f4\u6210\u672c\uff0c\u800c\u4e14\u4f1a\u8ba9\u81ea\u52a8\u5316\u4e0b\u8f7d\u7684\u96be\u5ea6\u5927\u5927\u589e\u52a0\u3002\u5e9e\u5927\u7684\u6570\u636e\u91cf\u65e0\u53ef\u539a\u975e\uff0c\u4f46\u662f\u5bf9\u4e8e\u5927\u591a\u6570\u4e2d\u56fd\u5927\u9646\u7684\u7528\u6237\u6765\u8bf4\uff0c\u4ec5\u9700\u8981\u53bb\u5224\u65ad IP \u7684\u5730\u7406\u4f4d\u7f6e\u662f\u5426\u5c5e\u4e8e\u4e2d\u56fd\u5927\u9646\u5883\u5185\uff0c\u5176\u4ed6\u56fd\u5bb6\u7684 IP \u4e00\u5f8b\u4ee3\u7406\u3002\u8fc7\u591a\u7684\u6570\u636e\u91cf\u4f1a\u589e\u52a0\u8f7d\u5165\u65f6\u95f4\uff0c\u964d\u4f4e\u67e5\u8be2\u6548\u7387\u3002\\n\\n\u57fa\u4e8e\u4e0a\u8ff0\u8003\u8651, \u7ed3\u5408`caddy-maxmind-geolocation`\u548c`Hackl0us/GeoIP2-CN`\u4e24\u8005, \u53ea\u6709\u5224\u65adip\u662f\u5426\u662f\u4e2d\u56fd\u5927\u9646ip\u5373\u53ef\u3002\\n\\n## \u6838\u5fc3\u8bbe\u8ba1\\n\\n- \u4f7f\u7528`Hackl0us/GeoIP2-CN`\u63d0\u4f9b\u7684\u51c6\u786e\u5ea6\u9ad8\u3001\u7528\u6237\u4f7f\u7528\u4f53\u9a8c\u597d\u7684\u4ec5\u542b\u6709\u4e2d\u56fd\u5927\u9646 IP \u4fe1\u606f\u7684 GeoIP2 \u6570\u636e\u5e93\\n- \u4f7f\u7528`caddyhttp.RequestMatcher`, \u4e0d\u5f97\u4e0d\u8bf4 `Request Matchers`\\n    - \u83b7\u53d6`request.RemoteAddr`\u5730\u5740, \u4f18\u5148\u7ea7\u6700\u9ad8\\n    - \u4ece`request.Header`\u83b7\u53d6`X-Forwarded-For`\u5730\u5740, \u5982\u679cRemoteAddr\u4e3a\u5185\u7f51\u5730\u5740,\u624d\u8003\u8651\\n\\n## \u4f7f\u7528caddy\\n\\n### \u7f16\u8bd1caddy2\\n\\n\u53ef\u4ee5\u53c2\u8003 [ysicing/caddy2](https://github.com/ysicing/dockerfiles/blob/master/caddy2/Dockerfile)\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u76f4\u63a5\u4f7f\u7528\u63d0\u4f9b\u7684\u4e8c\u8fdb\u5236\u5373\u53ef\u3002\u4e0d\u8fc7\u6211\u4eec\u9700\u8981\u96c6\u6210\u7b2c\u4e09\u65b9\u63d2\u4ef6\uff0c\u9700\u8981\u4f7f\u7528`xcaddy`\u81ea\u884c\u7f16\u8bd1\\n\\n```bash\\n# \u672c\u5730\u5b89\u88c5xcaddy\\ngo install github.com/caddyserver/xcaddy/cmd/xcaddy@latest\\n# github action\u5b89\u88c5\\n    - name: Install Go\\n      uses: actions/setup-go@v1\\n      with:\\n        go-version: 1.17.x\\n    - name: install xcaddy\\n      run: |\\n          echo \\"install xcaddy\\"\\n          go get -u github.com/caddyserver/xcaddy/cmd/xcaddy@latest\\n    - name: build bin\\n      run: |\\n        export TZ=\'Asia/Shanghai\'\\n        export PATH=$PATH:$(go env GOPATH)/bin\\n        xcaddy build --with github.com/ysicing/caddy2-geocn\\n```\\n\\n\u6784\u5efacaddy\u4e8c\u8fdb\u5236\\n\\n```bash\\n# \u4f7f\u7528remote code\\nxcaddy build --with github.com/ysicing/caddy2-geocn\\n# \u4f7f\u7528local code\\nxcaddy build --with github.com/ysicing/caddy2-geocn=../caddy2-geocn\\n```\\n\\n### \u63d2\u4ef6\u672c\u5730\u5316\u6d4b\u8bd5\\n\\n```\\ncd go/src/github.com/ysicing/\\ngit clone https://github.com/ysicing/caddy2-geocn.git\\ncd caddy2-geocn\\n# \u4e8c\u8fdb\u5236\\nmake build\\nmake run\\n# docker\\nGOOS=linux xcaddy build --with github.com/ysicing/caddy2-geocn=../caddy2-geocn\\nrm -rf Country.mmdb\\nwget https://github.com/Hackl0us/GeoIP2-CN/raw/release/Country.mmdb\\ndocker build -t ghcr.io/ysicing/caddy2-geocn -f example/Dockerfile .\\n```\\n\\ndocker-compose.yaml\u793a\u4f8b\u5982\u4e0b:\\n\\n```yaml\\nversion: \'2\'\\nservices:\\n  caddy2-geocn:\\n    image: ghcr-proxy.hk1.godu.dev/ysicing/caddy2-geocn\\n    container_name: caddy2-geocn\\n    ports:\\n      - \'80:80\'\\n    volumes:\\n      - \'./Caddyfile:/etc/caddy/Caddyfile\'\\n```\\n\\nCaddyfile\u793a\u4f8b\u5982\u4e0b:\\n\\n```Caddyfile\\n(LOG) {\\n    log {\\n        output file /var/log/caddy.log {\\n            roll_size 1mb\\n\\t\\t    roll_keep 5\\n\\t\\t    roll_keep_for 1h\\n        }\\n        format console {\\n            time_format \\"iso8601\\"\\n        }\\n    }\\n}\\n\\n(COMCFG) {\\n    encode zstd gzip\\n}\\n\\n{\\n    debug\\n}\\n\\n:80 {\\n    import COMCFG\\n    import LOG\\n    metrics /metrics\\n    @geofilter {\\n        not geocn {\\n            db_file \\"/etc/caddy/Country.mmdb\\"\\n        }\\n    }\\n    # file_server @geofilter {\\n    #    root /etc/caddy/example/deny\\n    #}\\n    redir @geofilter  https://www.baidu.com{uri} permanent\\n    file_server {\\n        root /etc/caddy/example/allow\\n    }\\n}\\nEOF \\ndocker-compose up -d\\n```\\n\\n### \u4e91\u73af\u5883\\n\\n```docker\\ndocker run -itd 80:80 ghcr.io/ysicing/caddy2-geocn:latest\\n```\\n\\n### \u5e94\u7528\u573a\u666f\\n\\n[\u6211\u7684\u535a\u5ba2](https://ysicing.me) \u5c31\u662f\u5f88\u597d\u7684\u793a\u4f8b, \u5206\u522b\u4f7f\u7528\u4ee3\u7406\u548c\u975e\u4ee3\u7406\u65b9\u5f0f\u8bbf\u95ee\\n\\n## \u81f4\u8c22\\n\\n- [Hackl0us/GeoIP2-CN](https://github.com/Hackl0us/GeoIP2-CN)\\n- [Caddyserver](https://caddyserver.com/)"},{"id":"/posts/k3s-install-bullseye","metadata":{"permalink":"/posts/k3s-install-bullseye","source":"@site/blog/posts/k3s-install-bullseye.md","title":"Debian 11\u5b89\u88c5k3s","description":"Debian11 (Bullseye)\u5b89\u88c5k3s","date":"2021-08-15T14:55:18.000Z","formattedDate":"2021\u5e748\u670815\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"k3s","permalink":"/tags/k-3-s"},{"label":"debian","permalink":"/tags/debian"}],"readingTime":1.2866666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Debian 11\u5b89\u88c5k3s","date":"2021-08-15T14:55:18.000Z","description":"Debian11 (Bullseye)\u5b89\u88c5k3s","tags":["kubernetes","k3s","debian"]},"prevItem":{"title":"Caddy2\u63d2\u4ef6Geocn","permalink":"/posts/caddy2-plugin-geocn"},"nextItem":{"title":"\u57fa\u4e8eALIDNS\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","permalink":"/posts/cert-manager-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n> k3s \u662fRancher\u63a8\u51fa\u7684\u8f7b\u91cf\u7ea7 k8s.\\n\\n## \u5347\u7ea7debian10(buster)\u5185\u6838\u7248\u672c\\n\\n```bash\\nsed -i \'s/buster\\\\/updates/bullseye-security/g;s/buster/bullseye/g\' /etc/apt/sources.list\\n\\napt update\\napt dist-upgrade -y\\n# apt install -t bullseye-backports linux-image-amd64 -y\\n# update-grub\\n# reboot\\n# \u5185\u6838\\nLinux bj01 5.10.0-0.bpo.8-amd64 #1 SMP Debian 5.10.46-2~bpo10+1 (2021-07-22) x86_64 GNU/Linux\\n```\\n\\n\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 [Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357](/posts/debian-op/) \u5347\u7ea7\u5185\u6838\u90e8\u5206\u3002\\n\\n## \u5b89\u88c5 wireguard\\n\\n```bash\\n#  \u6240\u6709\u8282\u70b9\u9700\u5b89\u88c5\\napt install wireguard -y\\n```\\n\\n## \u5b89\u88c5docker\\n\\n```bash\\ncurl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -\\necho \\"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian bullseye stable\\" | tee /etc/apt/sources.list.d/docker.list\\napt update\\napt install -y docker-ce\\n# \u817e\u8baf\u4e91\u4f7f\u7528bip\u6709\u95ee\u9898 169.254.123.1/24, \u8bf7\u4f7f\u7528172.30.42.1/16\\ncat > /etc/docker/daemon.json <<EOF\\n{\\n  \\"registry-mirrors\\": [\\"https://dyucrs4l.mirror.aliyuncs.com\\"],\\n  \\"bip\\": \\"169.254.123.1/24\\",\\n  \\"max-concurrent-downloads\\": 10,\\n  \\"log-driver\\": \\"json-file\\",\\n  \\"log-level\\": \\"warn\\",\\n  \\"log-opts\\": {\\n    \\"max-size\\": \\"30m\\",\\n    \\"max-file\\": \\"3\\"\\n  },\\n  \\"storage-driver\\": \\"overlay2\\"\\n}\\nEOF\\nsystemctl enable docker\\nsystemctl daemon-reload\\nsystemctl restart docker\\ndocker info -f \\"{{json .ServerVersion }}\\"\\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/tools\\ndocker run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools tar zxf /pkg.tgz -C /sysdir\\n\\n```\\n\\n## \u90e8\u7f72\u63a7\u5236\u5e73\u9762master\u8282\u70b9\\n\\n\u4e0a\u9762\u5b89\u88c5docker/tools\u65f6, \u9ed8\u8ba4\u5185\u7f6e\u4e86k3s,\u7248\u672c`v1.18.19`, \u4e5f\u53ef\u4ee5\u81ea\u884c\u4e0b\u8f7d\u5176\u4ed6\u7248\u672c\u7684k3s\u66ff\u6362\\n\\n```\\nk3s --version\\nk3s version v1.18.19+k3s1 (a260c3c6)\\n\\n# \u6267\u884c\u5b89\u88c5, \u9ed8\u8ba4\u5f00\u673a\u542f\u52a8\\nk3s.master.install\\n```\\n\\n\u9ed8\u8ba4k3s.master.install\u914d\u7f6e\u53c2\u6570\u5982\u4e0b:\\n\\n```bash\\nExecStart=/usr/local/bin/k3s \\\\\\n    server \\\\\\n    --docker \\\\\\n    --flannel-backend wireguard \\\\\\n    --no-deploy traefik,servicelb \\\\\\n    --kube-proxy-arg \\"proxy-mode=ipvs\\" \\"masquerade-all=true\\" \\\\\\n    --kube-proxy-arg \\"metrics-bind-address=0.0.0.0\\"\\n```\\n\\n\u67e5\u770b\u7ec4\u4ef6\u72b6\u6001\\n\\n```\\nk3s kubectl get cs\\nNAME                 STATUS    MESSAGE   ERROR\\ncontroller-manager   Healthy   ok\\nscheduler            Healthy   ok\\n```\\n\\n\\n## \u90e8\u7f72\u8ba1\u7b97worker\u8282\u70b9\\n\\n\u4ecemaster\u8282\u70b9\u83b7\u53d6token\\n\\n- K3S_TOKEN : \u52a0\u5165\u96c6\u7fa4\u6240\u9700\u7684token\uff0c\u53ef\u4ee5\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u67e5\u770b`/var/lib/rancher/k3s/server/node-token` \u6587\u4ef6\\n- K3S_URL: master\u8282\u70b9\u5730\u5740\\n\\n```\\nexport K3S_URL=https://10.147.20.42:6443\\nexport K3S_TOKEN=K102f2c1f6c878f693700c24b741d309d2ff4038ade912f0a44248781c04376e878::server:bc39d44d89042011b985f267eebe2b2f\\n\\nk3s.worker.install\\n```\\n\\n## \u67e5\u770b\u8282\u70b9\u72b6\u6001\\n\\n```bash\\n~# kubectl get nodes\\nNAME    STATUS   ROLES    AGE   VERSION\\nk3s02   Ready    <none>   53m   v1.18.19+k3s1\\nk3s03   Ready    <none>   52m   v1.18.19+k3s1\\nk3s01   Ready    master   54m   v1.18.19+k3s1\\n```"},{"id":"/posts/cert-manager-install","metadata":{"permalink":"/posts/cert-manager-install","source":"@site/blog/posts/cert-manager-install.md","title":"\u57fa\u4e8eALIDNS\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","description":"k8s \u4e0a\u5229\u7528 cert-manager \u81ea\u52a8\u7b7e\u53d1 TLS \u8bc1\u4e66","date":"2020-10-26T03:02:44.000Z","formattedDate":"2020\u5e7410\u670826\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"cert-manager","permalink":"/tags/cert-manager"},{"label":"aliyun","permalink":"/tags/aliyun"}],"readingTime":3.2533333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u57fa\u4e8eALIDNS\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","date":"2020-10-26T03:02:44.000Z","description":"k8s \u4e0a\u5229\u7528 cert-manager \u81ea\u52a8\u7b7e\u53d1 TLS \u8bc1\u4e66","tags":["kubernetes","cert-manager","aliyun"]},"prevItem":{"title":"Debian 11\u5b89\u88c5k3s","permalink":"/posts/k3s-install-bullseye"},"nextItem":{"title":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","permalink":"/posts/artifactory-setup-mirrors"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u6982\u8ff0\\n\\n\u968f\u7740\u4e92\u8054\u7f51\u53d1\u5c55\uff0chttps\u8d8a\u6765\u8d8a\u666e\u53ca\uff0c\u662f\u4e2a\u7f51\u7ad9\u90fd\u8981\u4e0a\u4e2ahttps\uff0c\u5426\u5219\u5c31\u662f\u975e\u4e3b\u6d41\u54c8\u54c8\u54c8\u3002\u4e4b\u524d\u4e5f\u4ecb\u7ecd\u8fc7**caddy**\uff0c\u81ea\u52a8\u7b7e\u53d1https\u8bc1\u4e66\uff0c\u8fd9\u662f\u4e00\u4e2a\u4f20\u7edf\u7684\u65b9\u5f0f\u3002\u90a3\u4e48\u670d\u52a1\u4e0a\u5230k8s\u4e0a\uff0c\u5982\u4f55\u5b9e\u73b0\u6c38\u4e45\u514d\u8d39\u8bc1\u4e66\u4e86\u3002**cert-manager** \u662f Kubernetes \u4e0a\u6bd4\u8f83\u725b\u903c\u7684\u8bc1\u4e66\u7ba1\u7406\u5de5\u5177\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4ece\u5404\u79cd\u6765\u6e90\u9881\u53d1\u8bc1\u4e66\uff0c\u800c\u4e14\u786e\u4fdd\u8bc1\u4e66\u6709\u6548\u4e14\u6700\u65b0\uff0c\u5e76\u5c1d\u8bd5\u5728\u5230\u671f\u524d\u7684\u914d\u7f6e\u65f6\u95f4\u7eed\u8ba2\u8bc1\u4e66\u3002\\n\\n## \u5de5\u4f5c\u539f\u7406\\n\\n![005](https://gitee.com/godu/blogimage/raw/master/blog/20201026/high-level-overview.svg)\\n\\n**cert-manager**\u90e8\u7f72\u5230 Kubernetes \u96c6\u7fa4\u540e\uff0c\u6839\u636e\u5b9e\u9645\u6307\u5b9a\u7684CRD\u8d44\u6e90\u6765\u7b7e\u53d1\u8bc1\u4e66\u5e76\u81ea\u52a8\u7eed\u671f\u3002\\n\\n\u90e8\u5206\u540d\u8bcd\u89e3\u91ca\\n\\n- **Issuer**/**ClusterIssuer**: \u5b9a\u4e49\u8bc1\u4e66\u7b7e\u53d1\u7684\u59ff\u52bf\u3002\u4e24\u8005\u552f\u4e00\u533a\u522b\u5c31\u662f**Issuer**\u53ea\u80fd\u7528\u6765\u7b7e\u53d1\u5355\u4e00ns\u4e0b\u7684\u8bc1\u4e66\uff0c**ClusterIssuer**\u53ef\u4ee5\u7b7e\u53d1\u96c6\u7fa4\u7ea7\u522b\u7684\u8bc1\u4e66\u3002\\n\\n- **Certificate**: \u5177\u4f53\u7b7e\u53d1\u57df\u540d\u4ee5\u53ca\u901a\u8fc7\u54ea\u79cd\u59ff\u52bf(\u5373<b>\u6307\u5b9aIssuer/ClusterIssuer</b>)\u3002\\n\\n### \u8bc1\u4e66\u7b7e\u53d1\u539f\u7406\\n\\n\u7531\u4e8e**cert-manager**\u662f\u57fa\u4e8e**ACME**\u534f\u8bae\u4e0e**Let\'s Encrypt**\u6765\u7b7e\u53d1\u514d\u8d39\u8bc1\u4e66\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u660e\u8fd9\u4e2a\u4e86, \u5176\u4e3b\u6d41\u6821\u9a8c\u65b9\u5f0f\u662f**HTTP-01** \u548c **DNS-01**\u3002\u7531\u4e8e\u6211\u4eec\u9700\u8981\u5728\u5185\u7f51\u7b7e\u53d1\u8bc1\u4e66\uff0cHTTP-01\u6821\u9a8c\u65b9\u5f0f\u5c31\u4e0d\u592a\u9002\u7528\u4e86\u3002\\n\\n## \u64cd\u4f5c\u6b65\u9aa4\\n\\n> \u63a8\u8350\u4f7f\u7528**helmv3**\u5b89\u88c5\\n\\n### \u5b89\u88c5 cert-manager\\n\\n```\\n# \u521b\u5efa\u547d\u540d\u7a7a\u95f4\\nkubectl create namespace cert-manager\\n# \u6dfb\u52a0helm\u4ed3\u5e93\u6216\u8005\u66f4\u65b0\\nhelm repo add jetstack https://charts.jetstack.io\\nhelm repo update\\nhelminit\\n# \u4e00\u952e\u5b89\u88c5\\nhelm upgrade -i cert-manager -n cert-manager -f https://gitee.com/godu/helminit/raw/master/cert-manager.1.0.3.yaml --version v1.0.3 jetstack/cert-manager\\n# \u67e5\u770b\u5b89\u88c5\u60c5\u51b5\\nkubectl get pods -n cert-manager\\nNAME                                       READY   STATUS    RESTARTS   AGE\\ncert-manager-6564dc56bf-qgxlr              1/1     Running   0          97s\\ncert-manager-cainjector-7b98cf8646-t6cqd   1/1     Running   0          97s\\ncert-manager-webhook-5f8bb4f46c-44hzt      1/1     Running   0          97s\\n```\\n\\n### DNS-01\u6821\u9a8c\\n\\n\u56e0\u4e3adns\u6258\u7ba1\u5728\u963f\u91cc\u4e91\uff0c\u4e14cert-manager\u4e0d\u652f\u6301alidns\uff0c\u53ea\u80fd\u901a\u8fc7webhook\u65b9\u5f0f\u90e8\u7f72\uff0c\u6765\u6269\u5c55DNS\u63d0\u4f9b\u5546\u3002\\n\\n\u8fd9\u91cc\u4ee5\u963f\u91ccdns + alidns-webhook\u65b9\u5f0f\u4e3a\u4f8b\u3002\\n\\n#### \u90e8\u7f72alidns-webhook\\n\\n- \u5b89\u88c5alidns-webhook\\n\\n```bash\\n# \u9ed8\u8ba4\u955c\u50cf\u4f7f\u7528\u963f\u91cc\u4e91k7scn\\nkubectl apply -f https://gitee.com/godu/helminit/raw/master/cert-manager/alidns-cm-webhook.yaml\\n```\\n\\n- \u521b\u5efaalidns api secret\\n\\n```yaml\\napiVersion: v1\\nkind: Secret\\nmetadata:\\n  name: alidns-secret\\n  namespace: cert-manager\\ndata:\\n  access-key: YOUR_ACCESS_KEY # base64\\n  secret-key: YOUR_SECRET_KEY\\n```\\n\\n\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u4e24\u70b9\uff0c\u4e00\u4e2a\u662fSecret\u503c\u95ee\u9898\uff0c\u9700\u8981\u907f\u514d\\\\n\u6216\u8005\u7a7a\u683c\u5f71\u54cd\\n\\n\u5efa\u8bae\u8fd9\u6837 `echo -n YOUR_ACCESS_KEY | base64`\uff0c \u8fd8\u6709\u5982\u679c\u662f\u8981\u521b\u5efa ClusterIssuer\uff0cSecret \u9700\u8981\u521b\u5efa\u5728 cert-manager \u6240\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u5982\u679c\u662f Issuer\uff0c\u90a3\u5c31\u521b\u5efa\u5728 Issuer \u6240\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u3002\\n\\n\u7b2c2\u4e2a\u70b9\u5c31\u662f\u914d\u7f6ealidns\u7684RAM\uff0c\u8fd9\u91cc\u6709\u4e2aRAM\u5751\u3002\\n\\nRAM\u6743\u9650\u8bbe\u7f6e\u5982\u4e0b:\\n\\n```json\\n{\\n    \\"Version\\": \\"1\\",\\n    \\"Statement\\": [\\n        {\\n            \\"Action\\": \\"*\\",\\n            \\"Resource\\": \\"acs:alidns:*:*:domain/<\u57df\u540d>\\",\\n            \\"Effect\\": \\"Allow\\"\\n        },\\n        {\\n            \\"Action\\": [\\n                \\"alidns:DescribeSiteMonitorIspInfos\\",\\n                \\"alidns:DescribeSiteMonitorIspCityInfos\\",\\n                \\"alidns:DescribeSupportLines\\",\\n                \\"alidns:DescribeDomains\\",\\n                \\"alidns:DescribeDomainNs\\",\\n                \\"alidns:DescribeDomainGroups\\"\\n            ],\\n            \\"Resource\\": \\"acs:alidns:*:*:*\\",\\n            \\"Effect\\": \\"Allow\\"\\n        }\\n    ]\\n}\\n```\\n\\n\u6b63\u5e38\u60c5\u51b5\u4e0b\u53ea\u9700\u8981\u914d\u7f6e\u7b2c\u4e00\u6761\u89c4\u5219\u5373\u53ef\uff0c\u4f46\u662f\u7531\u4e8ealidns-webhook\u4f1a\u6821\u9a8c\u8fd9\u4e2a\u57df\u540d\u5b58\u4e0d\u5b58\u5728,\u5982\u679c\u4e0d\u914d\u7f6e\u4f1a\u62a5403\u6743\u9650\\n\\n```go\\n# https://github.com/pragkent/alidns-webhook/blob/master/alidns/client.go#L26\\nfunc (c *Client) getHostedZone(zone string) (string, error) {\\n\\trequest := alidns.CreateDescribeDomainsRequest()\\n\\trequest.KeyWord = util.UnFqdn(zone)\\n\\trequest.SearchMode = \\"EXACT\\"\\n\\n\\tresponse, err := c.dnsc.DescribeDomains(request)\\n\\tif err != nil {\\n\\t\\treturn \\"\\", err\\n\\t}\\n\\n\\tzones := response.Domains.Domain\\n\\tif len(zones) == 0 {\\n\\t\\treturn \\"\\", fmt.Errorf(\\"zone %s does not exist\\", zone)\\n\\t}\\n\\n\\treturn zones[0].DomainName, nil\\n}\\n```\\n\\n### \u521b\u5efaClusterIssuer\\n\\n```yaml\\napiVersion: cert-manager.io/v1alpha2\\nkind: ClusterIssuer\\nmetadata:\\n  name: letsencrypt-prod\\nspec:\\n  acme:\\n    # Change to your letsencrypt email\\n    email: your@domain # \u4f60\u7684\u90ae\u7bb1\\n    server: https://acme-v02.api.letsencrypt.org/directory\\n    privateKeySecretRef:\\n      name: letsencrypt-prod\\n    solvers:\\n    - dns01:\\n        webhook:\\n          groupName: acme.yourcompany.com\\n          solverName: alidns\\n          config:\\n            region: \\"\\"\\n            accessKeySecretRef:\\n              name: alidns-secret\\n              key: access-key\\n            secretKeySecretRef:\\n              name: alidns-secret\\n              key: secret-key\\n```\\n\\n### \u521b\u5efa Certificate\\n\\n```yaml\\napiVersion: cert-manager.io/v1alpha2\\nkind: Certificate\\nmetadata:\\n  name: tls-ops-domain-prod\\n  namespace: gaea-op\\nspec:\\n  secretName: tls-ops-domain-prod # \u8bc1\u4e66\u4fdd\u5b58\u7684 secret \u540d\\n  commonName: \\n  dnsNames:\\n  - \\"*.bj-internal.ops.domain\\"\\n  - \\"*.bj-external.ops.domain\\"\\n  issuerRef:\\n    name: letsencrypt-prod\\n    kind: ClusterIssuer\\n```\\n\\n\u901a\u8fc7dns\u9a8c\u8bc1\u53ef\u4ee5\u521b\u5efa\u6cdb\u57df\u540d\u8bc1\u4e66\u3002\\n\\n### \u83b7\u53d6\u548c\u4f7f\u7528\u8bc1\u4e66\\n\\n\u521b\u5efa\u597d Certificate \u540e\uff0c\u7a0d\u7b492-3\u5206\u949f \u6211\u4eec\u53ef\u4ee5 \u67e5\u770b\u662f\u5426\u7b7e\u53d1\u6210\u529f:\\n\\n```\\nkubectl get certificate -n gaea-op\\nNAME                READY   SECRET                  AGE\\ntls-ops-domain-prod   True   tls-ops-domain-prod   2m\\n```\\n\\n\u67e5\u770b\u8bc1\u4e66\u4fe1\u606f\\n\\n```\\nkubectl get secrets/tls-ops-domain-prod  -n gaea-op -o json | jq \'.data.\\"tls.crt\\"\' | tr \'\\\\\\"\' \' \' | base64 -D | openssl x509 -in /dev/stdin -text -noout\\n\\n```\\n\\n### \u4f7f\u7528\u8bc1\u4e66\\n\\n```yaml\\napiVersion: extensions/v1beta1\\nkind: Ingress\\nmetadata:\\n  name: log\\n  namespace: gaea-op\\nspec:\\n  rules:\\n  - host: log01.bj-internal.ops.domain\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: log\\n          servicePort: http-2379\\n        path: /\\n  tls:\\n  - hosts:\\n    - log01.bj-internal.ops.domain\\n    secretName: tls-ops-domain-prod\\nstatus:\\n  loadBalancer:\\n    ingress:\\n    - ip: 10.10.10.159\\n```\\n\\n\\n## \u603b\u7ed3\\n\\n\u5230\u8fd9\u91cc\u4e3a\u6b62,  <b>cert-manager </b> \u57fa\u672c\u64cd\u4f5c\u5df2\u7ecf\u5b8c\u6210\u3002\\n\\n\u6e90\u7801\u90e8\u5206  [godu/helminit](https://gitee.com/godu/helminit)"},{"id":"/posts/artifactory-setup-mirrors","metadata":{"permalink":"/posts/artifactory-setup-mirrors","source":"@site/blog/posts/artifactory-setup-mirrors.md","title":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","description":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","date":"2020-09-30T14:01:08.000Z","formattedDate":"2020\u5e749\u670830\u65e5","tags":[{"label":"Artifactory","permalink":"/tags/artifactory"}],"readingTime":2.96,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","date":"2020-09-30T14:01:08.000Z","description":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","tags":["Artifactory"]},"prevItem":{"title":"\u57fa\u4e8eALIDNS\u4f7f\u7528cert-manager\u81ea\u52a8\u7b7e\u53d1TLS\u8bc1\u4e66","permalink":"/posts/cert-manager-install"},"nextItem":{"title":"\u7fa4\u6656\u914d\u7f6eClash","permalink":"/posts/clash-dsm"}},"content":"> \u8d81\u7740\u8282\u524d\uff0c\u9700\u8981\u6298(dao)\u817e(shi)\u4e00\u4e0b\u53bb\u5e74\u90e8\u7f72\u7684artifactory\u955c\u50cf\u6e90\uff0c\u5e76\u5c06\u5347\u7ea7\u52307.x\u7248\u672c\u3002\\n\\n\x3c!-- truncate --\x3e\\n\\n## \u573a\u666f\\n\\n\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90\uff0c\u5bf9\u5185\u63d0\u4f9b\u670d\u52a1\u3002\u8fd9\u91cc\u53ea\u4f5c\u4e3a\u8f6f\u4ef6\u6e90\u6d4b\u8bd5\u4f7f\u7528\uff0c\u5176\u4ed6\u573a\u666f\u81ea\u884c\u7422\u78e8\u3002\\n\\n\\n## \u90e8\u7f72\u670d\u52a1\\n\\n\u90e8\u7f72\u5f88\u7b80\u5355\uff0c\u8fd9\u91cc\u4f7f\u7528docker-compose\u65b9\u5f0f\u90e8\u7f72\\n\\n```\\n# docker-compose.yaml\\nversion: \'2.1\'\\nservices:\\n  ossv2:\\n    image: registry.cn-beijing.aliyuncs.com/k7scn/artifactory-pro:7.6.1\\n    container_name: ossv2\\n    volumes:\\n    - /data/ossv2:/var/opt/jfrog/artifactory\\n    network_mode: host\\n    restart: always\\n  nginx:\\n    image: registry.cn-beijing.aliyuncs.com/k7scn/nginx:1.17.3\\n    container_name: nginx\\n    volumes:\\n    - /var/log/nginx:/var/log/nginx:rw\\n    - ./config:/etc/nginx/conf.d:rw\\n    - ./nginxconfig.io:/etc/nginx/nginxconfig.io:rw\\n    - ./ssl:/etc/nginx/ssl:rw\\n    - ./wwwroot:/var/www:rw\\n    network_mode: host\\n    restart: always\\n```\\n\\n#### \u6ce8\u610f\u4e8b\u9879\\n\\n- **artifactory** \u6301\u4e45\u5316\u6570\u636e\u76ee\u5f55\u53ef\u7528\u7a7a\u95f4\u6700\u597d\u7a0d\u5fae\u5927\u4e9b(<b>>500GB</b>)\uff0c\u5177\u4f53\u770b\u955c\u50cf\u6e90\u6570\u76ee\u591a\u5c11\u3002\\n- \u4f7f\u7528nginx\u8fdb\u884c\u53cd\u5411\u4ee3\u7406\u3002\\n\\n## \u914d\u7f6e\u6e90\\n\\n7.x \u548c 6.x \u7248\u672c\u5dee\u522b\u8fd8\u633a\u5927\u7684\u3002\\n\\n`docker-compose up -d` \u542f\u52a8\u670d\u52a1\u540e\uff0c\u8bbf\u95ee `<ip>:8082` \u8fdb\u884c\u521d\u59cb\u5316\u670d\u52a1\u914d\u7f6e\uff0c\u57fa\u672c\u9ed8\u8ba4\u914d\u7f6e\u5373\u53ef\u6216\u8005SKIP\u8df3\u8fc7\u3002\\n\\n> \u5728\u6b64\u8fc7\u7a0b\u4e2d\u6709\u4e00\u6b65\u6bd4\u8f83\u5751\uff0c\u5c31\u662f\u521b\u5efa\u9ed8\u8ba4\u7684**Repositories**\uff0c\u8fd9\u4e2a\u8df3\u8fc7\u8df3\u8fc7\uff0c\u5426\u5219\u540e\u9762\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5c31\u8981\u8e29\u5751\u4e86\uff0c\u5982\u914d\u7f6e**Debian**\u6216\u8005\u6e90\u540e**Alpine**\u540e\uff0c\u5982\u679c\u6587\u4ef6\u8def\u5f84\u91cc\u6709**.**\u5c31\u4f1a\u5bfc\u81f4\u6587\u4ef6\u65e0\u6cd5\u4e0b\u8f7d404\\n\\n### artifactory \u6e90\\n\\n\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\uff0c\\n\\n- Local \u672c\u5730 \uff08\u901a\u5e38\u653e\u4e00\u4e9b\u5185\u90e8\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u6216\u8005\u5176\u4ed6\uff0c\u5f53oss\u7528\uff09\\n- Remote \u8fdc\u7a0b (\u5e38\u7528\uff0c\u9ed8\u8ba4\u5c31\u57fa\u672c\u4f7f\u7528\u8fd9\u4e2a \u901a\u5e38\u955c\u50cfaliyun\u6216\u8005tuna)\\n- Virtual \u865a\u62df (local + remote)\\n\\n\u8fd9\u91cc\u6211\u622a\u53d6\u90e8\u5206\u8f6f\u4ef6\u6e90\u793a\u4f8b\uff0c\u57fa\u672c\u50bb\u74dc\u5f0f\u64cd\u4f5c\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirrors01.png)\\n\\n## \u793a\u4f8b\u914d\u7f6eDebian\u6e90\\n\\n\u6b63\u5e38Debian\u6e90\u5982\u4e0b:\\n\\n```bash\\ndeb https://mirrors.ysicing.me/debian/ buster main contrib non-free\\ndeb https://mirrors.ysicing.me/debian/ buster-updates main contrib non-free\\ndeb https://mirrors.ysicing.me/debian/ buster-backports main contrib non-free\\ndeb https://mirrors.ysicing.me/debian-security buster/updates main contrib non-free\\n```\\n\\n\u5982\u679c\u60f3\u8fbe\u6210\u5982\u4e0a\uff0c\u9700\u8981\u505a\u4e24\u4ef6\u4e8b\\n\\n- \u955c\u50cfDebian\u6e90\\n- \u914d\u7f6e\u57df\u540d\\n\\n#### \u955c\u50cfDebian\u6e90\\n\\n- \u521b\u5efaRemote Repositories `debian` \u548c `debian-security`\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/debian_create_repo.png)\\n\\n- \u914d\u7f6edebian Remote Repositories\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirrors_debian.png)\\n\\n\u540c\u7406 debian-security \u7c7b\u4f3c\\n\\n- \u914d\u7f6e\u5b8c\u6210\u540e\u8bbf\u95ee **\\\\<ip\\\\>:8082/artifactory/debian/** \u6216\u8005 **\\\\<ip\\\\>:8081/artifactory/debian/**\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/list_debian.png)\\n\\n\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\\n\\n```bash\\ndeb http://172.16.72.42:8082/artifactory/debian/ buster main contrib non-free\\n....\\n```\\n\\nip+\u7aef\u53e3\u7684\u65b9\u5f0f\u7ec8\u7a76\u4e0d\u592a\u597d\u8bb0\uff0c\u662f\u65f6\u5019\u62d6\u51fanginx\u5927\u6740\u5668\u4e86\\n\\n#### \u914d\u7f6enginx\\n\\n\u8fd9\u91cc\u4e0d\u5177\u4f53\u8bf4nginx\u914d\u7f6e\u4e86\uff0c\u76f4\u63a5\u4e0a\u914d\u7f6e\\n\\n```\\n# mirrors.conf\\nserver {\\n    listen 80;\\n    listen [::]:80;\\n    listen 443 ssl http2;\\n    listen [::]:443 ssl http2;\\n\\n    server_name mirrors.ysicing.me;\\n    if ($http_x_forwarded_proto = \'\') {\\n        set $http_x_forwarded_proto  $scheme;\\n    }\\n    index index.html;\\n    root /var/www/mirrors.ysicing.me/public;\\n\\n    # SSL\\n    ssl_certificate /etc/nginx/ssl/ysicing.me.crt;\\n    ssl_certificate_key /etc/nginx/ssl/ysicing.me.key;\\n\\n    # security\\n    # include security.conf;\\n\\n    location = / {\\n\\t    root /var/www/mirrors.ysicing.me/public;\\n    }\\n\\n    location ~ .*\\\\.(html|htm|reponew)$ {\\n\\t    root /var/www/mirrors.ysicing.me/public;\\n    }\\n\\n    location ~ (docker.sh|func.sh|data.json)$ {\\n\\t   root /var/www/mirrors.ysicing.me/public;\\n    }\\n\\n    # location ~ ^/$ {\\n    #     root /var/www/mirrors.ysicing.me/public;\\n    # }\\n\\n    location /pypi/ {\\n\\tproxy_pass http://127.0.0.1:8081/artifactory/api/pypi/pypi/;\\n   \\tinclude nginxconfig.io/proxy.conf;\\n    }\\n\\n    # chunked_transfer_encoding on;\\n    # client_max_body_size 0;\\n\\n    # reverse proxy\\n    location / {\\n\\n\\tproxy_buffering    off;\\n\\tproxy_buffer_size  128k;\\n\\tproxy_buffers 100  128k;\\n\\tclient_max_body_size 100m;\\n\\n        proxy_pass http://127.0.0.1:8081/artifactory/;\\n        include nginxconfig.io/proxy.conf;\\n\\n        location ~ ^/artifactory/ {\\n            proxy_pass    http://127.0.0.1:8081;\\n            include nginxconfig.io/proxy.conf;\\n        }\\n    }\\n\\n    # additional config\\n    include nginxconfig.io/general.conf;\\n}\\n```\\n\\n\u7c7b\u4f3c\u4e24\u4e2a\u914d\u7f6e\u62ff\u81ea**nginxconfig.io**\\n\\n```\\n# proxy.conf\\nproxy_http_version    1.1;\\nproxy_cache_bypass    $http_upgrade;\\nproxy_read_timeout  2400s;\\nproxy_pass_header   Server;\\nproxy_next_upstream error timeout non_idempotent;\\nproxy_next_upstream_tries    1;\\nproxy_set_header Upgrade            $http_upgrade;\\nproxy_set_header Connection         \\"upgrade\\";\\nproxy_set_header Host                $host;\\nproxy_set_header X-Real-IP            $remote_addr;\\nproxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\\nproxy_set_header X-Forwarded-Proto    $scheme;\\nproxy_set_header X-Forwarded-Host    $host;\\nproxy_set_header X-Forwarded-Port    $server_port;\\n\\n# general.conf\\n# favicon.ico\\nlocation = /favicon.ico {\\n    log_not_found off;\\n    access_log off;\\n}\\n\\n# robots.txt\\nlocation = /robots.txt {\\n    log_not_found off;\\n    access_log off;\\n}\\n\\n# assets, media\\nlocation ~* \\\\.(?:css(\\\\.map)?|js(\\\\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv)$ {\\n    expires 7d;\\n    access_log on;\\n}\\n\\n# svg, fonts\\nlocation ~* \\\\.(?:svgz?|ttf|ttc|otf|eot|woff2?)$ {\\n    add_header Access-Control-Allow-Origin \\"*\\";\\n    expires 7d;\\n    access_log off;\\n}\\n\\n# gzip\\ngzip on;\\ngzip_vary on;\\ngzip_proxied any;\\ngzip_comp_level 6;\\ngzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml;\\n```\\n\\n\u5230\u8fd9\u91cc\u8f6f\u4ef6\u6e90\u914d\u7f6e\u5c31\u57fa\u672c\u5b8c\u6210\u4e86\u3002\\n\\n\u6548\u679c\u56fe\u5982\u4e0b:\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirros_done.png)\\n\\nUI\u501f\u9274\u4e86\u7f51\u6613\u5f00\u6e90\u955c\u50cf\u7ad9\\n\\n#### \u8e29\u7684pypi\u5751\uff0c\u5c0f\u8bb0\u5907\u5fd8\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200930/pypi.png)\\n\\npypi\u6e90\u4e0d\u540c\u4e8e\u5176\u4ed6\uff0c\u9700\u8981\u989d\u5916\u914d\u7f6enginx\u89c4\u5219\\n\\n```\\n    location /pypi/ {\\n\\tproxy_pass http://127.0.0.1:8081/artifactory/api/pypi/pypi/;\\n   \\tinclude nginxconfig.io/proxy.conf;\\n    }\\n```\\n\\n\u4f7f\u7528\\n\\n```\\n~/.pip/pip.conf\\n[global]\\nindex-url = https://mirrors.ysicing.me/pypi/simple\\n\\n# \u6d4b\u8bd5\\ngit clone https://gitee.com/ysbot/CTFd.git --depth 1\\ncd CTFd\\npip3 install -r requirements.txt\\n```\\n\\n#### Go\u4ee3\u7406\\n\\n\u65b0\u7248\u672c\u5bf9Go\u4ee3\u7406\u505a\u4e86\u4f18\u5316\uff0c\u4f7f\u7528\u5f88\u6d41\u7a0b\uff0c\u521b\u5efa\u8fdc\u7a0bGo\uff0c\u6e90\u4f7f\u7528`https://goproxy.cn`\\n\\n```\\ngo env -w GO111MODULE=on\\ngo env -w GOPROXY=https://mirrors.ysicing.me/go/,direct\\n```"},{"id":"/posts/clash-dsm","metadata":{"permalink":"/posts/clash-dsm","source":"@site/blog/posts/clash-dsm.md","title":"\u7fa4\u6656\u914d\u7f6eClash","description":"\u7fa4\u6656\u914d\u7f6eClash","date":"2020-09-20T13:05:54.000Z","formattedDate":"2020\u5e749\u670820\u65e5","tags":[{"label":"clash","permalink":"/tags/clash"}],"readingTime":0.9933333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u7fa4\u6656\u914d\u7f6eClash","date":"2020-09-20T13:05:54.000Z","description":"\u7fa4\u6656\u914d\u7f6eClash","tags":["clash"]},"prevItem":{"title":"\u4f7f\u7528Artifactory\u90e8\u7f72\u79c1\u6709\u5316\u8f6f\u4ef6\u6e90","permalink":"/posts/artifactory-setup-mirrors"},"nextItem":{"title":"Caddy2\u521d\u4f53\u9a8c","permalink":"/posts/caddy2"}},"content":"\x3c!-- truncate --\x3e\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/clash.png)\\n\\n> \u8d81\u7740\u642c\u5bb6\uff0c\u9700\u8981\u6298(dao)\u817e(shi)\u4e00\u4e0b\u5403\u7070\u7684\u7fa4\u6656\uff0c\u5c06Clash\u5347\u7ea7\u52302.0\\n\\n## \u51c6\u5907clash\u914d\u7f6e\u6587\u4ef6\\n\\n\u7531\u4e8e\u65e5\u5e38\u4f7f\u7528clashx\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4ecb\u7ecd\u5982\u4f55\u83b7\u53d6Clash\u914d\u7f6e\u6587\u4ef6\u4e86\u3002\u81ea\u884c\u89e3\u51b3\uff0c\u53ef\u4ee5\u53c2\u8003\u5927\u4f6c\u6574\u7406\u7684[LAZY_RULES](https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/clash.yaml)\\n\\n#### \u6ce8\u610f\u51e0\u70b9\\n\\n```yaml\\n#HTTP(S) and SOCKS5 \u5171\u7528\u7aef\u53e3\\nmixed-port: 7890\\n# \u5141\u8bb8\u5c40\u57df\u7f51\u7684\u8fde\u63a5\uff08\u53ef\u7528\u6765\u5171\u4eab\u4ee3\u7406\uff09\\nallow-lan: true\\n# clash \u7684 RESTful API\\nexternal-controller: 0.0.0.0:9090\\n```\\n\\n## \u6548\u679c\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh01.jpg)\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh02.jpg)\\n\\n\\n### \u521b\u5efaclash-prod\u670d\u52a1\\n\\n- \u83b7\u53d6\u955c\u50cf\u6216\u8005\u4e0a\u4f20\u955c\u50cf\uff0c\u8fd9\u91cc\u9ed8\u8ba4\u4e0a\u4f20\u955c\u50cf\\n\\n```\\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/clash:1.1.0\\ndocker save registry.cn-beijing.aliyuncs.com/k7scn/clash:1.1.0 > clash.tar\\n```\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh03.jpg)\\n\\n- \u521b\u5efa\u5bb9\u5668\\n\\n\u70b9\u51fb\u955c\u50cf\u521b\u5efa\u5bb9\u5668\u540e\uff0c\u9ad8\u7ea7\u8bbe\u7f6e\u3002\\n\\n> - \u9ad8\u7ea7\u8bbe\u7f6e\uff0c\u52fe\u9009\u542f\u7528\u81ea\u52a8\u91cd\u65b0\u542f\u52a8\\n> - \u5377\uff0c\u6301\u4e45\u5316\u914d\u7f6e\u6587\u4ef6\\n> - \u7f51\u7edc\uff0c\u52fe\u9009\u4f7f\u7528\u4e0eDocker Host\u76f8\u540c\u7684\u7f51\u7edc(\u5171\u4eab\u7f51\u7edc)\\n\\n\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh04.jpg)\\n\\n\u914d\u7f6e\u5b8c\u6210\u5e94\u7528\uff0c\u5373\u53ef\u3002\\n\\n\\n### \u521b\u5efaclash-ui\u670d\u52a1\\n\\n\u540c\u7406\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u7b80\u5355\u8bf4\u4e0b\\n\\n```\\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/clash:yacd\\ndocker save registry.cn-beijing.aliyuncs.com/k7scn/clash:yacd > yacd.tar\\n```\\n\\n- \u4e0d\u9700\u8981\u989d\u5916\u914d\u7f6e\uff0c\u5f53\u670d\u52a1\u8d77\u6765\u540e\uff0c\u83b7\u53d6clash-ui\u9ed8\u8ba4\u5206\u914d\u7684\u7aef\u53e3\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u914d\u7f6eAPI\u5730\u5740\u4e3a**http://127.0.0.1:9090**\\n\\n\u5230\u8fd9\u91cc\u5c31\u8fbe\u5230\u4e86\u4e0a\u8ff0\u6548\u679c\u3002\\n\\n## \u7fa4\u6656\u914d\u7f6e\u4ee3\u7406\\n\\n![](https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh05.jpg)"},{"id":"/posts/caddy2","metadata":{"permalink":"/posts/caddy2","source":"@site/blog/posts/caddy2.md","title":"Caddy2\u521d\u4f53\u9a8c","description":"Caddy2\u521d\u4f53\u9a8c","date":"2020-09-15T23:38:56.000Z","formattedDate":"2020\u5e749\u670815\u65e5","tags":[{"label":"caddy","permalink":"/tags/caddy"}],"readingTime":1.36,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Caddy2\u521d\u4f53\u9a8c","date":"2020-09-15T23:38:56.000Z","description":"Caddy2\u521d\u4f53\u9a8c","tags":["caddy"]},"prevItem":{"title":"\u7fa4\u6656\u914d\u7f6eClash","permalink":"/posts/clash-dsm"},"nextItem":{"title":"Vagrant\u4ece\u5165\u95e8\u5230\u653e\u5f03","permalink":"/posts/vagrant-study"}},"content":"> `Caddy2`\u4f7f\u7528\u5c0f\u8bb0\\n\\n\x3c!-- truncate --\x3e\\n\\n> \u5c06**Caddy**\u5347\u7ea7\u5230 **Caddy2**\uff0c \u8bb0\u5f55\u4e00\u4e0b\u3002 2.0\u7248\u672c\u6539\u53d8\u633a\u5927\u7684\u3002\\n\\n## \u73af\u5883\\n\\n\u817e\u8baf\u4e91\u9999\u6e2f\u8f7b\u91cf, **Debian 10**, \u79d2\u4e0d\u53ef\u8a00\u3002\\n\\n## \u5b89\u88c5caddy2\\n\\n#### \u4f7f\u7528\u955c\u50cf\u6216\u8005\u6e90\u5b89\u88c5(\u63a8\u8350\u6e90\u5b89\u88c5)\\n\\n```bash\\ndocker pull registry.cn-beijing.aliyuncs.com/k7scn/caddy\\n# \u6216\u8005\\necho  \\"deb [trusted=yes] https://apt.fury.io/caddy/ /\\" > /etc/apt/sources.list.d/caddy-fury.list\\napt update\\napt install caddy\\n```\\n\\n#### \u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u88c5\\n\\n```bash\\nwget https://github.com/caddyserver/caddy/releases/download/v2.1.1/caddy_2.1.1_linux_amd64.tar.gz\\ntar xf caddy_2.1.1_linux_amd64.tar.gz\\nmv caddy /usr/local/bin/caddy2\\n```\\n\\n\u914d\u7f6esystemd\\n\\n```\\n# /etc/systemd/system/caddy.service\\n[Unit]\\nDescription=Caddy\\nDocumentation=https://caddyserver.com/docs/\\nAfter=network.target\\n\\n[Service]\\nUser=caddy\\nGroup=caddy\\nEnvironmentFile=-/etc/caddy/caddy.env\\nExecStart=/usr/local/bin/caddy2 run --environ --config /etc/caddy/Caddyfile\\nExecReload=/usr/local/bin/caddy2 reload --config /etc/caddy/Caddyfile\\nTimeoutStopSec=5s\\nLimitNOFILE=1048576\\nLimitNPROC=512\\nPrivateTmp=true\\nProtectSystem=full\\nAmbientCapabilities=CAP_NET_BIND_SERVICE\\n\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n## Caddyfile\u4f7f\u7528\\n\\n> \u76ee\u524d Caddy2 \u5b98\u65b9\u63a8\u8350\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528 JSON \u683c\u5f0f\uff0c\u6216\u8005\uff0c\u4e0d\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6\uff0c\u76f4\u63a5\u8c03\u7528 admin API\u3002\u4f46\u6211\u63a8\u8350\u4f7f\u7528 Caddyfile, \u65e5\u5e38\u7ef4\u62a4\u8d77\u6765\u8981\u65b9\u4fbf\u4e00\u4e9b\\n\\n```bash\\ncaddy2 adapt --config /etc/caddy/Caddyfile --validate  #\u6821\u9a8c\u662f\u5426\u5408\u6cd5\\n```\\n\\n<del>\u5b98\u65b9\u867d\u7136\u8bf4\u4ecev1\u5347\u7ea7\u5230v2\u5f88\u7b80\u5355\uff0c\u6211\u4fe1\u4f60\u7684\u9b3c</del>\\n\\n#### \u793a\u4f8b\\n\\n```\\n\\n{\\n  # \u5f00\u542f\u5b9e\u9a8c\u6027 HTTP/3\\n  experimental_http3\\n  # \u6d4b\u8bd5\u901a\u8fc7\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u53bb\u9664\u8be5\u9879\\n  # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory\\n}\\n\\n(common_headers) {\\n  encode gzip\\n}\\n(secure_headers) {\\n  header {\\n    Strict-Transport-Security \\"max-age=31536000; includeSubDomains; preload\\"\\n    X-Frame-Options SAMEORIGIN\\n    X-Content-Type-Options nosniff\\n  }\\n}\\n\\nci.hk2.godu.dev {\\n  tls ops.ysicing@gmail.com\\n  import common_headers\\n  import secure_headers\\n  reverse_proxy 169.254.0.2:80\\n}\\n\\ncr.hk2.godu.dev {\\n  tls ops.ysicing@gmail.com\\n  import common_headers\\n  import secure_headers\\n  reverse_proxy 127.0.0.1:404\\n}\\n\\n:80 {\\n        respond \\"2020 hello\\"\\n}\\n```\\n\\n#### \u914d\u7f6e\u8bf4\u660e\\n\\ncaddy2 \u5f15\u5165\u4e86\u5168\u5c40\u9009\u9879**global options**\u7684\u6982\u5ff5\uff0c\u5e76\u4e14\u5982\u679c\u5168\u5c40\u9009\u9879\u5b58\u5728\uff0c\u5fc5\u987b\u4f4d\u4e8e Caddyfile \u7684\u5f00\u5934\\n\\n```\\n# \u5168\u5c40\u914d\u7f6e\\n{\\n  # \u5f00\u542f\u5b9e\u9a8c\u6027 HTTP/3\\n  experimental_http3\\n  # \u6d4b\u8bd5\u901a\u8fc7\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u53bb\u9664\u8be5\u9879\\n  # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory\\n}\\n```\\n\\n1. \u652f\u6301**HTTP/3**\uff0c \u5de5\u4f5c\u5728 UDP \u534f\u8bae\u4e0a\uff0c\u9700\u8981\u653e\u884c443 UDP\\n2. Let\u2019s Encrypt \u6d4b\u8bd5\u73af\u5883\uff0c\u9ed8\u8ba4caddy2\u662f\u5904\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u6d4b\u8bd5\u65f6\u53ef\u6539\u4e3a\u6d4b\u8bd5\u73af\u5883\\n\\n[\u5b98\u65b9\u6587\u6863](https://caddyserver.com/docs/caddyfile)"},{"id":"/posts/vagrant-study","metadata":{"permalink":"/posts/vagrant-study","source":"@site/blog/posts/vagrant-study.md","title":"Vagrant\u4ece\u5165\u95e8\u5230\u653e\u5f03","description":"vagrant\u7b80\u5355\u4ecb\u7ecd\u4f7f\u7528","date":"2020-09-14T00:04:15.000Z","formattedDate":"2020\u5e749\u670814\u65e5","tags":[{"label":"vagrant","permalink":"/tags/vagrant"}],"readingTime":2.526666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Vagrant\u4ece\u5165\u95e8\u5230\u653e\u5f03","date":"2020-09-14T00:04:15.000Z","description":"vagrant\u7b80\u5355\u4ecb\u7ecd\u4f7f\u7528","tags":["vagrant"]},"prevItem":{"title":"Caddy2\u521d\u4f53\u9a8c","permalink":"/posts/caddy2"},"nextItem":{"title":"Istio 1.7\u5b89\u88c5","permalink":"/posts/istio-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n![vagrant](https://gitee.com/godu/blogimage/raw/master/docker/vagrant-k8s.png)\\n\\n## \u6e90\u8d77\\n\\n\u6709\u65f6\u5019\u8dd1\u4e00\u4e9b\u670d\u52a1\uff0c\u9700\u8981\u5728Linux\u4e0a\u8fd0\u884c\uff0c\u9700\u8981\u5feb\u901f\u62c9\u8d77\u5206\u5e03\u5f0f\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u914d\u7f6e\uff0c\u4e0d\u53ef\u80fd\u901a\u8fc7\u521b\u5efa\u865a\u62df\u673a\u5b89\u88c5\u670d\u52a1\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\uff0c\u5426\u5219\u4e00\u884c\u547d\u4ee4\uff0c\u4e00\u4e0a\u5348\u3002\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u4e00\u6b3e\u79d1\u5b66\u7684\u5de5\u5177\u6765\u7ba1\u7406\u865a\u62df\u673a\u3002\u6709\u4eba\u4f1a\u8bf4\uff0c\u4e0d\u662f\u6709**docker**\u4e48\uff0c\u4e3a\u5565\u8fd8\u7528**vagrant**\\n\\n### \u533a\u522b\\n\\n\u8fd9\u91cc\u7b80\u5355\u8bf4\u4e0b\u533a\u522b\\n\\n**vagrant**\u662fvm\u7684\u7f16\u6392\u5de5\u5177,\u662f\u7ba1\u7406\u7f16\u6392\u73af\u5883\uff0c\u5bf9\u6807\u5e94\u8be5\u662f**docker-compose**\\n**docker**\u662f\u5c06\u5e94\u7528\u8f7b\u91cf\u5316\u6784\u5efa\u548c\u90e8\u7f72\u5de5\u5177\\n\\n\u4e2a\u4eba\u8ba4\u4e3a\u4e24\u8005\u4f7f\u7528\u7eac\u5ea6\u4e0d\u4e00\u6837\uff0c \u800c\u4e14\u5e94\u7528\u573a\u666f\u54ea\u4e2a\u65b9\u4fbf\u7528\u54ea\u4e2a\u3002\\n\\n## \u7528\u6cd5\\n\\n\u4e0a\u9762\u8bf4\u5230**vagrant**\u662fvm\u865a\u62df\u673a\u7684\u7f16\u6392\u5de5\u5177\uff0c\u76ee\u524d\u652f\u6301\u591a\u4e2a\u865a\u62df\u673a\u8f6f\u4ef6\uff0c\u5e38\u89c1\u7528**virtualbox**\uff0c\u4e5f\u63a8\u8350\u7528\u8fd9\u4e2a\u3002\\n\\n[\u5b98\u65b9\u6587\u6863 Getting Started](https://learn.hashicorp.com/collections/vagrant/getting-started)\\n\\n\\n####  \u5b89\u88c5vagrant\\n\\n```bash\\n# MacOS, \u9ed8\u8ba4\u5df2\u7ecfvirtualbox\\nbrew cask install vagrant \\n```\\n\\n\u6216\u8005\u901a\u8fc7\u5b98\u7f51\u5b89\u88c5 [Download Vagrant](https://www.vagrantup.com/downloads)\\n\\n#### \u521d\u59cb\u5316\u4e00\u4e2a\u9879\u76ee\\n\\n`Vagrantfile`\u662f\u7528\u6765\u5b9a\u4e49vagrant project\u7684\uff0c\u4f7f\u7528ruby\u8bed\u6cd5\uff0c\u4e0d\u8fc7\u4f60\u4e0d\u9700\u8981\u77e5\u9053ruby\u5c31\u53ef\u4ee5\u5199\u4e00\u4e2aVagrantfile\u3002\\n\\n\u793a\u4f8b\u6765\u6e90\u4e8e [ysicing/debian-vagrant](https://raw.githubusercontent.com/ysicing/debian-vagrant/master/Vagrantfile)\\n\\n```ruby\\n# -*- mode: ruby -*-\\n# vi: set ft=ruby :\\n\\nVagrant.configure(\\"2\\") do |config|\\n  config.vm.box_check_update = false\\n  config.vm.provider \'virtualbox\' do |vb|\\n   vb.customize [ \\"guestproperty\\", \\"set\\", :id, \\"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\\", 1000 ]\\n  end  \\n  config.vm.synced_folder \\".\\", \\"/vagrant\\", type: \\"nfs\\", nfs_udp: false, disabled: true\\n  $num_instances = 1\\n  (1..$num_instances).each do |i|\\n    config.vm.define \\"node#{i}\\" do |node|\\n      node.vm.box = \\"ysicing/debian\\"\\n      node.vm.hostname = \\"debian105-#{i}\\"\\n      #node.ssh.username = \\"root\\"\\n      #node.ssh.password = \\"vagrant\\"\\n      ip = \\"11.11.11.#{i+10}\\"\\n      node.vm.network \\"private_network\\", ip: ip\\n      node.vm.provider \\"virtualbox\\" do |vb|\\n        vb.gui = false\\n        vb.memory = \\"1024\\"\\n        vb.cpus = 1\\n        vb.name = \\"node#{i}\\"\\n        vb.customize [\\"modifyvm\\", :id, \\"--natdnshostresolver1\\", \\"on\\"]\\n        vb.customize [\\"modifyvm\\", :id, \\"--ioapic\\", \\"on\\"]\\n      end\\n      node.vm.provision \\"shell\\", inline: \\"uname -a\\"\\n    end\\n  end\\nend\\n```\\n\\n\u7b80\u5355\u8bf4\u4e0b\u6838\u5fc3\u91cd\u8981\u76f8\u5173\u53c2\u6570:\\n\\n- **vm.provider**  \u865a\u62df\u673a\u670d\u52a1\\n- **vm.box** \u865a\u62df\u673a\u955c\u50cf, \u7c7b\u4f3cdocker\u955c\u50cf\u955c\u50cf\\n- **cpus,memory,network,instances** \u865a\u62df\u673a\u8d44\u6e90\u526f\u672c\u4fe1\u606f\u7b49\\n\\n#### \u5e38\u7528\u57fa\u7840\u547d\u4ee4\\n\\n```bash\\n# \u542f\u52a8\\nvagrant up\\n# ssh\u767b\u5f55\\nvagrant ssh\\n# \u9500\u6bc1\\nvagrant destroy\\n# \u5173\u673a\\nvagrant halt\\n```\\n\\n## \u793a\u4f8b\u90e8\u7f72k8s\u96c6\u7fa4\\n\\n```\\nmkdir vm\\ncat > vm/Vagrantfile <<EOF\\n\\n# -*- mode: ruby -*-\\n# vi: set ft=ruby :\\n\\nVagrant.configure(\\"2\\") do |config|\\n  config.vm.box_check_update = false\\n  config.vm.provider \'virtualbox\' do |vb|\\n   vb.customize [ \\"guestproperty\\", \\"set\\", :id, \\"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\\", 1000 ]\\n  end\\n  $num_instances = 3\\n  (1..$num_instances).each do |i|\\n    config.vm.define \\"0660b6a92e962a930692651db4562957#{i}\\" do |node|\\n      node.vm.box = \\"ysicing/debian\\"\\n      node.vm.hostname = \\"0660b6a92e962a930692651db4562957#{i}\\"\\n      node.vm.network \\"public_network\\", use_dhcp_assigned_default_route: true, bridge: \'en0: Wi-Fi (Wireless)\'\\n      # node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"ntpdate ntp.api.bz\\"\\n      node.vm.network \\"private_network\\", ip: \\"11.11.11.11#{i}\\"\\n      node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"echo hello from 0660b6a92e962a930692651db4562957#{i}\\"\\n      node.vm.provider \\"virtualbox\\" do |vb|\\n        vb.gui = false\\n        vb.memory = 4096\\n        vb.cpus = 2\\n        vb.name = \\"0660b6a92e962a930692651db4562957#{i}\\"\\n        vb.customize [\\"modifyvm\\", :id, \\"--natdnshostresolver1\\", \\"on\\"]\\n        vb.customize [\\"modifyvm\\", :id, \\"--ioapic\\", \\"on\\"]\\n        # cpu \u4f7f\u7528\u738750%\\n        vb.customize [\\"modifyvm\\", :id, \\"--cpuexecutioncap\\", \\"50\\"]\\n      end\\n    end\\n  end\\nend\\nEOF\\n\\n# \u542f\u52a8\u865a\u62df\u673a\\nvagrant up\\n\\n# 11.11.11.110\uff0c11.11.11.111\uff0c11.11.11.112 root/vagrant\\n\\n# pre k8s pkg\\ndocker run --rm -v /tmp:/data registry.cn-beijing.aliyuncs.com/k7scn/k7s:1.16.15 cp -a /kube.tgz /data/kube.tgz\\n\\nsealos init --master 11.11.11.110 --node 11.11.11.111 --node 11.11.11.112 --user root --passwd vagrant --version v1.16.15 --repo registry.cn-beijing.aliyuncs.com/k7scn --pkg-url /tmp/kube.tgz\\n```\\n\\n#### \u5176\u4ed6\u573a\u666f\\n\\n\u672c\u5730\u8d77\u591a\u4e2a\u865a\u62df\u673a\u73af\u5883\u6d4b\u8bd5\uff0c\u5176\u4ed6\u6ca1\u5fc5\u8981\uff0c\u611f\u89c9\u6ca1docker-compose\u65b9\u4fbf\u3002\\n\\n```\\nVagrant.configure(\\"2\\") do |config|\\n  config.vm.provision \\"shell\\", inline: \\"echo Hello\\"\\n\\n  config.vm.define \\"web\\" do |web|\\n    web.vm.box = \\"apache\\"\\n  end\\n\\n  config.vm.define \\"db\\" do |db|\\n    db.vm.box = \\"mysql\\"\\n  end\\nend\\n```\\n\\n## debian box\u7b80\u4ecb\\n\\n\u9ed8\u8ba4box\u4f7f\u7528**ysicing/debian**, \u4e2a\u4eba\u81ea\u7528debian\u955c\u50cf\uff0c\u6e90\u7801\u5982\u4e0b[ysicing/debian-vagrant](https://github.com/ysicing/debian-vagrant)\\n\\n#### \u5b9a\u5236\\n\\n- \u9ed8\u8ba4\u5141\u8bb8**root**(\u5bc6\u7801**vagrant**)\u7528\u6237\u767b\u5f55\\n- \u9ed8\u8ba4dns\u4e3a**1.2.4.8**, **114.114.114.114**\\n- \u955c\u50cf\u6e90\u4e3a **mirrors.aliyun.com**\\n- \u9ed8\u8ba4\u786c\u76d880G\\n- \u5b89\u88c5\u4e86\u5e38\u7528\u8fd0\u7ef4\u5de5\u5177\\n- ...\\n\\n---"},{"id":"/posts/istio-install","metadata":{"permalink":"/posts/istio-install","source":"@site/blog/posts/istio-install.md","title":"Istio 1.7\u5b89\u88c5","description":"k8s\u90e8\u7f72istio 1.7","date":"2020-09-01T13:53:59.000Z","formattedDate":"2020\u5e749\u67081\u65e5","tags":[{"label":"istio","permalink":"/tags/istio"}],"readingTime":0.15333333333333332,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Istio 1.7\u5b89\u88c5","date":"2020-09-01T13:53:59.000Z","description":"k8s\u90e8\u7f72istio 1.7","tags":["istio"]},"prevItem":{"title":"Vagrant\u4ece\u5165\u95e8\u5230\u653e\u5f03","permalink":"/posts/vagrant-study"},"nextItem":{"title":"Consul\u5b89\u88c5","permalink":"/posts/consul-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5b89\u88c5\u8bb0\u5f55\\n\\n```bash\\ngit clone https://github.com/ysicing/istio-install.git\\ncd istio-install\\nistioctl install --set profile=demo --set hub=registry.cn-beijing.aliyuncs.com/k7scn\\nkubectl apply -f .\\n```\\n\\n## \u90e8\u7f72demo\\n\\n```\\nkubectl create ns istio-demo\\nkubectl label namespace istio-demo istio-injection=enabled\\nkubectl apply -f example/bookinfo.yaml -n istio-demo\\n```"},{"id":"/posts/consul-install","metadata":{"permalink":"/posts/consul-install","source":"@site/blog/posts/consul-install.md","title":"Consul\u5b89\u88c5","description":"helm\u5b89\u88c5consule","date":"2020-08-03T12:04:08.000Z","formattedDate":"2020\u5e748\u67083\u65e5","tags":[{"label":"consul","permalink":"/tags/consul"}],"readingTime":0.25666666666666665,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Consul\u5b89\u88c5","date":"2020-08-03T12:04:08.000Z","description":"helm\u5b89\u88c5consule","tags":["consul"]},"prevItem":{"title":"Istio 1.7\u5b89\u88c5","permalink":"/posts/istio-install"},"nextItem":{"title":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","permalink":"/posts/k8s-install-ergo"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u901a\u8fc7helm\u5feb\u901f\u5b89\u88c5consule\\n\\n```\\n# \u9ed8\u8ba4\u5df2\u5b58\u5728\u9ed8\u8ba4sc\\n\\nkubectl get sc\\n\\nnfs-data (default)     nfs-data      Delete          Immediate           false                  206d\\n```\\n\\n\u5b89\u88c5consul\\n\\n```\\nhelminit\\nkubectl create ns gaea-op\\n\\nhelm upgrade -i consul --set global.imageRegistry=registry.cn-beijing.aliyuncs.com \\\\\\n    --set image.repository=k7scn/b-consul \\\\\\n    --set volumePermissions.enabled=true \\\\\\n    --set volumePermissions.image.repository=k7scn/b-minideb \\\\\\n    --set persistence.enabled=true \\\\\\n    --set metrics.enabled=true \\\\\\n    --set metrics.image.repository=k7scn/b-consul-exporter \\\\\\n    --set ingress.enabled=true \\\\\\n    --version 7.1.3 \\\\\\n    bitnami/consul  -n gaea-op \\n```"},{"id":"/posts/k8s-install-ergo","metadata":{"permalink":"/posts/k8s-install-ergo","source":"@site/blog/posts/k8s-install-ergo.md","title":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","description":"\u672c\u5730\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","date":"2020-06-19T14:30:18.000Z","formattedDate":"2020\u5e746\u670819\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":3.47,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","date":"2020-06-19T14:30:18.000Z","description":"\u672c\u5730\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","tags":["kubernetes"]},"prevItem":{"title":"Consul\u5b89\u88c5","permalink":"/posts/consul-install"},"nextItem":{"title":"\u5f00\u6e90k8slb\u5de5\u5177Metallb","permalink":"/posts/k8s-slb-metallb"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u57fa\u4e8e[sealos](https://github.com/ysicing/sealos), \u4e00\u952e\u9ad8\u53ef\u7528\uff0c\u7b80\u5355\u4e0a\u624b, \u5b89\u88c5k8s 1.18.4\u7248\u672c\\n\\n## \u51c6\u5907\u865a\u62df\u673a\\n\\n\\n\u73af\u5883: 3\u53f0\u673a\u5668(debian/buster 10.4, 11.11.11.111~11.11.11.113, 2\u68384G80G\u5b58\u50a8)\\n\\n\\n{{< expand \\"ergo vm create --vmname k8s --vmnum 3\\" >}}\\n\\n```\\n\u279c  ~ ergo  vm create   --vmname k8s --vmnum 3\\nI0523 15:20:15.819808   17953 root.go:51] Using config file:\\n2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:66] check system\\n2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/vm/linux.go:73] check system done. It looks good\\n2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:78] check vagrant\\n2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/utils/command.go:15] [os]exec cmd is :  which [vagrant]\\n/usr/local/bin/vagrant\\n2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/utils/command.go:15] [os]exec cmd is :  which [VirtualBoxVM]\\n/usr/local/bin/VirtualBoxVM\\n2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:85] write Vagrantfile\\n2020-05-23 15:20:15 [INFO] [github.com/ysicing/ergo/vm/linux.go:92] vagranfile:\\n# -*- mode: ruby -*-\\n# vi: set ft=ruby :\\n\\nVagrant.configure(\\"2\\") do |config|\\n  config.vm.box_check_update = false\\n  config.vm.provider \'virtualbox\' do |vb|\\n   vb.customize [ \\"guestproperty\\", \\"set\\", :id, \\"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\\", 1000 ]\\n  end\\n  $num_instances = 3\\n  (1..$num_instances).each do |i|\\n    config.vm.define \\"k8s#{i}\\" do |node|\\n      node.vm.box = \\"ysicing/debian\\"\\n      node.vm.hostname = \\"k8s#{i}\\"\\n      node.vm.network \\"public_network\\", use_dhcp_assigned_default_route: true, bridge: \'en0: Wi-Fi (Wireless)\'\\n      # node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"ntpdate ntp.api.bz\\"\\n      node.vm.network \\"private_network\\", ip: \\"11.11.11.11#{i}\\"\\n      node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"echo hello from k8s#{i}\\"\\n      node.vm.provider \\"virtualbox\\" do |vb|\\n        vb.gui = false\\n        vb.memory = 4096\\n        vb.cpus = 2\\n        vb.name = \\"k8s#{i}\\"\\n        vb.customize [\\"modifyvm\\", :id, \\"--natdnshostresolver1\\", \\"on\\"]\\n        vb.customize [\\"modifyvm\\", :id, \\"--ioapic\\", \\"on\\"]\\n        # cpu \u4f7f\u7528\u738750%\\n        vb.customize [\\"modifyvm\\", :id, \\"--cpuexecutioncap\\", \\"50\\"]\\n      end\\n    end\\n  end\\nend\\n\\n2020-05-23 15:20:15 [DEBG] [github.com/ysicing/ergo/vm/linux.go:117] vagrant up\\nBringing machine \'k8s1\' up with \'virtualbox\' provider...\\nBringing machine \'k8s2\' up with \'virtualbox\' provider...\\nBringing machine \'k8s3\' up with \'virtualbox\' provider...\\n...\\n2020-05-23 15:26:37 [INFO] [github.com/ysicing/ergo/vm/linux.go:130] ip: 11.11.11.111-11.11.11.113, root/vagrant\\n2020-05-23 15:26:37 [INFO] [github.com/ysicing/ergo/vm/linux.go:133] \u9500\u6bc1\u65b9\u5f0f: cd /Users/ysicing/vm, vagrant destroy -f\\n```\\n\\n{{< /expand >}}\\n\\n## \u521d\u59cb\u5316\u73af\u5883\\n\\n{{< expand \\"ergo vm init --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113\\" >}}\\n```\\n===============================================================================\\nprepare : \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6 -------------------------------------------------------- 8.77s\\nprepare : Install dbus for the hostname module -------------------------- 5.84s\\nprepare : \u5220\u9664\u9ed8\u8ba4\u5b89\u88c5 -------------------------------------------------------- 3.60s\\nGathering Facts --------------------------------------------------------- 1.15s\\nprepare : \u52a0\u8f7d\u5185\u6838\u6a21\u5757 -------------------------------------------------------- 0.92s\\nprepare : gather facts -------------------------------------------------- 0.67s\\nprepare : \u589e\u52a0\u5185\u6838\u6a21\u5757\u5f00\u673a\u52a0\u8f7d\u914d\u7f6e -------------------------------------------------- 0.63s\\nprepare : \u542f\u7528systemd\u81ea\u52a8\u52a0\u8f7d\u6a21\u5757\u670d\u52a1 --------------------------------------------- 0.53s\\nprepare : \u7981\u7528\u7cfb\u7edf swap ----------------------------------------------------- 0.47s\\nprepare : \u8bbe\u7f6e\u7cfb\u7edf ulimits -------------------------------------------------- 0.41s\\nprepare : \u4f18\u5316\u8bbe\u7f6e journal \u65e5\u5fd7 ----------------------------------------------- 0.37s\\nprepare : \u628aSCTP\u5217\u5165\u5185\u6838\u6a21\u5757\u9ed1\u540d\u5355 ------------------------------------------------ 0.36s\\nprepare : \u5220\u9664fstab swap \u76f8\u5173\u914d\u7f6e --------------------------------------------- 0.34s\\nprepare : \u8bbe\u7f6e\u7cfb\u7edf\u53c2\u6570 -------------------------------------------------------- 0.32s\\nprepare : \u51c6\u5907 journal \u65e5\u5fd7\u76f8\u5173\u76ee\u5f55 --------------------------------------------- 0.32s\\nprepare : \u521b\u5efa systemd \u914d\u7f6e\u76ee\u5f55 ----------------------------------------------- 0.30s\\nprepare : \u91cd\u542f journald \u670d\u52a1 ------------------------------------------------ 0.30s\\nprepare : update /etc/security/limits.conf ------------------------------ 0.28s\\nprepare : \u751f\u6548\u7cfb\u7edf\u53c2\u6570 -------------------------------------------------------- 0.19s\\nprepare : \u8bbe\u7f6e ulimits ---------------------------------------------------- 0.12s\\n```\\n{{< /expand >}}\\n\\n## \u5b89\u88c5docker\\n\\n{{< expand \\"ergo install docker --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant\\" >}}\\n```\\n...\\n+ sh -c \'docker version\'\\nClient: Docker Engine - Community\\n Version:           19.03.9\\n API version:       1.40\\n Go version:        go1.13.10\\n Git commit:        9d988398e7\\n Built:             Fri May 15 00:25:25 2020\\n OS/Arch:           linux/amd64\\n Experimental:      false\\n\\nServer: Docker Engine - Community\\n Engine:\\n  Version:          19.03.9\\n  API version:      1.40 (minimum version 1.12)\\n  Go version:       go1.13.10\\n  Git commit:       9d988398e7\\n  Built:            Fri May 15 00:23:57 2020\\n  OS/Arch:          linux/amd64\\n  Experimental:     false\\n containerd:\\n  Version:          1.2.13\\n  GitCommit:        7ad184331fa3e55e52b890ea95e65ba581ae3429\\n runc:\\n  Version:          1.0.0-rc10\\n  GitCommit:        dc9208a3303feef5b3839f4323d9beb36df0a9dd\\n docker-init:\\n  Version:          0.18.0\\n  GitCommit:        fec3683\\nIf you would like to use Docker as a non-root user, you should now consider\\nadding your user to the \\"docker\\" group with something like:\\n\\n  sudo usermod -aG docker your-user\\n\\nRemember that you will have to log out and back in for this to take effect!\\n\\nWARNING: Adding a user to the \\"docker\\" group will grant the ability to run\\n         containers which can be used to obtain root privileges on the\\n         docker host.\\n         Refer to https://docs.docker.com/engine/security/security/#docker-daemon-attack-surface\\n         for more information.\\nSynchronizing state of docker.service with SysV service script with /lib/systemd/systemd-sysv-install.\\nExecuting: /lib/systemd/systemd-sysv-install enable docker\\n\\"19.03.9\\"\\nUnable to find image \'ysicing/tools:latest\' locally\\nlatest: Pulling from ysicing/tools\\n0d6b48c80e92: Pull complete\\nf28c196b1246: Pull complete\\n04bb1e97c214: Pull complete\\nDigest: sha256:c689021150ec06af298db958d24c19fdbe3aea7c6717c5dee53f7e9071b4cd76\\nStatus: Downloaded newer image for ysicing/tools:latest\\n```\\n{{< /expand >}}\\n\\n## \u5b89\u88c5\u5e38\u7528\u5c0f\u5de5\u5177\\n\\n{{< expand \\"ergo install tools --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant\\" >}}\\n```\\nI0523 15:35:59.919563   19284 root.go:51] Using config file:\\nI0523 15:35:59.920024   19284 install.go:55] \ud83c\udf89 \u5b89\u88c5 tools\\n2020-05-23 15:35:59 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.111]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir\\n2020-05-23 15:36:08 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.111]command result is:\\n2020-05-23 15:36:08 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.112]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir\\n2020-05-23 15:36:17 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.112]command result is:\\n2020-05-23 15:36:17 [INFO] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:12] [ssh][11.11.11.113]exec cmd is : docker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir\\n2020-05-23 15:36:26 [DEBG] [/Users/ysicing/go/pkg/mod/github.com/kunnos/sshcmd@v1.6.0/pkg/sshutil/ssh.go:25] [ssh][11.11.11.113]command result is:\\n```\\n{{< /expand >}}\\n\\n{{< boxmd >}}\\n`ergo shell --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant --cmd upgrade-tools`\\n\u6216\u8005\u5728\u5f53\u524d\u673a\u5668\u76f4\u63a5\u6267\u884c\\n`upgrade-tools`\\n{{< /boxmd >}}\\n\\n## \u5b89\u88c5k8s\\n\\n> \u8bf4\u660e\uff0c\u6211\u5b9a\u5236\u4e86sealos\u548ccalico\u7248\u672c\u4e3a\u6700\u65b0\u7248\u672c,\u4e14\u4f7f\u7528\u4e86\u5728\u7ebf\u5b89\u88c5\u5305\\n\\n```\\n# \u5b89\u88c5\u4e86k8s 1.18.4, \u5b89\u88c5\u4e86ingress, \u914d\u7f6enfs\uff0c\u9ed8\u8ba4\u5b58\u50a8\u7c7b\u4e3anfs-data\\nergo install k8s --enablenfs=true --mip 11.11.11.111 --wip 11.11.11.112-11.11.11.113 --pass vagrant --ingresstype --enablekuboard --regioncn\\n```\\n\\n### \u5b89\u88c5\u5176\u4ed6ingress\\n\\n\u652f\u6301`nginx-ingress`, `traefik`, `ingress-nginx`\\n\\n```\\nergo install ingress --ip 11.11.11.111 --pk ~/.ssh/id_rsa --regioncn --ingresstype\\n```\\n\\n## \u9a8c\u8bc1\\n\\n```\\nroot@k8s1:~# kubectl get node\\nNAME   STATUS   ROLES    AGE    VERSION\\nk8s1   Ready    master   2m2s   v1.18.4\\nk8s2   Ready    <none>   87s    v1.18.4\\nk8s3   Ready    <none>   87s    v1.18.4\\nroot@k8s1:~# kubectl get ns\\nNAME              STATUS   AGE\\ndefault           Active   2m6s\\ningress-nginx     Active   2m13s\\nkube-node-lease   Active   2m7s\\nkube-public       Active   2m7s\\nkube-system       Active   2m8s\\nroot@k8s1:~# kubectl get cs\\nNAME                 STATUS    MESSAGE             ERROR\\ncontroller-manager   Healthy   ok\\nscheduler            Healthy   ok\\netcd-0               Healthy   {\\"health\\":\\"true\\"}\\nroot@k8s1:~# kubectl get sc\\nNAME                 PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\\nnfs-data (default)   nfs-provisioner   Delete          Immediate           false                  60s\\n```"},{"id":"/posts/k8s-slb-metallb","metadata":{"permalink":"/posts/k8s-slb-metallb","source":"@site/blog/posts/k8s-slb-metallb.md","title":"\u5f00\u6e90k8slb\u5de5\u5177Metallb","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u7a77\u4eba\u5982\u4f55\u4f7f\u7528LoadBalancer","date":"2020-06-19T14:14:20.000Z","formattedDate":"2020\u5e746\u670819\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"LoadBalancer","permalink":"/tags/load-balancer"}],"readingTime":1.7133333333333334,"hasTruncateMarker":true,"authors":[{"name":"ysicing"}],"frontMatter":{"title":"\u5f00\u6e90k8slb\u5de5\u5177Metallb","date":"2020-06-19T14:14:20.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u7a77\u4eba\u5982\u4f55\u4f7f\u7528LoadBalancer","author":"ysicing","tags":["kubernetes","LoadBalancer"]},"prevItem":{"title":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5k8s1.18.4","permalink":"/posts/k8s-install-ergo"},"nextItem":{"title":"Etcd\u4f7f\u7528\u5165\u95e8","permalink":"/posts/etcd-op"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u7b80\u4ecb\\n\\nkubernetes\u672c\u8eab\u5e76\u6ca1\u6709\u5b9e\u73b0LoadBalancer, \u5982\u679c\u662f\u4e91\u4e0a\u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e91\u670d\u52a1\u5546\u63d0\u4f9bk8s\u7684LoadBalancer, \u5982\u963f\u91cc\u4e91\u7684slb\u3002\\n\\n\u5f53\u6211\u4eec\u628ak8s\u90e8\u7f72\u5728\u79c1\u6709\u4e91\u65f6\uff0c\u9700\u8981\u7b80\u5355\u7684LoadBalancer\u6765\u9a8c\u8bc1\u5de5\u4f5c\uff0c\u5f00\u6e90\u7684metallb\u5c31\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u9009\u62e9\u3002\\n\\n\u901a\u8fc7k8s\u539f\u751f\u7684\u65b9\u5f0f\u63d0\u4f9bLB\u7c7b\u578b\u7684Service\u652f\u6301\uff0c\u5f00\u7bb1\u5373\u7528\u3002\\n\\n\u6838\u5fc3\u7279\u6027:\\n\\n- `\u5730\u5740\u5206\u914d` MetalLB\u4f1a\u4e3a\u7528\u6237\u7684lb\u7c7b\u578bservice\u5206\u914dIP\u5730\u5740\uff0c\u8be5IP\u5730\u5740\u9700\u8981\u7528\u6237\u9884\u5148\u5206\u914d\\n- `\u5916\u90e8\u7533\u660e` \u5730\u5740\u5206\u914d\u540e\u8fd8\u9700\u8981\u901a\u77e5\u5230\u7f51\u7edc\u4e2d\u7684\u5176\u4ed6\u4e3b\u673a, \u6709\u4e24\u79cd\u65b9\u5f0f\u57fa\u4e8eARP\u7684Layer2\u548cBGP\\n\\n## \u539f\u7406\\n\\n- Layer2 (\u9ed8\u8ba4\u4f7f\u7528)\\n- BGP\\n\\n### Layer2\\n\\n\u53ea\u9700\u8981\u4e00\u6bb5\u8ddfK8s\u7ba1\u7406\u7f51\u76f8\u540c\u7f51\u6bb5\u7684\u5730\u5740\u5373\u53ef, \u901a\u5e38\u8fd9\u79cd\u5c31\u53ef\u4ee5\u4e86\u3002\\n\\n\u5728\u6b64\u6a21\u5f0f\u4e0b, \u4f1a\u4ecek8s\u8282\u70b9\u4e2d\u9009\u4e00\u4e2aLeader\u8282\u70b9\uff0c\u5728\u8fd9\u4e2a\u8282\u70b9\u4e0a\u9762\u54cd\u5e94LB\u5730\u5740\u6bb5\u7684ARP\u8bf7\u6c42\uff0c\u4ece\u800c\u4f7f\u4e0a\u5c42\u8def\u7531\u628a\u53d1\u5f80LB\u7684\u6d41\u91cf\u90fd\u53d1\u5230Leader\u8282\u70b9\u3002\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0c\u6240\u6709\u5bf9LB\u7684\u8bf7\u6c42\u90fd\u4f1a\u53d1\u5f80Leader\u8282\u70b9\u3002\u5982\u679c\u5f53\u524dService\u4e0b\u9762\u7684Pod\u5206\u5e03\u5728\u4e0d\u540c\u8282\u70b9\uff0c\u90a3\u4e48\u8fd9\u4e2a\u6d41\u91cf\u8fd8\u4f1a\u4eceLeader\u53d1\u5f80\u76f8\u5e94\u7684\u8282\u70b9\u3002\\n\\n\u5c40\u9650\u6027: \u5355\u8282\u70b9\u6d41\u91cf\u74f6\u9888\u548c\u6162\u6545\u969c\u8f6c\u79fb\\n\\n### BGP\\n\\n\u9700\u8981\u4e0a\u5c42\u8def\u7531\u5668\u652f\u6301BGP\uff0c\u4e0d\u5728\u9700\u8981Leader\u8282\u70b9\u3002\\n\\n## \u5b89\u88c5\\n\\n```\\nhelm repo add bitnami https://charts.bitnami.com/bitnami\\nhelm repo update \\nhelm upgrade -i metallb bitnami/metallb  --create-namespace -n metallb-system\\n\\n# \u9ed8\u8ba4\u7a7a\u914d\u7f6e\\nkubectl get cm/metallb-config  -n metallb-system -o yaml \\nkubectl apply -f https://sh.ysicing.me/k8s/helm/metallb/lbconfig.yaml\\n```\\n\\n### \u914d\u7f6e\u8bf4\u660e\\n\\n```\\n# https://sh.ysicing.me/k8s/helm/metallb/lbconfig.yaml\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n  namespace: metallb-system\\n  name: metallb-config\\ndata:\\n  config: |\\n    address-pools:\\n    - name: lbpool\\n      protocol: layer2\\n      addresses:\\n      - 11.11.11.150-11.11.11.200\\n```\\n\\n### \u6d4b\u8bd5\\n\\n```yaml\\n# lb.yaml\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: nginx-deployment\\nspec:\\n  selector:\\n    matchLabels:\\n      app: nginx\\n  replicas: 2\\n  template:\\n    metadata:\\n      labels:\\n        app: nginx\\n    spec:\\n      containers:\\n      - name: nginx\\n        image: nginx\\n        ports:\\n        - containerPort: 80\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: nginx-service\\nspec:\\n  selector:\\n    app: nginx\\n  ports:\\n    - port: 80\\n      targetPort: 80\\n  type: LoadBalancer\\n```\\n\\n\u6d4b\u8bd5\\n\\n```\\nroot@k8s1:~# kubectl apply -f lb.yaml\\nroot@k8s1:~# kubectl get pods,svc\\nNAME                                   READY   STATUS    RESTARTS   AGE\\npod/nginx-deployment-d46f5678b-hm7r6   1/1     Running   0          96s\\npod/nginx-deployment-d46f5678b-zgfxd   1/1     Running   0          96s\\n\\nNAME                    TYPE           CLUSTER-IP     EXTERNAL-IP    PORT(S)        AGE\\nservice/kubernetes      ClusterIP      10.96.0.1      <none>         443/TCP        88m\\nservice/nginx-service   LoadBalancer   10.98.184.75   11.11.11.150   80:32002/TCP   6s\\n```"},{"id":"/posts/etcd-op","metadata":{"permalink":"/posts/etcd-op","source":"@site/blog/posts/etcd-op.md","title":"Etcd\u4f7f\u7528\u5165\u95e8","description":"Etcd\u4f7f\u7528\u5165\u95e8","date":"2020-05-31T11:54:36.000Z","formattedDate":"2020\u5e745\u670831\u65e5","tags":[{"label":"etcd","permalink":"/tags/etcd"}],"readingTime":0.68,"hasTruncateMarker":true,"authors":[{"name":"ysicing"}],"frontMatter":{"title":"Etcd\u4f7f\u7528\u5165\u95e8","date":"2020-05-31T11:54:36.000Z","description":"Etcd\u4f7f\u7528\u5165\u95e8","author":"ysicing","tags":["etcd"]},"prevItem":{"title":"\u5f00\u6e90k8slb\u5de5\u5177Metallb","permalink":"/posts/k8s-slb-metallb"},"nextItem":{"title":"\u5728k8s\u4e2d\u4f7f\u7528docker in docker","permalink":"/posts/docker-in-k8s"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u7b80\u4ecb\\n\\netcd\u662fCoreOS\u56e2\u961f\u53d1\u8d77\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u76ee\u6807\u662f\u6784\u5efa\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684\u5206\u5e03\u5f0f\u952e\u503c(key-value)\u6570\u636e\u5e93\u3002etcd\u5185\u90e8\u91c7\u7528raft\u534f\u8bae\u4f5c\u4e3a\u4e00\u81f4\u6027\u7b97\u6cd5\uff0cetcd\u57fa\u4e8eGo\u8bed\u8a00\u5b9e\u73b0\u3002\\n\\netcd\u6bd4\u8f83\u591a\u7684\u5e94\u7528\u573a\u666f\u662f\u7528\u4e8e\u670d\u52a1\u53d1\u73b0\u3002\\n\\n## \u4f7f\u7528helm\u5b89\u88c5etcd\\n\\n```bash\\n# \u67e5\u8be2\\nhelm search repo etcd\\n\\nNAME                    CHART VERSION   APP VERSION     DESCRIPTION                                       \\nbitnami/etcd            4.8.2           3.4.9           etcd is a distributed key value store that prov...\\nincubator/etcd          0.7.4           3.2.26          Distributed reliable key-value store for the mo...\\nstable/etcd-operator    0.10.3          0.9.4           CoreOS etcd-operator Helm chart for Kubernetes    \\nstable/zetcd            0.1.9           0.0.3           CoreOS zetcd Helm chart for Kubernetes  \\n\\n# \u4e0b\u8f7dhelm\u5305,\u6267\u884c\u5b9a\u5236\\nhelm pull bitnami/etcd\\n\\n# \u4f7f\u7528nodeport, \u7981\u7528rbac\uff0c\u7981\u7528\u5b58\u50a8\\nhelm install etcd bitnami/etcd --set service.type=NodePort --set service.type=NodePort --set auth.rbac.enabled=false --set persistence.enabled=false -n ops-open\\n\\nexport NODE_IP=$(kubectl get nodes --namespace ops-open -o jsonpath=\\"{.items[0].status.addresses[0].address}\\")\\nexport NODE_PORT=$(kubectl get --namespace ops-open -o jsonpath=\\"{.spec.ports[0].nodePort}\\" services etcd)\\nexport ETCDURL=http://$NODE_IP:$NODE_PORT\\necho \\"etcd URL: $ETCDURL\\"\\nexport ECTDCTL_API=3\\netcdctl member list --endpoints=$ETCDURL\\n```"},{"id":"/posts/docker-in-k8s","metadata":{"permalink":"/posts/docker-in-k8s","source":"@site/blog/posts/docker-in-k8s.md","title":"\u5728k8s\u4e2d\u4f7f\u7528docker in docker","description":"\u4f7f\u7528docker in docker","date":"2020-05-29T08:55:18.000Z","formattedDate":"2020\u5e745\u670829\u65e5","tags":[{"label":"docker","permalink":"/tags/docker"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.5266666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5728k8s\u4e2d\u4f7f\u7528docker in docker","date":"2020-05-29T08:55:18.000Z","description":"\u4f7f\u7528docker in docker","tags":["docker","kubernetes"]},"prevItem":{"title":"Etcd\u4f7f\u7528\u5165\u95e8","permalink":"/posts/etcd-op"},"nextItem":{"title":"Prometheus Operator \u521d\u4f53\u9a8c","permalink":"/posts/prometheus-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u90e8\u7f72\\n\\n```yaml\\n# docker.yaml\\napiVersion: apps/v1\\nkind: StatefulSet\\nmetadata:\\n  name: docker-api\\n  namespace: gaea-op\\n  annotations:\\n    k8s.gaea.me/workload: app\\n  labels:\\n    k8s.gaea.me/name: docker-api\\nspec:\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        k8s.gaea.me/name: docker-api\\n    spec:\\n      containers:\\n        - name: dockerd\\n          image: \'docker:18.09.9-dind\'\\n          securityContext:\\n            privileged: true\\n        - name: docker-cli\\n          image: \'docker:18.09.9\'\\n          env:\\n            - name: DOCKER_HOST\\n              value: tcp://127.0.0.1:2375\\n          command: [\\"/bin/sh\\"]\\n          args: [\\"-c\\", \\"docker info >/dev/null 2>&1; while [ $? -ne 0 ] ; do sleep 3; docker info >/dev/null 2>&1; done; docker pull library/busybox:latest; docker save -o busybox-latest.tar library/busybox:latest; docker rmi library/busybox:latest; while true; do sleep 86400; done\\"]\\n  selector:\\n    matchLabels:\\n      k8s.gaea.me/name: docker-api\\n  serviceName: docker-api\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: docker-api\\n  namespace: gaea-op\\nspec:\\n  ports:\\n    - name: tcp-2375\\n      port: 2375\\n  clusterIP: None\\n  selector:\\n    k8s.gaea.me/name: docker-api\\n```\\n\\n```bash\\nkubectl apply -f docker.yaml\\n```\\n\\n## \u4f7f\u7528\\n\\n```bash\\n# docker api\u5730\u5740: docker-api-0.docker-api.gaea-op.svc.cluster.local\\nkubectl exec -it pods/docker-api-0   -n gaea-op -c docker-cli -- ash\\n/ # docker info\\n```\\n\\n## go api\u64cd\u4f5c"},{"id":"/posts/prometheus-install","metadata":{"permalink":"/posts/prometheus-install","source":"@site/blog/posts/prometheus-install.md","title":"Prometheus Operator \u521d\u4f53\u9a8c","description":"Prometheus Operator \u521d\u4f53\u9a8c","date":"2020-05-25T14:55:18.000Z","formattedDate":"2020\u5e745\u670825\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"prometheus","permalink":"/tags/prometheus"}],"readingTime":0.34,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Prometheus Operator \u521d\u4f53\u9a8c","date":"2020-05-25T14:55:18.000Z","description":"Prometheus Operator \u521d\u4f53\u9a8c","tags":["kubernetes","prometheus"]},"prevItem":{"title":"\u5728k8s\u4e2d\u4f7f\u7528docker in docker","permalink":"/posts/docker-in-k8s"},"nextItem":{"title":"helm\u5c0f\u8bb0","permalink":"/posts/helm"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u901a\u8fc7Operator\u521b\u5efaPrometheus\\n\\n## \u811a\u672c\u90e8\u7f72\\n\\n```\\n#  \u5728\u4e4b\u524d\u7684\u57fa\u7840\u4e0a\uff0c\u914d\u7f6e\u4e86\u5b58\u50a8storageclass\\ngit clone https://github.com/ysicing/prometheus.git\\ncd prometheus\\n# prometheus-service/prometheus-storageclass.yaml #\u914d\u7f6e\u5b58\u50a8\\nbash -x ./deploy.sh\\n# \u5728\u7ba1\u7406\u8282\u70b9\u6267\u884c\uff0c\u5982\u6709\u62a5\u9519\uff0c\u5728\u6267\u884c\u4e00\u4e0b\\n```\\n\\n\u4e0e[\u5b98\u65b9](https://github.com/coreos/kube-prometheus/tree/master/manifests)\u7684\u533a\u522b\u652f\u6301\u4e86\u6570\u636e\u6301\u4e45\u5316\u548c\u57df\u540d\u914d\u7f6e,\u90e8\u5206\u76d1\u63a7\u7ec4\u4ef6\u5982etcd\u7b49\\n\\n## ergo\u5b89\u88c5\\n\\n```\\nergo install prom  --ip 10.147.20.42 --pass oac5eeWosie7aiP5Um2AeKahkaiCeigh  --domain godu.dev\\n```"},{"id":"/posts/helm","metadata":{"permalink":"/posts/helm","source":"@site/blog/posts/helm.md","title":"helm\u5c0f\u8bb0","description":"\u8bb0\u5f55helm\u76f8\u5173\u4f7f\u7528","date":"2020-05-23T18:55:18.000Z","formattedDate":"2020\u5e745\u670823\u65e5","tags":[{"label":"helm","permalink":"/tags/helm"}],"readingTime":0.22,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"helm\u5c0f\u8bb0","date":"2020-05-23T18:55:18.000Z","description":"\u8bb0\u5f55helm\u76f8\u5173\u4f7f\u7528","tags":["helm"]},"prevItem":{"title":"Prometheus Operator \u521d\u4f53\u9a8c","permalink":"/posts/prometheus-install"},"nextItem":{"title":"ergo\u5b89\u88c5ingress\u5b89\u88c5","permalink":"/posts/ingress-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5b89\u88c5\\n\\n> \u5b89\u88c5docker\u65f6\u9ed8\u8ba4\u5df2\u7ecf\u5b89\u88c5\u4e86helm,\u5982\u679c\u4e0d\u662f\u6700\u65b0\u7248\u672c\u8bf7`upgrade-tools`\\n\\n```bash\\nupgrade-tools\\n# \u7248\u672c\\nhelm version\\nversion.BuildInfo{Version:\\"v3.2.1\\", GitCommit:\\"fe51cd1e31e6a202cba7dead9552a6d418ded79a\\", GitTreeState:\\"clean\\", GoVersion:\\"go1.13.10\\"}\\n```\\n\\n## \u914d\u7f6ehelm\u955c\u50cf\u5e93\\n\\n```bash\\n# \u81ea\u52a8\\nhelminit\\n\\n# \u624b\u52a8\\nhelm repo add stable http://mirror.azure.cn/kubernetes/charts/\\nhelm repo add incubator http://mirror.azure.cn/kubernetes/charts-incubator/\\n```"},{"id":"/posts/ingress-install","metadata":{"permalink":"/posts/ingress-install","source":"@site/blog/posts/ingress-install.md","title":"ergo\u5b89\u88c5ingress\u5b89\u88c5","description":"k8s\u90e8\u7f72ingress","date":"2020-05-22T19:55:18.000Z","formattedDate":"2020\u5e745\u670822\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"ingress","permalink":"/tags/ingress"}],"readingTime":0.6433333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"ergo\u5b89\u88c5ingress\u5b89\u88c5","date":"2020-05-22T19:55:18.000Z","description":"k8s\u90e8\u7f72ingress","tags":["kubernetes","ingress"]},"prevItem":{"title":"helm\u5c0f\u8bb0","permalink":"/posts/helm"},"nextItem":{"title":"\u5982\u4f55\u5728\u7ebf\u91cd\u88c5Debian11","permalink":"/posts/debian-reinstall"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u57df\u540d\u76f8\u5173\\n\\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u672c\u5730\u73af\u5883\u57df\u540d\u6d4b\u8bd5\\n\\n```\\n*.k7s.xyz 11.11.11.111\\n*.slb.k7s.xyz 11.11.11.112\\n*.vlb.k7s.xyz 11.11.11.113\\n```\\n\\n## ergo\u5b89\u88c5\\n\\n```\\nUsage:\\n  ergo install ingress [flags]\\n\\nFlags:\\n  -h, --help                 help for ingress\\n      --ingresstype string   ingress: nginx-ingress, traefik, ingress-nginx (default \\"ingress-nginx\\")\\n\\nGlobal Flags:\\n      --config string   config file (default is $HOME/.doge/config.yaml)\\n      --ip strings      \u9700\u8981\u5b89\u88c5\u8282\u70b9ip (default [11.11.11.111])\\n      --pass string     \u7ba1\u7406\u5458\u5bc6\u7801\\n      --pk string       \u7ba1\u7406\u5458\u79c1\u94a5\\n      --regioncn        \u9ed8\u8ba4\u4f7f\u7528gitee\u6e90 (default true)\\n      --user string     \u7ba1\u7406\u5458 (default \\"root\\")\\n```\\n\\n\\n\u793a\u4f8b: `ergo install ingress --ip 10.147.20.43 --pk ~/.ssh/id_rsa --regioncn --ingresstype traefik`\\n\\n## \u5386\u53f2\u5b89\u88c5\\n\\n### NGINX Ingress Controller (ingress-nginx)\\n\\n\u4f7f\u7528helm\u65b9\u5f0f\u5b89\u88c5\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k8s/helm/nginx-ingress/ns.yaml\\n# \u5b89\u88c5\\nhelm install nginx-ingress -f https://sh.ysicing.me/k8s/helm/nginx-ingress/nginx-ingress-1.34.2.yaml stable/nginx-ingress -n ingress-nginx\\n# \u5347\u7ea7\\nhelm upgrade nginx-ingress -f https://sh.ysicing.me/k8s/helm/nginx-ingress/nginx-ingress-1.34.2.yaml stable/nginx-ingress -n ingress-nginx\\n```\\n\\n### NGINX Ingress Controllers (kubernetes-ingress)\\n\\n```\\nhelm repo add nginx-stable https://helm.nginx.com/stable\\nhelm repo update\\nhelm install nginx-ingress -f https://sh.ysicing.me/k8s/helm/nginxnc-ingress/nginx-ingress-0.4.3.yaml nginx-stable/nginx-ingress -n ingress-nginx\\n# \u6216\u8005\\nkubectl apply -f https://sh.ysicing.me/k7s/install/nginx-ingress/nginx-ingress.yml\\n```\\n\\n\u90e8\u7f72\u6587\u6863 [nginxinc/kubernetes-ingress v1.6.0](https://github.com/nginxinc/kubernetes-ingress/tree/v1.6.0/deployments)"},{"id":"/posts/debian-reinstall","metadata":{"permalink":"/posts/debian-reinstall","source":"@site/blog/posts/debian-reinstall.md","title":"\u5982\u4f55\u5728\u7ebf\u91cd\u88c5Debian11","description":"\u4ecb\u7ecd\u5982\u4f55\u7ed9\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\u673a\u5668\u5728\u7ebf\u91cd\u88c5Debian\uff0c\u4ee5\u8f7b\u91cf\u4e91\u4e3a\u4f8b","date":"2020-05-22T14:55:18.000Z","formattedDate":"2020\u5e745\u670822\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":0.93,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5982\u4f55\u5728\u7ebf\u91cd\u88c5Debian11","date":"2020-05-22T14:55:18.000Z","description":"\u4ecb\u7ecd\u5982\u4f55\u7ed9\u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\u673a\u5668\u5728\u7ebf\u91cd\u88c5Debian\uff0c\u4ee5\u8f7b\u91cf\u4e91\u4e3a\u4f8b","tags":["debian"]},"prevItem":{"title":"ergo\u5b89\u88c5ingress\u5b89\u88c5","permalink":"/posts/ingress-install"},"nextItem":{"title":"docker\u5feb\u901f\u5b89\u88c5","permalink":"/posts/docker"}},"content":"\x3c!-- truncate --\x3e\\n\\n## 1. \u80cc\u666f\\n\\n- \u4e91\u670d\u52a1\u5546\u63d0\u4f9b\u7684\u673a\u5668\u53ef\u80fd\u5b89\u88c5\u4e86\u4e00\u4e9b\u670d\u52a1\u7ec4\u4ef6\uff0c\u5982\u76d1\u63a7\u7b49\u7b49\uff0c\u60f3\u8981\u4e00\u4e2a\u5e72\u51c0\u7684\u73af\u5883\u3002\\n- \u4e00\u6761\u547d\u4ee4\u5feb\u901f\u91cd\u88c5\u5e72\u51c0\u7684Linux\u73af\u5883\\n- \u76ee\u524d\u4ec5\u652f\u6301Debian(\u4e0d\u4f1a\u4e0d\u6253\u7b97\u652f\u6301\u5176\u4ed6\u7cfb\u7edf)\\n- \u57fa\u4e8e\u840c\u5496\u5927\u4f6c\u7684\u4e8c\u6b21\u9b54\u6539\\n\\n## 2. \u5b9a\u5236\\n\\n- \u9ed8\u8ba4root\u5bc6\u7801 vagrant(\u5b89\u88c5\u5b8c\u6210\u5efa\u8bae\u4fee\u6539\uff0c\u7981\u6b62\u5bc6\u7801\u767b\u5f55)\\n- \u9ed8\u8ba4\u914d\u7f6e\u6e90\u4e3a`mirrors.tuna.tsinghua.edu.cn`,\u9ed8\u8ba4\u6dfb\u52a0\u4e86`security`,`backports`\\n- \u9ed8\u8ba4\u65f6\u533a\u4e3a`Asia/Shanghai`\\n- \u9ed8\u8ba4\u5b89\u88c5\u4e86`curl wget openssh-server sudo sed apt-transport-https net-tools`\u7b49\u5e38\u7528\u5de5\u5177\\n- \u540c\u65f6\u9ed8\u8ba4\u652f\u6301\u81ea\u5b9a\u4e49\u5bc6\u7801\\n\\n## 3. \u5b89\u88c5\\n\\n```bash\\ncurl -sSL https://sh.ysicing.me/reinstall/install.sh | bash\\n# \u6307\u5b9a\u53c2\u6570\\n# -p \u9ed8\u8ba4\u5bc6\u7801vagrant\\n# -m \u9ed8\u8ba4\u6e90aliyun\\nbash <(wget --no-check-certificate -qO- \'https://sh.ysicing.me/reinstall/install.sh\') -p thah6oob7KieChie\\n```\\n\\n### 3.1 \u7279\u6b8a: \u81ea\u5b9a\u4e49\u786c\u76d8\\n\\n> \u5b58\u5728\u591a\u4e2a\u786c\u76d8\u65f6\uff0c\u9700\u8981\u4e0b\u8f7d [`https://sh.ysicing.me/reinstall/install-sdev.sh`](https://sh.ysicing.me/reinstall/install-sdev.sh)\u6587\u4ef6\uff0c\u7f16\u8f91\u5982\u4e0b\u90e8\u5206\u5373\u53ef\\n\\n```bash\\n# -p \u9ed8\u8ba4\u5bc6\u7801vagrant\\n# -m \u9ed8\u8ba4\u6e90aliyun\\n# -s \u6307\u5b9a\u542f\u52a8\u786c\u76d8\\nbash <(wget --no-check-certificate -qO- \'https://sh.ysicing.me/reinstall/install-sdev.sh\') -p thah6oob7KieChie -s /dev/sdb\\n```\\n\\n## 4. \u53c2\u8003\u9644\u5f55\\n\\n[[ Linux VPS ] Debian/Ubuntu/CentOS \u7f51\u7edc\u5b89\u88c5/\u91cd\u88c5\u7cfb\u7edf/\u7eaf\u51c0\u5b89\u88c5 \u4e00\u952e\u811a\u672c](https://moeclub.org/2018/04/03/603/?spm=ysicing.me)"},{"id":"/posts/docker","metadata":{"permalink":"/posts/docker","source":"@site/blog/posts/docker.md","title":"docker\u5feb\u901f\u5b89\u88c5","description":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5docker","date":"2020-05-19T14:55:18.000Z","formattedDate":"2020\u5e745\u670819\u65e5","tags":[{"label":"docker","permalink":"/tags/docker"},{"label":"cri","permalink":"/tags/cri"}],"readingTime":0.47,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"docker\u5feb\u901f\u5b89\u88c5","date":"2020-05-19T14:55:18.000Z","description":"\u4f7f\u7528ergo\u5feb\u901f\u5b89\u88c5docker","tags":["docker","cri"]},"prevItem":{"title":"\u5982\u4f55\u5728\u7ebf\u91cd\u88c5Debian11","permalink":"/posts/debian-reinstall"},"nextItem":{"title":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","permalink":"/posts/aliyun-ack-ingress"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5b89\u88c5docker\\n\\n```\\ncurl -fsSL https://sh.ysicing.me/install/docker.sh | bash \\n\u6216\u8005\\nergo install docker -h\\n```\\n\\n\u505a\u4e86\u5982\u4e0b\u8bbe\u7f6e\\n\\n```json\\n{\\n  \\"exec-opts\\": [\\"native.cgroupdriver=systemd\\"],\\n  \\"registry-mirrors\\": [\\"https://dyucrs4l.mirror.aliyuncs.com\\"],\\n  \\"bip\\": \\"169.254.0.1/24\\",\\n  \\"max-concurrent-downloads\\": 10,\\n  \\"log-driver\\": \\"json-file\\",\\n  \\"log-level\\": \\"warn\\",\\n  \\"log-opts\\": {\\n    \\"max-size\\": \\"20m\\",\\n    \\"max-file\\": \\"2\\"\\n  },\\n  \\"storage-driver\\": \\"overlay2\\"\\n}\\n```\\n\\n## \u5b89\u88c5tools\\n\\n```\\ndocker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir\\n```\\n\\n\u5185\u7f6e\u4e86\\n\\n```bash\\netcdctl\\nhelm(v3)\\nhelminit\\ndocker-compose\\ncalicoctl\\nctop\\ncclear (\u6e05\u7406\u9000\u51fa\u5bb9\u5668)\\ndin (\u8fdb\u5165\u5bb9\u5668 din <cname/>cid> ash/bash(\u9ed8\u8ba4)/sh)\\ndps (\u5bb9\u5668\u72b6\u6001)\\netcdcli (\u7279\u522b\u652f\u6301k8s\u96c6\u7fa4\u7684etcd)\\nkbtoken (\u67e5\u770bkuboard admin\u7528\u6237token)\\nkdtoken (\u67e5\u770bdashboard-admin \u7528\u6237token)\\n\\nistioctl\\nlinkerd\\n\\nupgrade-tools // \u5347\u7ea7\u4e8c\u8fdb\u5236\\n```"},{"id":"/posts/aliyun-ack-ingress","metadata":{"permalink":"/posts/aliyun-ack-ingress","source":"@site/blog/posts/aliyun-ack-ingress.md","title":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","description":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"ingress","permalink":"/tags/ingress"},{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"ack","permalink":"/tags/ack"}],"readingTime":0.5666666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","date":"2020-05-18T14:55:18.000Z","description":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","tags":["ingress","kubernetes","ack"]},"prevItem":{"title":"docker\u5feb\u901f\u5b89\u88c5","permalink":"/posts/docker"},"nextItem":{"title":"\u77e5\u8bc6\u70b9","permalink":"/posts/faq"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u5148\u5df2\u7ecf\u521b\u5efa\u597d\u5185\u7f51slb,\u83b7\u53d6slb\u7684ID\u4e3a`lb-xxxx`\\n\\n```\\n# intranet-slb-ingress.yml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  # \u8fd9\u91cc\u670d\u52a1\u53d6\u540d\u4e3anginx-ingress-lb-intranet\\n  name: nginx-ingress-lb-intranet\\n  namespace: kube-system\\n  labels:\\n    app: nginx-ingress-lb-intranet\\n  annotations:\\n    # \u6307\u660eSLB\u5b9e\u4f8b\u5730\u5740\u7c7b\u578b\u4e3a\u79c1\u7f51\u7c7b\u578b\\n    service.beta.kubernetes.io/alicloud-loadbalancer-address-type: intranet\\n    # \u4fee\u6539\u4e3a\u60a8\u7684\u79c1\u7f51SLB\u5b9e\u4f8bID\\n    service.beta.kubernetes.io/alicloud-loadbalancer-id: lb-xxxx\\n    # \u662f\u5426\u81ea\u52a8\u521b\u5efaSLB\u7aef\u53e3\u76d1\u542c\uff08\u4f1a\u8986\u5199\u5df2\u6709\u7aef\u53e3\u76d1\u542c\uff09\uff0c\u4e5f\u53ef\u624b\u52a8\u521b\u5efa\u7aef\u53e3\u76d1\u542c\\n    service.beta.kubernetes.io/alicloud-loadbalancer-force-override-listeners: \'true\'\\nspec:\\n  type: LoadBalancer\\n  # route traffic to other nodes\\n  externalTrafficPolicy: \\"Cluster\\"\\n  ports:\\n  - port: 80\\n    name: http\\n    targetPort: 80\\n  - port: 443\\n    name: https\\n    targetPort: 443\\n  selector:\\n    # select app=ingress-nginx pods\\n    app: ingress-nginx\\n```\\n\\n\u751f\u6548\u5185\u7f51slb\\n\\n```\\nkubectl apply -f intranet-slb-ingress.yml\\n```\\n\\n\u67e5\u770bslb\\n\\n```\\nnginx-ingress-lb                                  LoadBalancer   172.x.x.x    39.x.x.x   80:31110/TCP,443:31574/TCP   20h\\nnginx-ingress-lb-intranet                         LoadBalancer   172.x.x.x    10.x.x.x   80:30740/TCP,443:30852/TCP   73m\\n```"},{"id":"/posts/faq","metadata":{"permalink":"/posts/faq","source":"@site/blog/posts/faq.md","title":"\u77e5\u8bc6\u70b9","description":"\u77e5\u8bc6\u70b9","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"misc","permalink":"/tags/misc"}],"readingTime":0.15666666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u77e5\u8bc6\u70b9","date":"2020-05-18T14:55:18.000Z","description":"\u77e5\u8bc6\u70b9","tags":["misc"]},"prevItem":{"title":"ACK \u6dfb\u52a0\u5185\u7f51\u8d1f\u8f7d\u5747\u8861","permalink":"/posts/aliyun-ack-ingress"},"nextItem":{"title":"Go\u57fa\u7840","permalink":"/posts/go-study-ch1"}},"content":"\x3c!-- truncate --\x3e\\n\\n### docker npm\u5b89\u88c5\u95ee\u9898\\n\\n```\\nnpm config set unsafe-perm true\\n```\\n\\n### git\u64cd\u4f5c\\n\\n```\\n# \u6539\u5d29\u4e86\\ngit fetch --all\\ngit reset --hard origin/master\\n# \u653e\u5f03\u672c\u5730\u5168\u90e8/\u5355\u4e2a\\ngit checkout . \\ngit checkout -- filename\\n```"},{"id":"/posts/go-study-ch1","metadata":{"permalink":"/posts/go-study-ch1","source":"@site/blog/posts/go-study-ch1.md","title":"Go\u57fa\u7840","description":"Go\u57fa\u7840","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"go","permalink":"/tags/go"}],"readingTime":8.136666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Go\u57fa\u7840","date":"2020-05-18T14:55:18.000Z","description":"Go\u57fa\u7840","tags":["go"]},"prevItem":{"title":"\u77e5\u8bc6\u70b9","permalink":"/posts/faq"},"nextItem":{"title":"helm\u90e8\u7f72docker registry","permalink":"/posts/helm-docker-registry"}},"content":"\x3c!-- truncate --\x3e\\n\\n### \u53d8\u91cf\u548c\u5e38\u91cf\\n\\n\u5173\u952e\u5b57&\u4fdd\u7559\u5b57\\n\\n```\\n# 25\u4e2a\u4fdd\u7559\u5b57\\n    break        default      func         interface    select\\n    case         defer        go           map          struct\\n    chan         else         goto         package      switch\\n    const        fallthrough  if           range        type\\n    continue     for          import       return       var\\n\\n# 37\u4e2a\u4fdd\u7559\u5b57\\n\\nConstants:    true  false  iota  nil\\n\\nTypes:  int  int8  int16  int32  int64  \\n        uint  uint8  uint16  uint32  uint64  uintptr\\n        float32  float64  complex128  complex64\\n        bool  byte  rune  string  error\\n\\nFunctions:  make  len  cap  new  append  copy  close  delete\\n            complex  real  imag\\n            panic  recover\\n```\\n\\n\u6ce8\u610f\\n\\n```\\n1. \u51fd\u6570\u5916\u7684\u6bcf\u4e2a\u8bed\u53e5\u90fd\u5fc5\u987b\u4ee5\u5173\u952e\u5b57\u5f00\u59cb\uff08var\u3001const\u3001func\u7b49\uff09\\n2. :=\u4e0d\u80fd\u4f7f\u7528\u5728\u51fd\u6570\u5916\u3002\\n3. _\u591a\u7528\u4e8e\u5360\u4f4d\uff0c\u8868\u793a\u5ffd\u7565\u503c(\u533f\u540d\u53d8\u91cf\uff0c\u4e0d\u5360\u7528\u547d\u540d\u7a7a\u95f4\uff0c\u4e0d\u4f1a\u5206\u914d\u5185\u5b58\uff0c\u4e0d\u9700\u8981\u5b58\u5728\u91cd\u590d\u7533\u660e)\\n```\\n\\n#### \u53d8\u91cf\\n\\n```go\\npackage main\\n\\nimport (\\n\\t\\"fmt\\"\\n)\\n// \u5168\u5c40\u53d8\u91cfm\\nvar m = 100\\n\\nfunc main() {\\n\\tn := 10\\n\\tm := 200 // \u6b64\u5904\u58f0\u660e\u5c40\u90e8\u53d8\u91cfm\\n\\tfmt.Println(m, n)\\n}\\n```\\n\\n#### \u5e38\u91cf\\n\\n\u5e38\u91cf\u662f\u6052\u5b9a\u4e0d\u53d8\u7684\u503c\\n\\n```go\\nconst pi = 3.1415\\n\\nconst (\\n    // const\u58f0\u660e\u591a\u4e2a\u5e38\u91cf\u65f6\uff0c\u5982\u679c\u7701\u7565\u4e86\u503c\u5219\u8868\u793a\u548c\u4e0a\u9762\u4e00\u884c\u7684\u503c\u76f8\u540c\\n    p1 = 3.1415\\n    p2 // 3.1415\\n    p3 // 3.1415\\n)\\n```\\n\\n#### iota\\n\\niota\u662fgo\u8bed\u8a00\u7684\u5e38\u91cf\u8ba1\u6570\u5668\uff0c\u53ea\u80fd\u5728\u5e38\u91cf\u7684\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u3002iota\u5728const\u5173\u952e\u5b57\u51fa\u73b0\u65f6\u5c06\u88ab\u91cd\u7f6e\u4e3a0\u3002const\u4e2d\u6bcf\u65b0\u589e\u4e00\u884c\u5e38\u91cf\u58f0\u660e\u5c06\u4f7fiota\u8ba1\u6570\u4e00\u6b21(iota\u53ef\u7406\u89e3\u4e3aconst\u8bed\u53e5\u5757\u4e2d\u7684\u884c\u7d22\u5f15)\\n\\n```go\\nconst (\\n    n1 = iota // 0\\n    n2 // 1\\n    n3 // 2\\n    _   // \u8df3\u8fc7\u67d0\u4e9b\u503c\\n    n4 // 3\\n    n5 = 10 // 10\\n    n6 // 4\\n)\\n\\nconst (\\n    _ = iota // 0\\n    KB = 1 << (10 * iota) // 1 1<<10 2^10 1024\\n    MB = 1 << (10 * iota) // 2 1<<20 2^20 1024*1024\\n)\\n\\nconst (\\n    a, b = iota + 1, iota + 2 // 1,2\\n    c, d  // 2, 3\\n)\\n```\\n\\n### \u57fa\u672c\u6570\u636e\u7c7b\u578b\\n\\n```\\npackage main\\n\\nimport (\\n    \\"fmt\\"\\n    \\"math\\"\\n)\\n\\nfunc main() {\\n\\tvar a int = 17 // int \u578b (int64)\\n\\tfmt.Printf(\\"%d \\\\n\\", a) // 17 \u5341\u8fdb\u5236\\n\\tfmt.Printf(\\"%b \\\\n\\", a) // 10001 \u4e8c\u8fdb\u5236\\n\\tfmt.Printf(\\"%o \\\\n\\", a) // 021 \u516b\u8fdb\u5236\\n\\tfmt.Printf(\\"%x \\\\n\\", a) // 0x11 16\u7981\u6b62\\n\\n    fmt.Printf(\\"%.2f \\\\n\\", math.Pi) // \u9ed8\u8ba4\u90fd\u662f\u6d6e\u70b9\u578bfloat64\\n\\n    var s = \\"666\\"\\n\\tfmt.Printf(\\"%T \\\\n\\", s) // \u7c7b\u578b string \\n\\tfmt.Printf(\\"%v \\\\n\\", s) // \u503c 666\\n\\tfmt.Printf(\\"%#v \\\\n\\", s) // \u503c \\"666\\"\\n}\\n```\\n\\n\u6ce8: \\n\\n```\\n\u5e03\u5c14\u7c7b\u578b\u53d8\u91cf\u7684\u9ed8\u8ba4\u503c\u4e3afalse\u3002\\nGo \u8bed\u8a00\u4e2d\u4e0d\u5141\u8bb8\u5c06\u6574\u578b\u5f3a\u5236\u8f6c\u6362\u4e3a\u5e03\u5c14\u578b.\\n\u5e03\u5c14\u578b\u65e0\u6cd5\u53c2\u4e0e\u6570\u503c\u8fd0\u7b97\uff0c\u4e5f\u65e0\u6cd5\u4e0e\u5176\u4ed6\u7c7b\u578b\u8fdb\u884c\u8f6c\u6362\\n```\\n\\n### \u5b57\u7b26\u4e32\\n\\n\u5b57\u7b26\u4e32\u9700\u8981\u4f7f\u7528`\\"`\\n\\n```\\ns1 := \\"ysicing\\"\\n```\\n\\n\u591a\u884c\u5b57\u7b26\u4e32\u9700\u8981\u4f7f\u7528`\\\\``\\n\\n```\\ns1 := `\u725b\\n\u725b \u725b\\n\u725b\\n`\\n```\\n\\n\\n\\n#### \u5b57\u7b26\u4e32\u64cd\u4f5c\\n\\n```go\\npackage main\\n\\nimport (\\n\\t\\"fmt\\"\\n\\t\\"strings\\"\\n)\\n\\nfunc main() {\\n\\ta := \\"666\\"\\n\\tb := \\"777\\"\\n\\tc := a + \\"-\\" + b\\n\\tfmt.Println(len(a))                    // len \u957f\u5ea6\\n\\tfmt.Println(fmt.Sprintf(\\"%s%s\\", a, b)) // \u62fc\u63a5\\n\\tfmt.Println(a + b)                     // \u62fc\u63a5\\n\\tfmt.Print(strings.Split(c, \\"-\\")[0])    // \u5206\u5272\\n\\tres := strings.Split(c, \\"-\\")           // \u5206\u5272\\n\\tfmt.Println(res)\\n\\n\\tfmt.Println(strings.HasPrefix(c, \\"6\\"), strings.HasSuffix(c, \\"6\\")) //\u524d\u7f00/\u540e\u7f00\u5224\u65ad\\n\\n\\ts := \\"China\u4e07\u5c81\\"\\n\\tfor i := 0; i < len(s); i++ { // byte\\n\\t\\tfmt.Printf(\\"%T %v(%c) \\\\n\\", s[i], s[i], s[i])\\n\\t}\\n\\tfmt.Println()\\n\\tfor _, j := range s { // rune\\n\\t\\tfmt.Printf(\\"%T %v(%c) \\\\n\\", j, j, j)\\n\\t}\\n\\tfmt.Println()\\n}\\n```\\n\\n1. uint8\u7c7b\u578b, \u6216\u8005\u53eb byte\u578b \u4ee3\u8868\u4e86ASCII\u7801\u7684\u4e00\u4e2a\u5b57\u7b26.\\n2. rune\u7c7b\u578b, \u4ee3\u8868\u4e00\u4e2a UTF-8\u5b57\u7b26(\u4e2d\u6587), \u5b9e\u9645\u662f\u4e00\u4e2aint32.\\n3. \u56e0\u4e3aUTF8\u7f16\u7801\u4e0b\u4e00\u4e2a\u4e2d\u6587\u6c49\u5b57\u75313~4\u4e2a\u5b57\u8282\u7ec4\u6210,\u4e00\u4e2arune\u5b57\u7b26\u7531\u4e00\u4e2a\u6216\u591a\u4e2abyte\u7ec4\u6210.\\n\\n### \u6d41\u7a0b\u63a7\u5236\\n\\n#### if\\n\\n```\\nif \u8868\u8fbe\u5f0f1 {\\n    \u5206\u652f1\\n} else if \u8868\u8fbe\u5f0f2 {\\n    \u5206\u652f2\\n} else{\\n    \u5206\u652f3\\n}\\n```\\n\\n#### for\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc main() {\\n\\t// \u57fa\u672c\u683c\u5f0f\\n\\tfor i := 1; i <= 3; i++ {\\n\\t\\tfmt.Println(i)\\n\\t}\\n\\n\\tj := 1\\n\\tfor ; j <= 3; j++ {\\n\\t\\tfmt.Println(j)\\n\\t}\\n\\n\\tk := 1\\n\\tfor k <= 3 {\\n\\t\\tfmt.Println(k)\\n\\t\\tk++\\n\\t}\\n\\n\\ts := \\"HellGo\\"\\n\\tfor i, j := range s {\\n\\t\\tfmt.Printf(\\"%d---\x3e%v(%T)--\x3e%c\\\\n\\", i, j, j, j) // rune\\n\\t}\\n\\n\\t// \u6b7b\u5faa\u73af\\n\\t//for {\\n\\t//\\tfmt.Println(\\"666\\")\\n\\t//}\\n}\\n```\\n\\n#### switch case\\n\\n\u7b80\u5316\u5224\u65ad\\n\\n```\\na := 4\\nswitch a {\\n    case a < 1:\\n        fmt.Println(\\"1\\")\\n    case 2,3:\\n        fmt.Println(\\"2\\")\\n    default:\\n        fmt.Println(\\"3\\") // 3\\n} \\n\\nb := 3\\nswitch a {\\n    case a < 1:\\n        fmt.Println(\\"1\\")\\n    case 2,3:\\n        fmt.Println(\\"2\\")\\n        fallthrough // \u53ef\u4ee5\u6267\u884c\u6ee1\u8db3\u6761\u4ef6\u7684case\u7684\u4e0b\u4e00\u4e2acase, \u4e86\u89e3\u5373\u53ef\\n    default:\\n        fmt.Println(\\"3\\") \\n} \\n\\n// 23\\n\\n```\\n\\n#### goto\\n\\n```go\\nfunc main() {\\n\\tfor i := 1; i <= 9999; i++ {\\n\\t\\tfor j := 3000; j <= i; j++ {\\n\\t\\t\\tif j < i {\\n\\t\\t\\t\\tfmt.Printf(\\"%d * %d = %d \\", i, j, i*j)\\n\\t\\t\\t} else if j == i {\\n\\t\\t\\t\\tfmt.Printf(\\"%d * %d = %d\\\\n\\", i, j, i*j)\\n\\t\\t\\t\\tgoto breakTag\\n\\t\\t\\t}\\n\\t\\t}\\n\\t}\\n\\nbreakTag: // label\\n\\tfmt.Println(\\"end\\")\\n}\\n```\\n\\n### \u8fd0\u7b97\u7b26\\n\\n\\n\u7b97\u6570\u8fd0\u7b97\u7b26: + - * / %\\n\u5173\u7cfb\u8fd0\u7b97\u7b26: == != > >= < << (\u7ed3\u679c\u4e3abool\u503c)\\n\u903b\u8f91\u8fd0\u7b97\u7b26: && || ! (\u7ed3\u679c\u4e3abool\u503c)\\n\u4f4d\u8fd0\u7b97\u7b26: & (\u76f8\u4e0e \u540c\u4e3a1\u4e3a1)\uff5c(\u76f8\u6216 \u67091\u4e3a1) ^\uff08\u76f8\u5f02 \u6216\u4e0d\u540c\u4e3a1\uff09 << (\u4e582\u7684n\u6b21\u65b9)  >> (\u96642\u7684n\u6b21\u65b9)\\n\u8d4b\u503c\u8fd0\u7b97\u7b26: \u5148\u5176\u4ed6\u8fd0\u7b97\u518d\u8d4b\u503c\\n\\n```\\n5 << 2 // 5 --- 101 \u5de6\u79fb 2 10100 --- 10 5 * 2^ 1\\n\\n5 >> 2 // 5 --- 101 \u53f3\u79fb 2 001 --- 1 \\n```\\n\\n\u6ce8: `++`,`--` \u5355\u72ec\u8bed\u53e5\uff0c\u4e0d\u662f\u8fd0\u7b97\u7b26\\n\\n### \u6570\u7ec4\\n\\n```\\nvar \u6570\u7ec4\u53d8\u91cf\u540d [\u5143\u7d20\u6570\u91cf]T // \u4e00\u65e6\u5b9a\u4e49\uff0c\u957f\u5ea6\u4e0d\u80fd\u53d8\\nvar a [3]int\\n```\\n\\n\u6570\u7ec4\u521d\u59cb\u5316\\n\\n```\\nvar a1 [3]int //\u6570\u7ec4\u4f1a\u521d\u59cb\u5316\u4e3aint\u7c7b\u578b\u7684\u96f6\u503c\\nvar a2 = [3]int{1,2} //\u4f7f\u7528\u6307\u5b9a\u7684\u521d\u59cb\u503c\u5b8c\u6210\u521d\u59cb\u5316\\nvar a3 = [...]int{1, 2} // \u8ba9\u7f16\u8bd1\u5668\u6839\u636e\u521d\u59cb\u503c\u7684\u4e2a\u6570\u81ea\u884c\u63a8\u65ad\u6570\u7ec4\u7684\u957f\u5ea6\\na4 := [...]int{1: 1, 3: 5} // \u6307\u5b9a\u7d22\u5f15\u503c\u7684\u65b9\u5f0f\u6765\u521d\u59cb\u5316\u6570\u7ec4 [0, 1, 0 ,3]\\n```\\n\\n\u6570\u7ec4\u904d\u5386\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc main() {\\n    var a = [...]int{1, 2, 3, 4, 5}\\n    // for\u5faa\u73af\u904d\u5386\\n\\tfor i := 0; i < len(a); i++ {\\n\\t\\tfmt.Println(a[i])\\n\\t}\\n    // range\\n\\tfor i, j := range a {\\n\\t\\tfmt.Println(i, j)\\n    }\\n    \\n    b := [...][2]int{\\n        {1,2},\\n        {2,1},\\n    }\\n\\n    for _, i := range b {\\n        for _, j := range i {\\n            fmt.Printf(\\"%d\\\\t\\", j)\\n        }\\n    }\\n}\\n```\\n\\n> \u6570\u7ec4\u662f\u503c\u7c7b\u578b\uff0c\u8d4b\u503c\u548c\u4f20\u53c2\u4f1a\u590d\u5236\u6574\u4e2a\u6570\u7ec4\u3002\u56e0\u6b64\u6539\u53d8\u526f\u672c\u7684\u503c\uff0c\u4e0d\u4f1a\u6539\u53d8\u672c\u8eab\u7684\u503c\u3002\\n\\n### \u5207\u7247slice\\n\\n\u5207\u7247\u662f\u5f15\u7528\u7c7b\u578b\uff0c\u62e5\u6709\u76f8\u540c\u7c7b\u578b\u5143\u7d20\u7684\u53ef\u53d8\u957f\u5ea6\u7684\u5e8f\u5217\\n\\n```\\nvar \u5207\u7247\u540d []\u5207\u7247\u7c7b\u578b\\nvar name []string\\n# \u52a8\u6001\u521b\u5efa\\nmake([]T, size, cap) // T \u7c7b\u578b\uff0csize \u957f\u5ea6\uff0c cap\u5bb9\u91cf(\u4ece\u7b2c\u4e00\u4e2a\u5230\u6700\u540e\u5bb9\u91cf\u6570)\uff0ccap \u53ef\u7701\u5374\\n```\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc main() {\\n\\t//var a []int\\n\\tvar c = []string{\\"a\\", \\"b\\"}\\n\\tfmt.Println(len(c), cap(c))\\n\\td := make([]int, 2, 10)\\n    fmt.Println(len(d), cap(d))\\n    e := d[3:6]\\n    fmt.Println(len(e), cap(e)) // 3\uff0c 3-10 7\\n\\n\\n\\ts1 := make([]int, 3) // [0,0,0]\\n    s2 := s1\\n    // \u62f7\u8d1d\u524d\u540e\u4e24\u4e2a\u53d8\u91cf\u5171\u4eab\u5e95\u5c42\u6570\u7ec4\uff0c\u5bf9\u4e00\u4e2a\u5207\u7247\u7684\u4fee\u6539\u4f1a\u5f71\u54cd\u53e6\u4e00\u4e2a\u5207\u7247\u7684\u5185\u5bb9\\n\\ts2[0] = 100\\n\\tfmt.Println(s1)\\n    fmt.Println(s2)\\n    \\n    // \u904d\u5386\u548cfor\u4e00\u6837\\n    for i := 0; i < len(s1); i++ {\\n\\t\\tfmt.Printf(\\"%d\\\\t\\", s1[i])\\n\\t}\\n\\tfor _, i := range s2 {\\n\\t\\tfmt.Printf(\\"%d\\\\t\\", i)\\n\\t}\\n}\\n```\\n\\n> \u5207\u7247\u7684\u672c\u8d28\u5c31\u662f\u5bf9\u5e95\u5c42\u6570\u7ec4\u7684\u5c01\u88c5\\n\\n#### append\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc main() {\\n\\tvar num []int\\n\\tfor i := 0; i < 20; i++ {\\n        // \u8ffd\u52a0\u4e00\u4e2a\u5143\u7d20\\n\\t\\tnum = append(num, i)\\n\\t\\tfmt.Printf(\\"%v len:%d cap:%d ptr:%p\\\\n\\", num, len(num), cap(num), num)\\n    }\\n    // \u8ffd\u52a0\u591a\u4e2a\u5143\u7d20\\n    num = append(num, 1, 2, 3)\\n\\tfmt.Printf(\\"%v, \\\\n\\", num)\\n    num1 := []int{99, 98}\\n    // \u8ffd\u52a0\u5207\u7247\\n\\tnum = append(num, num1...)\\n\\tfmt.Println(num)\\n}\\n```\\n\\n#### copy\\n\\n```\\ncopy(\u76ee\u6807\u5207\u7247,\u6e90\u5207\u7247)\\n```\\n\\n```go\\nfunc main() {\\n\\t// copy()\u590d\u5236\u5207\u7247\\n\\ta := []int{1, 2, 3, 4, 5}\\n\\tc := make([]int, 5, 5)\\n\\tcopy(c, a)     //\u4f7f\u7528copy()\u51fd\u6570\u5c06\u5207\u7247a\u4e2d\u7684\u5143\u7d20\u590d\u5236\u5230\u5207\u7247c\\n\\tfmt.Println(a) //[1 2 3 4 5]\\n\\tfmt.Println(c) //[1 2 3 4 5]\\n\\tc[0] = 1000\\n\\tfmt.Println(a) //[1 2 3 4 5]\\n    fmt.Println(c) //[1000 2 3 4 5]\\n    \\n    var a = make([]string, 5, 10) // \u5df2\u7ecf\u67095\u4e2a\u4e86\\n\\tfor i := 0; i < 10; i++ {\\n\\t\\ta = append(a, fmt.Sprintf(\\"%v\\", i))\\n\\t}\\n    fmt.Println(a, cap(a), len(a))\\n    \\n    // [     0 1 2 3 4 5 6 7 8 9] 20 15\\n}\\n```\\n\\n### \u6307\u9488\\n\\n- \u53d6\u5730\u5740 `&a`\\n- \u6839\u636e\u5730\u5740\u53d6\u503c `*b`\\n\\n#### make & new\\n\\n\u90fd\u7528\u6765\u7533\u8bf7\u5185\u5b58\\n\\n```\\nmake: slice\uff0cmap\uff0c chan\u7533\u8bf7\u5185\u5b58\uff0c\u8fd4\u56de\u7c7b\u578b\u672c\u8eab\\nnew: \u57fa\u672c\u6570\u636e\u7c7b\u578b\u7533\u8bf7\u5185\u5b58, \u8fd4\u56de\u6307\u9488, \u4e14\u5185\u5b58\u5bf9\u5e94\u7684\u503c\u4e3a\u7c7b\u578b\u96f6\u503c\\n\\na := new(int)\\n```\\n\\n### map\\n\\n\u6563\u5217\u8868(hash)\u5b9e\u73b0, \u65e0\u5e8f\u7684\u57fa\u4e8ekey-value\u7684\u6570\u636e\u7ed3\u6784,\u5f15\u7528\u7c7b\u578b\uff0c\u5fc5\u987b\u521d\u59cb\u5316\u624d\u80fd\u4f7f\u7528.\\n\\n```\\nmap[KeyType]ValueType\\n\\nmake(map[keytype]valuetype, [cap])\\n\\ncode := make(map[string]string, 10)\\n\\ncode[\\"a\\"] = \\"a\\"\\ncode[\\"b\\"] = \\"b\\"\\n\\n# \u5224\u65ad \u503c\u662f\u5426\u5b58\u5728\\nvalue, ok := map[key]\\nif ok {\\n    // \u5b58\u5728\\n} else {\\n    // \u4e0d\u5b58\u5728\\n}\\n\\n// \u5faa\u73af\\nfor k, v := range map {\\n    // k,v v\u53ef\u7701\u7565\\n}\\n```\\n\\n### \u51fd\u6570\\n\\n```\\nfunc \u51fd\u6570\u540d(\u53c2\u6570)(\u8fd4\u56de\u503c){\\n\\n}\\n```\\n\\n\u793a\u4f8b\\n\\n```\\nfunc sum1(x, y int) int {\\n\\tsum := x + y\\n\\treturn sum\\n}\\n\\n// \u8fd4\u56de\u503c\u5b9a\u4e49\u4e86\u8fd4\u56de\u503c\u540d\uff0creturn\u53ef\u7701\u5374\\nfunc sum2(x, y int) (sum int) {\\n\\tsum = x + y\\n\\treturn\\n}\\n\\n// \u53ef\u53d8\u53c2\u6570\uff0c\u53ef\u53d8\u53c2\u6570\u53ef\u6709\u53ef\u65e0\\nfunc sum3(x int, y ...int) {\\n\\tfmt.Println(x)\\n\\tfmt.Println(y) // \u5207\u7247\\n}\\n\\nfunc main() {\\n\\tr1 := sum1(1, 2)\\n\\tr2 := sum2(1, 2)\\n\\tfmt.Println(r1, r2)\\n\\tsum3(1) // 1 []\\n\\tsum3(1, 2) 1 [2]\\n\\tsum3(1, 2, 3) 1 [2,3]\\n}\\n\\n```\\n\\n### defer\\n\\n\u5ef6\u8fdf\u5904\u7406, \u591a\u4e2adefer \u6309\u7167\u5148\u8fdb\u540e\u51fa\u5904\u7406\u3002\\n\\n\u51fd\u6570return\u5206\u6210\u4e24\u6b65\\n\\n- \u8fd4\u56de\u503c\u8d4b\u503c\\n- defer\\n- return\\n\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc deferdemo(name string) {\\n\\tfmt.Println(name)\\n}\\n\\nfunc f1() int {\\n\\tx := 5\\n\\tdefer func() {\\n\\t\\tx++ // \u4fee\u6539x\u4e0d\u662f \u8fd4\u56de\u503c\\n\\t}()\\n\\t// \u8fd4\u56de\u503c\u8d4b\u503c 5\\n\\t// \u4fee\u6539x\u503c\u4e3a 6\\n\\t// retrun 5\\n\\treturn x\\n}\\n\\nfunc f2() (x int) {\\n\\tdefer func() {\\n\\t\\tx++\\n\\t}()\\n\\n\\t// \u8fd4\u56de\u503c\u8d4b\u503c x=5\\n\\t// \u4fee\u6539x\u503c\u4e3a x=6\\n\\t// return 6\\n\\n\\treturn 5 // \u8fd4\u56de\u503c\\n}\\n\\nfunc f3() (y int) {\\n\\tx := 5\\n\\tdefer func() {\\n\\t\\tx++\\n\\t}()\\n\\n\\t// y = x = 5\\n\\t// x = 6\\n\\t// return y = 6\\n\\n\\treturn x\\n}\\n\\nfunc f4() (x int) {\\n\\tdefer func(x int) {\\n\\t\\tx++\\n\\t}(x)\\n\\t// x = 5\\n\\t// \u526f\u672c x = 6\\n\\t// return x\\n\\treturn 5\\n}\\n\\nfunc main() {\\n\\tdeferdemo(\\"666\\")\\n\\tdefer deferdemo(\\"777\\")\\n\\tdeferdemo(\\"888\\")\\n\\tdefer deferdemo(\\"999\\")\\n\\n\\tfmt.Println(f1(), f2(), f3(), f4()) // 5,6,5,5\\n\\n}\\n```\\n\\n### \u533f\u540d\u51fd\u6570\\n\\n```go\\n\\n\\t// \u591a\u6b21\u6267\u884c\\n\\te1 := func(x, y int) {\\n\\t\\tfmt.Println(x)\\n\\t\\tfmt.Println(y)\\n\\t\\tfmt.Println(x + y)\\n\\t}\\n\\te1(2, 4)\\n\\n\\t// \u7acb\u5373\u6267\u884c\uff0c\u53ea\u6267\u884c\u4e00\u6b21\\n\\tfunc(x, y int) {\\n\\t\\tfmt.Println(x * y)\\n\\t}(1, 2)\\n```\\n\\n### \u95ed\u5305\\n\\n1. \u51fd\u6570\u4f5c\u4e3a\u8fd4\u56de\u503c\\n2. \u5916\u90e8\u53d8\u91cf\u5f15\u7528\\n\\n```go\\npackage main\\n\\nimport \\"strings\\"\\n\\nimport \\"fmt\\"\\n\\n// checkMail\\nfunc checkMail(domain string) func(string) string {\\n\\treturn func(name string) string {\\n\\t\\tif strings.HasSuffix(name, domain) {\\n\\t\\t\\treturn name\\n\\t\\t}\\n\\t\\treturn name + \\"@\\" + domain\\n\\n\\t}\\n}\\n\\nfunc main() {\\n\\ttalkFunc := checkMail(\\"@ysicing.me\\")\\n\\tfmt.Println(talkFunc(\\"i\\"))\\n\\tfmt.Println(talkFunc(\\"root@ysicing.me\\"))\\n}\\n```\\n\\n### panic/recover\\n\\n- recover()\u548cdefer\u4e00\u8d77\u4f7f\u7528\\n- defer\u5728panic\u8bed\u53e5\u524d\\n\\n```go\\npackage main\\n\\nimport \\"fmt\\"\\n\\nfunc funcA() {\\n\\tfmt.Println(\\"a\\")\\n}\\n\\nfunc funcB() {\\n\\n\\tdefer func() {\\n\\t\\terr := recover()\\n\\t\\tfmt.Println(err)\\n\\t}()\\n\\tpanic(\\"error\\")\\n\\tfmt.Println(\\"b\\")\\n}\\n\\nfunc funC() {\\n\\tfmt.Println(\\"c\\")\\n}\\n\\nfunc main() {\\n\\tfuncA()\\n\\tfuncB()\\n\\tfunC()\\n}\\n```\\n\\n### \u5360\u4f4d\u7b26\\n\\n```\\n\\tm1 := make(map[string]int, 5)\\n\\tm1[\\"demo\\"] = 1\\n\\tfmt.Printf(\\"%v\\\\n\\", m1) // \u503c\u7684\u9ed8\u8ba4\u683c\u5f0f\\n\\tfmt.Printf(\\"%+v\\\\n\\", m1) // \u7c7b\u4f3c%v, \u7ed3\u6784\u4f53\u4f1a\u52a0\u5b57\u6bb5\u540d\\n\\tfmt.Printf(\\"%#v\\\\n\\", m1)\\t// map[string]int{\\"demo\\":1} \u503cGo\u8bed\u6cd5\\n\\tfmt.Printf(\\"%T\\\\n\\", m1) // map[string]int \u6253\u5370\u7c7b\u578b\\n```\\n\\n### \u7ed3\u6784\u4f53"},{"id":"/posts/helm-docker-registry","metadata":{"permalink":"/posts/helm-docker-registry","source":"@site/blog/posts/helm-docker-registry.md","title":"helm\u90e8\u7f72docker registry","description":"helm\u90e8\u7f72docker registry","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"helm","permalink":"/tags/helm"}],"readingTime":0.7,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"helm\u90e8\u7f72docker registry","date":"2020-05-18T14:55:18.000Z","description":"helm\u90e8\u7f72docker registry","tags":["helm"]},"prevItem":{"title":"Go\u57fa\u7840","permalink":"/posts/go-study-ch1"},"nextItem":{"title":"helm\u90e8\u7f72drone","permalink":"/posts/helm-drone"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u90e8\u7f72docker registry\\n\\n> \u6700\u8fd1\u5927\u9646push\u955c\u50cf\u8001\u662f\u8d85\u65f6\uff0c\u4e8e\u662f\u60f3\u81ea\u5efa\u4e00\u4e2a\uff0c\u4f7f\u7528helm\u65b9\u5f0f, \u548cdrone\u5b89\u88c5\u65b9\u5f0f\u7c7b\u4f3c\\n\\n### \u90e8\u7f72\\n\\n```\\nhelm pull stable/docker-registry\\ntar xf docker-registry-1.9.1.tgz && cd docker-registry/\\n# \u7f16\u8f91values.yaml,\u81ea\u5b9a\u4e49\u914d\u7f6e\\n```\\n\\n```yaml\\n# \u6ce8\u91ca\u90e8\u5206\u4e3a\u8c03\u6574\\nreplicaCount: 1\\nupdateStrategy:\\npodAnnotations: {}\\npodLabels: {}\\nimage:\\n  repository: registry\\n  tag: 2.7.1\\n  pullPolicy: IfNotPresent\\nservice:\\n  name: registry\\n  type: ClusterIP\\n  port: 5000\\n  annotations: {}\\ningress:\\n  enabled: true # \u542f\u7528ingress\\n  path: /\\n  hosts:\\n    - hub.local.godu.dev # \u57df\u540d\\n  annotations:\\n    nginx.ingress.kubernetes.io/proxy-body-size: \\"0\\" # k8s ingress 413\\n    nginx.org/client-max-body-size: \\"0\\" # nginxnc ingress 413\\n  labels: {}\\n  tls:\\n    - secretName: godu.dev # \u8bc1\u4e66\\n      hosts:\\n        - hub.local.godu.dev # \u57df\u540d\\nresources: {}\\npersistence:\\n  accessMode: \'ReadWriteOnce\'\\n  enabled: true\\n  size: 5Gi\\n  existingClaim: registry # \u540cdrone\\nstorage: filesystem\\nsecrets:\\n  haSharedSecret: \\"\\"\\n  htpasswd: \\"\\"\\nconfigData:\\n  version: 0.1\\n  log:\\n    fields:\\n      service: registry\\n  storage:\\n    cache:\\n      blobdescriptor: inmemory\\n  http:\\n    addr: :5000\\n    headers:\\n      X-Content-Type-Options: [nosniff]\\n  health:\\n    storagedriver:\\n      enabled: true\\n      interval: 10s\\n      threshold: 3\\nsecurityContext:\\n  enabled: true\\n  runAsUser: 1000\\n  fsGroup: 1000\\npriorityClassName: \\"\\"\\npodDisruptionBudget: {}\\nnodeSelector: {}\\ntolerations: []\\nextraVolumeMounts: []\\nextraVolumes: []\\n```\\n\\ndeploy\\n\\n```\\nhelm install registry -f values.yaml stable/docker-registry\\n```"},{"id":"/posts/helm-drone","metadata":{"permalink":"/posts/helm-drone","source":"@site/blog/posts/helm-drone.md","title":"helm\u90e8\u7f72drone","description":"helm\u90e8\u7f72drone","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"drone","permalink":"/tags/drone"},{"label":"helm","permalink":"/tags/helm"}],"readingTime":2.8666666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"helm\u90e8\u7f72drone","date":"2020-05-18T14:55:18.000Z","description":"helm\u90e8\u7f72drone","tags":["drone","helm"]},"prevItem":{"title":"helm\u90e8\u7f72docker registry","permalink":"/posts/helm-docker-registry"},"nextItem":{"title":"debian10\u5b89\u88c5k3s","permalink":"/posts/k3s-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u4f7f\u7528Helm\u5b89\u88c5Drone\\n\\n> \u4e00\u4e2a\u6bd4\u8f83\u70ed\u95e8\u7684\u8f7b\u91cf\u7ea7CI/CD\u5f00\u6e90\u5de5\u5177\uff1a[Drone](https://drone.io/)\\n\\n### \u7b80\u4ecb\\n\\n- Drone\u662f\u7528Go\u5f00\u53d1\u7684\u5f00\u6e90\u8f7b\u91cf\u7ea7CI/CD\u5de5\u5177\\n- \u4f7f\u7528\u7b80\u5355\u7684 YAML \u914d\u7f6e\u6587\u4ef6\u6765\u5b9a\u4e49\u548c\u6267\u884c Docker \u5bb9\u5668\u4e2d\u5b9a\u4e49\u7684 Pipeline\\n- \u6784\u6210\u7b80\u5355,\u670d\u52a1\u5360\u7528\u8d44\u6e90\u5c11\\n    - Server\u7aef\u8d1f\u8d23\u8eab\u4efd\u8ba4\u8bc1\uff0c\u4ed3\u5e93\u914d\u7f6e\uff0c\u7528\u6237\u3001Secrets \u4ee5\u53ca Webhook \u76f8\u5173\u7684\u914d\u7f6e\\n    - Agent\u7aef\u7528\u4e8e\u63a5\u53d7\u6784\u5efa\u7684\u4f5c\u4e1a\u548c\u771f\u6b63\u7528\u4e8e\u8fd0\u884c\u7684 Pipeline \u5de5\u4f5c\u6d41\\n- \u5b89\u88c5\u7b80\u5355\uff0c\u652f\u6301\u4e3b\u6d41Git\u6258\u7ba1\u670d\u52a1(github,gitea\u7b49)\\n- \u5b98\u65b9\u6587\u6863\u4e5f\u5f88\u5168\\n\\n### \u73af\u5883\\n\\n- helm v3.0.2\\n- drone 1.6.1\\n- k8s 1.17.0\\n\\n### \u51c6\u5907\u5de5\u4f5c\\n\\n\u6ce8\u518c[Github OAuth\u5e94\u7528](https://github.com/settings/developers)\\n\\n![drone github oauth\u5e94\u7528](/images/drone/github.png)\\n\\n\u83b7\u53d6\u5230github oauth `Client ID`,`Client Secret`\u7559\u7528\u3002\\n\\n\\n### \u521b\u5efa\u6301\u4e45\u5316\u5b58\u50a8\\n\\n```yaml\\n# https://sh.ysicing.me/k8s/demo/pvc.yaml\\napiVersion: v1\\nkind: PersistentVolume\\nmetadata:\\n  name: dronepv\\nspec:\\n  accessModes:\\n  - ReadWriteOnce\\n  capacity:\\n    storage: 2Gi\\n  persistentVolumeReclaimPolicy: Delete\\n  storageClassName: nfs-test\\n  nfs:\\n    server: 192.168.100.101\\n    path: /k8sdata/default-drone-pvc\\n---\\nkind: PersistentVolumeClaim\\napiVersion: v1\\nmetadata:\\n  name: dronepvc\\n  namespace: default\\nspec:\\n  accessModes:\\n    - ReadWriteOnce\\n  resources:\\n    requests:\\n      storage: 2Gi\\n  storageClassName: nfs-test\\n```\\n\\n\u793a\u4f8b\\n\\n```\\n# nfs \u5730\u5740\u9700\u8981\u6309\u9700\u8c03\u6574\u4e00\u4e0b\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/pvc.yaml\\nkubectl get pvc\\n```\\n\\n### \u5b89\u88c5\\n\\n> \u672c\u6587\u4f7f\u7528helm\u65b9\u5f0f\u5b89\u88c5\uff0c\u56e0\u4e3a\u9700\u8981\u5bf9\u914d\u7f6e\u505a\u4e9b\u8c03\u6574\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e9b\u914d\u7f6e\\n\\n```bash\\nhelm repo update\\n# \u83b7\u53d6\u6700\u65b0\u7684\u79bb\u7ebfdrone\u5305\\nhelm pull  stable/drone\\ntar xf drone-2.4.0.tgz && cd drone\\n# \u7f16\u8f91values.yaml\\n```\\n\\n\u793a\u4f8bvalues.yaml\u5982\u4e0b\\n\\n```yaml\\n# \u6709\u6ce8\u91ca\u7684\u5730\u65b9\u8bf4\u660e\u6709\u4fee\u6539\\nimages:\\n  server:\\n    repository: \\"docker.io/drone/drone\\"\\n    tag: 1.6.1\\n    pullPolicy: IfNotPresent\\n  agent:\\n    repository: \\"docker.io/drone/agent\\"\\n    tag: 1.6.1\\n    pullPolicy: IfNotPresent\\n  dind:\\n    repository: \\"docker.io/library/docker\\"\\n    tag: 18.06.1-ce-dind\\n    pullPolicy: IfNotPresent\\nservice:\\n  httpPort: 80\\n  type: ClusterIP\\n  exposeGRPC: false\\ningress:\\n  enabled: true # \u542f\u7528\\n  hosts:\\n    - drone.godu.dev # \u57df\u540d\\n  tls:\\n    - secretName: godu.dev # \u8bc1\u4e66\uff0c\u96c6\u7fa4\u5185\u5df2\u7ecf\u8bc1\u4e66\u7684secret\u4e86\uff0c\u53ef\u4ee5\u4e0d\u542f\u7528\uff0c\u56e0\u4e3a\u6211\u7684dev\u57df\u540d\u5fc5\u987bhttps\u8bbf\u95ee\\n      hosts:\\n        - drone.godu.dev # \u57df\u540d\\nsourceControl:\\n  provider: github # github\\n  secret:\\n  github:\\n    clientID: xxx # github oauth id xxx\\n    clientSecretKey: clientSecret\\n    clientSecretValue: xxxx # github oauth secret xxxx\\n    server: https://github.com\\n  gitlab:\\n    clientID:\\n    clientSecretKey: clientSecret\\n    clientSecretValue:\\n    server:\\n  gitea:\\n    clientID:\\n    clientSecretKey: clientSecret\\n    clientSecretValue:\\n    server:\\n  gogs:\\n    server:\\n  bitbucketCloud:\\n    clientID:\\n    clientSecretKey: clientSecret\\n    clientSecretValue:\\n  bitbucketServer:\\n    server:\\n    consumerKey: consumerKey\\n    privateKey: privateKey\\n    username:\\n    passwordKey: password\\nserver:\\n  host: \\"drone.godu.dev\\"\\n  protocol: https\\n  rpcProtocol: http\\n  adminUser: ysicing # github \u767b\u5f55\u540e\u5c31\u5177\u6709\u7ba1\u7406\u5458\u6743\u9650\\n  alwaysAuth: false\\n  kubernetes:\\n    enabled: true # \u8fd0\u884c Drone \u7684\u4efb\u52a1\u7684\u65f6\u5019\u5c31\u662f\u76f4\u63a5\u4f7f\u7528 Kubernetes \u7684 Job \u8d44\u6e90\u5bf9\u8c61\u6765\u6267\u884c\uff0c\u800c\u4e0d\u662f Drone \u7684 agent.\\n  env:\\n    DRONE_LOGS_DEBUG: \\"false\\"\\n    DRONE_DATABASE_DRIVER: \\"sqlite3\\"\\n    DRONE_DATABASE_DATASOURCE: \\"/var/lib/drone/drone.sqlite\\"\\n  annotations: {}\\n  resources: {}\\n  affinity: {}\\n  nodeSelector: {}\\n  tolerations: []\\n  extraContainers: |\\n  extraVolumes: |\\nagent:\\n  env:\\n    DRONE_LOGS_DEBUG: \\"false\\"\\n  replicas: 1\\n  annotations: {}\\n  resources: {}\\n  livenessProbe: {}\\n  readinessProbe: {}\\n  affinity: {}\\n  nodeSelector: {}\\n  tolerations: []\\ndind:\\n  enabled: true\\n  driver: overlay2\\n  resources: {}\\nmetrics:\\n  prometheus:\\n    enabled: true\\npersistence:\\n  enabled: true\\n  existingClaim: dronepvc # \u521a\u521a\u521b\u5efa\u7684\u6301\u4e45\u5316 pvc\\nrbac:\\n  create: true\\n  apiVersion: v1\\nserviceAccount:\\n  create: true\\n  name:\\n```\\n\\n\u90e8\u7f72drone\\n\\n```bash\\n$ helm install drone -f values.yaml stable/drone\\n\\n$ helm status drone\\n\\nNAME: drone\\nLAST DEPLOYED: Sun Jan  5 20:30:00 2020\\nNAMESPACE: default\\nSTATUS: deployed\\nREVISION: 1\\nTEST SUITE: None\\nNOTES:\\n*********************************************************************************\\n***        PLEASE BE PATIENT: drone may take a few minutes to install         ***\\n*********************************************************************************\\nFrom outside the cluster, the server URL(s) are:\\n     http://drone.godu.dev\\n```\\n\\n\u6700\u540e\\n\\n```\\nroot@k8s.cn1:~/drone/drone# kubectl get pods -l app=drone\\nNAME                                  READY   STATUS    RESTARTS   AGE\\ndrone-drone-server-5bffbc56df-qzk28   1/1     Running   0          35m\\nroot@k8s.cn1:~/drone/drone# kubectl get ing -l app=drone\\nNAME          HOSTS            ADDRESS   PORTS     AGE\\ndrone-drone   drone.godu.dev             80, 443   36m\\n```\\n\\n### \u89e6\u53d1CI\u6784\u5efa\\n\\n```yaml\\n# .drone.yml\\nkind: pipeline\\nname: default\\n\\nsteps:\\n  - name: build\\n    image: golang:latest\\n    environment:\\n      GOPROXY: https://goproxy.cn\\n    commands:\\n      - CGO_ENABLED=0 go build \\n\\n  - name: docker\\n    image: plugins/docker\\n    settings:\\n      repo: ysicing/godemo\\n      use_cache: true\\n      username:\\n        from_secret: dockeruser\\n      password:\\n        from_secret: docker\\n    tags:\\n      - latest\\n    when:\\n      event: push\\n      branch: master\\n```\\n\\n\u4ee3\u7801\u5730\u5740: [BeidouCloudPlatform/demo](https://github.com/BeidouCloudPlatform/demo/blob/master/.drone.yml)\\n\\n![drone ci](/images/drone/ci.png)\\n\\n![drone \u8be6\u60c5\u9875](/images/drone/d.png)\\n\\n### Cli\u5de5\u5177\\n\\n```\\nbrew install drone-cli\\nexport DRONE_SERVER=https://drone.godu.dev\\nexport DRONE_TOKEN=<token>\\ndrone info\\n# \u4fee\u590dwebhook\uff0c\u5982\u679c\u8c03\u6574\u4e86\u57df\u540d\uff0c\u53ef\u4ee5\u901a\u8fc7\u6b64\u547d\u4ee4\u4fee\u590dwebhook\\ndrone repo repair  BeidouCloudPlatform/demo\\n```\\n\\n### Job\u6e05\u7406\u95ee\u9898\\n\\n\u56e0\u4e3a\u4f7f\u7528Job\u7684\u65b9\u5f0f\u8fdb\u884cpipline\u64cd\u4f5c\uff0c\u5982\u679c\u4e0d\u542f\u7528`TTLAfterFinished`\u4f1a\u5bfc\u81f4job\u4e0d\u4f1a\u88ab\u81ea\u52a8\u6e05\u7406\u3002 \u5f00\u542ffeature\u8bf7\u53c2\u8003 [feature\u5f00\u542f](/posts/k8s-feature)\\n\\n\u9ed8\u8ba4drone\u6e05\u7406\u662f300s"},{"id":"/posts/k3s-install","metadata":{"permalink":"/posts/k3s-install","source":"@site/blog/posts/k3s-install.md","title":"debian10\u5b89\u88c5k3s","description":"debian10\u5b89\u88c5k3s","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"k3s","permalink":"/tags/k-3-s"}],"readingTime":1.01,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"debian10\u5b89\u88c5k3s","date":"2020-05-18T14:55:18.000Z","description":"debian10\u5b89\u88c5k3s","tags":["kubernetes","k3s"]},"prevItem":{"title":"helm\u90e8\u7f72drone","permalink":"/posts/helm-drone"},"nextItem":{"title":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","permalink":"/posts/k8s-addons"}},"content":"\x3c!-- truncate --\x3e\\n\\nk3s \u662fRancher\u63a8\u51fa\u7684\u8f7b\u91cf\u7ea7 k8s.\\n\\n## \u5347\u7ea7\u5185\u6838\u7248\u672c\\n\\n```\\napt update\\napt dist-upgrade\\napt install -t buster-backports linux-image-amd64 -y\\nupdate-grub\\nreboot\\n# \u5185\u6838\\nLinux cn2 5.6.0-0.bpo.2-amd64 #1 SMP Debian 5.6.14-2~bpo10+1 (2020-06-09) x86_64 GNU/Linux\\n```\\n\\n\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 [Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357](/posts/debian-op/) \u5347\u7ea7\u5185\u6838\u90e8\u5206\u3002\\n\\n## \u5b89\u88c5 wireguard\\n\\n```\\n#  \u6240\u6709\u8282\u70b9\u9700\u5b89\u88c5\\napt install wireguard -y\\n```\\n\\n## \u90e8\u7f72\u63a7\u5236\u5e73\u9762master\u8282\u70b9\\n\\n```\\ncat > /etc/systemd/system/k3s.service <<EOF\\n[Unit]\\nDescription=Lightweight Kubernetes\\nDocumentation=https://k3s.io\\nWants=network-online.target\\n\\n[Install]\\nWantedBy=multi-user.target\\n\\n[Service]\\nType=notify\\nEnvironmentFile=-/etc/systemd/system/k3s.service.env\\nKillMode=process\\nDelegate=yes\\n# Having non-zero Limit*s causes performance problems due to accounting overhead\\n# in the kernel. We recommend using cgroups to do container-local accounting.\\nLimitNOFILE=1048576\\nLimitNPROC=infinity\\nLimitCORE=infinity\\nTasksMax=infinity\\nTimeoutStartSec=0\\nRestart=always\\nRestartSec=5s\\nExecStartPre=-/sbin/modprobe br_netfilter\\nExecStartPre=-/sbin/modprobe overlay\\nExecStart=/usr/local/bin/k3s \\\\\\n    server \\\\\\n    --tls-san 10.147.20.42 \\\\\\n    --node-ip 10.147.20.42 \\\\\\n    --node-external-ip 10.147.20.42 \\\\\\n    --docker \\\\\\n    --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 \\\\\\n    --flannel-backend wireguard \\\\\\n    --kube-proxy-arg \\"proxy-mode=ipvs\\" \\"masquerade-all=true\\" \\\\\\n    --kube-proxy-arg \\"metrics-bind-address=0.0.0.0\\"\\nEOF\\n```\\n\\n\u5f00\u673a\u542f\u52a8\\n\\n```bash\\nsystemctl enable k3s --now\\n```\\n\\n\u67e5\u770b\u7ec4\u4ef6\u72b6\u6001\\n\\n```\\nk3s kubectl get cs\\nNAME                 STATUS    MESSAGE   ERROR\\ncontroller-manager   Healthy   ok\\nscheduler            Healthy   ok\\n```\\n\\n\\n## \u90e8\u7f72\u8ba1\u7b97worker\u8282\u70b9\\n\\n```\\ncat > /etc/systemd/system/k3s-agent.service <<EOF\\n[Unit]\\nDescription=Lightweight Kubernetes\\nDocumentation=https://k3s.io\\nWants=network-online.target\\n\\n[Install]\\nWantedBy=multi-user.target\\n\\n[Service]\\nType=exec\\nEnvironmentFile=-/etc/systemd/system/k3s-agent.service.env\\nKillMode=process\\nDelegate=yes\\nLimitNOFILE=infinity\\nLimitNPROC=infinity\\nLimitCORE=infinity\\nTasksMax=infinity\\nTimeoutStartSec=0\\nRestart=always\\nRestartSec=5s\\nExecStartPre=-/sbin/modprobe br_netfilter\\nExecStartPre=-/sbin/modprobe overlay\\nExecStart=/usr/local/bin/k3s agent \\\\\\n    --node-external-ip 10.147.20.43 \\\\\\n    --node-ip 10.147.20.43 \\\\\\n    --docker \\\\\\n    --pause-image registry.cn-beijing.aliyuncs.com/k7scn/pause:3.2 \\\\\\n    --kube-proxy-arg \\"proxy-mode=ipvs\\" \\"masquerade-all=true\\" \\\\\\n    --kube-proxy-arg \\"metrics-bind-address=0.0.0.0\\"\\nEOF\\n```\\n\\n- K3S_TOKEN : \u52a0\u5165\u96c6\u7fa4\u6240\u9700\u7684token\uff0c\u53ef\u4ee5\u5728\u63a7\u5236\u8282\u70b9\u4e0a\u67e5\u770b`/var/lib/rancher/k3s/server/node-token` \u6587\u4ef6\\n\\n```\\ncat > /etc/systemd/system/k3s-agent.service.env <<EOF\\nK3S_URL=https://10.147.20.42:6443\\nK3S_TOKEN=K102f2c1f6c878f693700c24b741d309d2ff4038ade912f0a44248781c04376e878::server:bc39d44d89042011b985f267eebe2b2f\\nEOF\\n```\\n\\n\u5f00\u673a\u542f\u52a8 \\n\\n\\n```\\nsystemctl enable k3s-agent --now\\n```"},{"id":"/posts/k8s-addons","metadata":{"permalink":"/posts/k8s-addons","source":"@site/blog/posts/k8s-addons.md","title":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","description":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.23333333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","tags":["kubernetes"]},"prevItem":{"title":"debian10\u5b89\u88c5k3s","permalink":"/posts/k3s-install"},"nextItem":{"title":"k8s\u5b9e\u8df5\u4e4bcalico mtu","permalink":"/posts/k8s-calico-mtu"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u6269\u5c55\u4e86Kubernetes\u7684\u529f\u80fd\\n\\n#### \u90e8\u7f72kuboard\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k7s/install/kuboard/deploy.yml\\n# \u56e0\u4e3aingress\u90e8\u7f72\u5173\u7cfb\uff0c\u6240\u4ee5\u914d\u7f6e\u89e3\u6790\u57df\u540d\u4e3aui.slb.k7s.xyz\\n# \u7ba1\u7406\u8282\u70b9\u6267\u884c\uff0c\u83b7\u53d6token\\nkbtoken\\n```\\n\\n#### \u90e8\u7f72metrics-server\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k7s/install/metrics-server/deploy.yaml\\n```\\n\\n#### \u90e8\u7f72Dashboard\\n\\n```\\nsealos install --pkg-url https://github.com/sealstore/dashboard/releases/download/v2.0.0-bata5/dashboard.tar\\nkdtoken\\n```"},{"id":"/posts/k8s-calico-mtu","metadata":{"permalink":"/posts/k8s-calico-mtu","source":"@site/blog/posts/k8s-calico-mtu.md","title":"k8s\u5b9e\u8df5\u4e4bcalico mtu","description":"k8s\u5b9e\u8df5\u4e4bcalico mtu","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"calico","permalink":"/tags/calico"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.13333333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5b9e\u8df5\u4e4bcalico mtu","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5b9e\u8df5\u4e4bcalico mtu","tags":["calico","kubernetes"]},"prevItem":{"title":"k8s\u5e38\u7528\u6269\u5c55\u7ec4\u4ef6","permalink":"/posts/k8s-addons"},"nextItem":{"title":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","permalink":"/posts/k8s-default-sc"}},"content":"\x3c!-- truncate --\x3e\\n\\n## Ucloud \u7f51\u7edc\\n\\nucloud\u9ed8\u8ba4mtu\u662f 1454\\n\\n\u6240\u4ee5calico\u9700\u8981\u6539mtu\\n\\n```\\nkubectl patch configmap/calico-config -n kube-system --type merge   -p \'{\\"data\\":{\\"veth_mtu\\": \\"1404\\"}}\'\\n```\\n\\n\u53c2\u8003 [Configure MTU to maximize network performance](https://docs.projectcalico.org/networking/mtu)"},{"id":"/posts/k8s-default-sc","metadata":{"permalink":"/posts/k8s-default-sc","source":"@site/blog/posts/k8s-default-sc.md","title":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","description":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"csi","permalink":"/tags/csi"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.16,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","date":"2020-05-18T14:55:18.000Z","description":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","tags":["csi","kubernetes"]},"prevItem":{"title":"k8s\u5b9e\u8df5\u4e4bcalico mtu","permalink":"/posts/k8s-calico-mtu"},"nextItem":{"title":"\u5f00\u542f\u96c6\u7fa4feature\u5f00\u542f\u96c6\u7fa4feature","permalink":"/posts/k8s-feature"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8\\n\\n```\\n# \u96c6\u7fa4\u5df2\u6709\u5b58\u50a8\u7c7b\u578b\uff08StorageClass\uff09\uff0c\u6267\u884c kubectl get sc\u770b\u4e0b\u5f53\u524d\u662f\u5426\u8bbe\u7f6e\u4e86\u9ed8\u8ba4\u7684 storageclass\\nkubectl get sc\\n\\nkubectl patch storageclass nfs-data -p \'{\\"metadata\\": {\\"annotations\\":{\\"storageclass.kubernetes.io/is-default-class\\":\\"true\\"}}}\'\\n```"},{"id":"/posts/k8s-feature","metadata":{"permalink":"/posts/k8s-feature","source":"@site/blog/posts/k8s-feature.md","title":"\u5f00\u542f\u96c6\u7fa4feature\u5f00\u542f\u96c6\u7fa4feature","description":"\u5f00\u542f\u96c6\u7fa4feature","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.4166666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5f00\u542f\u96c6\u7fa4feature\u5f00\u542f\u96c6\u7fa4feature","date":"2020-05-18T14:55:18.000Z","description":"\u5f00\u542f\u96c6\u7fa4feature","tags":["kubernetes"]},"prevItem":{"title":"k8s\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8","permalink":"/posts/k8s-default-sc"},"nextItem":{"title":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","permalink":"/posts/k8s-ingress-tls-config"}},"content":"\x3c!-- truncate --\x3e\\n\\n## ttlSecondsAfterFinished\\n\\n\u81ea\u52a8\u6e05\u7406\u5b8c\u6210\u548c\u5931\u8d25\u7684Job\uff0c\u76ee\u524d\u8be5\u7279\u6027\u9ed8\u8ba4\u4e0d\u542f\u7528\u3002\u5982\u4f55\u5224\u65ad\u672a\u542f\u7528,\u67e5\u770bjob\u8d44\u6e90\uff0c\u5728spec\u91cc\u672a\u53d1\u73b0`ttlSecondsAfterFinished`\u5b9a\u4e49\u5219\u8868\u793a\u672a\u542f\u7528\u3002\\n\\n## \u542f\u7528\\n\\n\u6211\u7684\u96c6\u7fa4\u4f7f\u7528sealos\u5b89\u88c5\u7684\uff0c\u5176\u914d\u7f6e\u6587\u4ef6\u5728 `/etc/kubernetes/manifests`\u4e0b,\u5206\u522b\u8c03\u6574 kube-apiserver.yaml,kube-controller-manager.yaml,kube-scheduler.yaml\u914d\u7f6e\uff0c\u65b0\u589e\\n\\n```\\n# \u793a\u4f8b\\nspec:\\n  containers:\\n  - command:\\n    - kube-scheduler\\n    - --authentication-kubeconfig=/etc/kubernetes/scheduler.conf\\n    - --authorization-kubeconfig=/etc/kubernetes/scheduler.conf\\n    - --bind-address=127.0.0.1\\n    - --kubeconfig=/etc/kubernetes/scheduler.conf\\n    - --leader-elect=true\\n    - --feature-gates=TTLAfterFinished=true # \u65b0\u589e\u914d\u7f6e\\n    image: k8s.gcr.io/kube-scheduler:v1.17.0\\n```\\n\\n\u8c03\u6574\u5b8c\u6210\u540e\u7a0d\u7b49\u7247\u523b,\u76f8\u5173pod\u4f1a\u91cd\u5efa\u3002"},{"id":"/posts/k8s-ingress-tls-config","metadata":{"permalink":"/posts/k8s-ingress-tls-config","source":"@site/blog/posts/k8s-ingress-tls-config.md","title":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","description":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"ingress","permalink":"/tags/ingress"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.6466666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","date":"2020-05-18T14:55:18.000Z","description":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","tags":["ingress","kubernetes"]},"prevItem":{"title":"\u5f00\u542f\u96c6\u7fa4feature\u5f00\u542f\u96c6\u7fa4feature","permalink":"/posts/k8s-feature"},"nextItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","permalink":"/posts/k8s-intro-base"}},"content":"\x3c!-- truncate --\x3e\\n\\n> nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66(\u9ed8\u8ba4\u4ee5ingress-nginx\u4e3a\u4f8b)\\n\\n## \xa0\u521b\u5efa\u8bc1\u4e66\\n\\n\u9ed8\u8ba4\u5df2\u7ecf\u7b7e\u53d1\u8bc1\u4e66\\n\\n## \u521b\u5efa secret\\n\\n\u521b\u5efa\u597d\u8bc1\u4e66\u4ee5\u540e\uff0c\u9700\u8981\u5c06\u8bc1\u4e66\u5185\u5bb9\u653e\u5230 secret \u4e2d\uff0csecret \u4e2d\u5168\u90e8\u5185\u5bb9\u9700\u8981 base64 \u7f16\u7801\\n\\n```yaml\\n# ingress-secret.yml\\napiVersion: v1\\nkind: Secret\\nmetadata:\\n  name: ingress-secret-prom\\n  namespace: monitoring\\ntype: kubernetes.io/tls\\ndata:\\n  tls.crt: <base64 encoded cert>\\n  tls.key: <base64 encoded key>\\n```\\n\\n\u5b8c\u6210\u521b\u5efa\\n\\n```bash\\n~# kubectl apply -f ingress-secret.yml -n monitoring\\nsecret/ingress-secret created\\n~# kubectl apply -f ingress-secret.yml -n kube-system\\nsecret/ingress-secret created\\n```\\n\\n\u6216\u8005\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\\n\\n```bash\\nkubectl create secret tls ingress-secret --key tls.key.pem --cert tls.pem\\n```\\n\\n## \u914d\u7f6eingress\\n\\n```yaml\\napiVersion: networking.k8s.io/v1beta1\\nkind: Ingress\\nmetadata:\\n  annotations:\\n    kubernetes.io/ingress.class: nginx\\n  name: prom\\n  namespace: monitoring\\nspec:\\n  tls:\\n  - hosts:\\n    - prom.k7s.xyz\\n    - grafana.k7s.xyz\\n    - alter.k7s.xyz\\n    secretName: ingress-secret\\n  rules:\\n  - host: prom.k7s.xyz\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: prometheus-k8s\\n          servicePort: 9090\\n  - host: grafana.k7s.xyz\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: grafana\\n          servicePort: 3000\\n  - host: alter.k7s.xyz\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: alertmanager-main\\n          servicePort: 9093\\n```"},{"id":"/posts/k8s-intro-base","metadata":{"permalink":"/posts/k8s-intro-base","source":"@site/blog/posts/k8s-intro-base.md","title":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","description":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":2.0433333333333334,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","tags":["kubernetes"]},"prevItem":{"title":"nginx ingress \u914d\u7f6e\u57df\u540d\u8bc1\u4e66","permalink":"/posts/k8s-ingress-tls-config"},"nextItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","permalink":"/posts/k8s-intro-deploy"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u6982\u5ff5\u7bc7\\n\\n> Kubernetes \u57fa\u672c\u6982\u5ff5\u548c\u4f7f\u7528\u65b9\u6cd5\\n\\n### \u67b6\u6784\\n\\n![k8s\u67b6\u6784](/images/k8s/k8s-arch.png)\\n\\n![k8s\u6574\u4f53\u67b6\u6784](/images/k8s/kubernetes-high-level-component-archtecture.jpg)\\n\\n```\\netcd\u4fdd\u5b58\u4e86\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\uff1b\\napiserver\u63d0\u4f9b\u4e86\u8d44\u6e90\u64cd\u4f5c\u7684\u552f\u4e00\u5165\u53e3\uff0c\u5e76\u63d0\u4f9b\u8ba4\u8bc1\u3001\u6388\u6743\u3001\u8bbf\u95ee\u63a7\u5236\u3001API\u6ce8\u518c\u548c\u53d1\u73b0\u7b49\u673a\u5236\uff1b\\ncontroller manager\u8d1f\u8d23\u7ef4\u62a4\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u6545\u969c\u68c0\u6d4b\u3001\u81ea\u52a8\u6269\u5c55\u3001\u6eda\u52a8\u66f4\u65b0\u7b49\uff1b\\nscheduler\u8d1f\u8d23\u8d44\u6e90\u7684\u8c03\u5ea6\uff0c\u6309\u7167\u9884\u5b9a\u7684\u8c03\u5ea6\u7b56\u7565\u5c06Pod\u8c03\u5ea6\u5230\u76f8\u5e94\u7684\u673a\u5668\u4e0a\uff1b\\n\\nkubelet\u8d1f\u8d23\u7ef4\u62a4\u5bb9\u5668\u7684\u751f\u547d\u5468\u671f\uff0c\u540c\u65f6\u4e5f\u8d1f\u8d23Volume\uff08CSI\uff09\u548c\u7f51\u7edc\uff08CNI\uff09\u7684\u7ba1\u7406\uff1b\\nContainer runtime\u8d1f\u8d23\u955c\u50cf\u7ba1\u7406\u4ee5\u53caPod\u548c\u5bb9\u5668\u7684\u771f\u6b63\u8fd0\u884c\uff08CRI\uff09\uff1b\\nkube-proxy\u8d1f\u8d23\u4e3aService\u63d0\u4f9bcluster\u5185\u90e8\u7684\u670d\u52a1\u53d1\u73b0\u548c\u8d1f\u8f7d\u5747\u8861\uff1b\\n\\nCoreDns \u96c6\u7fa4dns\u89e3\u6790\u670d\u52a1\\nIngress Controller \u5e94\u7528\u5c42\u8d1f\u8f7d\u5747\u8861\u63d0\u4f9b\u5bf9\u5916\u8bbf\u95ee\u670d\u52a1\\nKube-state-metrics \u96c6\u7fa4\u76d1\u63a7\\nPrometheus \u8d44\u6e90\u76d1\u63a7\\nDashboard Web UI \\n```\\n\\n### Master(Control Plane)\u8282\u70b9\\n\\n![master\u8282\u70b9\u67b6\u6784](/images/k8s/kubernetes-master-arch.png)\\n\\nMaster\u662f\u96c6\u7fa4\u7684\u63a7\u5236\u5e73\u9762:\\n\\n- \u8d1f\u8f7d\u96c6\u7fa4\u7684\u5168\u5c40\u51b3\u7b56(\u5982\u8c03\u5ea6\u7b49)\\n- \u63a2\u6d4b\u54cd\u5e94\u96c6\u7fa4\u4e8b\u4ef6(\u5982\u63a2\u6d4b\u5e94\u7528\u7684\u5b9e\u4f8b\u6570\u662f\u5426\u7b26\u5408\u9884\u671f)\\n- \u901a\u5e38master\u8282\u70b9\u4e0d\u8c03\u5ea6\u4e1a\u52a1\u670d\u52a1\\n\\nMaster\u8282\u70b9\u4e3b\u8981\u5305\u62eckube-apiserver\u3001kube-scheduler\u3001kube-controller-manager\u548cetcd\u56db\u4e2a\u7ec4\u4ef6\u3002\\n\\n```bash\\nkube-apiserver: API\u670d\u52a1, Kubernetes\u63a7\u5236\u5e73\u9762\u7684\u524d\u7aef\uff0c\u6240\u6709\u8bf7\u6c42\u5165\u53e3\\nkube-scheduler: watch API\u8d44\u6e90\u72b6\u6001\uff0c\u6839\u636e\u76f8\u5173\u6761\u4ef6\u8c03\u5ea6\u5230\u5408\u9002\u7684node\u8282\u70b9\u521b\u5efa\u76f8\u5173\u8d44\u6e90\\nkube-controller-manager: \u751f\u547d\u5468\u671f\u7ba1\u7406\u548cAPI\u4e1a\u52a1\u903b\u8f91(\u5982: \u8282\u70b9\u63a7\u5236\u5668,\u526f\u672c\u63a7\u5236\u5668)\\netcd: k8s\u6570\u636e\u5b58\u50a8\u7ec4\u4ef6\\ncloud-controller-manager: \u4e91\u670d\u52a1\u5546\u7ec4\u4ef6\uff0c\u5bf9\u63a5\u5404\u5bb6\u4e91\u8d44\u6e90(\u4e91\u670d\u52a1\u5546\u7ef4\u62a4)\\n```\\n\\n### Worker(Node)\u8282\u70b9\\n\\n![worker\u8282\u70b9\u67b6\u6784](/images/k8s/kubernetes-node-arch.png)\\n\\n\u5305\u62eckubelet\u3001kube-proxy\u548cContainer Runtime\u4e09\u4e2a\u7ec4\u4ef6\u3002\\n\\n```\\nkubelet:\\n    \u8fd0\u884c\u5728\u96c6\u7fa4\u6bcf\u4e2a\u8282\u70b9\u7684\u5ba2\u6237\u7aef\uff0c\u9700\u8981\u786e\u4fdd\u76f8\u5173\u5bb9\u5668\u8fd0\u884c\u5728pod\u4e2d\uff1b\\n    \u901a\u8fc7PodSpecs\u6807\u7b7e\uff0c\u63cf\u8ff0\u5bb9\u5668\u7684\u8fd0\u884c\u72b6\u6001\uff1b\\n    kubelet\u53ea\u7ba1\u7406\u901a\u8fc7kubernetes\u521b\u5efa\u7684\u5bb9\u5668\u3002\\n    \\nkube-proxy\uff1a\\n    \u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u96c6\u7fa4\u6bcf\u4e2a\u8282\u70b9\u7684\u7f51\u7edc\u4ee3\u7406\u7ec4\u4ef6,\u4e3b\u8981\u662f\u7ef4\u62a4\u7f51\u7edc\u89c4\u5219\uff0c\u4fdd\u8bc1\u96c6\u7fa4\u5185\u5916\u4e0ePod\u901a\u4fe1\u3002\\n    \\nContainer Runtime\uff1a\\n    \u652f\u6301\u8fd0\u884c\u5bb9\u5668\u5e95\u5c42\u73af\u5883\u7684\u8f6f\u4ef6\uff1b\\n    \u652f\u6301\uff1a CRI(Container Runtime Interface) \u5982Docker/Containerd\u3002\\n```\\n\\n### \u6838\u5fc3Addons\\n\\n> Addons \u4f7f\u7528 Kubernetes \u8d44\u6e90\uff08DaemonSet\u3001Deployment\u7b49\uff09\u5b9e\u73b0\u96c6\u7fa4\u7684\u529f\u80fd\u7279\u6027\u3002\u7531\u4e8e\u4ed6\u4eec\u63d0\u4f9b\u96c6\u7fa4\u7ea7\u522b\u7684\u529f\u80fd\u7279\u6027\uff0caddons\u4f7f\u7528\u5230\u7684Kubernetes\u8d44\u6e90\u90fd\u653e\u7f6e\u5728 `kube-system`\u540d\u79f0\u7a7a\u95f4\u4e0b\u3002\\n\\n- CNI(Calico\u7b49)\\n- DNS(CoreDNS\u7b49)\\n- UI(Dashboard)\\n- ...\\n\\n[\u5b98\u65b9Addons](https://kubernetes.io/docs/concepts/cluster-administration/addons/)"},{"id":"/posts/k8s-intro-deploy","metadata":{"permalink":"/posts/k8s-intro-deploy","source":"@site/blog/posts/k8s-intro-deploy.md","title":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","description":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":5.463333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","tags":["kubernetes"]},"prevItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u57fa\u7840\u6982\u5ff5","permalink":"/posts/k8s-intro-base"},"nextItem":{"title":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","permalink":"/posts/k8s-kubectl-plugins"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528\\n\\n```yaml\\n# https://sh.ysicing.me/k8s/demo/deploy.yaml\\napiVersion: apps/v1    #\u4e0ek8s\u96c6\u7fa4\u7248\u672c\u6709\u5173\uff0c\u4f7f\u7528 kubectl api-versions \u5373\u53ef\u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u652f\u6301\u7684\u7248\u672c\\nkind: Deployment    #\u8be5\u914d\u7f6e\u7684\u7c7b\u578b\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f Deployment\\nmetadata:            #\u8bd1\u540d\u4e3a\u5143\u6570\u636e\uff0c\u5373 Deployment \u7684\u4e00\u4e9b\u57fa\u672c\u5c5e\u6027\u548c\u4fe1\u606f\\n  namespace: default # \u547d\u540d\u7a7a\u95f4\\n  name: demo-deployment    #Deployment \u7684\u540d\u79f0\\n  labels:        #\u6807\u7b7e\uff0c\u53ef\u4ee5\u7075\u6d3b\u5b9a\u4f4d\u4e00\u4e2a\u6216\u591a\u4e2a\u8d44\u6e90\uff0c\u5176\u4e2dkey\u548cvalue\u5747\u53ef\u81ea\u5b9a\u4e49\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u7ec4\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3\\n    app: demo    #\u4e3a\u8be5Deployment\u8bbe\u7f6ekey\u4e3aapp\uff0cvalue\u4e3ademo\u7684\u6807\u7b7e\\nspec:            #\u8fd9\u662f\u5173\u4e8e\u8be5Deployment\u7684\u63cf\u8ff0\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4f60\u671f\u5f85\u8be5Deployment\u5728k8s\u4e2d\u5982\u4f55\u4f7f\u7528\\n  replicas: 1    #\u4f7f\u7528\u8be5Deployment\u521b\u5efa\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\\n  #strategy: #\u6eda\u52a8\u7b56\u7565 \u6700\u591a\u65b0\u589e\u4e00\u4e2a\uff0c\u6700\u5c0f\u4e0b\u7ebf\u4e00\u4e2a\\n  #  rollingUpdate:\\n  #    maxSurge: 1\\n  #    maxUnavailable: 1\\n  #  type: RollingUpdate\\n  selector:        #\u6807\u7b7e\u9009\u62e9\u5668\uff0c\u4e0e\u4e0a\u9762\u7684\u6807\u7b7e\u5171\u540c\u4f5c\u7528\uff0c\u76ee\u524d\u4e0d\u9700\u8981\u7406\u89e3\\n    matchLabels: #\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:demo\u7684\u8d44\u6e90\\n      app: demo\\n  template:        #\u8fd9\u662f\u9009\u62e9\u6216\u521b\u5efa\u7684Pod\u7684\u6a21\u677f\\n    metadata:    #Pod\u7684\u5143\u6570\u636e\\n      labels:    #Pod\u7684\u6807\u7b7e\uff0c\u4e0a\u9762\u7684selector\u5373\u9009\u62e9\u5305\u542b\u6807\u7b7eapp:demo\u7684Pod\\n        app: demo\\n    spec:        #\u671f\u671bPod\u5b9e\u73b0\u7684\u529f\u80fd\uff08\u5373\u5728pod\u4e2d\u90e8\u7f72\uff09\\n      containers:    #\u751f\u6210container\uff0c\u4e0edocker\u4e2d\u7684container\u662f\u540c\u4e00\u79cd\\n      - name: godemo    #container\u7684\u540d\u79f0\\n        image: ysicing/godemo    #\u4f7f\u7528\u955c\u50cfgodemo\u521b\u5efacontainer\uff0c\u8be5container\u9ed8\u8ba480\u7aef\u53e3\u53ef\u8bbf\u95ee\\n```\\n\\n\u90e8\u7f72\u5e94\u7528\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/deploy.yaml\\ndeployment.apps/demo-deployment created\\n```\\n\\n\u67e5\u770b\u90e8\u7f72\u7ed3\u679c\\n\\n```\\n# \u9ed8\u8ba4ns\u5c31\u662fdefault\u53ef\u7701\u5374\\nkubectl get deployments -n default\\nNAME              READY   UP-TO-DATE   AVAILABLE   AGE\\ndemo-deployment   1/1     1            1           2m54s\\n\\nkubectl get pods\\nNAME                               READY   STATUS    RESTARTS   AGE\\ndemo-deployment-59cd96d4d5-cjjwr   1/1     Running   0          3m17s\\n```\\n\\n`Deployment`\u662fpod\u63a7\u5236\u5668\\n\\n\u5e38\u89c1pod\u63a7\u5236\u5668\\n\\n```\\n\u5b88\u62a4\u578b:\\n    \u65e0\u72b6\u6001\u975e\u7cfb\u7edf\u7ea7\u5e94\u7528: Deployment (\u5982nginx)\\n    \u65e0\u72b6\u6001\u7cfb\u7edf\u7ea7\u5e94\u7528: DaemonSet (\u5982\u65e5\u5fd7\u76d1\u63a7\u6536\u96c6\u7aef\uff0c\u6bcf\u4e2anode\u8282\u70b9\u4ec5\u4e14\u9700\u8981\u8dd1\u4e00\u4e2apod)\\n    \u6709\u72b6\u6001\u5e94\u7528: StatefulSet (\u6570\u636e\u5e93\u7c7b\u5e94\u7528\u5982mysql\u7b49)\\n\u975e\u5b88\u62a4\u578b:\\n    \u4e00\u6b21\u6027\u4efb\u52a1: Job\\n    \u5b9a\u65f6\u4efb\u52a1: CronJob\\n```\\n\\n### \u5e38\u7528\u547d\u4ee4\\n\\n```\\n# \u83b7\u53d6\u8d44\u6599\\nkubectl explain \u7c7b\u578b(\u5982pods)\\n\\n# \u83b7\u53d6\u8d44\u6e90\u4fe1\u606f\\nkubectl get \u8d44\u6e90\u7c7b\u578b\\n\\nkubectl get pods \u83b7\u53d6default\u79df\u6237\u7684\u6240\u6709pods\u8d44\u6e90\u5217\u8868\\nkubectl get nodes \u83b7\u53d6\u8282\u70b9\u8d44\u6e90\u5217\u8868\\nkubectl get deploy \u83b7\u53d6default\u79df\u6237\u7c7b\u578b\u4e3adeployment\u7684\u8d44\u6e90\u5217\u8868\\n\\n# \u663e\u793a\u8d44\u6e90\u7684\u8be6\u7ec6\u4fe1\u606f\\nkubectl describe \u8d44\u6e90\u7c7b\u578b \u8d44\u6e90\u540d\u79f0\\n\\nkubectl describe deploy demo-deployment \u83b7\u53d6default\u79df\u6237deployment\u7c7b\u578b\u4e14\u540d\u4e3ademo-deployment\u7684\u8be6\u7ec6\u4fe1\u606f\\n\\n# \u770bpod\u65e5\u5fd7\uff0c\u7c7b\u4f3cdocker logs\\nkubectl logs Pod\u540d\u79f0 \\nkubectl logs demo-deployment-59cd96d4d5-cjjwr \u67e5\u770bdefault\u79df\u6237\u4e0bpod\u540d\u4e3ademo-deployment-59cd96d4d5-cjjwr\u7684\u65e5\u5fd7\\n\\n# \u8fdb\u5165\u5bb9\u5668\uff0c\u7c7b\u578bdocker exec\\nkubectl exec -it Pod\u540d\u79f0 \u64cd\u4f5c\u547d\u4ee4\\n\\nkubectl exec -it demo-deployment-59cd96d4d5-cjjwr ash\\n/ #\\n```\\n\\n## \u8bbf\u95ee\u90e8\u7f72\u7684\u5e94\u7528\\n\\n\u90a3\u4e48\uff0c\u90e8\u7f72\u5b8c\u7b2c\u4e00\u4e2a\u5e94\u7528\u53c8\u8be5\u5982\u4f55\u8bbf\u95ee?\\n\\nKubernetes \u4e2d\u7684 Service\uff08\u670d\u52a1\uff09 \u63d0\u4f9b\u4e86\u8fd9\u6837\u7684\u4e00\u4e2a\u62bd\u8c61\u5c42\uff0c\u5b83\u9009\u62e9\u5177\u5907\u67d0\u4e9b\u7279\u5f81\u7684 Pod\uff08\u5bb9\u5668\u7ec4\uff09\u5e76\u4e3a\u5b83\u4eec\u5b9a\u4e49\u4e00\u4e2a\u8bbf\u95ee\u65b9\u5f0f\u3002\\n\\n\u5728\u521b\u5efaService\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 spec.type \u5b57\u6bb5\u7684\u503c\uff0c\u53ef\u4ee5\u4ee5\u4e0d\u540c\u65b9\u5f0f\u5411\u5916\u90e8\u66b4\u9732\u5e94\u7528\u7a0b\u5e8f\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u5e38\u7528\u76843\u79cd\uff1a\\n\\n```\\nClusterIP(\u9ed8\u8ba4): \u96c6\u7fa4\u5185\u90e8\u53ef\u8bbf\u95ee\\nNodePort: NAT\u65b9\u5f0f,\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u96c6\u7fa4\u4e2d\u4efb\u610f\u8282\u70b9+\u7aef\u53e3\u53f7\u7684\u65b9\u5f0f\u8bbf\u95ee\u670d\u52a1 <NodeIP>:<NodePort>,\u6b64\u65f6ClusterIP\u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002\\nLoadBalancer: \u8d1f\u8f7d\u5747\u8861(\u4f9d\u8d56\u4e91\u8bbf\u95ee)\u3002\u6b64\u65f6 ClusterIP \u548c NodePort \u7684\u8bbf\u95ee\u65b9\u5f0f\u4ecd\u7136\u53ef\u7528\u3002\\n```\\n\\n![ClusterIP\u65b9\u5f0f](/images/k8s/clusterip.png)\\n![NodePort\u65b9\u5f0f](/images/k8s/NodePort.png)\\n![LoadBalancer\u65b9\u5f0f](/images/k8s/lb.png)\\n\\n``` yaml\\nkubectl explain svc\\n\\n# https://sh.ysicing.me/k8s/demo/svc.yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: demo-service\\t#Service \u7684\u540d\u79f0\\n  labels:     \\t#Service \u81ea\u5df1\u7684\u6807\u7b7e\\n    app: demo\\t#\u4e3a\u8be5 Service \u8bbe\u7f6e key \u4e3a app\uff0cvalue \u4e3a demo \u7684\u6807\u7b7e\\nspec:\\t    #\u8fd9\u662f\u5173\u4e8e\u8be5 Service \u7684\u5b9a\u4e49\uff0c\u63cf\u8ff0\u4e86 Service \u5982\u4f55\u9009\u62e9 Pod\uff0c\u5982\u4f55\u88ab\u8bbf\u95ee\\n  selector:\\t    #\u6807\u7b7e\u9009\u62e9\u5668\\n    app: demo\\t#\u9009\u62e9\u5305\u542b\u6807\u7b7e app:demo \u7684 Pod\\n  ports:\\n  - name: demo-port\\t#\u7aef\u53e3\u7684\u540d\u5b57\\n    protocol: TCP\\t    #\u534f\u8bae\u7c7b\u578b TCP/UDP\\n    port: 80\\t        #\u96c6\u7fa4\u5185\u7684\u5176\u4ed6\u5bb9\u5668\u7ec4\u53ef\u901a\u8fc7 80 \u7aef\u53e3\u8bbf\u95ee Service\\n    nodePort: 32600   #\u901a\u8fc7\u4efb\u610f\u8282\u70b9\u7684 32600 \u7aef\u53e3\u8bbf\u95ee Service\\n    targetPort: 80\\t#\u5c06\u8bf7\u6c42\u8f6c\u53d1\u5230\u5339\u914d Pod \u7684 80 \u7aef\u53e3\\n  type: NodePort\\t#Serive\u7684\u7c7b\u578b\uff0cClusterIP/NodePort/LoaderBalancer\\n```\\n\\n\u751f\u6548\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/svc.yaml\\nservice/demo-service created\\n```\\n\\n\u67e5\u770bservice\uff0c\u901a\u8fc7\u4e4b\u524d\u7684\u6587\u6863\\n\\n```\\nkubectl get svc -l app=demo\\nNAME           TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE\\ndemo-service   NodePort   10.96.37.87   <none>        80:32600/TCP   55s\\n\\n---\\n\\nkubectl describe svc/demo-service\\n\\nName:                     demo-service\\nNamespace:                default\\nLabels:                   app=demo\\nAnnotations:              kubectl.kubernetes.io/last-applied-configuration:\\n                            {\\"apiVersion\\":\\"v1\\",\\"kind\\":\\"Service\\",\\"metadata\\":{\\"annotations\\":{},\\"labels\\":{\\"app\\":\\"demo\\"},\\"name\\":\\"demo-service\\",\\"namespace\\":\\"default\\"},\\"spe...\\nSelector:                 app=demo\\nType:                     NodePort\\nIP:                       10.96.37.87\\nPort:                     demo-port  80/TCP\\nTargetPort:               80/TCP\\nNodePort:                 demo-port  32600/TCP\\nEndpoints:                172.16.219.5:80\\nSession Affinity:         None\\nExternal Traffic Policy:  Cluster\\nEvents:                   <none>\\n```\\n\\n\u6d4b\u8bd5\u670d\u52a1\u8bbf\u95ee\\n\\n```\\n# \u5728\u96c6\u7fa4\u8282\u70b9\\nroot@k8s1:~# curl 10.96.37.87\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\nroot@k8s1:~# curl 172.16.219.5\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\nroot@k8s1:~# curl 192.168.100.101:32600\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\nroot@k8s1:~# curl 192.168.100.102:32600\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\n```\\n\\n\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u60f3\u901a\u8fc7clusterip\u65b9\u5f0f\u63d0\u4f9b\u5bf9\u5916\u670d\u52a1\uff0c\u8be5\u600e\u4e48\u505a\uff1f\\n\\n```\\n# https://sh.ysicing.me/k8s/demo/ing.yaml\\napiVersion: networking.k8s.io/v1beta1\\nkind: Ingress\\nmetadata:\\n  labels:\\n    app: demo\\n  name: demo-ingress # ingress\u540d\\n  namespace: default\\nspec:\\n  rules:\\n    - host: godemo.slb.k7s.xyz # \u57df\u540d\\n      http:\\n        paths:\\n          - backend:\\n              serviceName: demo-service # godemo\u7684 service\u540d\\n              servicePort: demo-port # godemo\u7684service\u5b9a\u4e49\u7684port\\n            path: / #\u8def\u5f84\\n```\\n\\n\u751f\u6548\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/ing.yaml\\ningress.networking.k8s.io/demo-ingress created\\n\\nkubectl get ing\\nNAME           HOSTS                ADDRESS   PORTS   AGE\\ndemo-ingress   godemo.slb.k7s.xyz             80      91s\\n```\\n\\n\u9a8c\u8bc1ingress\\n\\n```\\ncurl godemo.slb.k7s.xyz      \\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\n```\\n\\n\u8fd9\u65f6\u5019\u6d41\u91cf\u589e\u52a0\uff0c\u600e\u4e48\u5feb\u901f\u4f38\u7f29\u5e94\u7528\u3002\\n\\n### \u4f38\u7f29\u5e94\u7528\\n\\n\u4f38\u7f29 \u7684\u5b9e\u73b0\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539 deploy.yaml \u6587\u4ef6\u4e2d\u90e8\u7f72\u7684 replicas\uff08\u526f\u672c\u6570\uff09\u6765\u5b8c\u6210\\n\\n```\\n# replicas: 1 ---\x3e replicas: 4\\n# \u6539\u5b8c\u751f\u6548\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/deploy2.yaml\\ndeployment.apps/demo-deployment configured\\n\\n# \u67e5\u770bpod\\nkubectl get pods -l app=demo\\nNAME                               READY   STATUS    RESTARTS   AGE\\ndemo-deployment-59cd96d4d5-78v28   1/1     Running   0          16s\\ndemo-deployment-59cd96d4d5-cjjwr   1/1     Running   0          15m\\ndemo-deployment-59cd96d4d5-mn7r8   1/1     Running   0          16s\\ndemo-deployment-59cd96d4d5-mvxk2   1/1     Running   0          16s\\n\\n# \u4fee\u6539\u4e86 Deployment \u7684 replicas \u4e3a 4 \u540e\uff0cKubernetes \u53c8\u4e3a\u8be5 Deployment \u521b\u5efa\u4e86 3 \u65b0\u7684 Pod\uff0c\u8fd9 4 \u4e2a Pod \u6709\u76f8\u540c\u7684\u6807\u7b7e\u3002\u56e0\u6b64nginx Service \u901a\u8fc7\u6807\u7b7e\u9009\u62e9\u5668\u4e0e\u65b0\u7684 Pod\u5efa\u7acb\u4e86\u5bf9\u5e94\u5173\u7cfb\uff0c\u5c06\u8bbf\u95ee\u6d41\u91cf\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u5728 4 \u4e2a Pod \u4e4b\u95f4\u8fdb\u884c\u8f6c\u53d1\\n\\nName:                     demo-service\\nNamespace:                default\\nLabels:                   app=demo\\nAnnotations:              kubectl.kubernetes.io/last-applied-configuration:\\n                            {\\"apiVersion\\":\\"v1\\",\\"kind\\":\\"Service\\",\\"metadata\\":{\\"annotations\\":{},\\"labels\\":{\\"app\\":\\"demo\\"},\\"name\\":\\"demo-service\\",\\"namespace\\":\\"default\\"},\\"spe...\\nSelector:                 app=demo\\nType:                     NodePort\\nIP:                       10.96.37.87\\nPort:                     demo-port  80/TCP\\nTargetPort:               80/TCP\\nNodePort:                 demo-port  32600/TCP\\nEndpoints:                172.16.109.71:80,172.16.109.72:80,172.16.219.5:80 + 1 more...\\nSession Affinity:         None\\nExternal Traffic Policy:  Cluster\\nEvents:                   <none>\\n```\\n\\n\u9a8c\u8bc1\u6548\u679c,\u6d41\u91cf\u662f\u8d1f\u8f7d\u5230\u540e\u7aef\u4e0d\u540cpod\u4e0a\\n\\n```\\nroot@k8s1:~# curl godemo.slb.k7s.xyz\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-mn7r8\\",\\"ip\\":{\\"eth0\\":\\"172.16.109.71/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\nroot@k8s1:~# curl godemo.slb.k7s.xyz\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-cjjwr\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.5/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\nroot@k8s1:~# curl godemo.slb.k7s.xyz\\n{\\"hostname\\":\\"demo-deployment-59cd96d4d5-78v28\\",\\"ip\\":{\\"eth0\\":\\"172.16.219.6/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\n```\\n\\n\\n### \u6700\u540e\\n\\n```yaml\\n\u9648\u8ff0\u5f0f\uff1a\\n    kubectl create -f xx.yaml\\n        \\n\u7533\u660e\u5f0f\uff08\u5efa\u8bae\u4f7f\u7528\uff09\uff1a\\n    kubectl apply -f xx.yaml\\n```\\n\\n- pod\u5bb9\u5668\u5982\u679c\u672a\u53d1\u751f\u8c03\u5ea6\uff0c\u91cd\u542f\u5bb9\u5668ip\u662f\u4e0d\u4f1a\u6539\u53d8\u7684\\n\\n\u53e6\u5916\u9664\u4e86Service\u8fd9\u79cd\u7f51\u7edc\uff0c\u8fd8\u6709`hostPort`,`hostNetwork`\\n\\n```\\nhostPort\uff1a\u76f4\u63a5\u5c06\u5bb9\u5668\u7684\u7aef\u53e3\u4e0e\u6240\u8c03\u5ea6\u7684\u8282\u70b9\u4e0a\u7684\u7aef\u53e3\u8def\u7531\uff0c\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u5bbf\u4e3b\u673a\u7684IP\u52a0\u4e0a\u6765\u8bbf\u95eePod\u4e86, Ingress\u5c31\u662f\u8fd9\u6837\u7684\\nhostNetwork\uff1a\u5171\u4eab\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u540d\u79f0\u7a7a\u95f4\\n```\\n\\n\u8fd9\u91cc\u53ef\u4ee5\u8fd9\u4e48\u6d4b\u8bd5\u4f7f\u7528hostPort\\n\\n```\\nkubectl apply -f https://sh.ysicing.me/k8s/demo/deploy3.yaml\\nkubectl get pods  -l app=demo -o wide\\nNAME                               READY   STATUS    RESTARTS   AGE    IP              NODE   NOMINATED NODE   READINESS GATES\\ndemo-deployment-6c5664f4d6-s6w8v   1/1     Running   0          112s   172.16.109.68   k8s2   <none>           <none>\\n\\ncurl 666.slb.k7s.xyz:28080\\n{\\"hostname\\":\\"demo-deployment-6c5664f4d6-s6w8v\\",\\"ip\\":{\\"eth0\\":\\"172.16.109.68/32\\",\\"lo\\":\\"127.0.0.1/8\\"}}\\n```"},{"id":"/posts/k8s-kubectl-plugins","metadata":{"permalink":"/posts/k8s-kubectl-plugins","source":"@site/blog/posts/k8s-kubectl-plugins.md","title":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","description":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"krew","permalink":"/tags/krew"},{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":1.46,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","date":"2020-05-18T14:55:18.000Z","description":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","tags":["krew","kubernetes"]},"prevItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u90e8\u7f72\u7b2c\u4e00\u4e2a\u5e94\u7528","permalink":"/posts/k8s-intro-deploy"},"nextItem":{"title":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","permalink":"/posts/k8s-labels"}},"content":"\x3c!-- truncate --\x3e\\n\\n## kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew\\n\\n### \u63d2\u4ef6\u673a\u5236\\n\\n\u8fd9\u4e2a\u65e9\u5c31\u5df2\u7ecfGA\u4e86\uff0c\u5176\u4f5c\u7528\u5141\u8bb8\u5f00\u53d1\u8005\u4ee5\u72ec\u7acb\u7684\u4e8c\u8fdb\u5236\u6216\u811a\u672c\u5f62\u5f0f\u53d1\u5e03\u81ea\u5b9a\u4e49\u7684kubectl\u5b50\u547d\u4ee4, \u7075\u6d3b\u5feb\u901f\u64cd\u4f5ck8s\\n\\n\u63d2\u4ef6\u4e0d\u9650\u5236\u8bed\u8a00\uff0c\u53ea\u9700\u5c06\u811a\u672c\u6216\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\u4ee5`kubectl-<plugin-name>`\u7684\u524d\u7f00\u653e\u5230PATH\u4e2d\u5373\u53ef.\\n\\n#### \u5b98\u65b9\u793a\u4f8b\\n\\n\u5b98\u65b9Go\u793a\u4f8b\u8f85\u52a9\u5e93 [https://github.com/kubernetes/cli-runtime.git](https://github.com/kubernetes/cli-runtime.git)\\n\\n\u4e0d\u592a\u7b80\u5355\u7684\u5b98\u65b9\u793a\u4f8b\u63d2\u4ef6 [https://github.com/kubernetes/sample-cli-plugin](https://github.com/kubernetes/sample-cli-plugin)\\n\\n#### \u793a\u4f8b\u63d2\u4ef6\\n\\n```\\nmkdir /usr/local/k8s\\nexport PATH=$PATH:/usr/local/k8s\\n```\\n\\n\u793a\u4f8b\u63d2\u4ef6\u5982\u4e0b\uff1a\\n```\\nroot@k8s1:~# cat /usr/local/k8s/kubectl-demo\\n#!/bin/bash\\n\\necho $1\\n```\\n\\n\u8d4b\u4e88\u6267\u884c\u6743\u9650 \\n\\n```\\nchmod +x /usr/local/k8s/kubectl-demo\\n```\\n\\n\u8fd0\u884c\u6d4b\u8bd5:\\n\\n```\\nroot@k8s1:~# kubectl demo 666\\n666\\n\\nroot@k8s1:~# kubectl plugin list\\nThe following compatible plugins are available:\\n\\n/usr/local/k8s/kubectl-demo\\n```\\n\\n`kubectl plugin list` \u53ef\u4ee5\u67e5\u770bPATH\u4e2d\u67e5\u770b\u6709\u54ea\u4e9b\u63d2\u4ef6\\n\\n### krew\\n\\nPackage manager for kubectl plugins -- [krew](https://krew.dev)\\n\\n#### \u5b89\u88c5krew\\n\\n```\\n# Bash and ZSH\\n\\n(\\n  set -x; cd \\"$(mktemp -d)\\" &&\\n  curl -fsSLO \\"https://github.com/kubernetes-sigs/krew/releases/download/v0.3.4/krew.{tar.gz,yaml}\\" &&\\n  tar zxvf krew.tar.gz &&\\n  KREW=./krew-linux_amd64 &&\\n  \\"$KREW\\" install --manifest=krew.yaml --archive=krew.tar.gz &&\\n  \\"$KREW\\" update\\n)\\n\\n# .bashrc/.zshrc\\nexport PATH=$PATH:/usr/local/k8s:${KREW_ROOT:-$HOME/.krew}/bin\\n```\\n\\n\u67e5\u770b\u5f53\u524d\u53ef\u7528\u7684kubectl plugin\uff0c\u53d1\u73b0\u591a\u4e86\u4e00\u4e2akubect-krew\\n\\n```\\nroot@k8s1:~# kubectl plugin list\\nThe following compatible plugins are available:\\n\\n/usr/local/k8s/kubectl-demo\\n/root/.krew/bin/kubectl-krew\\n```\\n\\n#### krew\u4f7f\u7528\\n\\n```\\nkubectl krew\\nkrew is the kubectl plugin manager.\\nYou can invoke krew through kubectl: \\"kubectl krew [command]...\\"\\n\\nUsage:\\n  krew [command]\\n\\nAvailable Commands:\\n  help        Help about any command\\n  info        Show information about a kubectl plugin\\n  install     Install kubectl plugins\\n  list        List installed kubectl plugins\\n  search      Discover kubectl plugins\\n  uninstall   Uninstall plugins\\n  update      Update the local copy of the plugin index\\n  upgrade     Upgrade installed plugins to newer versions\\n  version     Show krew version and diagnostics\\n\\nFlags:\\n  -h, --help      help for krew\\n  -v, --v Level   number for the log level verbosity\\n\\nUse \\"krew [command] --help\\" for more information about a command.\\n```\\n\\n#### \u521d\u4f53\u9a8c\\n\\n```\\nroot@k8s1:~# kubectl get pods\\nNo resources found in default namespace.\\nroot@k8s1:~# kubectl krew install change-ns\\nInstalling plugin: change-ns\\nInstalled plugin: change-ns\\nroot@k8s1:~# kubectl krew list\\nPLUGIN     VERSION\\nchange-ns  v1.0.0\\nkrew       v0.3.3\\nroot@k8s1:~# kubectl change-ns nginx-ingress\\nnamespace changed to \\"nginx-ingress\\"\\nroot@k8s1:~# kubectl get pod\\nroot@k8s1:~#  kubectl get pod\\nNAME                  READY   STATUS              RESTARTS   AGE\\nnginx-ingress-rfswh   1/1     Running             0          2m6s\\nnginx-ingress-v6c4l   1/1     Running             0          2m6s\\n```"},{"id":"/posts/k8s-labels","metadata":{"permalink":"/posts/k8s-labels","source":"@site/blog/posts/k8s-labels.md","title":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","description":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":0.38,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","date":"2020-05-18T14:55:18.000Z","description":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","tags":["kubernetes"]},"prevItem":{"title":"kubectl plugin\u63d2\u4ef6\u673a\u5236\u521d\u4f53\u9a8c\u4e4bkrew","permalink":"/posts/k8s-kubectl-plugins"},"nextItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","permalink":"/posts/k8s-linkerd-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n\u683c\u5f0f\u8981\u6c42\uff1a\\n\\n```\\n\u6709\u6548\u6807\u7b7e\u503c\u5fc5\u987b\u4e3a 63 \u4e2a\u5b57\u7b26\u6216\u66f4\u5c11\uff0c\u5e76\u4e14\u5fc5\u987b\u4e3a\u7a7a\u6216\u4ee5\u5b57\u6bcd\u6570\u5b57\u5b57\u7b26\uff08[a-z0-9A-Z]\uff09\u5f00\u5934\u548c\u7ed3\u5c3e\uff0c\u4e2d\u95f4\u53ef\u4ee5\u5305\u542b\u7834\u6298\u53f7\uff08-\uff09\u3001\u4e0b\u5212\u7ebf\uff08_\uff09\u3001\u70b9\uff08.\uff09\u548c\u5b57\u6bcd\u6216\u6570\u5b57\\n```\\n\\n### \u8282\u70b9\u8c03\u5ea6nodeSelector\\n\\n```bash\\n# \u6253label\\nkubectl label nodes <node-name> <label-key>=<label-value>\\n# \u663e\u793alabel\\nkubectl get node --show-labels\\n```\\n\\npod\u8c03\u5ea6\u5230\u8282\u70b9\\n\\n```yaml\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: nginx\\n  labels:\\n    env: test\\nspec:\\n  containers:\\n  - name: nginx\\n    image: nginx\\n    imagePullPolicy: IfNotPresent\\n  nodeSelector:\\n    disktype: ssd\\n```"},{"id":"/posts/k8s-linkerd-install","metadata":{"permalink":"/posts/k8s-linkerd-install","source":"@site/blog/posts/k8s-linkerd-install.md","title":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","description":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"linkerd","permalink":"/tags/linkerd"}],"readingTime":1.0633333333333332,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","tags":["linkerd"]},"prevItem":{"title":"k8s\u6807\u7b7e\u548c\u9009\u62e9\u5668","permalink":"/posts/k8s-labels"},"nextItem":{"title":"minikube\u5b89\u88c5k8s","permalink":"/posts/k8s-minikube-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5b89\u88c5linkerd v2\\n\\n#### \u5b89\u88c5\u4e8c\u8fdb\u5236\\n\\n```\\ndocker run --rm -v /usr/local/bin:/sysdir ysicing/tools tar zxf /pkg.tgz -C /sysdir\\n```\\n\\n#### \u83b7\u53d6\u76f8\u5173\u955c\u50cf\\n\\n```bash\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | xargs -I {} docker pull {}\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | grep \\"gcr.io/linkerd-io\\" | awk -F/ \'{print $NF}\' | xargs -I {} docker tag gcr.io/linkerd-io/{} ysicing/linkerd-io-{}\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | grep \\"gcr.io/linkerd-io\\" | awk -F/ \'{print $NF}\' | xargs -I {} docker push ysicing/linkerd-io-{}\\n```\\n\\n#### \u540c\u6b65\u5230\u5185\u7f51\u73af\u5883\\n\\n```bash\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | grep \\"gcr.io/linkerd-io\\" | awk -F/ \'{print $NF}\' | xargs -I {} docker pull ysicing/linkerd-io-{}\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | grep \\"gcr.io/linkerd-io\\" | awk -F/ \'{print $NF}\' | xargs -I {} docker tag ysicing/linkerd-io-{} hub.godu.dev/linkerd/{}\\nlinkerd install --ignore-cluster | grep image: | sed -e \'s/^ *//\' | sort | uniq | awk \'{print $2}\' | grep \\"gcr.io/linkerd-io\\" | awk -F/ \'{print $NF}\' | xargs -I {} docker push hub.godu.dev/linkerd/{}\\n```\\n\\n#### \u5b89\u88c5\\n\\n```bash\\nlinkerd check --pre\\nlinkerd install --registry hub.godu.dev/linkerd | kubectl apply -f -\\nlinkerd check\\n```\\n\\n#### \u542f\u7528\\n\\n```\\n# \u5df2\u6709\u5e94\u7528\\nkubectl get -n emojivoto deploy/web -o yaml | linkerd inject - | kubectl apply -f -\\n# go \u521b\u5efa\u5e94\u7528\\nfunc (app *TalkController) CustomAnnotations() map[string]string {\\n\\treturn map[string]string{\\n\\t\\t\\"linkerd.io/inject\\": \\"enabled\\",\\n\\t\\t//\\"prometheus.io/port\\": \\"12306\\",\\n\\t\\t//\\"prometheus.io/scrape\\": \\"true\\",\\n\\t}\\n}\\n# deploy\\n  template:\\n    metadata:\\n      annotations:\\n        linkerd.io/inject: enabled\\n        prometheus.io/port: \\"80\\"\\n        prometheus.io/scrape: \\"true\\"\\n```"},{"id":"/posts/k8s-minikube-install","metadata":{"permalink":"/posts/k8s-minikube-install","source":"@site/blog/posts/k8s-minikube-install.md","title":"minikube\u5b89\u88c5k8s","description":"minikube\u5b89\u88c5k8s","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"minikube","permalink":"/tags/minikube"}],"readingTime":0.16666666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"minikube\u5b89\u88c5k8s","date":"2020-05-18T14:55:18.000Z","description":"minikube\u5b89\u88c5k8s","tags":["kubernetes","minikube"]},"prevItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u5b89\u88c5linkerdv2","permalink":"/posts/k8s-linkerd-install"},"nextItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","permalink":"/posts/k8s-sa"}},"content":"\x3c!-- truncate --\x3e\\n\\n## minikube\u5b89\u88c5k8s\\n\\n### MacOS\u5b89\u88c5\\n\\n```bash\\nbrew install minikube\\n```\\n\\n```bash\\n# PROXY\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u9700\u8981\u8bbe\u7f6e\uff0c\u53ef\u4e0d\u8bbe\u7f6e\\nminikube start --cpus=2 --memory 4g --disk-size=40g --driver=virtualbox --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers --nodes=2 --docker-env HTTP_PROXY=http://192.168.99.1:7890 --docker-env HTTPS_PROXY=http://192.168.99.1:7890  --docker-env NO_PROXY=127.0.0.1/32,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost\\n```"},{"id":"/posts/k8s-sa","metadata":{"permalink":"/posts/k8s-sa","source":"@site/blog/posts/k8s-sa.md","title":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","description":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"}],"readingTime":2.1533333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","date":"2020-05-18T14:55:18.000Z","description":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","tags":["kubernetes"]},"prevItem":{"title":"minikube\u5b89\u88c5k8s","permalink":"/posts/k8s-minikube-install"},"nextItem":{"title":"NFS\u5b58\u50a8","permalink":"/posts/nfs-install-k8s"}},"content":"\x3c!-- truncate --\x3e\\n\\n## k8s \u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236\\n\\n\u5728k8s\u4e2d\uff0c\u7531\u7cfb\u7edf\u81ea\u8eab\u7684\u63a5\u53e3\u6765\u521b\u5efa\u548c\u7ba1\u7406\u7684\u8d26\u53f7\u7c7b\u578b\u53ea\u6709\u4e00\u79cd\uff0c\u53eb\u505a`ServiceAccount`\u3002\\n\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u67e5\u770b\u76ee\u524d\u7cfb\u7edf\u5df2\u6709\u7684`ServiceAccount`\uff0c\u7b80\u5199`sa`\\n\\n```\\n\u279c  ~ kubectl get sa\\nNAME      SECRETS   AGE\\ndefault   1         2d8h\\n```\\n\\n\u67e5\u770bsa\u5177\u4f53\u5b9a\u4e49\\n\\n```\\n\u279c  ~ kubectl get sa default -o yaml\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  creationTimestamp: \\"2020-01-05T06:27:59Z\\"\\n  name: default\\n  namespace: default\\n  resourceVersion: \\"428\\"\\n  selfLink: /api/v1/namespaces/default/serviceaccounts/default\\n  uid: 9881e9a3-4097-44b4-a9e3-e5a9d4e516e0\\nsecrets:\\n- name: default-token-8xcpl # \u5f15\u7528\u4e86\u540d\u4e3adefault-token-8xcpl\u7684secrets\\n\\n\u279c  ~ kubectl get secrets default-token-8xcpl  -o yaml\\napiVersion: v1\\ndata:\\n  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRJd01ERXdOVEEyTWpjeE5Gb1lEekl4TVRneE1qRXlNRFl5TnpFMFdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCnoyS0ttbzh2emdXWE1WR09hSy9DeWk2cGZ2T0psWUMxd1paRTdWS3IwTENFZDBQWXVKbk10NStQdVhKUkw4OFUKK2t2U0RGRm1RS3J6QUhCN0IwNGVybEwyd0NHeDZwa2FIOFBMMTJqKzdUUW5VS2doa1lHb1ZxUjNKV3NTSS9jcwo0ampGWTJyVmY3Z3pDNG9LbHlBc2VRdXFRaERPV004emtCalFYa3gyZVdnSSthRFNpOHd5SHNSNXZwK0Y4TkNOCnEreHY3bFczOERBcTB2SGlSYnBlZHVCTWpUTksyaHlYYWpyeFpWNTZxTTdnRUJWcVBjRCtUWmQySGs2SGQ2dlgKaGhTeTdUQ3lOY1kvbi9HNjRscTBUaG9JZTBWaFBncG8rU3JzRXVOVTBqWlFmRllDMDRWZlluSU0yZmxuSkY5YQpVWjkraVEza25ZR3RmSTA4cXRScjh3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFOWHdQUkRLd05yMEFzMVpiN1NWWnVQeSsKMVhtbWhWS3dVUmVROXF2QjQwWU5sTVBKMVVqbUNyVmdVRmM4WldmUEhwTmZ6Z2dXTUJUbFFrZDhOK1NhTHB3bAo0bTJtMlpmTTV6Q3R2QVg2MzhHZUVPYTViVkNHcXhudUNVOWQxb2p0M2JZSkYwZGxSMy9VY3FpaDRaeEdUL0syCkJweEZ5QXBRRUZ0elhVZmE0dTBYcFBwUU1aa2txK2hkd01mZjQ3VlBma3NUazUvN2ZaK08vUXk4SElSM00wWFEKUWZyRWpIRXRwL2VSU1hENm95ZHF4R2RKL0pOWU4rKzJYU05lRm51bDFOakh2bG1IT1JpRDI2S2Rqb24vT1Y5cgplYlp0T1oxRmJPVVVFNktJRG9CWTJIK0JCWVppNkwzajJBRkpFTFozWE5tNUdlSTB0NGduWW8zSXU0SnRmZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n  namespace: ZGVmYXVsdA==\\n  token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUnBTa2RCWlZwcVMwOVdOVmxCVDJkemQySTBkRlpPVVVkRlVHOVZYMXB0VDA1Q1dXeG5UVGhhTVdjaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUprWldaaGRXeDBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbVJsWm1GMWJIUXRkRzlyWlc0dE9IaGpjR3dpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1dVlXMWxJam9pWkdWbVlYVnNkQ0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG5WcFpDSTZJams0T0RGbE9XRXpMVFF3T1RjdE5EUmlOQzFoT1dVekxXVTFZVGxrTkdVMU1UWmxNQ0lzSW5OMVlpSTZJbk41YzNSbGJUcHpaWEoyYVdObFlXTmpiM1Z1ZERwa1pXWmhkV3gwT21SbFptRjFiSFFpZlEub1NwZ0w4V3liYlJEb0tvYUpxclJ1RkxGOUN6SW1tdlo3VEtWU1RXdVpnWVpCWTRRZ092NjVCbGFLTF9qQU9DSFNyQzd6WW5pSjlXVDVCcVd2N3dfQU9XdEhURVJWSU00Y3I5LXh6LUxMRHZ6bl9qZlNIR0VoSnBPZHZnMGppRFZydi0xanJOb2g1S3VKMGw0TlNULVBnemtUQTU5bWhfNzdodFRtdzJfaDJCWHNDWDBROFg1dm5uMTBMVFJaeHRtNnZTank5dVRIcUZpa0pkU2pTX2c1SjJiS3BXVW1sZnl6OWNKTkliNWhDS0hYVEYyWGlDaG9vMlI3RmdvcHc5X1ltNWxLc2JudGh0bHA5TDUzZ2M2UV9IUkRvb05hSk04RHZndTNybXJheUhPa193RkFTbE1XZ2NkZzF0OGNjYXIwM1V0aWZ5RElDS2s1OTBMM2d2T0hR\\nkind: Secret\\nmetadata:\\n  annotations:\\n    kubernetes.io/service-account.name: default\\n    kubernetes.io/service-account.uid: 9881e9a3-4097-44b4-a9e3-e5a9d4e516e0\\n  creationTimestamp: \\"2020-01-05T06:27:59Z\\"\\n  name: default-token-8xcpl\\n  namespace: default\\n  resourceVersion: \\"421\\"\\n  selfLink: /api/v1/namespaces/default/secrets/default-token-8xcpl\\n  uid: 2f07379e-80bb-4c24-a3e3-8a37d1c4c9fb\\ntype: kubernetes.io/service-account-token\\n```\\n\\n### \u521b\u5efasa\\n\\n```\\n\u279c  ~ kubectl create sa ysicing\\nserviceaccount/ysicing created\\n\\n\u279c  ~ kubectl get sa ysicing -o yaml\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  creationTimestamp: \\"2020-01-07T14:40:07Z\\"\\n  name: ysicing\\n  namespace: default\\n  resourceVersion: \\"134248\\"\\n  selfLink: /api/v1/namespaces/default/serviceaccounts/ysicing\\n  uid: e5f19802-a196-47d6-b194-3684642357ef\\nsecrets:\\n- name: ysicing-token-zvgr4\\n\\n# \u83b7\u53d6token,\u8fd9\u91cctoken\u662f\u539f\u59cbtoken\uff0c\u672a\u7ecf\u8fc7base64\u52a0\u5bc6\\nkubectl describe secrets ysicing-token-zvgr4\\n```\\n\\n\u6d4b\u8bd5\u8bf7\u6c42k8s api,\u53d1\u73b0\u8fd8\u662f403.\\n\\n```\\n\u279c  ~ curl -k  https://192.168.100.101:6443/healthz/ping -H \'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ\'\\n{\\n  \\"kind\\": \\"Status\\",\\n  \\"apiVersion\\": \\"v1\\",\\n  \\"metadata\\": {\\n\\n  },\\n  \\"status\\": \\"Failure\\",\\n  \\"message\\": \\"forbidden: User \\\\\\"system:serviceaccount:default:ysicing\\\\\\" cannot get path \\\\\\"/healthz/ping\\\\\\"\\",\\n  \\"reason\\": \\"Forbidden\\",\\n  \\"details\\": {\\n\\n  },\\n  \\"code\\": 403\\n}\\n```\\n\\nk8s\u5bf9\u8d44\u6e90\u64cd\u4f5c\u6743\u9650\u5212\u5206\u7684\u6bd4\u8f83\u8be6\u7ec6:\\n\\n- \u5199\u6743\u9650\\n    - create\\n    - update\\n    - delete\\n    - patch\\n- \u8bfb\u6743\u9650 \\n    - get\\n    - list\\n    - watch\\n\\n\u914d\u7f6esa ysicing\u8bbf\u95ee\u8d44\u6e90,\u5373\u914d\u7f6e `.kube/config`\\n\\n```\\n# \u914d\u7f6esa ysicing token\u9274\u6743\u4fe1\u606f\\nkubectl config set-credentials ysicing --token eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ\\n\\nUser \\"ysicing\\" set.\\n\\n# \u914d\u7f6e\u96c6\u7fa4\u8bbf\u95ee\u4fe1\u606f\\n# .kube/ca.crt \u4ece192.168.100.101:/etc/kubernetes/pki/ca.crt\u83b7\u53d6\u7684\\n\u279c  ~ kubectl config set-cluster local --server https://192.168.100.101:6443 --certificate-authority .kube/ca.crt --embed-certs=true\\nCluster \\"local\\" set.\\n\\n# \u914d\u7f6econtext, \u5c06cluster & user \u7ed1\u5b9a\\n\u279c  ~ kubectl config set-context local-ctx --cluster local --user ysicing\\nContext \\"local-ctx\\" created.\\n\\n# \u5207\u6362ctx\\n\u279c  ~ kubectl config use-context local-ctx\\nSwitched to context \\"local-ctx\\".\\n```\\n\\n\u8bf7\u6c42\u63a5\u53e3\\n\\n```\\n\u279c  ~ kubectl get pods\\nError from server (Forbidden): pods is forbidden: User \\"system:serviceaccount:default:ysicing\\" cannot list resource \\"pods\\" in API group \\"\\" in the namespace \\"default\\"\\n```\\n\\n### \u6388\u6743\u914d\u7f6e\\n\\n- \u521b\u5efa\u89d2\u8272\uff0c\u5b9a\u4e49\u8d44\u6e90\u64cd\u4f5c\u6743\u9650(ClusterRole/Role)\\n- \u89d2\u8272\u7ed1\u5b9a\uff0c\u5c06\u89d2\u8272\u4e0eSa\u7ed1\u5b9a(ClusterRoleBinding/RoleBinding)\\n\\n```\\n# \u521b\u5efa\u89d2\u8272\\n\u279c  ~ kubectl create role ysicing-role --resource pod,service,deployment,secret,ingress --verb create,update,delete,patch,get,list,watch\\nrole.rbac.authorization.k8s.io/ysicing-role created\\n\\n\u279c  ~ kubectl get roles\\nNAME           AGE\\nysicing-role   34s\\n\\n# \u89d2\u8272\u7ed1\u5b9a\\n\u279c  ~ kubectl create rolebinding ysbot.ysicing-binding --role ysicing-role --serviceaccount default:ysicing\\nrolebinding.rbac.authorization.k8s.io/ysbot.ysicing-binding created\\n```\\n\\n\u518d\u6b21\u83b7\u53d6pods\u4fe1\u606f\\n\\n```\\n\u279c  ~ kubectl config use-context local-ctx\\nSwitched to context \\"local-ctx\\".\\n\u279c  ~ kubectl get pods\\nNAME                               READY   STATUS    RESTARTS   AGE\\ndemo-deployment-6c5664f4d6-s6w8v   1/1     Running   0          2d4h\\n```\\n\\n\u518d\u6b21\u8bf7\u6c42`https://192.168.100.101:6443/healthz/ping`\u53d1\u73b0\u4f9d\u65e7403\uff0c\u90a3\u4e48\u7ed9ysicing sa\u901a\u8fc7ClusterRoleBinding \u6388\u4e88\u4e00\u4e2a\u540d\u4e3a cluster-admin \u7684 ClusterRole\\n\\n```\\n\u279c  ~ kubectl config use-context kubernetes-admin@kubernetes\\nSwitched to context \\"kubernetes-admin@kubernetes\\".\\n\u279c  ~ kubectl create clusterrolebinding cluster-ysicing --clusterrole cluster-admin --serviceaccount default:ysicing\\nclusterrolebinding.rbac.authorization.k8s.io/cluster-ysicing created\\n\\n\u279c  ~ curl -k  https://192.168.100.101:6443/healthz/ping -H \'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ.D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3-wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX-yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P-0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz-ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W-PZRFY_5_mV8fAJCVJ-E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ\'\\nok%\\n\\n# \u771f\u9999\u54c8\u54c8\u54c8\u54c8\\n```\\n\\n`cluster-admin`\u6743\u9650\u7279\u522b\u5927,\u5b9e\u9645\u4f7f\u7528\u8fd8\u9700\u8981\u8c28\u614e\u64cd\u4f5c\u3002\\n\\n```\\n# \u53ef\u4ee5\u67e5\u770b\u5177\u4f53\u5b9a\u4e49\\nkubectl get role ysicing-role\\n```"},{"id":"/posts/nfs-install-k8s","metadata":{"permalink":"/posts/nfs-install-k8s","source":"@site/blog/posts/nfs-install-k8s.md","title":"NFS\u5b58\u50a8","description":"NFS\u5b58\u50a8","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"csi","permalink":"/tags/csi"}],"readingTime":0.4533333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"NFS\u5b58\u50a8","date":"2020-05-18T14:55:18.000Z","description":"NFS\u5b58\u50a8","tags":["kubernetes","csi"]},"prevItem":{"title":"k8s\u5b9e\u8df5\u4e4b\u8d44\u6e90\u7ba1\u7406\u7684\u6743\u9650\u63a7\u5236","permalink":"/posts/k8s-sa"},"nextItem":{"title":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","permalink":"/posts/nodejs-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## NFS\u5b58\u50a8\\n\\n### Debian\\n\\n```\\n# \u5b89\u88c5\\napt update\\napt install -y nfs-kernel-server\\n# \u914d\u7f6e\\nmkdir /k8sdata\\necho \\"/k8sdata/ *(insecure,rw,sync,no_root_squash,no_subtree_check)\\" > /etc/exports\\n# \u542f\u52a8nfs\\nsystemctl enable rpcbind\\nsystemctl enable nfs-server\\nsystemctl start rpcbind\\nsystemctl start nfs-server\\nexportfs -r\\n# \u6d4b\u8bd5\\nshowmount -e 127.0.0.1\\n```\\n\\n### CentOS\\n\\n```\\n# \u5b89\u88c5nfs\\nyum install -y nfs-utils\\n# \u914d\u7f6e\u5171\u4eab\u76ee\u5f55\\nmkdir /k8sdata\\necho \\"/k8sdata *(insecure,rw,sync,no_root_squash)\\" > /etc/exports\\n# \u542f\u52a8nfs\\nsystemctl enable rpcbind\\nsystemctl enable nfs-server\\n\\nsystemctl start rpcbind\\nsystemctl start nfs-server\\nexportfs -r\\n# \u6d4b\u8bd5\\nshowmount -e 127.0.0.1\\n```\\n\\n### \u4e00\u952e\u90e8\u7f72nfs\u4e14\u914d\u7f6e\u9ed8\u8ba4\u5b58\u50a8\\n\\n```\\n# \u672a\u5b89\u88c5\u5b58\u50a8\\ncurl https://sh.ysicing.me/k7s/install/nfs/deploy.sh | bash\\n# \u5df2\u6709\u5b58\u50a8\\nwget https://sh.ysicing.me/k7s/install/nfs/deploy_exist_nfs.sh\\n./deploy_exist_nfs.sh <ip> <path>\\n```"},{"id":"/posts/nodejs-install","metadata":{"permalink":"/posts/nodejs-install","source":"@site/blog/posts/nodejs-install.md","title":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","description":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"nodejs","permalink":"/tags/nodejs"}],"readingTime":0.26666666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","date":"2020-05-18T14:55:18.000Z","description":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","tags":["nodejs"]},"prevItem":{"title":"NFS\u5b58\u50a8","permalink":"/posts/nfs-install-k8s"},"nextItem":{"title":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","permalink":"/posts/openldap-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406\\n\\n### \u5b89\u88c5nvm\\n\\n```bash\\n# \u5b89\u88c5\\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh | bash\\n# \u9ed8\u8ba4\u4f1a\u5199.zshrc\\n\\n### .zshrc nvm start \\nexport NVM_DIR=\\"$HOME/.nvm\\"\\n[ -s \\"$NVM_DIR/nvm.sh\\" ] && \\\\. \\"$NVM_DIR/nvm.sh\\"  # This loads nvm\\n[ -s \\"$NVM_DIR/bash_completion\\" ] && \\\\. \\"$NVM_DIR/bash_completion\\"  # This loads nvm bash_completion\\n### .zshrc nvm end\\n\\nsource .zshrc\\n\\nnvm install node # \\"node\\" is an alias for the latest version\\n```"},{"id":"/posts/openldap-install","metadata":{"permalink":"/posts/openldap-install","source":"@site/blog/posts/openldap-install.md","title":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","description":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"ldap","permalink":"/tags/ldap"}],"readingTime":0.43333333333333335,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","date":"2020-05-18T14:55:18.000Z","description":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","tags":["ldap"]},"prevItem":{"title":"\u4f7f\u7528nvm\u8fdb\u884cnode\u7248\u672c\u7ba1\u7406","permalink":"/posts/nodejs-install"},"nextItem":{"title":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","permalink":"/posts/systemd-timers"}},"content":"\x3c!-- truncate --\x3e\\n\\n## OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c\\n\\n> \u7b80\u4ecb\u8fd9\u91cc\u4e0d\u5728\u63cf\u8ff0\uff0cgoogle\u5373\u53ef\\n\\n### docke\u5feb\u901f\u90e8\u7f72\\n\\n```yaml\\nversion: \'2\'\\nservices:\\n  openldap:\\n    image: osixia/openldap:1.3.0\\n    container_name: openldap\\n    environment:\\n      LDAP_LOG_LEVEL: \\"256\\"\\n      LDAP_ORGANISATION: \\"Godu Inc.\\"\\n      LDAP_DOMAIN: \\"ysicing.me\\"\\n      LDAP_BASE_DN: \\"\\"\\n      LDAP_ADMIN_PASSWORD: \\"meadmin\\"\\n      LDAP_CONFIG_PASSWORD: \\"meconfig\\"\\n      LDAP_READONLY_USER: \\"true\\"\\n      LDAP_READONLY_USER_USERNAME: \\"readonly\\"\\n      LDAP_READONLY_USER_PASSWORD: \\"readonly\\"\\n      LDAP_RFC2307BIS_SCHEMA: \\"false\\"\\n      LDAP_BACKEND: \\"mdb\\"\\n      LDAP_TLS: \\"false\\"\\n      LDAP_REPLICATION: \\"false\\"\\n      KEEP_EXISTING_CONFIG: \\"false\\"\\n      LDAP_REMOVE_CONFIG_AFTER_SETUP: \\"true\\"\\n      LDAP_SSL_HELPER_PREFIX: \\"ldap\\"\\n    tty: true\\n    stdin_open: true\\n    ports:\\n      - \\"389:389\\"\\n      - \\"636:636\\"\\n    domainname: \\"ldap.ysicing.me\\" # important: same as hostname\\n#    hostname: \\"ldap.ysicing.me\\"\\n    command: [\\"--copy-service\\", \\"--loglevel\\", \\"debug\\"]\\n  phpldapadmin:\\n    image: osixia/phpldapadmin:latest\\n    container_name: phpldapadmin\\n    environment:\\n      PHPLDAPADMIN_LDAP_HOSTS: \\"openldap\\"\\n      PHPLDAPADMIN_HTTPS: \\"false\\"\\n    ports:\\n      - \\"8080:80\\"\\n    depends_on:\\n      - openldap\\n```\\n\\n### \u9a8c\u8bc1\\n\\n```\\ndin openldap\\nldapsearch -x -H ldap://localhost -b dc=ysicing,dc=me -D \'cn=admin,dc=ysicing,dc=me\' -w meadmin\\n```\\n\\n\u6216\u8005\u8bbf\u95ee`127.0.0.1:8080`"},{"id":"/posts/systemd-timers","metadata":{"permalink":"/posts/systemd-timers","source":"@site/blog/posts/systemd-timers.md","title":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","description":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"misc","permalink":"/tags/misc"},{"label":"linux","permalink":"/tags/linux"}],"readingTime":1.0166666666666666,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","date":"2020-05-18T14:55:18.000Z","description":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","tags":["misc","linux"]},"prevItem":{"title":"OpenLDAP\u5b89\u88c5\u521d\u4f53\u9a8c","permalink":"/posts/openldap-install"},"nextItem":{"title":"vim\u914d\u7f6e","permalink":"/posts/vim-config"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u5b9a\u65f6\u4efb\u52a1\uff0c\u5982\u6bcf65\u5206\u949f\u6267\u884c\u4e00\u6b21\\n\\n[crontab \u5b9a\u65f6\u4efb\u52a1 65 \u5206\u949f\u6267\u884c\u4e00\u6b21\uff0c\u600e\u4e48\u5199\uff1f](https://www.v2ex.com/t/631917#reply40)\\n\\n\u8fd9\u4e2a\u65f6\u5019\uff0c\u7528\u7cfb\u7edf\u81ea\u5e26\u7684crontab\u5c31\u4e0d\u597d\u5b9e\u73b0\u4e86,\u8fd9\u65f6\u5019\u5c31\u662fsystemd\u8be5\u4e0a\u573a\u4e86\\n\\n\\n\u53c2\u8003[Systemd \u5b9a\u65f6\u5668\u6559\u7a0b](http://www.ruanyifeng.com/blog/2018/03/systemd-timer.html)\\n\\n```\\ncat /etc/systemd/system/example.timer\\n[Unit]\\nDescription=example timer\\n\\n[Timer]\\nOnUnitActiveSec=1h\\nUnit=example.service\\n\\n[Install]\\nWantedBy=multi-user.target\\n\\ncat /etc/systemd/system/example.service\\n[Unit]\\nDescription=example\\n\\n[Service]\\nExecStart=<\u76f8\u5173\u547d\u4ee4>\\n[Install]\\nWantedBy=multi-user.target\\n```\\n\\n\u5b9a\u5236\u5b9a\u65f6\u5668\\n\\n```\\nOnActiveSec\uff1a\u5b9a\u65f6\u5668\u751f\u6548\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u5f00\u59cb\u6267\u884c\u4efb\u52a1\\nOnBootSec\uff1a\u7cfb\u7edf\u542f\u52a8\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u5f00\u59cb\u6267\u884c\u4efb\u52a1\\nOnStartupSec\uff1aSystemd \u8fdb\u7a0b\u542f\u52a8\u540e\uff0c\u591a\u5c11\u65f6\u95f4\u5f00\u59cb\u6267\u884c\u4efb\u52a1\\nOnUnitActiveSec\uff1a\u8be5\u5355\u5143\u4e0a\u6b21\u6267\u884c\u540e\uff0c\u7b49\u591a\u5c11\u65f6\u95f4\u518d\u6b21\u6267\u884c\\nOnUnitInactiveSec\uff1a \u5b9a\u65f6\u5668\u4e0a\u6b21\u5173\u95ed\u540e\u591a\u5c11\u65f6\u95f4\uff0c\u518d\u6b21\u6267\u884c\\nOnCalendar\uff1a\u57fa\u4e8e\u7edd\u5bf9\u65f6\u95f4\uff0c\u800c\u4e0d\u662f\u76f8\u5bf9\u65f6\u95f4\u6267\u884c\\nAccuracySec\uff1a\u5982\u679c\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\uff0c\u4efb\u52a1\u5fc5\u987b\u63a8\u8fdf\u6267\u884c\uff0c\u63a8\u8fdf\u7684\u6700\u5927\u79d2\u6570\uff0c\u9ed8\u8ba4\u662f60\u79d2\\nUnit\uff1a\u771f\u6b63\u8981\u6267\u884c\u7684\u4efb\u52a1\uff0c\u9ed8\u8ba4\u662f\u540c\u540d\u7684\u5e26\u6709.service\u540e\u7f00\u7684\u5355\u5143\\nPersistent\uff1a\u5982\u679c\u8bbe\u7f6e\u4e86\u8be5\u5b57\u6bb5\uff0c\u5373\u4f7f\u5b9a\u65f6\u5668\u5230\u65f6\u6ca1\u6709\u542f\u52a8\uff0c\u4e5f\u4f1a\u81ea\u52a8\u6267\u884c\u76f8\u5e94\u7684\u5355\u5143\\nWakeSystem\uff1a\u5982\u679c\u7cfb\u7edf\u4f11\u7720\uff0c\u662f\u5426\u81ea\u52a8\u5524\u9192\u7cfb\u7edf\\n```\\n\\nTimer\u548cService\u5927\u4f53\u7528\u6cd5\u4e00\u81f4"},{"id":"/posts/vim-config","metadata":{"permalink":"/posts/vim-config","source":"@site/blog/posts/vim-config.md","title":"vim\u914d\u7f6e","description":"vim\u914d\u7f6e","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"vim","permalink":"/tags/vim"}],"readingTime":1.3533333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"vim\u914d\u7f6e","date":"2020-05-18T14:55:18.000Z","description":"vim\u914d\u7f6e","tags":["vim"]},"prevItem":{"title":"Systemd \u5b9a\u65f6\u5668\u6559\u7a0b","permalink":"/posts/systemd-timers"},"nextItem":{"title":"vscode\u914d\u7f6e","permalink":"/posts/vscode-config"}},"content":"\x3c!-- truncate --\x3e\\n\\n### \u5b89\u88c5vim plug\\n\\n```\\ncurl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\\n```\\n\\n### \u5199\u914d\u7f6e\\n\\n\u5411`~/.vimrc`\u5199\u5165\\n\\n```\\n\\" autocmd BufWritePost $MYVIMRC source $MYVIMRC\\n\\n\\" \u5173\u95ed\u517c\u5bb9\u6a21\u5f0f\\n\\nset nocompatible\\n\\n\\" \u8bbe\u7f6e\u884c\u53f7\\nset nu\\n\\n\\"\u7a81\u51fa\u663e\u793a\u5f53\u524d\u884c,\u5217\\nset cursorline\\nset cursorcolumn\\n\\n\\"\u663e\u793a\u62ec\u53f7\u5339\u914d\\n\\nset showmatch\\n\\n\\" tab \u7f29\u8fdb\\nset tabstop=4 \\" \u8bbe\u7f6eTab\u957f\u5ea6\u4e3a4\u7a7a\u683c\\nset shiftwidth=4 \\" \u8bbe\u7f6e\u81ea\u52a8\u7f29\u8fdb\u957f\u5ea6\u4e3a4\u7a7a\u683c\\nset autoindent \\" \u7ee7\u627f\u524d\u4e00\u884c\u7684\u7f29\u8fdb\u65b9\u5f0f\uff0c\u9002\u7528\u4e8e\u591a\u884c\u6ce8\u91ca\\n\\n\\" \u5b9a\u4e49\u5feb\u6377\u952e\u7684\u524d\u7f00\uff0c\u5373<Leader>\\nlet mapleader=\\";\\"\\n\\n\\" ==== \u7cfb\u7edf\u526a\u5207\u677f\u590d\u5236\u7c98\u8d34 ====\\n\\" v \u6a21\u5f0f\u4e0b\u590d\u5236\u5185\u5bb9\u5230\u7cfb\u7edf\u526a\u5207\u677f\\nvmap <Leader>c \\"+yy\\n\\" n \u6a21\u5f0f\u4e0b\u590d\u5236\u4e00\u884c\u5230\u7cfb\u7edf\u526a\u5207\u677f\\nnmap <Leader>c \\"+yy\\n\\" n \u6a21\u5f0f\u4e0b\u7c98\u8d34\u7cfb\u7edf\u526a\u5207\u677f\u7684\u5185\u5bb9\\nnmap <Leader>v \\"+p\\n\\n\\" \u5f00\u542f\u5b9e\u65f6\u641c\u7d22\\nset incsearch\\n\\" \u641c\u7d22\u65f6\u5927\u5c0f\u5199\u4e0d\u654f\u611f\\nset ignorecase\\nsyntax enable\\nsyntax on                    \\" \u5f00\u542f\u6587\u4ef6\u7c7b\u578b\u4fa6\u6d4b\\nfiletype plugin indent on    \\" \u542f\u7528\u81ea\u52a8\u8865\u5168\\n\\n\\" \u9000\u51fa\u63d2\u5165\u6a21\u5f0f\u6307\u5b9a\u7c7b\u578b\u7684\u6587\u4ef6\u81ea\u52a8\u4fdd\u5b58\\nau InsertLeave *.go,*.sh,*.php write\\n\\n\\" \u63d2\u4ef6\\ncall plug#begin(\'~/.vim/plugged\')\\n\\n\\" \u53ef\u4ee5\u5feb\u901f\u5bf9\u9f50\u7684\u63d2\u4ef6\\nPlug \'junegunn/vim-easy-align\'\\n\\n\\" \u7528\u6765\u63d0\u4f9b\u4e00\u4e2a\u5bfc\u822a\u76ee\u5f55\u7684\u4fa7\u8fb9\u680f\\nPlug \'scrooloose/nerdtree\'\\n\\n\\" \u53ef\u4ee5\u5728\u5bfc\u822a\u76ee\u5f55\u4e2d\u770b\u5230 git \u7248\u672c\u4fe1\u606f\\nPlug \'Xuyuanp/nerdtree-git-plugin\'\\n\\n\\" \u81ea\u52a8\u8865\u5168\u62ec\u53f7\u7684\u63d2\u4ef6\uff0c\u5305\u62ec\u5c0f\u62ec\u53f7\uff0c\u4e2d\u62ec\u53f7\uff0c\u4ee5\u53ca\u82b1\u62ec\u53f7\\nPlug \'jiangmiao/auto-pairs\'\\n\\n\\" \u53ef\u4ee5\u5728 vim \u4e2d\u4f7f\u7528 tab \u8865\u5168\\nPlug \'vim-scripts/SuperTab\'\\n\\nPlug \'majutsushi/tagbar\'\\n\\n\\" go \u4e3b\u8981\u63d2\u4ef6\\nPlug \'fatih/vim-go\', { \'tag\': \'*\' }\\n\\" go \u4e2d\u7684\u4ee3\u7801\u8ffd\u8e2a\uff0c\u8f93\u5165 gd \u5c31\u53ef\u4ee5\u81ea\u52a8\u8df3\u8f6c\\nPlug \'dgryski/vim-godef\'\\n\\ncall plug#end()\\n\\n```\\n\\n### \u5b89\u88c5\u63d2\u4ef6\\n\\n```\\nvim ~/.vimrc\\n\\n# \u5b89\u88c5\u63d2\u4ef6\\n:PlugInstall\\n\\n# \u66f4\u65b0\u63d2\u4ef6\\n:PlugUpdate\\n```"},{"id":"/posts/vscode-config","metadata":{"permalink":"/posts/vscode-config","source":"@site/blog/posts/vscode-config.md","title":"vscode\u914d\u7f6e","description":"vscode\u914d\u7f6e","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"vscode","permalink":"/tags/vscode"},{"label":"go","permalink":"/tags/go"}],"readingTime":0.52,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"vscode\u914d\u7f6e","date":"2020-05-18T14:55:18.000Z","description":"vscode\u914d\u7f6e","tags":["vscode","go"]},"prevItem":{"title":"vim\u914d\u7f6e","permalink":"/posts/vim-config"},"nextItem":{"title":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","permalink":"/posts/wireguard-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## vscode\u914d\u7f6e\\n\\n### \u5b89\u88c5\u597dGo\u76f8\u5173\u63d2\u4ef6\uff0c\u914d\u7f6e\u5de5\u5177\u5305\\n\\n\u4f7f\u7528`command+shift+P`\u5feb\u6377\u952e,\u7136\u540e\u952e\u5165`Go: Install/Update Tools`\u9009\u4e2d\u5168\u90e8(\u6839\u636e\u9700\u8981),\u7a0d\u7b49\u7247\u523b\uff0c\u5c31\u4f1a\u5b89\u88c5\u5b8c\u6210\u3002\\n\\n### \u81ea\u5b9a\u4e49\u914d\u7f6e\u9879\\n\\n```json\\n{\\n    \\"git.autofetch\\": true,\\n    \\"files.autoSave\\": \\"onWindowChange\\",\\n    \\"workbench.colorTheme\\": \\"Go - Sources\\",\\n    \\"terminal.integrated.shell.osx\\": \\"/bin/zsh\\",\\n    \\"go.autocompleteUnimportedPackages\\": true,\\n    \\"go.gocodeAutoBuild\\": true,\\n    \\"go.useLanguageServer\\": true,\\n    \\"goOutliner.enableDebugChannel\\": true,\\n    \\"goOutliner.extendExplorerTab\\": true,\\n    \\"go.inferGopath\\": true,\\n    \\"go.docsTool\\": \\"godoc\\",\\n    \\"go.gocodePackageLookupMode\\": \\"go\\",\\n    \\"go.gotoSymbol.includeImports\\": true,\\n    \\"go.useCodeSnippetsOnFunctionSuggest\\": true, //\u4f7f\u7528\u4ee3\u7801\u7247\u6bb5\u63d0\u793a\\n    \\"go.useCodeSnippetsOnFunctionSuggestWithoutType\\": true,\\n    \\"go.formatTool\\": \\"goimports\\", //\u4ee3\u7801\u683c\u5f0f\u5316\\n   // \\"go.buildOnSave\\": true, //\u4fdd\u5b58\u4ee3\u7801\u65f6\u81ea\u52a8\u7f16\u8bd1\\n    \\"go.lintOnSave\\": \\"file\\", //\u4fdd\u5b58\u4ee3\u7801\u65f6\u4f18\u5316\\n    \\"go.vetOnSave\\": \\"package\\", //\u4fdd\u5b58\u4ee3\u7801\u65f6\u68c0\u67e5\u6f5c\u5728\u9519\u8bef\\n    \\"go.coverOnSave\\": false //\u4fdd\u5b58\u4ee3\u7801\u65f6\u6267\u884c\u6d4b\u8bd5\\n}\\n```"},{"id":"/posts/wireguard-install","metadata":{"permalink":"/posts/wireguard-install","source":"@site/blog/posts/wireguard-install.md","title":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","description":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","date":"2020-05-18T14:55:18.000Z","formattedDate":"2020\u5e745\u670818\u65e5","tags":[{"label":"wireguard","permalink":"/tags/wireguard"}],"readingTime":1.3433333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","date":"2020-05-18T14:55:18.000Z","description":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","tags":["wireguard"]},"prevItem":{"title":"vscode\u914d\u7f6e","permalink":"/posts/vscode-config"},"nextItem":{"title":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","permalink":"/posts/awk-func"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u5185\u7f51\u7a7f\u900f\u4e4bwireguard\\n\\n## \u5b89\u88c5\\n\\n#### Debian\\n\\n```\\n# Debian Bullseye \u4e4b\u524d\u7248\u672c\u90fd\u9700\u8981\u542f\u7528backports\u6e90\u6765\u652f\u6301\u5b89\u88c5\\napt install wireguard -y\\n```\\n\\n#### macOS\\n\\n```\\nbrew install wireguard-tools\\n```\\n\\n## \u914d\u7f6e\u670d\u52a1\u7aef\\n\\n```\\ncd /etc/wireguard\\n# \u521b\u5efa\u670d\u52a1\u7aef\u5bc6\u94a5\u5bf9\\numask 077\\nwg genkey | tee privatekey | wg pubkey > publickey\\n# \u521b\u5efawg0.conf\\ncat > /etc/wireguard/wg0.conf <<EOF\\n[Interface]\\nPrivateKey = <Private Key>\\nAddress = 10.0.0.1/24, fd86:ea04:1115::1/64\\nListenPort = 51820\\nPostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE\\nSaveConfig = true\\nEOF\\n# \u542f\u52a8\\nwg-quick up wg0\\n# \u5f00\u673a\u542f\u52a8\\nsystemctl enable wg-quick@wg0\\n# \u68c0\u67e5\\nwg show\\n```\\n\\n## \u914d\u7f6e\u5ba2\u6237\u7aef\\n\\n```\\numask 077\\nwg genkey | tee privatekey | wg pubkey > publickey\\ncat > /etc/wireguard/wg0.conf <<EOF\\n[Interface]\\nPrivateKey = <Output of privatekey file that contains your private key>\\nAddress = 10.0.0.2/24, fd86:ea04:1115::5/64\\nEOF\\n```\\n\\n## \u8fde\u63a5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\\n\\n### \u6cd5\u4e00 \u5ba2\u6237\u7aef\u64cd\u4f5c\\n\\n1. `wg-quick down wg0`\\n2. \u76f4\u63a5\u7f16\u8f91\u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6\\n3. \u542f\u52a8`wg-quick up wg0;systemctl enable wg-quick@wg0`\\n\\n```\\n# /etc/wireguard/wg0.conf \u65b0\u589e\\n[Peer]\\nPublicKey = <Server Public key>\\nEndpoint = <Server Public IP>:51820\\nAllowedIPs = 10.0.0.2/24, fd86:ea04:1115::5/64\\n```\\n\\n### \u6cd5\u4e8c \u670d\u52a1\u7aef\u64cd\u4f5c\\n\\n```\\nwg set wg0 peer <Client Public Key> endpoint <Client IP address>:51820 allowed-ips 203.0.113.12/24,fd86:ea04:1115::5/64\\n```\\n\\n\\n## \u95ee\u9898\u89e3\u51b3\\n\\n```\\n# 1. \u5185\u6838\u6a21\u5757\u6ca1\u6709\\nlsmod | grep wireguard && echo yes || echo no\\nno\\nmodprobe wireguard\\nmodprobe: FATAL: Module wireguard not found in directory /lib/modules/5.4.0-0.bpo.4-amd64\\n\\ndkms status\\nwireguard, 0.0.20200318, 4.19.0-8-amd64, x86_64: installed\\nuname -a\\nLinux cn3 5.4.0-0.bpo.4-amd64 #1 SMP Debian 5.4.19-1~bpo10+1 (2020-03-09) x86_64 GNU/Linux\\n\\ndkms autoinstall\\nError! Your kernel headers for kernel 5.4.0-0.bpo.4-amd64 cannot be found.\\nPlease install the linux-headers-5.4.0-0.bpo.4-amd64 package\\n\\n# \u89e3\u51b3\u65b9\u5f0f\\napt install -y linux-headers-5.4.0-0.bpo.4-amd64\\n\\n# ipv6 RTNETLINK answers: Permission denied\\n\u542f\u7528ipv6\u5373\u53ef\\nnet.ipv6.conf.all.disable_ipv6=0\\n```"},{"id":"/posts/awk-func","metadata":{"permalink":"/posts/awk-func","source":"@site/blog/posts/awk-func.md","title":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","description":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","date":"2019-12-18T14:55:18.000Z","formattedDate":"2019\u5e7412\u670818\u65e5","tags":[{"label":"shell","permalink":"/tags/shell"}],"readingTime":0.5333333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","date":"2019-12-18T14:55:18.000Z","description":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","tags":["shell"]},"prevItem":{"title":"\u5185\u7f51\u7a7f\u900f\u4e4bwireguard","permalink":"/posts/wireguard-install"},"nextItem":{"title":"Docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u6865ip\u5730\u5740","permalink":"/posts/docker-default-address-pools"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u4e0a\u5468\u6709\u9047\u5230\u8fc7\u8fd9\u4e2a\u95ee\u9898 `awk \'{print $$1}\'` \u8fd9\u4e2a$$\u662f\u4ec0\u4e48\u7528\u6cd5\u5462\\n\\n\u95f4\u63a5\u5b57\u6bb5\u5bfb\u5740,\u5176\u7c7b\u4f3c\\n\\n```\\nawk \'{print $$1}\' ===> awk \'{print $($1)}\' ===> awk \'{Nr=$1; print $Nr}\'\\n```\\n\\n\u793a\u4f8b:\\n\\n```\\n$ echo -e \\"1 b c d\\\\n2 b c d\\\\n3 b c d\\\\n4 b c d\\" \\n1 b c d\\n2 b c d\\n3 b c d\\n4 b c d\\n\\n$ echo -e \\"1 b c d\\\\n2 b c d\\\\n3 b c d\\\\n4 b c d\\" | awk \'{print $$1}\'\\n1  # since filed #1=1 result print first field\\nb  # since filed #1=2 result print secondfield\\nc  # since filed #1=3 result print third field\\nd  # since filed #1=4 result print fourth field\\n```\\n\\n\u7c7b\u4f3c$\u53ef\u4ee5\u6839\u636e\u9700\u8981\u6dfb\u52a0\u66f4\u591a\\n\\n```\\nawk \'{print $$$1}\' ===>  awk \'{print $$($1)}\' ===> awk \'{print $($($1))}\'\\n```"},{"id":"/posts/docker-default-address-pools","metadata":{"permalink":"/posts/docker-default-address-pools","source":"@site/blog/posts/docker-default-address-pools.md","title":"Docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u6865ip\u5730\u5740","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u7edcip\u6bb5","date":"2019-09-13T10:24:06.000Z","formattedDate":"2019\u5e749\u670813\u65e5","tags":[{"label":"docker","permalink":"/tags/docker"},{"label":"cri","permalink":"/tags/cri"}],"readingTime":0.23,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u6865ip\u5730\u5740","date":"2019-09-13T10:24:06.000Z","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u7edcip\u6bb5","tags":["docker","cri"]},"prevItem":{"title":"awk \u4e2d\u5173\u4e8e\u591a\u4e2a$\u7684\u7528\u6cd5","permalink":"/posts/awk-func"},"nextItem":{"title":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","permalink":"/posts/aliyun-debian-upgrade-kernel"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u8bb0\u5f55\u4e00\u4e0b\\n\\n## \u4fee\u6539docker\u9ed8\u8ba4\u6865\u63a5\u7f51\u7edcip\u6bb5\\n\\n```bash\\ncat > /etc/docker/daemon.json <<EOF\\n{\\n  \\"registry-mirrors\\": [\\"https://dyucrs4l.mirror.aliyuncs.com\\"],\\n  \\"bip\\": \\"169.254.0.1/24\\",\\n  \\"max-concurrent-downloads\\": 10,\\n  \\"log-driver\\": \\"json-file\\",\\n  \\"log-level\\": \\"warn\\",\\n  \\"log-opts\\": {\\n    \\"max-size\\": \\"20m\\",\\n    \\"max-file\\": \\"2\\"\\n  },\\n  \\"default-address-pools\\": [\\n    {\\n      \\"base\\": \\"100.250.0.0/16\\",\\n      \\"size\\": 24\\n    }\\n  ],\\n  \\"storage-driver\\": \\"overlay2\\"\\n}\\nEOF\\n```\\n\\n\u91cd\u542fdocker\\n\\n```bash\\nsystemctl restart docker\\n```\\n\\n\u53c2\u8003\u6587\u6863 [dockerd](https://docs.docker.com/engine/reference/commandline/dockerd/)"},{"id":"/posts/aliyun-debian-upgrade-kernel","metadata":{"permalink":"/posts/aliyun-debian-upgrade-kernel","source":"@site/blog/posts/aliyun-debian-upgrade-kernel.md","title":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","description":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","date":"2019-05-18T14:55:18.000Z","formattedDate":"2019\u5e745\u670818\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":0.56,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","date":"2019-05-18T14:55:18.000Z","description":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","tags":["debian"]},"prevItem":{"title":"Docker\u914d\u7f6e\u9ed8\u8ba4\u7f51\u6865ip\u5730\u5740","permalink":"/posts/docker-default-address-pools"},"nextItem":{"title":"\u4e00\u952e\u5b89\u88c5go1.17","permalink":"/posts/go-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838\\n\\n> \u5347\u7ea7\u6709\u98ce\u9669\u8bf7\u614e\u91cd\u54e6\\n\\n#### \u914d\u7f6e\u8bf4\u660e\\n\\n> \u963f\u91cc\u4e91HK 1\u68381G1TB30Mbps \xa524/m\\n> Debian 9.9\\n\\n\\n#### \u66f4\u65b0\u6e90\\n\\n> \u9700\u8981\u79fb\u9664\u9ed8\u8ba4\u6e90\uff0c\u4f7f\u7528\u5982\u4e0b\u6e90\\n\\n```\\n# \u9700\u8981\u6dfb\u52a0buster-backports\u6e90\\nsed -i \\"s#stretch#buster#g\\" /etc/apt/sources.list\\n# \u793a\u4f8b\\ndeb http://mirrors.a li yun c/debian/ buster main contrib non-free\\ndeb http://mirrors.aliyun.com/debian/ buster-updates main contrib non-free\\ndeb http://mirrors.aliyun.com/debian/ buster-proposed-updates main non-free contrib\\ndeb http://mirrors.aliyun.com/debian/ buster-backports main non-free contrib\\ndeb http://mirrors.aliyun.com/debian-security/ buster/updates main non-free contrib\\n```\\n\\n\u66f4\u65b0\u5347\u7ea7\\n\\n```bash\\napt-get update\\napt-get dist-upgrade -y\\n```\\n\\n#### \u5347\u7ea7\u5230\u6700\u65b0\u5185\u6838\\n\\n```\\napt-get install -t buster-backports linux-image-amd64 -y\\nupdate-grub\\napt autoclean\\napt autoremove -y\\nreboot\\n```\\n\\n#### \u5347\u7ea7\u5b8c\u6210\u540edocker\u65e0\u6cd5\u542f\u52a8\\n\\n```\\nprior storage driver aufs failed: driver not supported\\n```\\n\\n\u5220\u9664`/var/lib/docker`\uff0cdocker\u5b58\u50a8\u7531aufs\u53d8\u6210overlay2"},{"id":"/posts/go-install","metadata":{"permalink":"/posts/go-install","source":"@site/blog/posts/go-install.md","title":"\u4e00\u952e\u5b89\u88c5go1.17","description":"\u4e00\u952e\u5b89\u88c5go1.17.1","date":"2019-05-18T14:55:18.000Z","formattedDate":"2019\u5e745\u670818\u65e5","tags":[{"label":"go","permalink":"/tags/go"}],"readingTime":0.5766666666666667,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u4e00\u952e\u5b89\u88c5go1.17","date":"2019-05-18T14:55:18.000Z","description":"\u4e00\u952e\u5b89\u88c5go1.17.1","tags":["go"]},"prevItem":{"title":"\u963f\u91cc\u4e91\u8f7b\u91cf\u5e94\u7528\u670d\u52a1\u5668\u5347\u7ea7\u5185\u6838","permalink":"/posts/aliyun-debian-upgrade-kernel"},"nextItem":{"title":"AdGuard\u4f7f\u7528\u59ff\u52bf","permalink":"/posts/dns-adguard-install"}},"content":"\x3c!-- truncate --\x3e\\n\\n## Linux\u73af\u5883\u4e00\u952e\u811a\u672c\\n\\n```bash\\ncurl https://sh.ysicing.me/install/go.sh | bash\\n```\\n\\n### ChangeLog\\n\\n#### 20210911\\n\\n- \u66f4\u65b0\u811a\u672c\u652f\u6301lima\u666e\u901a\u7528\u6237\\n- go\u5347\u7ea7\u52301.17.1\\n\\n## Mac\u5b89\u88c5\\n\\n\u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e86brew\uff0c\u5c31\u53ef\u4ee5\u5feb\u901f\u5b89\u88c5\u4e86\\n\\n```\\n# \u5b89\u88c5git\\nbrew install git\\n\\n# \u5b89\u88c5go\\nbrew install go\\n\\n# add GOBIN path to your PATH in ~/.zshrc\\nexport GO111MODULE=on\\nexport GOPROXY=https://goproxy.cn\\nexport GOPATH=\\"/Users/ysicing/go\\" # \u793a\u4f8b\\nexport GOBIN=\\"$GOPATH/bin\\"\\nexport PATH=$HOME/bin:/usr/local/bin:/usr/local/opt/mysql-client/bin:$GOBIN:$PATH\\n```\\n\\n### \u914d\u7f6eVisual Studio Code Editor\\n\\n```\\n\u5feb\u6377\u952ecmd+shift+p\\n\u952e\u5165: go install\\n\u9009\u62e9 \\"Go: Install/Update Tools\\"\\nCheck all the checkboxes\\n```\\n\\n## Linux\u5b89\u88c5\\n\\n\u8bbf\u95ee [golang\u4e2d\u56fd](https://golang.google.cn/dl/) \u83b7\u53d6\u6700\u65b0go\u7248\u672c\\n\\n```bash\\n# \u4e0b\u8f7d\\nwget https://dl.google.com/go/go1.17.linux-amd64.tar.gz\\n# \u89e3\u538b\\ntar -C /usr/local -xzf go1.17.linux-amd64.tar.gz\\n# \u914d\u7f6e .bashrc\\nexport GO111MODULE=on\\nexport GOPROXY=https://goproxy.cn\\nexport GOPATH=\\"/root/go\\"\\nexport GOBIN=\\"$GOPATH/bin\\"\\nexport PATH=$PATH:$GOBIN:/usr/local/go/bin\\nsource .bashrc\\n# \u9a8c\u8bc1\\ngo env\\n```"},{"id":"/posts/dns-adguard-install","metadata":{"permalink":"/posts/dns-adguard-install","source":"@site/blog/posts/dns-adguard-install.md","title":"AdGuard\u4f7f\u7528\u59ff\u52bf","description":"AdGuard\u4f7f\u7528\u59ff\u52bf","date":"2019-04-18T14:55:18.000Z","formattedDate":"2019\u5e744\u670818\u65e5","tags":[{"label":"dns","permalink":"/tags/dns"},{"label":"tools","permalink":"/tags/tools"}],"readingTime":0.95,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"AdGuard\u4f7f\u7528\u59ff\u52bf","date":"2019-04-18T14:55:18.000Z","description":"AdGuard\u4f7f\u7528\u59ff\u52bf","tags":["dns","tools"]},"prevItem":{"title":"\u4e00\u952e\u5b89\u88c5go1.17","permalink":"/posts/go-install"},"nextItem":{"title":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","permalink":"/posts/mips64el-loongson-k8s"}},"content":"\x3c!-- truncate --\x3e\\n\\n> AdGuard Home\u4f7f\u7528Golang\u5f00\u53d1\uff0c\u56e0\u6b64\u5b89\u88c5\u975e\u5e38\u7b80\u5355\uff0c\u8fd9\u91cc\u4ee5\u5bb9\u5668\u7684\u65b9\u5f0f\u90e8\u7f72\u4e3a\u4f8b\uff0c\u5176\u5b83\u65b9\u5f0f\u53ef\u53c2\u8003\u5b98\u65b9\u5e2e\u52a9\u6587\u6863\u3002\\n\\n### \u4e3b\u8981\u529f\u80fd\\n\\n- \u62e6\u622aAD\\n- \u53f7\u79f0\u9690\u79c1\u4fdd\u62a4\\n- \u5bb6\u5ead\u4fdd\u62a4\u6a21\u5f0f\\n- \u81ea\u5b9a\u4e49\u8fc7\u6ee4(\u52ab\u6301) (\ud83d\ude02\u6211\u7528\u7684\u6700\u591a\u7684\u662f\u8fd9\u4e2a)\\n\\n### \u90e8\u7f72\\n\\n\u4e8c\u8bdd\u4e0d\u8bf4\u76f4\u63a5\u4e0a\\n\\n```yaml\\n# docker-compose.yaml\\nversion: \'2.1\'\\nservices:\\n  caddy:\\n    image: spanda/caddy\\n    container_name: caddy\\n    volumes:\\n    - ./ssl:/root/.caddy\\n    - /var/log/caddy:/var/log/caddy\\n    - ./Caddyfile:/etc/Caddyfile\\n    network_mode: host\\n    restart: always\\n  dns:\\n    image: adguard/adguardhome\\n    container_name: dns\\n    volumes:\\n    - ./ad/conf:/opt/adguardhome/conf\\n    - ./ad/work:/opt/adguardhome/work\\n    network_mode: host\\n    restart: always\\n\\n# Caddyfile\\ndns.ysicing.net {\\n   gzip\\n   tls root@ysicing.net\\n   log / /var/log/caddy/dns.ysicing.net.log \\"{remote} {when} {method} {uri} {proto} {status} {size} {>User-Agent} {latency}\\" {\\n        rotate_size 50\\n        rotate_age  90\\n        rotate_keep 20\\n        rotate_compress\\n        }\\n\\t\\n    header / {\\n        Strict-Transport-Security \\"max-age=31536000;includeSubDomains;preload\\"\\n\\t\\tAccess-Control-Allow-Origin  *\\n\\t\\tAccess-Control-Allow-Methods \\"GET, POST, OPTIONS\\"\\n        -Server\\n    }\\n    proxy / 127.0.0.1:7070 {\\n        transparent\\n        websocket\\n    }\\n}\\n```\\n\\n\u8bbf\u95ee\u516c\u7f51`IP:3000`,\u6309\u7740\u65e0\u8111\u4e00\u987f\u731b\u64cd\u4f5c\u3002\u4fee\u6539\u9ed8\u8ba4web\u76d1\u542c\u7aef\u53e3\u4e3a127.0.0.1:7070,53\u7aef\u53e3\u9ed8\u8ba4\u76d1\u542c\u5168\u90e8\u3002\\n\\n\\n### \u4f7f\u7528\\n\\n#### Windows\\n\\n1. \u6253\u5f00\u7f51\u7edc\u548cInternet\u8bbe\u7f6e\\n2. \u6253\u5f00\u7f51\u7edc\u548c\u5171\u4eab\u4e2d\u5fc3\\n3. \u6253\u5f00\u4ee5\u592a\u7f51\\n4. \u6253\u5f00\u5c5e\u6027\\n5. \u7f16\u8f91TCP/IPV4\\n6. \u4f7f\u7528\u4e0b\u9762\u7684DNS\u670d\u52a1\u5668 \u9996 59.110.220.53 \u5907 8.8.8.8\\n\\n#### Mac\\n\\n\u8df3\u8fc7\u5f88\u7b80\u5355\\n\\n#### \u5b89\u5353\\n\\n\u81ea\u5df1\u6298\u817e\u5427\uff0c\u79c1\u6709dns\u641e\u4e0d\u5b9a\uff0c\u5b98\u65b9APP\u53ef\u4ee5"},{"id":"/posts/mips64el-loongson-k8s","metadata":{"permalink":"/posts/mips64el-loongson-k8s","source":"@site/blog/posts/mips64el-loongson-k8s.md","title":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","description":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","date":"2018-05-18T14:55:18.000Z","formattedDate":"2018\u5e745\u670818\u65e5","tags":[{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"mips64el","permalink":"/tags/mips-64-el"}],"readingTime":0.9033333333333333,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","date":"2018-05-18T14:55:18.000Z","description":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","tags":["kubernetes","mips64el"]},"prevItem":{"title":"AdGuard\u4f7f\u7528\u59ff\u52bf","permalink":"/posts/dns-adguard-install"},"nextItem":{"title":"mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","permalink":"/posts/mysql8-binlog-too-large"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u4e0d\u4f1a\u5177\u4f53\u8bb2\u600e\u4e48\u90e8\u7f72\uff0c\u539f\u7406\u90fd\u7c7b\u4f3c,\u5c06\u539f\u5148amd64\u6362\u6210mips64el\\n\\n## \u4e2d\u6807\u9e92\u9e9f\u9f99\u82afCPU\u6e90\\n\\n```bash\\n# /etc/yum.repos.d/ns7-mips.repo\\n[ns7-mips64el-os]\\nname=NeoKylin Linux Advanced Server 7 - $basearch - Os\\nbaseurl=http://download.cs2c.com.cn/neokylin/server/releases/7.0/ls_64/\\ngpgcheck=0\\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release\\nenabled=1\\n\\n[ns7-mips64el-extras]\\nname=NeoKylin Linux Advanced Server 7 - Addons\\nbaseurl=http://download.cs2c.com.cn/neokylin/server/everything/7.0/ls_64/\\ngpgcheck=0\\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release\\nenabled=0\\n\\n[ns7-mips64el-updates]\\nname=NeoKylin Linux Advanced Server 7 - Updates\\nbaseurl=http://download.cs2c.com.cn/neokylin/server/updates/7.0/ls_64/\\ngpgcheck=0\\ngpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release\\nenabled=1\\n```\\n\\n\u8fd8\u6709\u4e00\u4e2a\u5c31\u662f\u9f99\u82af\u81ea\u5df1\u7684\u4ed3\u5e93\u6bd4\u8f83\u8ff7\uff0c\u4f46\u662f\u8f6f\u4ef6\u5305\u6bd4\u8f83\u65b0\\n\\n```bash\\nhttp://ftp.loongnix.org/os/loongnix/1.0/\\n```\\n\\n## \u57fa\u7840\u955c\u50cf\\n\\n### neokylin\u57fa\u7840\u955c\u50cf\\n\\n```bash\\nwget https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-yum.sh\\nchmod +x ./mkimage-yum.sh\\n./mkimage-yum.sh -y /etc/yum.conf nk-base\\n\\nwget http://list.isoftos.win/script/create_docker_image.loogson\\nchmod +x create_docker_image.loogson\\n./create_docker_image.loogson nk-base\\n```\\n\\n### debian\u57fa\u7840\u955c\u50cf\\n\\n\u53ef\u4ee5\u901a\u8fc7\u5f02\u6784\u6784\u5efa\u955c\u50cf\u65b9\u5f0f\\n\\n\u53ef\u4ee5\u53c2\u8003\u5927\u4f6c\u9879\u76ee [debian-debootstrap](https://github.com/liupeng0518/debian-debootstrap)\\n\\n## k8s\u7f16\u8bd1\\n\\n### \u5bbf\u4e3b\u673a\u7f16\u8bd1\\n\\n> 4\u683816G,\u6027\u80fd\u592a\u5dee,\u6e90\u7801\u7f16\u8bd1\u5b89\u88c5go\u65b0\u7248\u672c\u5dee\u4e0d\u591a\u4e24\u5c0f\u65f6\\n\\n### \u901a\u8fc7\u5f02\u6784\u955c\u50cf\u7f16\u8bd1\\n\\n\u5927\u6982\u4fee\u6539\u5370\u8c61: \\n\\n```bash\\n# \u7b2c\u4e00\u5904\\nmips64*)\\n    host_arch=mips64le\\n    ;;\\n# \u7b2c\u4e8c\u5904\\n\\"linux/mips64le\\")\\n    export CGO_ENABLED=1\\n    export CC=mips64el-linux-gnu-gcc\\n    ;;\\n# \u7b2c\u4e09\u5904\\nlinux/mips64le\\n# \u7b2c\u56db\u5904\\nuint64\u8f6c\u6362\u4e00\u4e0b\\n```\\n\\n\u5177\u4f53\u53ef\u4ee5\u901a\u8fc7make <xxx\u7ec4\u4ef6\u540d>\\n\\n## pause\u955c\u50cf\\n\\n\u8fd9\u4e2a\u5f97\u6ce8\u610f\u4e00\u4e0b, \u4e0d\u80fd\u7528\u7a7a\u955c\u50cf\uff0c\u53ef\u4ee5\u4f7f\u7528\u57fa\u7840\u955c\u50cf"},{"id":"/posts/mysql8-binlog-too-large","metadata":{"permalink":"/posts/mysql8-binlog-too-large","source":"@site/blog/posts/mysql8-binlog-too-large.md","title":"mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","description":"\u672c\u6587\u4e3b\u8981mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","date":"2018-05-18T14:55:18.000Z","formattedDate":"2018\u5e745\u670818\u65e5","tags":[{"label":"mysql","permalink":"/tags/mysql"}],"readingTime":0.53,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","date":"2018-05-18T14:55:18.000Z","description":"\u672c\u6587\u4e3b\u8981mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","tags":["mysql"]},"prevItem":{"title":"\u9f99\u82afMips64el\u5e73\u53f0\u4e0a\u90e8\u7f72K8s","permalink":"/posts/mips64el-loongson-k8s"},"nextItem":{"title":"Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357","permalink":"/posts/debian-op"}},"content":"\x3c!-- truncate --\x3e\\n\\n:::info\\n\u57fa\u4e8e`bitnami/mysql:8.0`\u64cd\u4f5c\\n:::\\n\\n## \u4e34\u65f6\u64cd\u4f5c(\u5b9e\u8df5\u7248\u672c 8.0)\\n\\n```mysql\\n# \u67e5\u770bbinlog\u5217\u8868\\nshow binary logs;\\n# \u67e5\u770bbinlog\u8fc7\u671f\u65f6\u95f4, \u9ed8\u8ba430\u5929(2592000)\\nshow variables like \'%binlog_expire_logs_seconds%\';\\n# \u4fee\u6539\u4e3a 3\u5929(259200)\\nset global binlog_expire_logs_seconds=259200;\\n# \u5237\u65b0\u65e5\u5fd7\\nflush logs;\\n```\\n\\n## \u6c38\u4e45\u64cd\u4f5c(\u672a\u5b9e\u8df5)\\n\\n\u4fee\u6539`my.cnf`\\n\\n```bash\\n# \u8bbe\u7f6ebinlog\u65e5\u5fd7\u5927\u5c0f\\nmax_binlog_size = 500M\\n# \u8bbe\u7f6e\u8fc7\u671f\u6e05\u7406\u65f6\u95f4\\nexpire_logs_days = 3\\n```\\n\\n## 5.7\u7248\u672c\u6570\u636e\u5e93(\u672a\u5b9e\u8df5)\\n\\n```mysql\\n# \u67e5\u770bbinlog\u5217\u8868\\nshow binary logs;\\n# \u67e5\u770bbinlog\u8fc7\u671f\u65f6\u95f4, \u9ed8\u8ba490\u5929, 0\u8868\u793a\u6c38\u4e0d\u8fc7\u671f\\nshow variables like \'%expire_logs_days%\';\\n# \u4fee\u6539\u4e3a 3\u5929\\nset global expire_logs_days=3;\\n# \u5237\u65b0\u65e5\u5fd7\\nflush logs;\\n```"},{"id":"/posts/debian-op","metadata":{"permalink":"/posts/debian-op","source":"@site/blog/posts/debian-op.md","title":"Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357","description":"Debian\u5e38\u7528\u64cd\u4f5c\u6307\u5357","date":"2017-05-18T14:55:18.000Z","formattedDate":"2017\u5e745\u670818\u65e5","tags":[{"label":"debian","permalink":"/tags/debian"}],"readingTime":1.6866666666666668,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357","date":"2017-05-18T14:55:18.000Z","description":"Debian\u5e38\u7528\u64cd\u4f5c\u6307\u5357","tags":["debian"]},"prevItem":{"title":"mysql\u6570\u636e\u5e93binlog\u65e5\u5fd7\u592a\u5927\u89e3\u51b3\u529e\u6cd5","permalink":"/posts/mysql8-binlog-too-large"},"nextItem":{"title":"README","permalink":"/posts/blog-notice"}},"content":"\x3c!-- truncate --\x3e\\n\\n## \u4e00\u952e\u6700\u65b0\u811a\u672c\\n\\n```bash\\nexport MIRRORS=\\"http://mirrors.aliyun.com\\" # \u9ed8\u8ba4\u662f\u6e05\u534e\u6e90\\ncurl -s https://sh.ysicing.me/debian/init.sh | bash\\n```\\n\\n## Debian 11\\n\\n> \u8d76\u7d27\u5347\u7ea7Debian 11, \u597d\u5904\u591a\u591a\\n\\n### \u5347\u7ea7debian10(buster)\u5185\u6838\u7248\u672c\\n\\n```bash\\nsed -i \'s/buster\\\\/updates/bullseye-security/g;s/buster/bullseye/g\' /etc/apt/sources.list\\n\\napt update\\napt dist-upgrade -y\\n# apt install -t bullseye-backports linux-image-amd64 -y\\n# update-grub\\n# reboot\\n# \u5185\u6838\\nLinux bj01 5.10.0-0.bpo.8-amd64 #1 SMP Debian 5.10.46-2~bpo10+1 (2021-07-22) x86_64 GNU/Linux\\n```\\n\\n<hr />\\n\\n## Debian 10\u5b58\u6863\\n\\n### \u521b\u5efaDebian\u865a\u62df\u673a\\n\\n```bash\\nUsage:\\n  ergo vm create [flags]\\n\\nFlags:\\n  -h, --help            help for create\\n      --path string     Vagrantfile\u6240\u5728\u76ee\u5f55, $HOME/vm\\n      --vmcpus string   \u865a\u62df\u673aCPU\u6570 (default \\"2\\")\\n      --vmmem string    \u865a\u62df\u673aMem MB\u6570 (default \\"4096\\")\\n      --vmname string   \u865a\u62df\u673a\u540d\\n      --vmnum string    \u865a\u62df\u673a\u526f\u672c\u6570 (default \\"1\\")   \\n```\\n\\n\u9ed8\u8ba4\u4f7f\u7528ergo\u521b\u5efa\u865a\u62df\u673a\\n\\n```bash\\nergo vm create --vmcpus 4 --vmmem 8192 --vmname debian\\n```\\n\\n\u6216\u8005\u81ea\u884c\u4f7f\u7528`Vagrantfile`\\n\\n```ruby\\n# -*- mode: ruby -*-\\n# vi: set ft=ruby :\\n\\nVagrant.configure(\\"2\\") do |config|\\n  config.vm.box_check_update = false\\n  config.vm.provider \'virtualbox\' do |vb|\\n   vb.customize [ \\"guestproperty\\", \\"set\\", :id, \\"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\\", 1000 ]\\n  end\\n  $num_instances = 1\\n  (1..$num_instances).each do |i|\\n    config.vm.define \\"debian#{i}\\" do |node|\\n      node.vm.box = \\"ysicing/debian\\"\\n      node.vm.hostname = \\"debian#{i}\\"\\n      node.vm.network \\"public_network\\", use_dhcp_assigned_default_route: true, bridge: \'en0: Wi-Fi (Wireless)\'\\n      # node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"ntpdate ntp.api.bz\\"\\n      node.vm.network \\"private_network\\", ip: \\"11.11.11.11#{i}\\"\\n      node.vm.provision \\"shell\\", run: \\"always\\", inline: \\"echo hello from debian#{i}\\"\\n      node.vm.provider \\"virtualbox\\" do |vb|\\n        vb.gui = false\\n        vb.memory = 8192\\n        vb.cpus = 4\\n        vb.name = \\"debian#{i}\\"\\n        vb.customize [\\"modifyvm\\", :id, \\"--natdnshostresolver1\\", \\"on\\"]\\n        vb.customize [\\"modifyvm\\", :id, \\"--ioapic\\", \\"on\\"]\\n        # cpu \u4f7f\u7528\u738750%\\n        vb.customize [\\"modifyvm\\", :id, \\"--cpuexecutioncap\\", \\"50\\"]\\n      end\\n    end\\n  end\\nend\\n```\\n\\n### \u521d\u59cb\u5316Debian\\n\\n```\\nergo vm init --ip 11.11.11.111 --docker\\n# \u9ed8\u8ba4\u4f1a\u4f7f\u7528ysicing/ansible\u955c\u50cf\uff0c\u6267\u884cansible\u811a\u672c\u521d\u59cb\u5316debian\uff0c--docker\u53c2\u6570\u9ed8\u8ba4\u8868\u793a\u5b89\u88c5docker\\n```\\n\\n#### \u624b\u52a8\u6267\u884c\u4e4b\u5bbf\u4e3b\u673a\u521d\u59cb\u5316\\n\\n```\\ngit clone https://github.com/ysicing/play-ansible.git\\ncd play-ansible\\n# \u5b89\u88c5ansible,\u5982\u679c\u5df2\u5b89\u88c5\u53ef\u8df3\u8fc7\\n./install.sh\\n# \u914d\u7f6e\u521d\u59cb\u5316\u673a\u5668\\ncp inventory.ini.example inventory.ini\\n# \u6267\u884c\u521d\u59cb\u5316\\nansible-playbook init.yml\\n```\\n\\n#### \u624b\u52a8\u6267\u884c\u4e4b\u5bb9\u5668\u5316\u65b9\u5f0f\u521d\u59cb\u5316\\n\\n```bash\\ndocker pull ysicing/ansible\\ndocker run -it --rm ysicing/ansible bash\\ncp inventory.ini.example inventory.ini\\n# \u521d\u59cb\u5316\u7cfb\u7edf\\nansible-playbook init.yml\\nexit\\n```\\n\\n### Debian 10\u5347\u7ea7\u5185\u6838\\n\\n> \u6dfb\u52a0buster-backports\u6e90\uff0c\u5982\u679c\u4f60\u4f7f\u7528ysicin/debian\u955c\u50cf\u53ef\u8df3\u8fc7\\n\\n```\\n# \u9ed8\u8ba4\\ncat >/etc/apt/sources.list <<EOF\\ndeb http://mirrors.aliyun.com/debian buster-backports main contrib non-free\\ndeb http://mirrors.aliyun.com/debian-security buster/updates main contrib non-free\\nEOF\\n\\n# Ucloud\\ncat >/etc/apt/sources.list <<EOF\\ndeb http://mirrors.ucloud.cn/debian/ buster-backports main contrib non-free\\ndeb http://mirrors.ucloud.cn/debian-security/ buster/updates main contrib non-free\\nEOF\\n```\\n\\n\u66f4\u65b0\u5347\u7ea7\\n\\n```bash\\napt update\\napt dist-upgrade -y\\napt-get install -t buster-backports linux-image-amd64 -y\\nupdate-grub\\napt autoclean\\napt autoremove -y\\nreboot\\n```"},{"id":"/posts/blog-notice","metadata":{"permalink":"/posts/blog-notice","source":"@site/blog/posts/blog-notice.md","title":"README","description":"\u4f60\u597d,\u6211\u7684\u535a\u5ba2","date":"2013-07-28T05:21:00.000Z","formattedDate":"2013\u5e747\u670828\u65e5","tags":[{"label":"site","permalink":"/tags/site"}],"readingTime":0.53,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"README","date":"2013-07-28T05:21:00.000Z","description":"\u4f60\u597d,\u6211\u7684\u535a\u5ba2","tags":["site"]},"prevItem":{"title":"Debian\u4e2a\u4eba\u5e38\u7528\u64cd\u4f5c\u6307\u5357","permalink":"/posts/debian-op"}},"content":"\x3c!-- truncate --\x3e\\n\\n> \u5982\u679c\u4f60\u89c9\u5f97\u6211\u7684\u6587\u7ae0\u6216\u8005\u9879\u76ee\u5bf9\u4f60\u6709\u7528\uff0c\u90a3\u4e48\u6765\u505a\u4e00\u53ea\u5c0f\u53ef\u7231\u5427\uff01[\u7231\u53d1\u7535@ysicing](https://afdian.net/@ysicing)\\n\\n## \u5f00\u59cb\u4e4b\u524d\\n\\n\u5728\u9605\u8bfb\u672c\u4e66\u4e4b\u524d\u5e0c\u671b\u60a8\u638c\u63e1\u4ee5\u4e0b\u77e5\u8bc6\u548c\u51c6\u5907\u4ee5\u4e0b\u73af\u5883\uff1a\\n\\n- Debian \u5e38\u7528\u547d\u4ee4\\n- Docker \u57fa\u672c\u64cd\u4f5c\\n- Mac/Linux \u7686\u53ef\\n\\n## \u7cfb\u5217\u4e3b\u9898\\n\\n- Kubernetes(1.23)\u5b9e\u8df5\\n- Go(1.18)\u5f00\u53d1\u5b9e\u8df5\\n- \u8fd0\u7ef4\u5b9e\u8df5(\u4e3b\u8981\u662f\u57fa\u4e8eDebian(bullseye)\u53d1\u884c\u7248)\\n\\n## \uff1f\\n\\n\u6b22\u8fce\u4ea4\u6d41, \u4e00\u8d77\u52aa\u529b.\\n\\n\u5982\u679c\u6709\u4efb\u4f55\u7591\u95ee\u6216\u9519\u8bef\uff0c\u6b22\u8fce\u5728 issues \u8fdb\u884c\u63d0\u95ee\u6216\u7ed9\u4e88\u4fee\u6b63\u610f\u89c1\\n\\n\u5982\u679c\u559c\u6b22\u6216\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\uff0c\u6b22\u8fce Star\uff0c\u5bf9\u6211\u662f\u4e00\u79cd\u9f13\u52b1\u548c\u63a8\u8fdb \ud83d\ude00"}]}')}}]);