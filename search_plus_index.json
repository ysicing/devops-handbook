{"./":{"url":"./","title":"Â∫èË®Ä","keywords":"","body":"DevOpsËøêÁª¥ÊåáÂçó/‰∫ëÂéüÁîüÂÆûË∑µÊâãÂÜå ÂºÄÂßã‰πãÂâç Âú®ÈòÖËØªÊú¨‰π¶‰πãÂâçÂ∏åÊúõÊÇ®ÊéåÊè°‰ª•‰∏ãÁü•ËØÜÂíåÂáÜÂ§á‰ª•‰∏ãÁéØÂ¢ÉÔºö Debian Â∏∏Áî®ÂëΩ‰ª§ Docker Âü∫Êú¨Êìç‰Ωú Mac/Linux ÁöÜÂèØ Á≥ªÂàó‰∏ªÈ¢ò Kubernetes(1.16,1.18)ÂÆûË∑µ Go(1.15+)ÂºÄÂèëÂÆûË∑µ ËøêÁª¥ÂÆûË∑µ(‰∏ªË¶ÅÊòØÂü∫‰∫éDebian(buster)ÂèëË°åÁâà) ? Ê¨¢Ëøé‰∫§ÊµÅ, ‰∏ÄËµ∑Âä™Âäõ. Â¶ÇÊûúÊúâ‰ªª‰ΩïÁñëÈóÆÊàñÈîôËØØÔºåÊ¨¢ËøéÂú® issues ËøõË°åÊèêÈóÆÊàñÁªô‰∫à‰øÆÊ≠£ÊÑèËßÅ Â¶ÇÊûúÂñúÊ¨¢ÊàñÂØπ‰Ω†ÊúâÊâÄÂ∏ÆÂä©ÔºåÊ¨¢Ëøé StarÔºåÂØπÊàëÊòØ‰∏ÄÁßçÈºìÂä±üòÄ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/":{"url":"linux/debian/","title":"Debian","keywords":"","body":"Debian DebianÂÆûË∑µÂèäÂ∏∏Áî®ÊäÄÂ∑ßÔºåÂåÖÊã¨ DebianÁ≥ªÂàùÂßãÂåñÁ≥ªÁªü DebianÁ≥ªÂçáÁ∫ßÂÜÖÊ†∏ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/init-system.html":{"url":"linux/debian/init-system.html","title":"ÂàùÂßãÂåñ","keywords":"","body":"ÂàùÂßãÂåñDebian ‰ΩøÁî®ergoËøõË°åÂàùÂßãÂåñ ergo vm init --ip --ip --pass # ÂàùÂßãÂåñ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/upcore.html":{"url":"linux/debian/upcore.html","title":"ÂçáÁ∫ßÂÜÖÊ†∏","keywords":"","body":"ÂçáÁ∫ßDebianÂÜÖÊ†∏ ergo vm upcore --ip --ip --pass # ÂçáÁ∫ßÂÜÖÊ†∏ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/centos/":{"url":"linux/centos/","title":"CetnOS","keywords":"","body":"CentOS CentOSÂÆûË∑µÂèäÂ∏∏Áî®ÊäÄÂ∑ßÔºåÂåÖÊã¨ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/":{"url":"practice/","title":"ÂÆûË∑µÊ¶ÇËßà","keywords":"","body":"ÂÆûË∑µÊ¶ÇËßà Kubernetes‰∫ëÂéüÁîüÂÆûË∑µÂèäÂ∏∏Áî®ÊäÄÂ∑ßÔºåÂåÖÊã¨ ÁõëÊéß Êó•Âøó È´òÂèØÁî® ÂÆâÂÖ®&ÂÆ°ËÆ° ÁΩëÁªú Â≠òÂÇ® DNS Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/loadbalancer/":{"url":"practice/loadbalancer/","title":"Ë¥üËΩΩÂùáË°°","keywords":"","body":"Ë¥üËΩΩÂùáË°°Ê¶ÇËßà ‰∫ëÂéüÁîüË¥üËΩΩÂùáË°°ÂÆûË∑µÂèäÂ∏∏Áî®ÊäÄÂ∑ßÔºåÂåÖÊã¨ metallbÈÉ®ÁΩ≤‰ΩøÁî® Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/loadbalancer/metallb.html":{"url":"practice/loadbalancer/metallb.html","title":"metallbÈÉ®ÁΩ≤‰ΩøÁî®","keywords":"","body":"metallbÈÉ®ÁΩ≤‰ΩøÁî® k8sÈªòËÆ§‰∏çÊèê‰æõË£∏Êú∫ÁöÑ loadbalancer service. Â¶ÇÊûúË¶Å‰ΩøÁî®loadbalancer serviceÔºåÈÇ£‰πàÂ∞±Ë¶ÅÁî®Âà∞metallb‰∫Ü metallbÊîØÊåÅ‰∏§ÁßçÂ∑•‰ΩúÊ®°Âºè,‰∏ÄÁßçÊòØlayer2Ê®°Âºè,‰πüÂ∞±ÊòØÂ∑•‰ΩúÂú®2Â±ÇÊù•Ë¥üË¥£Áõ∏Â∫îarpËØ∑Ê±ÇÔºåÂØπ‰∫éÂ±ÄÂüüÁΩë‰∏≠ÁöÑ‰∫∫Êù•ËØ¥‰ªø‰ΩõÂ∞±ÊòØÁªôÊúçÂä°ÂàÜÈÖç‰∫Ü‰∏Ä‰∏™ipÔºå‰ΩÜÊòØ2Â±ÇÊ®°Âºè‰∏çÊòØÁúüÊ≠£ÁöÑË¥üËΩΩÂùáË°°ÔºåÂõ†‰∏∫ÊâÄÊúâÁöÑÊµÅÈáè‰ºöÁªèËøáÈõÜÁæ§‰∏≠ÁöÑ‰∏Ä‰∏™ËäÇÁÇπÔºåÂΩìËøô‰∏™ËäÇÁÇπÊåÇ‰∫ÜÁöÑËØùÔºåmetallb‰ºöËøÅÁßªipÂà∞Âè¶Â§ñ‰∏Ä‰∏™ËäÇÁÇπ‰∏ä„ÄÇÂè¶Â§ñ‰∏ÄÁßçÊòØbgpÊ®°ÂºèÔºåÂú®bgpÊ®°Âºè‰∏ãÔºåÈõÜÁæ§‰∏≠ÊØè‰∏Ä‰∏™ËäÇÁÇπÈÉΩ‰ºöÂíåË∑ØÁî±Âô®Âª∫Á´ãbgp‰ºöËØùÔºåÊâÄ‰ª•bgpÊ®°ÂºèÊòØÈ´òÂèØÁî®ÁöÑÔºå‰ΩÜÊòØÈúÄË¶Å‰Ω†ÁöÑË∑ØÁî±Âô®ÊîØÊåÅbgp„ÄÇË∑ØÁî±Âô®ÊòØ‰∏çÊîØÊåÅbgpÁöÑÔºåÊâÄ‰ª•Â∞±ÈááÁî®‰∫åÂ±ÇÊ®°Âºè„ÄÇ ÂÆâË£Ö Âø´ÈÄüÂÆâË£Ö ergo helm install lb --ip 172.16.74.102 --pk .ssh/id_rsa # ÈªòËÆ§ÈÖçÁΩÆ kubectl edit configmaps --namespace metallb-system metallb-config -o yaml apiVersion: v1 data: config: | address-pools: - addresses: - 11.11.11.0/24 name: generic-cluster-pool protocol: layer2 kind: ConfigMap È¶ñÂÖà‰Ω†Ë¶ÅÁ°ÆËÆ§‰Ω†ÁöÑk8s kube-proxy ÊòØ‰∏çÊòØ‰ΩøÁî®ipvsÊ®°ÂºèÁöÑÔºåÂ¶ÇÊûúÊòØÈÇ£‰πà‰Ω†Ë¶ÅÂºÄÂêØstrictARPÈÄâÈ°πÔºåÁºñËæëkube-proxyÁöÑconfigmap kubectl edit configmap -n kube-system kube-proxy # ÂºÄÂêØ strictARP: true ÊâãÂä®ÂÆâË£Ö kubectl create ns metallb-system helm upgrade -i metallb -f https://raw.githubusercontent.com/ysicing/helminit/master/metallb/values.yaml -n metallb-system bitnami/metallb --version 2.2.0 ÈôÑÂΩïÂèÇËÄÉ metallbÂÆòÊñπÂÆâË£ÖÊñáÊ°£ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/storage/":{"url":"practice/storage/","title":"Â≠òÂÇ®","keywords":"","body":"Â≠òÂÇ®Ê¶ÇËßà ‰∫ëÂéüÁîüÂ≠òÂÇ®ÂÆûË∑µÂèäÂ∏∏Áî®ÊäÄÂ∑ßÔºåÂåÖÊã¨ ÁΩëÁªúÊñá‰ª∂Á≥ªÁªü(NFS)Â≠òÂÇ®ÊåÅ‰πÖÂç∑ Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/storage/nfs-pv.html":{"url":"practice/storage/nfs-pv.html","title":"ÁΩëÁªúÊñá‰ª∂Á≥ªÁªü(NFS)Â≠òÂÇ®ÊåÅ‰πÖÂç∑","keywords":"","body":"nfs nfsÂç∑ËÉΩÂ∞ÜNFS(NAS)ÊåÇËΩΩÂà∞‰Ω†Pod‰∏≠. nfsÂÜÖÁöÑÊï∞ÊçÆ‰∏ç‰ºöÂõ†‰∏∫Âà†Èô§PodËÄåË¢´Âà†Èô§,Âç∑Âè™ÊòØË¢´Âç∏ËΩΩ. Âè¶Â§ñnasÂèØ‰ª•ÊúâÊï∞ÊçÆ‰∏îpodÈó¥ÂÖ±‰∫´ Ê≥®ÊÑèÔºö Âú®‰ΩøÁî® NFS Âç∑‰πãÂâçÔºå‰Ω†ÂøÖÈ°ªÊúâNFSÊúçÂä°Âπ∂Â∑≤ÂÖ±‰∫´Êï∞ÊçÆ„ÄÇ ‰∫ë‰∏äÂèØ‰ª•‰ΩøÁî®Á±ª‰ººÈòøÈáå‰∫ëÁöÑNAS ‰ΩøÁî® ÈÉ®ÁΩ≤nfsÊúçÂä° nfspath=\"/k8sdata\" # ÂÆâË£Ö apt update apt install -y nfs-kernel-server # ÈÖçÁΩÆ mkdir ${nfspath} echo \"${nfspath}/ *(insecure,rw,sync,no_root_squash,no_subtree_check)\" > /etc/exports # ÂêØÂä®nfs systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r # ÊµãËØï showmount -e 172.16.74.102 ÈÉ®ÁΩ≤nfs-client-provisioner --- apiVersion: v1 kind: ServiceAccount metadata: name: nfs-client-provisioner namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: nfs-client-provisioner-runner namespace: kube-system rules: - apiGroups: - '' resources: - persistentvolumes verbs: - get - list - watch - create - delete - apiGroups: - '' resources: - persistentvolumeclaims verbs: - get - list - watch - update - apiGroups: - storage.k8s.io resources: - storageclasses verbs: - get - list - watch - apiGroups: - '' resources: - events verbs: - create - update - patch --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: run-nfs-client-provisioner namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: nfs-client-provisioner-runner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: leader-locking-nfs-client-provisioner namespace: kube-system rules: - apiGroups: - '' resources: - endpoints verbs: - get - list - watch - create - update - patch --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: leader-locking-nfs-client-provisioner namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: leader-locking-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: kube-system --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: nfs-service name: nfs-service namespace: kube-system spec: replicas: 1 selector: matchLabels: app: nfs-service strategy: type: Recreate template: metadata: labels: app: nfs-service spec: containers: - env: - name: PROVISIONER_NAME value: nfs-provisioner - name: NFS_SERVER value: 172.16.74.102 - name: NFS_PATH value: /k8sdata image: registry.cn-beijing.aliyuncs.com/k7scn/nfs-client-provisioner name: nfs-client-provisioner volumeMounts: - mountPath: /persistentvolumes name: nfs-client-root serviceAccountName: nfs-client-provisioner volumes: - name: nfs-client-root nfs: path: /k8sdata server: 172.16.74.102 ÂàõÂª∫Storageclass apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: annotations: storageclass.kubernetes.io/is-default-class: 'true' name: nfsdata parameters: archiveOnDelete: 'false' provisioner: nfs-provisioner reclaimPolicy: Delete volumeBindingMode: Immediate È™åËØÅ kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE nfsdata (default) nfs-provisioner Delete Immediate false 7s ÂàõÂª∫Â∫îÁî®Âπ∂ÁªëÂÆöÂ≠òÂÇ® apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: ports: - port: 80 name: web selector: app: nginx --- apiVersion: apps/v1 kind: StatefulSet metadata: name: web spec: selector: matchLabels: app: nginx # has to match .spec.template.metadata.labels serviceName: \"nginx\" replicas: 3 # by default is 1 template: metadata: labels: app: nginx # has to match .spec.selector.matchLabels spec: terminationGracePeriodSeconds: 10 containers: - name: nginx image: registry.cn-beijing.aliyuncs.com/k7scn/nginx-slim:0.8 ports: - containerPort: 80 name: web volumeMounts: - name: www mountPath: /usr/share/nginx/html volumeClaimTemplates: - metadata: name: www spec: accessModes: [ \"ReadWriteOnce\" ] storageClassName: \"nfsdata\" resources: requests: storage: 1Gi kubectl get sts,pods,svc,pv,pvc -o wide NAME READY AGE CONTAINERS IMAGES statefulset.apps/web 3/3 84s nginx registry.cn-beijing.aliyuncs.com/k7scn/nginx-slim:0.8 NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod/web-0 1/1 Running 0 84s 100.72.165.193 k8s-03 pod/web-1 1/1 Running 0 57s 100.122.222.2 k8s-cluster02 pod/web-2 1/1 Running 0 29s 100.101.2.65 k8s-04 NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR service/nginx ClusterIP None 80/TCP 85s app=nginx NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE VOLUMEMODE persistentvolume/pvc-b19a2bba-3156-48c3-8b30-56e7031ceeda 1Gi RWO Delete Bound default/www-web-1 nfsdata 57s Filesystem persistentvolume/pvc-d39852ad-7b80-4650-8cc3-0984d85732fb 1Gi RWO Delete Bound default/www-web-0 nfsdata 84s Filesystem persistentvolume/pvc-ee6cc8e2-b03b-4c4b-b72a-f39381431e4c 1Gi RWO Delete Bound default/www-web-2 nfsdata 29s Filesystem NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE VOLUMEMODE persistentvolumeclaim/www-web-0 Bound pvc-d39852ad-7b80-4650-8cc3-0984d85732fb 1Gi RWO nfsdata 84s Filesystem persistentvolumeclaim/www-web-1 Bound pvc-b19a2bba-3156-48c3-8b30-56e7031ceeda 1Gi RWO nfsdata 57s Filesystem persistentvolumeclaim/www-web-2 Bound pvc-ee6cc8e2-b03b-4c4b-b72a-f39381431e4c 1Gi RWO nfsdata 29s Filesystem Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/devops/":{"url":"practice/devops/","title":"ÊúçÂä°Ê≤ªÁêÜ","keywords":"","body":"Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"troubleshooting/cluster.html":{"url":"troubleshooting/cluster.html","title":"ÈõÜÁæ§ÊéíÈîô","keywords":"","body":"Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"appendix/tutorial.html":{"url":"appendix/tutorial.html","title":"Â≠¶‰π†ËµÑÊ∫ê","keywords":"","body":"Â≠¶‰π†ËµÑÊñô Â≠¶Ëã±ËØ≠Â∞±‰∏ä51talk, Ê¨¢ËøéÊâæÊàëÂÜÖÊé®. Copyright ¬© 2021 | ‰ªÖ‰æõÂ≠¶‰π†ÂèÇËÄÉ,‰∏çÂèØÁî®‰∫éÂÖ∂‰ªñÈÄîÂæÑ. all right reservedÔºåpowered by Gitbook Updated at 2021-02-11 13:08:09 "}}