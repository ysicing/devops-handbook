{"./":{"url":"./","title":"åºè¨€","keywords":"","body":"DevOpsè¿ç»´æŒ‡å—/äº‘åŸç”Ÿå®è·µæ‰‹å†Œ å¼€å§‹ä¹‹å‰ åœ¨é˜…è¯»æœ¬ä¹¦ä¹‹å‰å¸Œæœ›æ‚¨æŒæ¡ä»¥ä¸‹çŸ¥è¯†å’Œå‡†å¤‡ä»¥ä¸‹ç¯å¢ƒï¼š Debian å¸¸ç”¨å‘½ä»¤ Docker åŸºæœ¬æ“ä½œ Mac/Linux çš†å¯ ç³»åˆ—ä¸»é¢˜ Kubernetes(1.16,1.18)å®è·µ Go(1.15+)å¼€å‘å®è·µ è¿ç»´å®è·µ(ä¸»è¦æ˜¯åŸºäºDebian(buster)å‘è¡Œç‰ˆ) ? æ¬¢è¿äº¤æµ, ä¸€èµ·åŠªåŠ›. å¦‚æœæœ‰ä»»ä½•ç–‘é—®æˆ–é”™è¯¯ï¼Œæ¬¢è¿åœ¨ issues è¿›è¡Œæé—®æˆ–ç»™äºˆä¿®æ­£æ„è§ å¦‚æœå–œæ¬¢æˆ–å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ Starï¼Œå¯¹æˆ‘æ˜¯ä¸€ç§é¼“åŠ±ğŸ˜€ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/":{"url":"linux/debian/","title":"Debian","keywords":"","body":"Debian Debianå®è·µåŠå¸¸ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬ Debianç³»åˆå§‹åŒ–ç³»ç»Ÿ Debianç³»å‡çº§å†…æ ¸ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/init-system.html":{"url":"linux/debian/init-system.html","title":"åˆå§‹åŒ–","keywords":"","body":"åˆå§‹åŒ–Debian ä½¿ç”¨ergoè¿›è¡Œåˆå§‹åŒ– ergo vm init --ip --ip --pass # åˆå§‹åŒ– Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/debian/upcore.html":{"url":"linux/debian/upcore.html","title":"å‡çº§å†…æ ¸","keywords":"","body":"å‡çº§Debianå†…æ ¸ ergo vm upcore --ip --ip --pass # å‡çº§å†…æ ¸ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"linux/centos/":{"url":"linux/centos/","title":"CetnOS","keywords":"","body":"CentOS CentOSå®è·µåŠå¸¸ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/":{"url":"practice/","title":"å®è·µæ¦‚è§ˆ","keywords":"","body":"å®è·µæ¦‚è§ˆ Kubernetesäº‘åŸç”Ÿå®è·µåŠå¸¸ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬ ç›‘æ§ æ—¥å¿— é«˜å¯ç”¨ å®‰å…¨&å®¡è®¡ ç½‘ç»œ å­˜å‚¨ DNS Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/loadbalancer/":{"url":"practice/loadbalancer/","title":"è´Ÿè½½å‡è¡¡","keywords":"","body":"è´Ÿè½½å‡è¡¡æ¦‚è§ˆ äº‘åŸç”Ÿè´Ÿè½½å‡è¡¡å®è·µåŠå¸¸ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬ metallbéƒ¨ç½²ä½¿ç”¨ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/loadbalancer/metallb.html":{"url":"practice/loadbalancer/metallb.html","title":"metallbéƒ¨ç½²ä½¿ç”¨","keywords":"","body":"metallbéƒ¨ç½²ä½¿ç”¨ k8sé»˜è®¤ä¸æä¾›è£¸æœºçš„ loadbalancer service. å¦‚æœè¦ä½¿ç”¨loadbalancer serviceï¼Œé‚£ä¹ˆå°±è¦ç”¨åˆ°metallbäº† metallbæ”¯æŒä¸¤ç§å·¥ä½œæ¨¡å¼,ä¸€ç§æ˜¯layer2æ¨¡å¼,ä¹Ÿå°±æ˜¯å·¥ä½œåœ¨2å±‚æ¥è´Ÿè´£ç›¸åº”arpè¯·æ±‚ï¼Œå¯¹äºå±€åŸŸç½‘ä¸­çš„äººæ¥è¯´ä»¿ä½›å°±æ˜¯ç»™æœåŠ¡åˆ†é…äº†ä¸€ä¸ªipï¼Œä½†æ˜¯2å±‚æ¨¡å¼ä¸æ˜¯çœŸæ­£çš„è´Ÿè½½å‡è¡¡ï¼Œå› ä¸ºæ‰€æœ‰çš„æµé‡ä¼šç»è¿‡é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“è¿™ä¸ªèŠ‚ç‚¹æŒ‚äº†çš„è¯ï¼Œmetallbä¼šè¿ç§»ipåˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚å¦å¤–ä¸€ç§æ˜¯bgpæ¨¡å¼ï¼Œåœ¨bgpæ¨¡å¼ä¸‹ï¼Œé›†ç¾¤ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šå’Œè·¯ç”±å™¨å»ºç«‹bgpä¼šè¯ï¼Œæ‰€ä»¥bgpæ¨¡å¼æ˜¯é«˜å¯ç”¨çš„ï¼Œä½†æ˜¯éœ€è¦ä½ çš„è·¯ç”±å™¨æ”¯æŒbgpã€‚è·¯ç”±å™¨æ˜¯ä¸æ”¯æŒbgpçš„ï¼Œæ‰€ä»¥å°±é‡‡ç”¨äºŒå±‚æ¨¡å¼ã€‚ å®‰è£… å¿«é€Ÿå®‰è£… ergo helm install lb --ip 172.16.74.102 --pk .ssh/id_rsa # é»˜è®¤é…ç½® kubectl edit configmaps --namespace metallb-system metallb-config -o yaml apiVersion: v1 data: config: | address-pools: - addresses: - 11.11.11.0/24 name: generic-cluster-pool protocol: layer2 kind: ConfigMap é¦–å…ˆä½ è¦ç¡®è®¤ä½ çš„k8s kube-proxy æ˜¯ä¸æ˜¯ä½¿ç”¨ipvsæ¨¡å¼çš„ï¼Œå¦‚æœæ˜¯é‚£ä¹ˆä½ è¦å¼€å¯strictARPé€‰é¡¹ï¼Œç¼–è¾‘kube-proxyçš„configmap kubectl edit configmap -n kube-system kube-proxy # å¼€å¯ strictARP: true æ‰‹åŠ¨å®‰è£… kubectl create ns metallb-system helm upgrade -i metallb -f https://raw.githubusercontent.com/ysicing/helminit/master/metallb/values.yaml -n metallb-system bitnami/metallb --version 2.2.0 é™„å½•å‚è€ƒ metallbå®˜æ–¹å®‰è£…æ–‡æ¡£ Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/storage/":{"url":"practice/storage/","title":"å­˜å‚¨","keywords":"","body":"å­˜å‚¨æ¦‚è§ˆ äº‘åŸç”Ÿå­˜å‚¨å®è·µåŠå¸¸ç”¨æŠ€å·§ï¼ŒåŒ…æ‹¬ ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ(NFS)å­˜å‚¨æŒä¹…å· Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/storage/nfs-pv.html":{"url":"practice/storage/nfs-pv.html","title":"ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ(NFS)å­˜å‚¨æŒä¹…å·","keywords":"","body":"nfs nfså·èƒ½å°†NFS(NAS)æŒ‚è½½åˆ°ä½ Podä¸­. nfså†…çš„æ•°æ®ä¸ä¼šå› ä¸ºåˆ é™¤Podè€Œè¢«åˆ é™¤,å·åªæ˜¯è¢«å¸è½½. å¦å¤–naså¯ä»¥æœ‰æ•°æ®ä¸”podé—´å…±äº« æ³¨æ„ï¼š åœ¨ä½¿ç”¨ NFS å·ä¹‹å‰ï¼Œä½ å¿…é¡»æœ‰NFSæœåŠ¡å¹¶å·²å…±äº«æ•°æ®ã€‚ äº‘ä¸Šå¯ä»¥ä½¿ç”¨ç±»ä¼¼é˜¿é‡Œäº‘çš„NAS ä½¿ç”¨ éƒ¨ç½²nfsæœåŠ¡ nfspath=\"/k8sdata\" # å®‰è£… apt update apt install -y nfs-kernel-server # é…ç½® mkdir ${nfspath} echo \"${nfspath}/ *(insecure,rw,sync,no_root_squash,no_subtree_check)\" > /etc/exports # å¯åŠ¨nfs systemctl enable rpcbind systemctl enable nfs-server systemctl start rpcbind systemctl start nfs-server exportfs -r # æµ‹è¯• showmount -e 172.16.74.102 éƒ¨ç½²nfs-client-provisioner --- apiVersion: v1 kind: ServiceAccount metadata: name: nfs-client-provisioner namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: name: nfs-client-provisioner-runner namespace: kube-system rules: - apiGroups: - '' resources: - persistentvolumes verbs: - get - list - watch - create - delete - apiGroups: - '' resources: - persistentvolumeclaims verbs: - get - list - watch - update - apiGroups: - storage.k8s.io resources: - storageclasses verbs: - get - list - watch - apiGroups: - '' resources: - events verbs: - create - update - patch --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: run-nfs-client-provisioner namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: nfs-client-provisioner-runner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: name: leader-locking-nfs-client-provisioner namespace: kube-system rules: - apiGroups: - '' resources: - endpoints verbs: - get - list - watch - create - update - patch --- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: leader-locking-nfs-client-provisioner namespace: kube-system roleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: leader-locking-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: kube-system --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: nfs-service name: nfs-service namespace: kube-system spec: replicas: 1 selector: matchLabels: app: nfs-service strategy: type: Recreate template: metadata: labels: app: nfs-service spec: containers: - env: - name: PROVISIONER_NAME value: nfs-provisioner - name: NFS_SERVER value: 172.16.74.102 - name: NFS_PATH value: /k8sdata image: registry.cn-beijing.aliyuncs.com/k7scn/nfs-client-provisioner name: nfs-client-provisioner volumeMounts: - mountPath: /persistentvolumes name: nfs-client-root serviceAccountName: nfs-client-provisioner volumes: - name: nfs-client-root nfs: path: /k8sdata server: 172.16.74.102 åˆ›å»ºStorageclass apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: annotations: storageclass.kubernetes.io/is-default-class: 'true' name: nfsdata parameters: archiveOnDelete: 'false' provisioner: nfs-provisioner reclaimPolicy: Delete volumeBindingMode: Immediate éªŒè¯ kubectl get sc NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION AGE nfsdata (default) nfs-provisioner Delete Immediate false 7s åˆ›å»ºåº”ç”¨å¹¶ç»‘å®šå­˜å‚¨ apiVersion: v1 kind: Service metadata: name: nginx labels: app: nginx spec: ports: - port: 80 name: web selector: app: nginx --- apiVersion: apps/v1 kind: StatefulSet metadata: name: web spec: selector: matchLabels: app: nginx # has to match .spec.template.metadata.labels serviceName: \"nginx\" replicas: 3 # by default is 1 template: metadata: labels: app: nginx # has to match .spec.selector.matchLabels spec: terminationGracePeriodSeconds: 10 containers: - name: nginx image: registry.cn-beijing.aliyuncs.com/k7scn/nginx-slim:0.8 ports: - containerPort: 80 name: web volumeMounts: - name: www mountPath: /usr/share/nginx/html volumeClaimTemplates: - metadata: name: www spec: accessModes: [ \"ReadWriteOnce\" ] storageClassName: \"nfsdata\" resources: requests: storage: 1Gi kubectl get sts,pods,svc,pv,pvc -o wide NAME READY AGE CONTAINERS IMAGES statefulset.apps/web 3/3 84s nginx registry.cn-beijing.aliyuncs.com/k7scn/nginx-slim:0.8 NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pod/web-0 1/1 Running 0 84s 100.72.165.193 k8s-03 pod/web-1 1/1 Running 0 57s 100.122.222.2 k8s-cluster02 pod/web-2 1/1 Running 0 29s 100.101.2.65 k8s-04 NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTOR service/nginx ClusterIP None 80/TCP 85s app=nginx NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE VOLUMEMODE persistentvolume/pvc-b19a2bba-3156-48c3-8b30-56e7031ceeda 1Gi RWO Delete Bound default/www-web-1 nfsdata 57s Filesystem persistentvolume/pvc-d39852ad-7b80-4650-8cc3-0984d85732fb 1Gi RWO Delete Bound default/www-web-0 nfsdata 84s Filesystem persistentvolume/pvc-ee6cc8e2-b03b-4c4b-b72a-f39381431e4c 1Gi RWO Delete Bound default/www-web-2 nfsdata 29s Filesystem NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE VOLUMEMODE persistentvolumeclaim/www-web-0 Bound pvc-d39852ad-7b80-4650-8cc3-0984d85732fb 1Gi RWO nfsdata 84s Filesystem persistentvolumeclaim/www-web-1 Bound pvc-b19a2bba-3156-48c3-8b30-56e7031ceeda 1Gi RWO nfsdata 57s Filesystem persistentvolumeclaim/www-web-2 Bound pvc-ee6cc8e2-b03b-4c4b-b72a-f39381431e4c 1Gi RWO nfsdata 29s Filesystem Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"practice/devops/":{"url":"practice/devops/","title":"æœåŠ¡æ²»ç†","keywords":"","body":"Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"troubleshooting/cluster.html":{"url":"troubleshooting/cluster.html","title":"é›†ç¾¤æ’é”™","keywords":"","body":"Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "},"appendix/tutorial.html":{"url":"appendix/tutorial.html","title":"å­¦ä¹ èµ„æº","keywords":"","body":"å­¦ä¹ èµ„æ–™ å­¦è‹±è¯­å°±ä¸Š51talk, æ¬¢è¿æ‰¾æˆ‘å†…æ¨. Copyright Â© 2021 | ä»…ä¾›å­¦ä¹ å‚è€ƒ,ä¸å¯ç”¨äºå…¶ä»–é€”å¾„. all right reservedï¼Œpowered by Gitbook Updated at 2021-02-11 13:08:09 "}}