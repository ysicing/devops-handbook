<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ysicing.me/</id>
    <title>ysicing</title>
    <updated>2022-05-10T14:09:20.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ysicing.me/"/>
    <subtitle>缘生笔记 Blog</subtitle>
    <icon>https://ysicing.me/https://github.com/ysicing.png</icon>
    <rights>Copyright © 2022 ysicing Built with Docusaurus.&lt;p&gt;&lt;a href="http://beian.miit.gov.cn/" class="footer_lin"&gt;京ICP备17001940号&lt;/a&gt;&lt;/p&gt;</rights>
    <entry>
        <title type="html"><![CDATA[大猫二狗开发者计划]]></title>
        <id>/posts/bigcat-ergo</id>
        <link href="https://ysicing.me/posts/bigcat-ergo"/>
        <updated>2022-05-10T14:09:20.000Z</updated>
        <summary type="html"><![CDATA[本文主要介绍大猫二狗开发者计划]]></summary>
        <content type="html"><![CDATA[<blockquote><p>以前养了一只狗叫大猫，一只猫叫二狗.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="大猫bigcat">大猫(BigCat)<a class="hash-link" href="#大猫bigcat" title="标题的直接链接">​</a></h2><blockquote><p>平台项目, 简单理解应该是个人版的轻量化容器平台。</p></blockquote><p><a href="https://github.com/ysicing/next" target="_blank" rel="noopener noreferrer">还未开源</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="功能介绍">功能介绍<a class="hash-link" href="#功能介绍" title="标题的直接链接">​</a></h3><ul><li>待定</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="二狗ergo">二狗(ErGo)<a class="hash-link" href="#二狗ergo" title="标题的直接链接">​</a></h2><blockquote><p>命令行工具, 集成常见的运维功能。</p></blockquote><p><a href="https://github.com/ysicing/ergo" target="_blank" rel="noopener noreferrer">ysicing/ergo</a></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="功能介绍-1">功能介绍<a class="hash-link" href="#功能介绍-1" title="标题的直接链接">​</a></h3><ul><li>创建k3s集群, 大猫就完全依托k8s(k3s)集群</li><li>安装常见服务，如docker/containerd</li><li>Debian系的初始化，重装等操作</li><li>还有一些运维命令</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="爱发电">爱发电<a class="hash-link" href="#爱发电" title="标题的直接链接">​</a></h2><blockquote><p>如果你觉得项目对你可能有用，那么来支持一下吧！<a href="https://afdian.net/@ysicing" target="_blank" rel="noopener noreferrer">爱发电@ysicing</a></p></blockquote>]]></content>
        <category label="site" term="site"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用 chartmuseum 管理 Helm Chart]]></title>
        <id>/posts/chartmuseum-deploy</id>
        <link href="https://ysicing.me/posts/chartmuseum-deploy"/>
        <updated>2022-04-21T01:23:55.000Z</updated>
        <summary type="html"><![CDATA[记录一下部署chartmuseum及简单使用]]></summary>
        <content type="html"><![CDATA[<blockquote><p>很早之前就写了哈</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是chartmuseum">什么是chartmuseum<a class="hash-link" href="#什么是chartmuseum" title="标题的直接链接">​</a></h2><blockquote><p><code>chartmuseum</code> 是一个开源的 Helm Chart Repository，支持多种后端存储(s3等). </p></blockquote><p>chartmuseum 提供若干 API 以实现 Helm Chart Repository 的能力。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署chartmuseum">部署chartmuseum<a class="hash-link" href="#部署chartmuseum" title="标题的直接链接">​</a></h2><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># .ergo/data/charts.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2.1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">charts-pass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ccr.ccs.tencentyun.com/k7scn/chartmuseum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v0.14.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> charts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./chartspass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"9080:9080"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> PORT=9080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> DEBUG=1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> STORAGE=local</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> STORAGE_LOCAL_ROOTDIR=/charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> AUTH_ANONYMOUS_GET=true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> BASIC_AUTH_PASS=aituZie3eex5fiDongoShairiangae6o</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> BASIC_AUTH_USER=ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">charts-noauth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ccr.ccs.tencentyun.com/k7scn/chartmuseum</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v0.14.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> charts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">noauth</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./chartsnoauth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"9081:9081"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> PORT=9081</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> DEBUG=1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> STORAGE=local</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> STORAGE_LOCAL_ROOTDIR=/charts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> AUTH_ANONYMOUS_GET=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动chartmuseum</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ergo repo init</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergo addons </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> ysicing/compose</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergo compose -f .ergo/data/charts.yaml up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># linux ergo addons install ysicing/helm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> d1 http://127.0.0.1:9080</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> d2 http://127.0.0.1:9081</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简单使用">简单使用<a class="hash-link" href="#简单使用" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cm-push使用">cm-push使用<a class="hash-link" href="#cm-push使用" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 大陆安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm plugin </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> https://gitee.com/ysbot/helm-push</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm cm-push -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="drone-ci使用">Drone CI使用<a class="hash-link" href="#drone-ci使用" title="标题的直接链接">​</a></h3><p>在CI中推送charts可以参考 <a href="https://github.com/drone-stack/drone-plugin-helm-release" target="_blank" rel="noopener noreferrer">drone-stack/drone-plugin-helm-release</a></p>]]></content>
        <category label="helm" term="helm"/>
        <category label="chartmuseum" term="chartmuseum"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[minipc折腾安装pve]]></title>
        <id>/posts/minipc-pve</id>
        <link href="https://ysicing.me/posts/minipc-pve"/>
        <updated>2022-04-18T15:27:49.000Z</updated>
        <summary type="html"><![CDATA[在minipc上折腾安装pve]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备工作">准备工作<a class="hash-link" href="#准备工作" title="标题的直接链接">​</a></h2><ul><li>USB移动存储设备</li><li>PVE镜像</li><li>MacOS M1</li><li>MiniPC</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="下载pve镜像">下载pve镜像<a class="hash-link" href="#下载pve镜像" title="标题的直接链接">​</a></h3><p><a href="https://www.proxmox.com/en/downloads/category/iso-images-pve" target="_blank" rel="noopener noreferrer">官网</a></p><p>等待下载完成,将iso文件转为dmg文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">hdiutil convert -format UDRW -o proxmox-ve_7.1-2.dmg  proxmox-ve_7.1-2.iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="制作启动盘">制作启动盘<a class="hash-link" href="#制作启动盘" title="标题的直接链接">​</a></h3><blockquote><p>在macos上制作PVE启动盘</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># u盘已插入, 确定分配的设备名(盘符)，我这里是disk5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ diskutil list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/dev/disk5 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">external, physical</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)">#:                       TYPE NAME                    SIZE       IDENTIFIER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">:     FDisk_partition_scheme                        *31.0 GB    disk5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">:               Windows_NTFS U盘装机大师             </span><span class="token number" style="color:rgb(9, 134, 88)">29.9</span><span class="token plain"> GB    disk5s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">:             Windows_FAT_32 UDSEFI                  </span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token plain"> GB     disk5s2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 移除disk5上的卷宗,取消挂载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ diskutil unmountDisk /dev/disk5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unmount of all volumes on disk5 was successful</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># dd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">if</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/Users/ysicing/hack/iso/proxmox-ve_7.1-2.dmg </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">of</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/dev/rdisk5 </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">bs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">1m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>等待dd完成, 就烧录好了pve启动盘，等待minipc了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装pve">安装pve<a class="hash-link" href="#安装pve" title="标题的直接链接">​</a></h2><p>debian系安装都比较简单，参考我在轻量上的操作步骤 <a href="/posts/lighthouse-pve/">腾讯云Lighthouse上海Debian11安装Proxmox VE</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置无线网卡">配置无线网卡<a class="hash-link" href="#配置无线网卡" title="标题的直接链接">​</a></h2><blockquote><p>默认源啥的都改了哦</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> full-upgrade</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">mv</span><span class="token plain"> /usr/share/proxmox-ve/pve-apt-hook /usr/share/proxmox-ve/pve-apt-hook.old</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"exit 0"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /usr/share/proxmox-ve/pve-apt-hook</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">chmod</span><span class="token plain"> +x /usr/share/proxmox-ve/pve-apt-hook</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 安装网卡相关工具包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> -y firmware-iwlwifi wireless-tools wpasupplicant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 安装其他工具</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> -y net-tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看网卡型号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~  lsmod </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> iw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iwlmvm                </span><span class="token number" style="color:rgb(9, 134, 88)">421888</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mac80211             </span><span class="token number" style="color:rgb(9, 134, 88)">1015808</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> iwlmvm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iwlwifi               </span><span class="token number" style="color:rgb(9, 134, 88)">376832</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> iwlmvm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cfg80211              </span><span class="token number" style="color:rgb(9, 134, 88)">888832</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> iwlmvm,iwlwifi,mac80211</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iw_cm                  </span><span class="token number" style="color:rgb(9, 134, 88)">49152</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> rdma_cm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ib_core               </span><span class="token number" style="color:rgb(9, 134, 88)">360448</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> rdma_cm,iw_cm,ib_iser,ib_cm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看网卡信息 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ iwconfig</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lo        no wireless extensions.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">enp3s0    no wireless extensions.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wlp1s0    IEEE </span><span class="token number" style="color:rgb(9, 134, 88)">802.11</span><span class="token plain">  ESSID:off/any</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          Mode:Managed  Access Point: Not-Associated   Tx-Power</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">-2147483648 dBm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          Retry short limit:7   RTS thr:off   Fragment thr:off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          Encryption key:off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          Power Management:on</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vmbr0     no wireless extensions.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 启用网卡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ifconfig</span><span class="token plain"> wlp1s0 up 或 </span><span class="token function" style="color:rgb(0, 0, 255)">ifup</span><span class="token plain"> wlp1s0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 扫描wifi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iwlist wlp1s0 scan</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 选择wifi,生成配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wpa_passphrase </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">wifi</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/wpa_supplicant/wlp1s0.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 编辑网卡 /etc/network/interfaces, 新增</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">allow-hotplug wlp1s0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface wlp1s0 inet dhcp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  wpa-conf /etc/wpa_supplicant/wlp1s0.conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 重启网络</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl restart networking.service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看ip r, 查看已分配ip了，完成。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h3><blockquote><p>失败可参考，本人未遇到问题，故没有测试如下命令。</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">killall</span><span class="token plain"> -9 wpa_supplicant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ifconfig</span><span class="token plain"> wlan0 down</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iwconfig wlan0 mode Managed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ifconfig</span><span class="token plain"> wlan0 up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wpa_supplicant -B -dwext -iwlan0 -c /etc/wpa_supplicant/wireless.conf -dd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="pve" term="pve"/>
        <category label="debian" term="debian"/>
        <category label="minipc" term="minipc"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[腾讯云Lighthouse上海Debian11安装Proxmox VE]]></title>
        <id>/posts/lighthouse-pve</id>
        <link href="https://ysicing.me/posts/lighthouse-pve"/>
        <updated>2022-04-09T13:46:48.000Z</updated>
        <summary type="html"><![CDATA[上次腾讯送的上海轻量一直吃灰，跑个pve玩玩.]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备工作">准备工作<a class="hash-link" href="#准备工作" title="标题的直接链接">​</a></h2><blockquote><p>默认使用Debian 11</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置网络">配置网络<a class="hash-link" href="#配置网络" title="标题的直接链接">​</a></h3><blockquote><p>轻量云防火墙放行 8006端口 和 30000-40000端口给小鸡用。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置主机名">配置主机名<a class="hash-link" href="#配置主机名" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 更改主机名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">hostname</span><span class="token plain"> pve</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> pve </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/hostname</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># vim /etc/hosts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.1.1 localhost.localdomain VM-16-11-debian</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1 localhost</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token plain">.16.11 pve </span><span class="token comment" style="color:rgb(0, 128, 0)"># 新增主机名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">::1 ip6-localhost ip6-loopback</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">fe00::0 ip6-localnet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ff00::0 ip6-mcastprefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ff02::1 ip6-allnodes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ff02::2 ip6-allrouters</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ff02::3 ip6-allhosts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>设置完成后可以验证</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">hostname</span><span class="token plain"> --ip-address</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token plain">.16.11</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装proxmox-ve">安装Proxmox VE<a class="hash-link" href="#安装proxmox-ve" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="添加软件源">添加软件源<a class="hash-link" href="#添加软件源" title="标题的直接链接">​</a></h3><blockquote><p>官方源比较慢，这里使用清华镜像源</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/apt/sources.list.d/pve-install-repo.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 添加仓库key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://enterprise.proxmox.com/debian/proxmox-release-bullseye.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bullseye.gpg </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更新系统</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> remove -y exim*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> full-upgrade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装pve">安装PVE<a class="hash-link" href="#安装pve" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> proxmox-ve postfix open-iscsi -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装过程中需要配置postfix，选择no configuration</p><p>等待安装完成，访问 <code>https://&lt;公网ip&gt;:8006</code>, 使用linux账户登陆<code>root/&lt;password&gt;</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置pve">配置PVE<a class="hash-link" href="#配置pve" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="网络">网络<a class="hash-link" href="#网络" title="标题的直接链接">​</a></h3><p>配置网络</p><p><img loading="lazy" alt="网络" src="/assets/images/network-001-94f3a8c58e380b22c9241d4e576c2c8a.png" width="758" height="392" class="img_ev3q">
<img loading="lazy" alt="网络" src="/assets/images/network-002-2fa0f953fe4eef27eaa8a2090e7da7b4.png" width="637" height="275" class="img_ev3q"></p><p>查看宿主机</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /etc/network/interfaces.new</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">auto lo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface lo inet loopback</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface eth0 inet manual</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">auto vmbr0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface vmbr0 inet static</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    address </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.1/24</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    gateway </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-ports eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-stp off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-fd </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-vlan-aware </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-vids </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-4094</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/network/interfaces.d/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调整网络配置，添加nat转发, 更多可以参考官方文档<a href="https://pve.proxmox.com/wiki/Network_Configuration" target="_blank" rel="noopener noreferrer">Network Configuration</a></p><p>{{&lt; alert theme="danger" &gt;}}
这里需要注意需要将eth0改成dhcp或者static，否则会导致机器离线。
{{&lt; /alert &gt;}}</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">auto lo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface lo inet loopback</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">auto eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface eth0 inet dhcp </span><span class="token comment" style="color:rgb(0, 128, 0)"># 这里</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">auto vmbr0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iface vmbr0 inet static</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    address </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.1/24</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    gateway </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-ports eth0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-stp off</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-fd </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-vlan-aware </span><span class="token function" style="color:rgb(0, 0, 255)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bridge-vids </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">-4094</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    post-up   </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /proc/sys/net/ipv4/ip_forward</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    post-up   iptables -t nat -A POSTROUTING -s </span><span class="token string" style="color:rgb(163, 21, 21)">'10.10.10.0/24'</span><span class="token plain"> -o eth0  -j MASQUERADE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    post-down iptables -t nat -D POSTROUTING -s </span><span class="token string" style="color:rgb(163, 21, 21)">'10.10.10.0/24'</span><span class="token plain"> -o eth0  -j MASQUERADE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> /etc/network/interfaces.d/*</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开小鸡">开小鸡<a class="hash-link" href="#开小鸡" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置lxc容器">配置LXC容器<a class="hash-link" href="#配置lxc容器" title="标题的直接链接">​</a></h3><p>默认CT Template下载速度很慢，这里选择清华镜像源</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(163, 21, 21)">'s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g'</span><span class="token plain"> /usr/share/perl5/PVE/APLInfo.pm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启生效。</p><p><img loading="lazy" alt="CT模版" src="/assets/images/ct-003-d9a1d96708a45ad5b70f4f590b20da27.png" width="650" height="279" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建容器">创建容器<a class="hash-link" href="#创建容器" title="标题的直接链接">​</a></h3><p>下载Debian等CT模版使用。</p><p>基于Debian CT模版创建一个LXC容器</p><p><img loading="lazy" alt="创建容器" src="/assets/images/ct-004-4c07122affa63b2ea4b61a8ae0eb7a5c.png" width="642" height="296" class="img_ev3q"></p><p>等待容器启动之后</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">ping</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PING </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">56</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">84</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> bytes of data.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"> bytes from </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">icmp_seq</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ttl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">time</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0.064</span><span class="token plain"> ms</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"> bytes from </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100: </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">icmp_seq</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ttl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">time</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0.056</span><span class="token plain"> ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置容器nat访问">配置容器NAT访问<a class="hash-link" href="#配置容器nat访问" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">iptables -t nat -I PREROUTING -p tcp -m tcp --dport </span><span class="token number" style="color:rgb(9, 134, 88)">30022</span><span class="token plain"> -j DNAT --to-destination </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100:22</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iptables -t nat -I PREROUTING -p tcp -m multiport --dports </span><span class="token number" style="color:rgb(9, 134, 88)">80,443</span><span class="token plain"> -j DNAT --to-destination </span><span class="token number" style="color:rgb(9, 134, 88)">10.10</span><span class="token plain">.10.100</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 查看 nat PREROUTING 端口映射规则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iptables -t nat -nvL PREROUTING</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 清空 nat PREROUTING 端口映射规则</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># iptables -t nat -F PREROUTING</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h3><p>还可以再次套娃，在Debian LXC中安装docker</p>]]></content>
        <category label="lighthouse" term="lighthouse"/>
        <category label="qcloud" term="qcloud"/>
        <category label="pve" term="pve"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在k8s中部署Tailscale私有中继服务器Derper]]></title>
        <id>/posts/tailscale-custom-derper-server</id>
        <link href="https://ysicing.me/posts/tailscale-custom-derper-server"/>
        <updated>2022-04-01T12:55:19.000Z</updated>
        <summary type="html"><![CDATA[介绍如何让Tailscale使用自定义的 DERP Servers]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="derp-简介">DERP 简介<a class="hash-link" href="#derp-简介" title="标题的直接链接">​</a></h2><p><code>Detoured Encrypted Routing Protocol</code>，这是 Tailscale 自研协议，用于在私有网络中实现路由转发。所有客户端之间的连接都是先选择 DERP 模式（中继模式），这意味着连接立即就能建立（优先级最低但 100% 能成功的模式），用户不用任何等待。然后开始并行地进行路径发现，通常几秒钟之后，我们就能发现一条更优路径，然后将现有连接透明升级（upgrade）过去，变成点对点连接。</p><p>更多可以阅读 <a href="https://fuckcloudnative.io/posts/custom-derp-servers" target="_blank" rel="noopener noreferrer">Tailscale 基础教程：部署私有 DERP 中继服务器</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dockerfile">Dockerfile<a class="hash-link" href="#dockerfile" title="标题的直接链接">​</a></h3><blockquote><p>需要调整一下Dockerfile</p></blockquote><div class="language-Dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Dockerfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">FROM ghcr.io/yangchuansheng/ip_derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ENV DERP_ADDR=":12345"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># build self-signed certs &amp;&amp; start derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CMD bash /app/build_cert.sh $DERP_HOST $DERP_CERTS /app/san.conf &amp;&amp; \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /app/derper --hostname=$DERP_HOST \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --certmode=manual \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --certdir=$DERP_CERTS \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --stun  \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --a=$DERP_ADDR \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --verify-clients=$DERP_VERIFY_CLIENTS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>构建出镜像示例： <code>ysicing/ip_derper:latest</code></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="集群中部署">集群中部署<a class="hash-link" href="#集群中部署" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DaemonSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ergo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">mode.ysicing.me/workload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.ysicing.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">mode.ysicing.me/workload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">k8s.ysicing.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">mode.ysicing.me/workload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">k8s.ysicing.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing/ip_derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 20Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ergo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">mode.ysicing.me/workload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.ysicing.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> derper</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> stun</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> UDP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3478</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3478</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12345</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12345</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tcp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">services</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">12345</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ergo-system/derper:12345"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> udp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">services</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">3478</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ergo-system/derper:3478"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生效之后配置在tailscale后台配置:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"Regions"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"901"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token property">"RegionID"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">901</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token property">"RegionCode"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"tx-bj"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token property">"RegionName"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Qcloud Beijing"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token property">"Nodes"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"Name"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"901a"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"RegionID"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">901</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"DERPPort"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12345</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"HostName"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"xxxx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"IPv4"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"xxxx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"InsecureForTests"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"Name"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"901b"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"RegionID"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">901</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"DERPPort"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12345</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"HostName"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"xxxx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"IPv4"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"xxxx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token property">"InsecureForTests"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意:</p><ol><li><code>HostName</code>和<code>IPv4</code>填实际ip</li><li>忽略证书校验</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重启">重启<a class="hash-link" href="#重启" title="标题的直接链接">​</a></h3><p>依次重启tailscaled, 然后检查</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">tailscale netcheck</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="tailscale" term="tailscale"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[CaddyV1升级到V2版本]]></title>
        <id>/posts/caddy-v1-upgrade-v2</id>
        <link href="https://ysicing.me/posts/caddy-v1-upgrade-v2"/>
        <updated>2022-02-26T12:18:08.000Z</updated>
        <summary type="html"><![CDATA[主要讲述caddy v1升级到v2版本的过程]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="背景">背景<a class="hash-link" href="#背景" title="标题的直接链接">​</a></h2><blockquote><p>想升级到v2版本踩踩坑</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级踩坑">升级踩坑<a class="hash-link" href="#升级踩坑" title="标题的直接链接">​</a></h2><p>目前caddy v1版本的安装和使用方式和v2版本相同，但是v2版本使用方式有所不同。</p><p>之前也写过<a href="/posts/caddy2/">Caddy2的使用</a>, 这里不详细了，直接跳过了。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="systemd">systemd<a class="hash-link" href="#systemd" title="标题的直接链接">​</a></h3><ul><li>v1</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Restart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">on-abnormal</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">User</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">www-data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Group</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">www-data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Environment</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CADDYPATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/ssl/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin/caddy -log stdout -agree</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true -conf</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/caddy/Caddyfile -root</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/var/tmp</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecReload</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/bin/kill -USR1 </span><span class="token variable" style="color:rgb(9, 134, 88)">$MAINPID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">KillMode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mixed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">KillSignal</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">SIGQUIT</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">TimeoutStopSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LimitNOFILE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1048576</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LimitNPROC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">PrivateTmp</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">PrivateDevices</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ProtectHome</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ProtectSystem</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">full</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ReadWritePaths</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/ssl/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ReadWriteDirectories</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/ssl/caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>v2</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Type</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">notify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">User</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">www-data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Group</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">www-data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">Environment</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CADDYPATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/etc/ssl/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin/caddy2 run --environ --watch  --config /etc/caddy2/Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecReload</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin/caddy2 reload --config /etc/caddy2/Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">TimeoutStopSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LimitNOFILE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1048576</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">LimitNPROC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">PrivateTmp</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ProtectSystem</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">full</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">AmbientCapabilities</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CAP_NET_BIND_SERVICE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="代理分流">代理分流<a class="hash-link" href="#代理分流" title="标题的直接链接">​</a></h3><ul><li>v1</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cao.buhuibaidu.me </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    timeouts none</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy / https://www.baidu.com </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        except /bing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy /bing https://127.0.0.1:40000 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        header_upstream Host </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        header_upstream X-Forwarded-Proto </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">scheme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        insecure_skip_verify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>v2</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cao.buhuibaidu.me </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> GZIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @noproxy </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        not path </span><span class="token string" style="color:rgb(163, 21, 21)">"/bing"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    reverse_proxy @noproxy https://www.baidu.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    reverse_proxy /bing https://127.0.0.1:40000 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        header_up Host </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        header_up X-Forwarded-Proto </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">scheme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        transport http </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            tls_insecure_skip_verify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="未填完的坑">未填完的坑<a class="hash-link" href="#未填完的坑" title="标题的直接链接">​</a></h3><p>之前v1版本部署过caddy和tailscale以及ergo的镜像代理，貌似v2不好使了</p><ul><li>v1</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">debian.ysicing.me </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   log stdout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tls root@ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   proxy / https://debian.cdn.ysicing.me/apt/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m.deb.ysicing.me </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   log stdout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tls root@ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   proxy /tailscale/ https://pkgs.tailscale.com/ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     without /tailscale</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   proxy /caddy/ https://dl.cloudsmith.io/public/caddy </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    without /caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">m.yum.ysicing.me </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token function" style="color:rgb(0, 0, 255)">gzip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   log stdout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tls root@ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   proxy /tailscale/ https://pkgs.tailscale.com/ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     without /tailscale</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>v2</li></ul><p>待续</p>]]></content>
        <category label="caddy" term="caddy"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在TKE上使用Traefik Ingress]]></title>
        <id>/posts/tke-traefik-ingress</id>
        <link href="https://ysicing.me/posts/tke-traefik-ingress"/>
        <updated>2022-01-10T13:08:31.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述在tke上部署traefik ingress]]></summary>
        <content type="html"><![CDATA[<blockquote><p>Traefik是一款优秀的边缘路由工具，兼容所有主流的集群技术。</p></blockquote><p>具体如下特性:</p><ul><li><p>原生支持服务发现、动态配置，可以自动watch后端变化同步到负载均衡，不需要重新加载配置</p></li><li><p>支持灵活配置可观性<code>logs</code>、<code>metrics</code>、<code>tracing</code></p></li><li><p>提供dashboard功能</p></li><li><p>拥有丰富的高级特性: 灰度发布、流量复制、中间件、https等。</p></li></ul><blockquote><p>本文主要已最新稳定版本 <code>2.5.6</code>为例讲述在tke集群中安装traefik，后续关于traefik都已本版本为例</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="前提条件">前提条件<a class="hash-link" href="#前提条件" title="标题的直接链接">​</a></h2><ul><li>已经ready集群的tke集群或者k3s集群,(后面会简单说下k3s单节点集群安装)</li><li>已配置好<code>kubectl</code></li><li>已安装<code>helm</code></li><li>已安装 <a href="https://github.com/ysicing/ergo" target="_blank" rel="noopener noreferrer">ergo</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装traefik">安装traefik<a class="hash-link" href="#安装traefik" title="标题的直接链接">​</a></h3><ol><li>添加traefik helm仓库</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> traefik https://helm.traefik.io/traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 下载helm包并解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm pull traefik/traefik --untar </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li><p>tke集群准备一个闲置的slb，获取slbid待用</p></li><li><p>安装<code>jaeger-operator</code></p></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl create namespace observability</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergo ops </span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain">  https://github.com/jaegertracing/jaeger-operator/releases/download/v1.29.0/jaeger-operator.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create -f /root/.ergo/tmp/jaeger-operator.yaml -n observability</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>安装<code>jaegertracing</code> all-in-one</li></ol><blockquote><p>测试使用，生产使用可考虑高可用部署</p></blockquote><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jaegertracing.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Jaeger</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> simplest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> observability</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> allInOne</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">allInOne</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> jaegertracing/all</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">one</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> jaeger</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">x.external.ysicing.me</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.entrypoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> websecure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.tls.certresolver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> myresolver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将上述yaml保存为<code>jaeger.yaml</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -n observability -f ./observability/jaeger.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>安装gateway api</li></ol><p>启用实验性 Kubernetes 网关,需要提前安装。具体可以参考官方文档<a href="https://doc.traefik.io/traefik/providers/kubernetes-gateway/" target="_blank" rel="noopener noreferrer">Traefik &amp; Kubernetes with Gateway API</a>,后面也会专门介绍.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl kustomize </span><span class="token string" style="color:rgb(163, 21, 21)">"github.com/kubernetes-sigs/gateway-api/config/crd?ref=v0.3.0"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> kubectl apply -f -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>配置traefik value.yaml</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">deployment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">minReadySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">podAnnotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tke.cloud.tencent.com/networks</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"tke-route-eni"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在 VPC-CNI 与 Global Router 两种网络模式混用的情况下，显示声明 Pod 要使用弹性网卡，与以下 eni-ip 的 request 与 limit 一起配合使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ingressClass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">isDefaultClass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">pilot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">experimental</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">plugins</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kubernetesGateway</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">appLabelSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"traefik"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ingressRoute</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dashboard</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Configure providers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">providers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kubernetesCRD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">allowCrossNamespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">allowExternalNameServices</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ingressClass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kubernetesIngress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">allowExternalNameServices</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">publishedService</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 让 Ingress 的外部 IP 地址状态显示为 Traefik 的 LB IP 地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">logs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">general</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">level</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ERROR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">access</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">filters</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># statuscodes: "200,300-302" #设置只保留指定状态码范围内的访问日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">retryattempts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置代理访问重试失败时，保留访问日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">minduration</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10ms </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置保留请求时间超过指定持续时间的访问日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">fields</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">general</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">defaultmode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> keep </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置默认日志输出模式，keep表示保留所有日志字段，drop表示不保留日志字段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">names</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">ClientUsername</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> drop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">headers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">defaultmode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> keep </span><span class="token comment" style="color:rgb(0, 128, 0)"># 设置 Header 中字段是否保留</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">names</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">User-Agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> redact</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">Authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> drop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">Content-Type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> keep</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">entryPoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> metrics</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">globalArguments</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--global.checknewversion"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--global.sendanonymoususage"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">additionalArguments</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--providers.kubernetesingress.ingressclass=traefik"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--entryPoints.web.proxyProtocol.insecure"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--api=true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--certificatesresolvers.myresolver.acme.email=ysicing@you.mail"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--certificatesresolvers.myresolver.acme.storage=/data/acme.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#- "--certificatesresolvers.myresolver.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--certificatesresolvers.myresolver.acme.tlschallenge=true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--certificatesresolvers.myresolver.acme.httpchallenge=true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--certificatesresolvers.myresolver.acme.httpchallenge.entrypoint=web"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#- "--certificatesresolvers.myresolver.acme.dnschallenge=false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--tracing.jaeger=true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--tracing.jaeger.samplingServerURL=http://simplest-agent.observability.svc:5778/sampling"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--tracing.jaeger.localAgentHostPort=simplest-agent.observability.svc:6831"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--tracing.jaeger.collector.endpoint=http://simplest-collector.observability.svc:14268/api/traces?format=jaeger.thrift"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#- "--log.level=DEBUG"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># The name of this one can't be changed as it is used for the readiness and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># liveness probes, but you can adjust its config to your liking</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">expose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">exposedPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">expose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">exposedPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">redirectTo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> websecure </span><span class="token comment" style="color:rgb(0, 128, 0)"># http重定向https, 内置中间件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">websecure</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">expose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">exposedPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#开启默认tls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># this is the name of a TLSOption definition</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">certResolver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">domains</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">expose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">exposedPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">service.kubernetes.io/tke-existed-lbid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> lb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">xxx </span><span class="token comment" style="color:rgb(0, 128, 0)"># 闲置slb id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">service.cloud.tencent.com/direct-access</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 网关类的应用建议使用 LB 直通 Pod (绕过 NodePort)。若使用 VPC-CNI 与 Global Router 两种网络模式混用，用此注解来显示声明 LB 直绑 Pod (绕过 NodePort); 若创建集群时就选的 VPC-CNI 网络模式，则不需要显示声明 (默认 LB 直通 Pod)。详情请参见官方文档 https://cloud.tencent.com/document/product/457/48793</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">service.cloud.tencent.com/enable-grace-shutdown</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># 表示使用优雅停机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">persistence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  existingClaim: ""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">accessMode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># storageClass: ""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># subPath: "" # only mount a subpath of the Volume into the pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">rbac</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespaced</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">podSecurityPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"100m"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"50Mi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tke.cloud.tencent.com/eni-ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1000m"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1500Mi"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tke.cloud.tencent.com/eni-ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">affinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># host默认需要配置，默认不需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">securityContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">capabilities</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">drop</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ALL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># add: [NET_BIND_SERVICE]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">runAsGroup</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">65532</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">runAsNonRoot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">runAsUser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">65532</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">podSecurityContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">fsGroup</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">65532</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装traefik</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 编辑默认的values.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create ns traefik-v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -i  --namespace</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">traefik-v2 traefik ./traefik</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="标题的直接链接">​</a></h2><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 25%</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 25%</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token comment" style="color:rgb(0, 128, 0)"># initContainers:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)"># Init containers are exactly like regular containers, except:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># - Init containers always run to completion.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token comment" style="color:rgb(0, 128, 0)"># - Each init container must complete successfully before the next one starts.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  traefik/whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 100Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">tcpSocket</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">timeoutSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">successThreshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">failureThreshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /_status/healthz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">timeoutSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">successThreshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">failureThreshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik.containo.us/v1alpha1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IngressRoute</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">entryPoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> websecure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">routes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">match</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Host(`whoami.internal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pre.ysicing.me`)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Rule</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">certResolver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> myresolver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># secretName: self-tls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># 自签证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj "/CN=whoami.internal-pre.ysicing.me"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># kubectl create secret tls self-tls --cert=tls.crt --key=tls.key -n traefik-v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.entrypoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> websecure</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">traefik.ingress.kubernetes.io/router.tls.certresolver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> myresolver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># traefik.ingress.kubernetes.io/router.middlewares: traefik-v2-http2https@kubernetescrd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami2.internal</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pre.ysicing.me</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>apply到集群访问测试</p><div class="language-http codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-http codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Hostname: whoami-57fd8795c-4s55f</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">IP: 127.0.0.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">IP: 10.52.37.48</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RemoteAddr: 10.0.16.12:37954</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GET / HTTP/1.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Host: whoami2.internal-pre.ysicing.me</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.35 Safari/537.36 Edg/96.0.1054.13</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Accept-Encoding: gzip, deflate, br</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Dnt: 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Ch-Ua: " Not A;Brand";v="99", "Chromium";v="96", "Microsoft Edge";v="96"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Ch-Ua-Mobile: ?0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Ch-Ua-Platform: "macOS"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Fetch-Dest: document</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Fetch-Mode: navigate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Fetch-Site: cross-site</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Sec-Fetch-User: ?1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Uber-Trace-Id: 2310a2ad4e9d5245:5b38aa949db62245:2310a2ad4e9d5245:1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Upgrade-Insecure-Requests: 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Forwarded-For: 101.35.53.4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Forwarded-Host: whoami2.internal-pre.ysicing.me</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Forwarded-Port: 443</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Forwarded-Proto: https</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Forwarded-Server: sh-pre</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">X-Real-Ip: 101.35.53.4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="ingress" term="ingress"/>
        <category label="kubernetes" term="kubernetes"/>
        <category label="tke" term="tke"/>
        <category label="traefik" term="traefik"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Tke集群基于CFS动态创建不同子目录的pvc]]></title>
        <id>/posts/tke-cfs-nfs-client</id>
        <link href="https://ysicing.me/posts/tke-cfs-nfs-client"/>
        <updated>2021-11-26T07:31:49.000Z</updated>
        <summary type="html"><![CDATA[使用 nfs-client-provisioner 动态创建不同子目录的 pvc]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="序">序<a class="hash-link" href="#序" title="标题的直接链接">​</a></h2><p>由于TKE集群CSI功能相对ACK比较鸡肋, 相对阿里云NAS CSI. 我们只需要SC自动改创建CFS类型的PV和PVC.
我们的使用场景是不同PV使用同一个CFS不同路径, 或者不同CFS可以共享资源包(成本问题,创建PV数目比较多), 恰恰这两点TKE都不支持。 对此使用社区的 nfs-client-provisioner 项目来实现动态创建 CFS 文件系统中的子路径</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h2><ol><li>创建CFS实例并配置好资源包</li><li>安装<code>nfs-subdir-external-provisioner</code></li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -i nfs-subdir-external-provisioner -n kube-system nfs-subdir-external-provisioner/nfs-subdir-external-provisioner </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set image.repository</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ccr.ccs.tencentyun.com/k7scn/nfs-subdir-external-provisioner </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set image.tag</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">v4.0.2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set nfs.server</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">cfs.ip</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set nfs.path</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set storageClass.defaultClass</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --set storageClass.name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">opencfs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>查看动态存储类</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl get sc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                PROVISIONER                                     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cbs                 com.tencent.cloud.csi.cbs                       Delete          Immediate           </span><span class="token boolean">false</span><span class="token plain">                  6d22h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cce                 com.tencent.cloud.csi.cfs                       Retain          Immediate           </span><span class="token boolean">false</span><span class="token plain">                  3d21h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">opencfs </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">   cluster.local/nfs-subdir-external-provisioner   Delete          Immediate           </span><span class="token boolean">true</span><span class="token plain">                   4s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>测试</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> opencfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 1Mi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> CloneSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> traefik/whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">vol</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">claimName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps.kruise.io/v1alpha1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> SidecarSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> whoami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">updateStrategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> RollingUpdate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> sidecar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing/debian</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">podInjectPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> AfterAppContainer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">shareVolumePolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> enabled</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"sleep"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"999d"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="qcloud" term="qcloud"/>
        <category label="csi" term="csi"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于DNSPOD使用cert-manager自动签发TLS证书]]></title>
        <id>/posts/tke-dnspod-cert-manager-install</id>
        <link href="https://ysicing.me/posts/tke-dnspod-cert-manager-install"/>
        <updated>2021-11-22T02:51:42.000Z</updated>
        <summary type="html"><![CDATA[k8s上使用cert-manager自动签发 TLS 证书]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="序">序<a class="hash-link" href="#序" title="标题的直接链接">​</a></h2><p>最近在使用tke集群和dnspod, 记录一下基于dnspod部署cert-manager</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装cert-manager">安装cert-manager<a class="hash-link" href="#安装cert-manager" title="标题的直接链接">​</a></h2><blockquote><p>这里使用bitnami提供的cert-manager</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl create namespace cert-manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> bitnami https://charts.bitnami.com/bitnami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -i cert-manager -n cert-manager --set </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">installCRDs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">true --set leaderElection.namespace</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">cert-manager bitnami/cert-manager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装dnspod-webhook">安装dnspod webhook<a class="hash-link" href="#安装dnspod-webhook" title="标题的直接链接">​</a></h2><p>创建腾讯云API token</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo add roc https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">charts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">imroc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i  cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">webhook</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dnspod roc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">webhook</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dnspod \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">namespace cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set clusterIssuer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">secretId</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SECRET_ID</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set clusterIssuer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">secretKey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">SECRET_KEY</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建clusterissuer">创建ClusterIssuer<a class="hash-link" href="#创建clusterissuer" title="标题的直接链接">​</a></h2><blockquote><p>由于上面配置了默认创建, 默认ClusterIssuer为<code>dnspod</code></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-certificate">创建 Certificate<a class="hash-link" href="#创建-certificate" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manager.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Certificate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">com</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">com</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod </span><span class="token comment" style="color:rgb(0, 128, 0)"># 证书保存的 secret 名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dnsNames</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*.default.ops.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">issuerRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dnspod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIssuer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">group</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manager.io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过dns验证可以创建泛域名证书。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h2><ol><li>在ingress里使用</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10.0.0.0/8</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> api.cce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system.internal.ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Prefix</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> api.cce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system.internal.ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">tls</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>在istio ingressgateway中使用</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.istio.io/v1alpha3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Gateway</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">gw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> istio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> istio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ingressgateway</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">istio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ingressgateway</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">servers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> HTTP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> HTTP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> example.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*.example.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">httpsRedirect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># http 重定向 https (强制 https)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> HTTPS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> HTTPS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> example.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*.example.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> SIMPLE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">credentialName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">crt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret </span><span class="token comment" style="color:rgb(0, 128, 0)"># 引用证书 secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.istio.io/v1beta1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> VirtualService</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">vs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">gateways</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> istio</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system/example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">gw </span><span class="token comment" style="color:rgb(0, 128, 0)"># 转发规则绑定到 ingressgateway，将服务暴露出去</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'test.example.com'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">route</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">destination</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> example</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="参考">参考<a class="hash-link" href="#参考" title="标题的直接链接">​</a></h2><p><a href="https://imroc.cc/k8s/trick/cert-manager-webhook-dnspod/" target="_blank" rel="noopener noreferrer">https://imroc.cc/k8s/trick/cert-manager-webhook-dnspod/</a></p><p><a href="/posts/cert-manager-install/">k8s上利用cert-manager自动签发TLS证书</a></p>]]></content>
        <category label="cert-manager" term="cert-manager"/>
        <category label="kubernetes" term="kubernetes"/>
        <category label="qcloud" term="qcloud"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Drone配置管理员账号]]></title>
        <id>/posts/drone-config-admin</id>
        <link href="https://ysicing.me/posts/drone-config-admin"/>
        <updated>2021-11-11T15:17:02.000Z</updated>
        <summary type="html"><![CDATA[本文主要记录一下drone调整管理员]]></summary>
        <content type="html"><![CDATA[<p>默认已经将drone数据持久化出来了</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">envFrom</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">configMapRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">beijing.aliyuncs.com/k7scn/drone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">hostPath</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /data/drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DirectoryOrCreate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian安装sqlite3">debian安装sqlite3<a class="hash-link" href="#debian安装sqlite3" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> sqlite3 -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改数据">修改数据<a class="hash-link" href="#修改数据" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sqlite3 database.sqlite</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.header on </span><span class="token comment" style="color:rgb(0, 128, 0)">#开启头部显示。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.mode </span><span class="token function" style="color:rgb(0, 0, 255)">column</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 列输出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">.tables</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">select</span><span class="token plain"> * from </span><span class="token function" style="color:rgb(0, 0, 255)">users</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">update </span><span class="token function" style="color:rgb(0, 0, 255)">users</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">set</span><span class="token plain"> user_admin </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证">验证<a class="hash-link" href="#验证" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">drone user info ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">User: ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Email: i@ysicing.me</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Admin: </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Active: </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Machine: </span><span class="token boolean">false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="drone" term="drone"/>
        <category label="devops" term="devops"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Brew Cask日常使用]]></title>
        <id>/posts/brew-cask-usage</id>
        <link href="https://ysicing.me/posts/brew-cask-usage"/>
        <updated>2021-10-19T01:57:40.000Z</updated>
        <summary type="html"><![CDATA[记录brew cask使用小技巧]]></summary>
        <content type="html"><![CDATA[<p>记录一下, 如何升级brew cask安装的软件。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装cu">安装cu<a class="hash-link" href="#安装cu" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew tap buo/cask-upgrade</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自动升级">自动升级<a class="hash-link" href="#自动升级" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew cu -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="macOS" term="macOS"/>
        <category label="tools" term="tools"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Containerd 使用教程之nerdctl]]></title>
        <id>/posts/containerd-nerdctl</id>
        <link href="https://ysicing.me/posts/containerd-nerdctl"/>
        <updated>2021-10-07T09:16:45.000Z</updated>
        <summary type="html"><![CDATA[本文主要描述Containerd Cli的安装及使用姿势。]]></summary>
        <content type="html"><![CDATA[<blockquote><p>默认本文演示环境为<code>Debian GNU/Linux 11 (bullseye)</code></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><p>nerdctl默认提供了两个压缩包</p><ul><li><code>nerdctl-0.12.1-linux-amd64.tar.gz</code>, 仅包含nerdctl</li><li><code>nerdctl-full-0.12.1-linux-amd64.tar.gz</code>, 包含了runc和作为k8s容器运行时所需的cni文件</li></ul><p>默认我们使用第二个压缩包<code>nerdctl-full-0.12.1-linux-amd64.tar.gz</code>,除非本地已安装使用containerd</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 从github下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://github.techoc.workers.dev/https://github.com/containerd/nerdctl/releases/download/v0.12.1/nerdctl-full-0.12.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> Cxzvvf /usr/local nerdctl-full-0.12.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 开启启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> containerd.service --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置">配置<a class="hash-link" href="#配置" title="标题的直接链接">​</a></h2><p>Containerd 的默认配置文件为 <code>/etc/containerd/config.toml</code>, 可以使用如下命令生成默认配置</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">containerd config default </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/containerd/config.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成docker执行文件">生成docker执行文件<a class="hash-link" href="#生成docker执行文件" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docker </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nerdctl $@</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">chmod </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装docker常用扩展插件">安装docker常用扩展插件<a class="hash-link" href="#安装docker常用扩展插件" title="标题的直接链接">​</a></h4><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools tar zxf /pkg.tgz -C /sysdir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h4><p>快速安装containerd脚本 <a href="https://sh.ysicing.me/k8s/cri/containerd-install" target="_blank" rel="noopener noreferrer">containerd-install</a></p>]]></content>
        <category label="containerd" term="containerd"/>
        <category label="nerdctl" term="nerdctl"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Openkruise快速安装]]></title>
        <id>/posts/openkruise-install</id>
        <link href="https://ysicing.me/posts/openkruise-install"/>
        <updated>2021-10-06T03:01:17.000Z</updated>
        <summary type="html"><![CDATA[本文介绍Openkruise安装部署]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h2><blockquote><p>OpenKruise 是一个基于 Kubernetes 的扩展套件，主要聚焦于云原生应用的自动化，比如部署、发布、运维以及可用性防护。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="核心功能">核心功能<a class="hash-link" href="#核心功能" title="标题的直接链接">​</a></h3><ul><li>增强版本的 Workloads, 如原地升级等</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="helm安装">helm安装<a class="hash-link" href="#helm安装" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新增开启特性">新增开启特性<a class="hash-link" href="#新增开启特性" title="标题的直接链接">​</a></h3><ul><li>PreDownloadImageForInPlaceUpdate 原地升级镜像预热</li><li>ResourcesDeletionProtection 资源删除保护</li><li>PodUnavailableBudgetUpdateGate pod原地升级</li><li>WorkloadSpread WorkloadSpread 管理应用多分区弹性与拓扑部署</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -i kruise https://github.com/openkruise/kruise/releases/download/v0.10.0/kruise-chart.tgz  --set </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">featureGates</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"ResourcesDeletionProtection=true\,PreDownloadImageForInPlaceUpdate=true\,PodUnavailableBudgetUpdateGate=true\,WorkloadSpread=true"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="openkruise" term="openkruise"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Tailscale内网穿透新姿势]]></title>
        <id>/posts/tailscale-k8s-mesh-network</id>
        <link href="https://ysicing.me/posts/tailscale-k8s-mesh-network"/>
        <updated>2021-10-02T02:39:15.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述tailscale如何打通podip,svcip]]></summary>
        <content type="html"><![CDATA[<blockquote><p>很久就用上了,用于替代之前自行部署的<code>wireguard mesh</code>组网</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="token申请">Token申请<a class="hash-link" href="#token申请" title="标题的直接链接">​</a></h2><p>申请两个token, 一个用于pod,一个用于svc</p><p><img loading="lazy" src="/assets/images/tailscale-token-498a9011b748596160b0fc92917dd571.jpg" width="2326" height="1206" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="helm-安装">helm 安装<a class="hash-link" href="#helm-安装" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> mvisonneau https://charts.visonneau.fr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade -i  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  tailscale-relay-svc </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  mvisonneau/tailscale-relay </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --set config.authKey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">your_auth_key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -n kube-system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get cm/tailscale-relay-svc-config  -n kube-system -o yaml </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  TAILSCALE_ADVERTISE_ROUTES: </span><span class="token number" style="color:rgb(9, 134, 88)">10.42</span><span class="token plain">.0.0/16</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind: ConfigMap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置route">配置route<a class="hash-link" href="#配置route" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="/assets/images/tailscale-route-372d50513180de10aaeab654783d2303.jpg" width="1692" height="1304" class="img_ev3q"></p>]]></content>
        <category label="wireguard" term="wireguard"/>
        <category label="tailscale" term="tailscale"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[群晖新套件：Tailscale极速组网]]></title>
        <id>/posts/tailscale-working-nas-dsm7</id>
        <link href="https://ysicing.me/posts/tailscale-working-nas-dsm7"/>
        <updated>2021-10-02T02:36:07.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述群晖安装Tailscale]]></summary>
        <content type="html"><![CDATA[<blockquote><p>最近群晖升级到DSM7了,决定使用<code>Tailscale</code>替代之前自行部署的<code>wireguard mesh</code>组网</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h2><p>Tailscale属于一种虚拟组网工具，基于WireGuard, 基本零配置，秒接入, 降低学习成本，超级简单，访问速度也很不错，而且支持全平台。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注意事项">注意事项<a class="hash-link" href="#注意事项" title="标题的直接链接">​</a></h2><ul><li>千万不要使用gmail验证/Google登录，否则移动端验证很蛋疼的。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><p>默认安装参考 <a href="https://tailscale.com/download" target="_blank" rel="noopener noreferrer">tailscale</a>, 中国大陆访问境外镜像站可能比较慢，这里我提供debian系统下的安装包。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull registry.cn-beijing.aliyuncs.com/k7scn/debcache</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> run -it --rm -v /root:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/debcache </span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable function" style="color:rgb(0, 0, 255)">docker</span><span class="token variable" style="color:rgb(9, 134, 88)"> run --rm registry.cn-beijing.aliyuncs.com/k7scn/debcache </span><span class="token variable function" style="color:rgb(0, 0, 255)">ls</span><span class="token variable" style="color:rgb(9, 134, 88)"> -l </span><span class="token variable operator" style="color:rgb(0, 0, 0)">|</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable function" style="color:rgb(0, 0, 255)">grep</span><span class="token variable" style="color:rgb(9, 134, 88)"> deb </span><span class="token variable operator" style="color:rgb(0, 0, 0)">|</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable function" style="color:rgb(0, 0, 255)">awk</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain"> /sysdir/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 已经安装ysicing/tools的可以使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergoget tailscaleget</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="群晖客户端安装">群晖客户端安装<a class="hash-link" href="#群晖客户端安装" title="标题的直接链接">​</a></h3><p>我的群晖是DS218+,架构是<code>apollolake/amd64</code>, 如果你不清楚你的架构，可以参考 <a href="https://github.com/tailscale/tailscale-synology/blob/main/docs/platforms.md" target="_blank" rel="noopener noreferrer">群晖等架构信息</a></p><p>下载 <a href="https://github.com/tailscale/tailscale-synology/releases/download/v1.14.6/tailscale-x86_64-1.14.6-2010-dsm7.spk" target="_blank" rel="noopener noreferrer">tailscale-x86_64-1.14.6-2010-dsm7.spk</a>,不要从官方下载版本比较老。</p><p>手动安装</p><p><img loading="lazy" src="/assets/images/nas-202110021101-5038e64399a64f0184b244e5d91ca98b.jpg" width="2060" height="1070" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/nas-1633147949452-089bbb6358f397c19749648cbdacc8d7.jpg" width="1560" height="822" class="img_ev3q"></p><p>登录查看状态</p><p><img loading="lazy" src="/assets/images/nas-conn-7c76fd37f10d7683f61e6fb5407ebf7d.jpg" width="1532" height="76" class="img_ev3q"></p>]]></content>
        <category label="wireguard" term="wireguard"/>
        <category label="tailscale" term="tailscale"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k3s使用Cilium替换默认Flannel]]></title>
        <id>/posts/how-to-use-cilium-to-replace-k3s-flannel</id>
        <link href="https://ysicing.me/posts/how-to-use-cilium-to-replace-k3s-flannel"/>
        <updated>2021-09-24T10:35:25.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述k3s使用cilium网络]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="系统要求">系统要求<a class="hash-link" href="#系统要求" title="标题的直接链接">​</a></h2><ul><li>k3s &gt;= 1.16,(默认v1.21.5+k3s1)</li><li>Debian 11，(默认5.10)</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改k3s配置">修改k3s配置<a class="hash-link" href="#修改k3s配置" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> /etc/systemd/system/k3s.service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --flannel-backend none </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将网络默认设置为<code>none</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="移除网络相关设置">移除网络相关设置<a class="hash-link" href="#移除网络相关设置" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 移除cni命名空间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> netns show </span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> cni- </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -r -t -n </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> netns delete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 移除cnio网卡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> show </span><span class="token operator file-descriptor important" style="color:rgb(0, 0, 0)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'master cni0'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">read</span><span class="token plain"> ignore iface ignore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">iface</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">${iface</span><span class="token variable operator" style="color:rgb(0, 0, 0)">%%</span><span class="token variable" style="color:rgb(9, 134, 88)">@*}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -z </span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$iface</span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> delete </span><span class="token variable" style="color:rgb(9, 134, 88)">$iface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> delete cni0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">ip</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">link</span><span class="token plain"> delete flannel.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">rm</span><span class="token plain"> -rf /var/lib/cni/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 清理iptables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">iptables-save </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> -v KUBE- </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> -v CNI- </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> iptables-restore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装cilium">安装cilium<a class="hash-link" href="#安装cilium" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="helm安装">helm安装<a class="hash-link" href="#helm安装" title="标题的直接链接">​</a></h3><div class="language-helm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-helm codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo add cilium https://helm.cilium.io/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm install cilium cilium/cilium --version 1.10.4 \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   --namespace kube-system\</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   --set hubble.relay.enabled=true \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   --set hubble.ui.enabled=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cilium安装">cilium安装<a class="hash-link" href="#cilium安装" title="标题的直接链接">​</a></h3><blockquote><p>默认 <a href="https://github.com/ysicing/tools" target="_blank" rel="noopener noreferrer">ysicig/tools</a>已内置</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 指定pod ip段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cilium </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --config cluster-pool-ipv4-cidr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"10.42.0.0/16"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 安装hubble网络拓扑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cilium hubble </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> --ui</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证cilium">验证cilium<a class="hash-link" href="#验证cilium" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# cilium status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\    Cilium</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">         OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> \__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">    Operator</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\    Hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">         OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> \__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">¯¯\__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">    ClusterMesh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    OK</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    \__</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Deployment        hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui                Desired</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ready</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Deployment        clustermesh</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">apiserver    Desired</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ready</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DaemonSet         cilium                   Desired</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ready</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Deployment        cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">operator          Desired</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ready</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Deployment        hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">relay             Desired</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ready</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       cilium                   Running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">operator          Running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">relay             Running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui                Running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  clustermesh</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">apiserver    Running</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Cluster Pods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> managed by Cilium</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Image versions    cilium                   quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">10.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">operator          quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">operator</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">generic</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">10.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">relay             quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">relay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">10.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui                quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">7.9</span><span class="token plain">@sha256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">e0e461c680ccd083ac24fe4f9e19e675422485f04d8720635ec41f2ba9e5562c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui                quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">7.9</span><span class="token plain">@sha256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">632c938ef6ff30e3a080c59b734afb1fb7493689275443faa1435f7141aabe76</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  hubble</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ui                docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">envoyproxy</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">envoy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">18.2</span><span class="token plain">@sha256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">e8b37c1d75787dd1e712ff389b0d37337dc8a174a63bed9c34ba73359dc67da7</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  clustermesh</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">apiserver    quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">coreos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etcd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4.13</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                  clustermesh</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">apiserver    quay</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cilium</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">clustermesh</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">apiserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">10.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="访问hubble查看网络连接">访问Hubble查看网络连接<a class="hash-link" href="#访问hubble查看网络连接" title="标题的直接链接">​</a></h3><p><img loading="lazy" src="/assets/images/hubble-ui-247e1a4afeb5ec48af4f9ae8f0f9a78b.png" width="3356" height="1740" class="img_ev3q"></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="绑定ingress">绑定ingress<a class="hash-link" href="#绑定ingress" title="标题的直接链接">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.ysicing.me</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s-app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui.internal.ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">number</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">pathType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ImplementationSpecific</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> hubble</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ui.internal.ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ysicing.net</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器访问 <code>https://hubble-ui.internal.ysicing.net</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="port-forward转发">port-forward转发<a class="hash-link" href="#port-forward转发" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl port-forward --namespace kube-system  service/hubble-ui </span><span class="token number" style="color:rgb(9, 134, 88)">38888</span><span class="token plain">:80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器访问 <code>http://127.0.0.1:38888</code></p>]]></content>
        <category label="k3s" term="k3s"/>
        <category label="cilium" term="cilium"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[部署一站式轻监控轻运维系统哪吒监控魔改版金吒监控]]></title>
        <id>/posts/nezha-ops-monitor</id>
        <link href="https://ysicing.me/posts/nezha-ops-monitor"/>
        <updated>2021-09-22T05:09:03.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述部署金吒监控]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="序">序<a class="hash-link" href="#序" title="标题的直接链接">​</a></h2><p>魔改版本, 仅支持资源展示。如果需要定时任务或者监控报警，请使用 <a href="https://github.com/naiba/nezha" target="_blank" rel="noopener noreferrer">哪吒监控</a></p><blockquote><p>本魔改目前仅体现资源相关信息</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="魔改功能">魔改功能<a class="hash-link" href="#魔改功能" title="标题的直接链接">​</a></h3><ul><li>支持被动注册和主动注册</li><li>推荐使用容器化部署</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="服务端">服务端<a class="hash-link" href="#服务端" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">debug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">httpport</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">grpcport</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5555</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">admin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 本地管理员账号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">pass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">12345678</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">oauth2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"github"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#gitee/github</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">admin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#管理员列表，半角逗号隔开</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">clientid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 在 https://github.com/settings/developers 创建，无需审核 Callback 填 http(s)://域名或IP/oauth2/callback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">clientsecret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">site</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">brand</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"金吒监控"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">cookiename</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"nezha-dashboard"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#浏览器 Cookie 字段名，可不改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">theme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> sqlite</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dsn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"nezha.sqlite"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  type: mysql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  dsn: root:rootpass@tcp(db.k8s.ysicing.local:3306)/bjdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">debug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nezha</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://sh.ysicing.me/k8s/nezha/dash.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="客户端">客户端<a class="hash-link" href="#客户端" title="标题的直接链接">​</a></h2><p>主动注册需要持久化<code>/var/lib/nezha</code> </p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nezha-agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ghcr.io/ysicing/nezha</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">edge</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nezha</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">agent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"host"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">pid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"host"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">privileged</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./agentdata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/var/lib/nezha</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># command:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># - "--p=cdxxxxxxx" # 被动注册</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="演示">演示<a class="hash-link" href="#演示" title="标题的直接链接">​</a></h2><p><a href="https://nezha.external.ysicing.net/" target="_blank" rel="noopener noreferrer">金吒监控</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="致谢">致谢<a class="hash-link" href="#致谢" title="标题的直接链接">​</a></h2><p><a href="https://github.com/naiba/nezha" target="_blank" rel="noopener noreferrer">naiba/nezha</a></p>]]></content>
        <category label="tools" term="tools"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Containerd 使用教程]]></title>
        <id>/posts/getting-started-with-containerd</id>
        <link href="https://ysicing.me/posts/getting-started-with-containerd"/>
        <updated>2021-09-13T09:16:45.000Z</updated>
        <summary type="html"><![CDATA[本文主要描述Containerd的安装及使用姿势。]]></summary>
        <content type="html"><![CDATA[<blockquote><p>默认本文演示环境为<code>Debian GNU/Linux 11 (bullseye)</code></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><p>containerd默认提供了两个压缩包</p><ul><li><code>containerd-1.5.5-linux-amd64.tar.gz</code></li><li><code>cri-containerd-cni-1.5.5-linux-amd64.tar.gz</code>, 包含了runc和作为k8s容器运行时所需的cni文件</li></ul><p>默认我们使用第二个压缩包<code>cri-containerd-cni-1.5.5-linux-amd64.tar.gz</code>,除非本地测试使用第一个</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 从github下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://github.com/containerd/containerd/releases/download/v1.5.5/cri-containerd-cni-1.5.5-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> -C / -xzf cri-containerd-cni-1.5.5-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 开启启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> containerd.service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start containerd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看版本信息</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ctr version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Client:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version:  v1.5.5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Revision: 72cec4be58a9eb6b2910f5d10f1c01ca47d231c0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Go version: go1.16.6</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Server:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version:  v1.5.5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Revision: 72cec4be58a9eb6b2910f5d10f1c01ca47d231c0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  UUID: 6a851001-a5f3-4722-94c4-38e2916eb44c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置文件">配置文件<a class="hash-link" href="#配置文件" title="标题的直接链接">​</a></h2><p>Containerd 的默认配置文件为 <code>/etc/containerd/config.toml</code>, 可以使用如下命令生成默认配置</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">containerd config default </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/containerd/config.toml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="高级配置">高级配置<a class="hash-link" href="#高级配置" title="标题的直接链接">​</a></h3><blockquote><p>利用containerd插件机制</p></blockquote><p>查看目前支持的插件 <code>ctr plugins ls</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ctr plugins </span><span class="token function" style="color:rgb(0, 0, 255)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TYPE                            ID                       PLATFORMS      STATUS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.content.v1        content                  -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    aufs                     linux/amd64    skip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    btrfs                    linux/amd64    skip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    devmapper                linux/amd64    error</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    native                   linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    overlayfs                linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.snapshotter.v1    zfs                      linux/amd64    skip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.metadata.v1       bolt                     -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.differ.v1         walking                  linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.gc.v1             scheduler                -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        introspection-service    -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        containers-service       -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        content-service          -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        diff-service             -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        images-service           -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        leases-service           -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        namespaces-service       -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        snapshots-service        -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.runtime.v1        linux                    linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.runtime.v2        task                     linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.monitor.v1        cgroups                  linux/amd64    ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.service.v1        tasks-service            -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.internal.v1       restart                  -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           containers               -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           content                  -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           </span><span class="token function" style="color:rgb(0, 0, 255)">diff</span><span class="token plain">                     -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           events                   -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           healthcheck              -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           images                   -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           leases                   -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           namespaces               -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.internal.v1       opt                      -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           snapshots                -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           tasks                    -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           version                  -              ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">io.containerd.grpc.v1           cri                      linux/amd64    ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="镜像加速">镜像加速<a class="hash-link" href="#镜像加速" title="标题的直接链接">​</a></h4><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 参考文档 https://github.com/containerd/containerd/blob/main/docs/cri/registry.md</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[plugins."io.containerd.grpc.v1.cri".registry]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  [plugins."io.containerd.grpc.v1.cri".registry.mirrors]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      endpoint = ["https://registry-1.docker.io"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."test.https-registry.io"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      endpoint = ["https://HostIP1:Port1"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."test.http-registry.io"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      endpoint = ["http://HostIP2:Port2"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # wildcard matching is supported but not required.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [plugins."io.containerd.grpc.v1.cri".registry.mirrors."*"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      endpoint = ["https://HostIP3:Port3"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  [plugins."io.containerd.grpc.v1.cri".registry.configs]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    [plugins."io.containerd.grpc.v1.cri".registry.configs."gcr.io".auth]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      username = "_json_key"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      password = 'paste output from jq'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h4><p>示例containerd配置文件 <a href="https://sh.ysicing.me/k8s/cri/containerd.config.toml" target="_blank" rel="noopener noreferrer">config.toml</a></p>]]></content>
        <category label="containerd" term="containerd"/>
        <category label="cri" term="cri"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[部署Kubernetes Dashboard]]></title>
        <id>/posts/k8s-kubernetes-dashboard-install</id>
        <link href="https://ysicing.me/posts/k8s-kubernetes-dashboard-install"/>
        <updated>2021-09-08T04:59:51.000Z</updated>
        <summary type="html"><![CDATA[安装部署k8s Dashboard]]></summary>
        <content type="html"><![CDATA[<p>简单记录一下快速安装dashboard</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://sh.ysicing.me/k8s/dashboard/recommended.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="授权">授权<a class="hash-link" href="#授权" title="标题的直接链接">​</a></h3><p>授权集群管理员权限, 默认用户为<code>super-kd-user</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://sh.ysicing.me/k8s/dashboard/admin.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取token">获取token<a class="hash-link" href="#获取token" title="标题的直接链接">​</a></h3><p>获取授权用户<code>super-kd-user</code>token</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kdtoken # 可以从ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools处获取</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 法一</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get secret </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dashboard $</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">kubectl get secret </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dashboard</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">grep super</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">kd</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">awk </span><span class="token char" style="color:rgb(129, 31, 63)">'{print $1}'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o jsonpath</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'  </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> base64 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">decode</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 法二</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dashboard describe secret super</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">kd</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> grep </span><span class="token char" style="color:rgb(129, 31, 63)">'^token'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="访问">访问<a class="hash-link" href="#访问" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl proxy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用浏览器访问<code>http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</code>
登录使用<code>super-kd-user</code>Bearer Token</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="附录">附录<a class="hash-link" href="#附录" title="标题的直接链接">​</a></h3><p><a href="https://github.com/ysicing/tools" target="_blank" rel="noopener noreferrer">ysicing/toos</a></p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Lima虚拟机初体验二]]></title>
        <id>/posts/lima-vm-on-macOS-M1</id>
        <link href="https://ysicing.me/posts/lima-vm-on-macOS-M1"/>
        <updated>2021-09-05T12:16:57.000Z</updated>
        <summary type="html"><![CDATA[M1 Mac上使用Lima运行Debian虚拟机]]></summary>
        <content type="html"><![CDATA[<p>接上文<a href="/posts/lima-vm-on-macos/">Lima虚拟机初体验一</a>在M1上玩转Lima</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="快速开始">快速开始<a class="hash-link" href="#快速开始" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="m1系统信息">M1系统信息<a class="hash-link" href="#m1系统信息" title="标题的直接链接">​</a></h3><div class="language-macOS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-macOS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># brew install m-cli</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ m info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ProductName:    macOS</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ProductVersion: 11.5.2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">BuildVersion:   20G95</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="m1-patch">m1 patch<a class="hash-link" href="#m1-patch" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 安装构建依赖</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew install libffi gettext glib pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">config autoconf automake pixman ninja</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 下载源码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git clone https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">qemu</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">qemu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd qemu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git checkout 3c93dfa42c394fdd55684f2fbf24cf2f39b97d47</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">patchwork</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kernel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">series</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">485309</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mbox</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> git am</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mkdir build </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> cd build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">configure </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">target</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">list</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">aarch64</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">softmmu </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">enable</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">hvf </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">disable</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">gnutls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j8 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sudo </span><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token plain"> install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意一点:</p><blockquote><p>可能通过brew安装的qemu，会识别默认该路径下的<code>/opt/homebrew/bin/qemu-system-aarch64</code>, 而patch生成的则在<code>/usr/local/bin/qemu-system-aarch64</code>。</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">opt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">homebrew</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">qemu</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">aarch64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试patch">测试patch<a class="hash-link" href="#测试patch" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://mirrors.tuna.tsinghua.edu.cn/debian-cd/current/arm64/iso-cd/debian-11.0.0-arm64-netinst.iso</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">qemu-img create -f qcow2 virtual-disk.qcow2 8G</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable function" style="color:rgb(0, 0, 255)">dirname</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">$(</span><span class="token variable" style="color:rgb(9, 134, 88)">which qemu-img</span><span class="token variable punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">/share/qemu/edk2-aarch64-code.fd </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">if</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">conv</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">sync </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">bs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">1m </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">count</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">of</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ovmf_vars.fd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/usr/local/bin/qemu-system-aarch64 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -machine virt,accel</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">hvf,highmem</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">off </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -cpu cortex-a72 -smp </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> -m 4G </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -device virtio-gpu-pci </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -device virtio-keyboard-pci </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -drive </span><span class="token string" style="color:rgb(163, 21, 21)">"format=raw,file=edk2-aarch64-code.fd,if=pflash,readonly=on"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -drive </span><span class="token string" style="color:rgb(163, 21, 21)">"format=raw,file=ovmf_vars.fd,if=pflash"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -drive </span><span class="token string" style="color:rgb(163, 21, 21)">"format=qcow2,file=virtual-disk.qcow2"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -cdrom debian-11.0.0-arm64-netinst.iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>成功启动虚拟机表示patch成功了，可以通过lima启动管理虚拟机了</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装lima并启动">安装Lima并启动<a class="hash-link" href="#安装lima并启动" title="标题的直接链接">​</a></h3><p>安装lima</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> lima</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动lima</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 下载专用debian配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://sh.ysicing.me/lima/debian.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 启动debian虚拟机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">limactl start ./debian.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="附录阅读">附录阅读<a class="hash-link" href="#附录阅读" title="标题的直接链接">​</a></h2><ul><li><a href="https://gist.github.com/nrjdalal/e70249bb5d2e9d844cc203fd11f74c55" target="_blank" rel="noopener noreferrer">Github - Create Virtual Machines using QEMU on Silicon based Apple Macs</a></li><li><a href="https://gist.github.com/citruz/9896cd6fb63288ac95f81716756cb9aa#gistcomment-3629192" target="_blank" rel="noopener noreferrer">Github - Running Linux and Windows on M1 with QEMU</a></li></ul>]]></content>
        <category label="vm" term="vm"/>
        <category label="debian" term="debian"/>
        <category label="macOS" term="macOS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Lima虚拟机初体验一]]></title>
        <id>/posts/lima-vm-on-macOS</id>
        <link href="https://ysicing.me/posts/lima-vm-on-macOS"/>
        <updated>2021-09-05T02:16:57.000Z</updated>
        <summary type="html"><![CDATA[Intel Mac上使用Lima运行Debian虚拟机]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="什么是lima">什么是Lima<a class="hash-link" href="#什么是lima" title="标题的直接链接">​</a></h2><blockquote><p>Linux virtual machines on macOS</p></blockquote><p>即专注于在macOS上支持文件共享、端口转发和使用 containerd 的 Linux 虚拟机, 其诞生的初衷是推广在macOS上使用<code>containerd</code>和<code>nerdctl</code></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="功能">功能<a class="hash-link" href="#功能" title="标题的直接链接">​</a></h4><ul><li>支持自动文件共享</li><li>支持端口转发</li><li>内置支持<code>containerd</code></li><li>基于QEMU支持 <code>Intel on Intel</code>, <code>ARM on Intel</code>, <code>ARM on ARM</code>, <code>Intel on ARM</code></li><li>支持Linux发行版常见都可以,如<code>Debian</code></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="快速开始">快速开始<a class="hash-link" href="#快速开始" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Intel Mac</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> lima</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian自定义配置">Debian自定义配置<a class="hash-link" href="#debian自定义配置" title="标题的直接链接">​</a></h4><p>生成debian配置</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"> ./debian.yml&lt;&lt;EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">images</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"x86_64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"https://cloud.debian.org/images/cloud/bullseye/20210814-734/debian-11-generic-amd64-20210814-734.qcow2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"x86_64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">cpus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"4GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">disk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"100GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">mounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"~"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">writable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/tmp/lima"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">writable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">localPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">provision</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      #!/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      echo "/usr/local/bin/nerdctl \$@" &gt; /usr/local/bin/docker</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      chmod +x /usr/local/bin/docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      #!/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">      nerdctl run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools tar zxf /pkg.tgz -C /sysdir</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">probes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">script</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">    #!/bin/bash</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">    set -eux -o pipefail</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">    if ! timeout 120s bash -c "until test -f /usr/local/bin/dps; do sleep 3; done"; then</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            echo &gt;&amp;2 "tools is not installed yet"</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">            exit 0</span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">    fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://sh.ysicing.me/lima/debian.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启动lima虚拟机">启动lima虚拟机<a class="hash-link" href="#启动lima虚拟机" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">limactl start ./debian.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">? Creating an instance </span><span class="token string" style="color:rgb(163, 21, 21)">"debian"</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Use arrows to move, </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">type</span><span class="token plain"> to filter</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> Proceed with the default configuration</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Open an editor to override the configuration</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Exit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">? Creating an instance </span><span class="token string" style="color:rgb(163, 21, 21)">"debian"</span><span class="token plain"> Proceed with the default configuration</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Downloading </span><span class="token string" style="color:rgb(163, 21, 21)">"https://github.com/containerd/nerdctl/releases/download/v0.11.1/nerdctl-full-0.11.1-linux-amd64.tar.gz"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sha256:ce7a6e119b03c3fb8ded3d46d929962fd17417bea1d5bbc07e0fce49494d8a09</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Using cache </span><span class="token string" style="color:rgb(163, 21, 21)">"/Users/ysicing/Library/Caches/lima/download/by-url-sha256/3304d173f1e1824e5be6cf84bf2f78825cf0db416c4c975dbb2458776942629e/data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0001</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Attempting to download the image from </span><span class="token string" style="color:rgb(163, 21, 21)">"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0002</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Downloaded image from </span><span class="token string" style="color:rgb(163, 21, 21)">"~/hack/iso/debian-11-generic-amd64-20210814-734.qcow2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0002</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Starting QEMU </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">hint: to </span><span class="token function" style="color:rgb(0, 0, 255)">watch</span><span class="token plain"> the boot progress, see </span><span class="token string" style="color:rgb(163, 21, 21)">"/Users/ysicing/.lima/debian/serial.log"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0002</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> SSH Local Port: </span><span class="token number" style="color:rgb(9, 134, 88)">60024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0002</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"ssh"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0020</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0020</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"sshfs binary to be installed"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0029</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0029</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"/etc/fuse.conf to contain </span><span class="token string entity" style="color:rgb(163, 21, 21)">\"</span><span class="token string" style="color:rgb(163, 21, 21)">user_allow_other</span><span class="token string entity" style="color:rgb(163, 21, 21)">\"</span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0044</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0044</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"the guest agent to be running"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0044</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The essential requirement </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0044</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Mounting </span><span class="token string" style="color:rgb(163, 21, 21)">"/Users/ysicing"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0044</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Mounting </span><span class="token string" style="color:rgb(163, 21, 21)">"/tmp/lima"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the optional requirement </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"systemd must be available"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Forwarding </span><span class="token string" style="color:rgb(163, 21, 21)">"/run/user/501/lima-guestagent.sock"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">guest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> to </span><span class="token string" style="color:rgb(163, 21, 21)">"/Users/ysicing/.lima/debian/ga.sock"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The optional requirement </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Waiting </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the optional requirement </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">: </span><span class="token string" style="color:rgb(163, 21, 21)">"containerd binaries to be installed"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Not forwarding TCP </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">::</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">:22</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Not forwarding TCP </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.0.0:22</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">hostagent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> The optional requirement </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> of </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> is satisfied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">0045</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> READY. Run </span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable" style="color:rgb(9, 134, 88)">limactl shell debian</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain"> to </span><span class="token function" style="color:rgb(0, 0, 255)">open</span><span class="token plain"> the shell.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果过程失败了, 请检查yaml中的端口配置 <code>ssh.localPort</code>, 较大概率是端口冲突了
如果提示<code>READY</code>, 则表示虚拟机已经ok</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">08:08 ➜  hack limactl shell debian</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">debian</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ysicing@lima-debian:/Users/ysicing/hack$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian </span><span class="token function" style="color:rgb(0, 0, 255)">uname</span><span class="token plain"> -a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Linux lima-debian </span><span class="token number" style="color:rgb(9, 134, 88)">5.10</span><span class="token plain">.0-8-amd64 </span><span class="token comment" style="color:rgb(0, 128, 0)">#1 SMP Debian 5.10.46-4 (2021-08-03) x86_64 GNU/Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="容器使用">容器使用<a class="hash-link" href="#容器使用" title="标题的直接链接">​</a></h2><blockquote><p>定制后的配置，可以无缝使用docker命令</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运行容器">运行容器<a class="hash-link" href="#运行容器" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 类似docker run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian nerdctl run -d --name nginx -p </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1:8080:80 nginx:alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 类型docker ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian nerdctl </span><span class="token function" style="color:rgb(0, 0, 255)">ps</span><span class="token plain">                                                    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">8b877fa8e942    docker.io/library/nginx:alpine    </span><span class="token string" style="color:rgb(163, 21, 21)">"/docker-entrypoint.…"</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> seconds ago    Up        </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1:8080-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">/tcp    nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">name nginx </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian docker ps                                                    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">8b877fa8e942    docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">library</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">alpine    </span><span class="token string" style="color:rgb(163, 21, 21)">"/docker-entrypoint.…"</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> seconds ago    Up        </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tcp    nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">limactl shell debian dps                                                </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                     NAMES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">8b877fa8e942    docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">library</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">alpine    </span><span class="token string" style="color:rgb(163, 21, 21)">"/docker-entrypoint.…"</span><span class="token plain">    </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> seconds ago    Up        </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8080</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tcp    nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>浏览器访问<a href="http://127.0.0.1:8080%E6%98%BE%E7%A4%BAnginx%E9%BB%98%E8%AE%A4%E9%9D%99%E6%80%81%E9%A1%B5" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080显示nginx默认静态页</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他">其他<a class="hash-link" href="#其他" title="标题的直接链接">​</a></h2><ol><li>使用root用户</li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sudo password root</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">su root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="附录">附录<a class="hash-link" href="#附录" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h4><p>lima默认配置, 默认在当前用户<code>~/.lima/default/lima.yaml</code></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># /Users/ysicing/.lima/default/lima.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># BASIC CONFIGURATION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Arch: "default", "x86_64", "aarch64".</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># "default" corresponds to the host architecture.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># An image must support systemd and cloud-init.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Ubuntu and Fedora are known to work.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: none (must be specified)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">images</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Try to use a local image first.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"~/Downloads/hirsute-server-cloudimg-amd64.img"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"x86_64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"~/Downloads/hirsute-server-cloudimg-arm64.img"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"aarch64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Download the file from the internet when the local file is missing.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Hint: run `limactl prune` to invalidate the "current" cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"https://cloud-images.ubuntu.com/hirsute/current/hirsute-server-cloudimg-amd64.img"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"x86_64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"https://cloud-images.ubuntu.com/hirsute/current/hirsute-server-cloudimg-arm64.img"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"aarch64"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># CPUs: if you see performance issues, try limiting cpus to 1.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">cpus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Memory size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: "4GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"4GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Disk size</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: "100GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">disk</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"100GiB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Expose host directories to the guest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: none</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">mounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"~"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># CAUTION: `writable` SHOULD be false for the home directory.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Setting `writable` to true is possible, but untested and dangerous.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">writable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">location</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/tmp/lima"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">writable</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># A localhost port of the host. Forwarded to port 22 of the guest.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Currently, this port number has to be specified manually.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: none</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">localPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60022</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Load ~/.ssh/*.pub in addition to $LIMA_HOME/_config/user.pub .</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># This option is useful when you want to use other SSH-based</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># applications such as rsync with the Lima instance.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># If you have an insecure key under ~/.ssh, do not use this option.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">loadDotSSHPubKeys</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ADVANCED CONFIGURATION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">containerd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Enable system-wide (aka rootful)  containerd and its dependencies (BuildKit, Stargz Snapshotter)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">system</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Enable user-scoped (aka rootless) containerd and its dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Provisioning scripts need to be idempotent because they might be called</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># multiple times, e.g. when the host VM is being restarted.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># provision:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # `system` is executed with the root privilege</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - mode: system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     script: |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       #!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       set -eux -o pipefail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       export DEBIAN_FRONTEND=noninteractive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       apt-get install -y vim</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # `user` is executed without the root privilege</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - mode: user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     script: |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       #!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       set -eux -o pipefail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       cat &lt;&lt;EOF &gt; ~/.vimrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       set number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># probes:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  # Only `readiness` probes are supported right now.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#  - mode: readiness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#    description: vim to be installed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#    script: |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       #!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       set -eux -o pipefail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       if ! timeout 30s bash -c "until command -v vim; do sleep 3; done"; then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#         echo &gt;&amp;2 "vim is not installed yet"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#         exit 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#       fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#    hint: |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#      vim was not installed in the guest. Make sure the package system is working correctly.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#      Also see "/var/log/cloud-init-output.log" in the guest.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># FURTHER ADVANCED CONFIGURATION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ===================================================================== #</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">firmware</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Use legacy BIOS instead of UEFI.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">legacyBIOS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">video</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># QEMU display, e.g., "none", "cocoa", "sdl".</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># As of QEMU v5.2, enabling this is known to have negative impact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># on performance on macOS hosts: https://gitlab.com/qemu-project/qemu/-/issues/334</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># Default: "none"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">display</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"none"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">network</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># The instance can get routable IP addresses from the vmnet framework using</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># https://github.com/lima-vm/vde_vmnet. Both vde_switch and vde_vmnet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># daemons must be running before the instance is started. The interface type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># (host, shared, or bridged) is configured in vde_vmnet and not lima.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">vde</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># vnl (virtual network locator) points to the vde_switch socket directory,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># optionally with vde:// prefix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># - vnl: "vde:///var/run/vde.ctl"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   # VDE Switch port number (not TCP/UDP port number). Set to 65535 for PTP mode.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   # Default: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   switchPort: 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   # MAC address of the instance; lima will pick one based on the instance name,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   # so DHCP assigned ip addresses should remain constant over instance restarts.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   macAddress: ""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   # Interface name, defaults to "vde0", "vde1", etc.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#   name: ""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Port forwarding rules. Forwarding between ports 22 and ssh.localPort cannot be overridden.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Rules are checked sequentially until the first one matches.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># portForwards:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestPort: 443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostIP: "0.0.0.0" # overrides the default value "127.0.0.1"; allows privileged port forwarding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: hostPort: 443 (same as guestPort)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: guestIP: "127.0.0.1" (also matches bind addresses "0.0.0.0", "::", and "::1")</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: proto: "tcp" (only valid value right now)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestPortRange: [4000, 4999]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostIP:  "0.0.0.0" # overrides the default value "127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: hostPortRange: [4000, 4999] (must specify same number of ports as guestPortRange)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestPort: 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostPort: 8080 # overrides the default value 80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestIP: "127.0.0.2" # overrides the default value "127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostIP: "127.0.0.2" # overrides the default value "127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: guestPortRange: [1024, 65535]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # default: hostPortRange: [1024, 65535]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestPort: 8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     ignore: true (don't forward this port)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # Lima internally appends this fallback rule at the end:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   - guestIP: "127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     guestPortRange: [1024, 65535]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostIP: "127.0.0.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#     hostPortRange: [1024, 65535]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#   # Any port still not matched by a rule will not be forwarded (ignored)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="vm" term="vm"/>
        <category label="debian" term="debian"/>
        <category label="macOS" term="macOS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Debian11配置Locales]]></title>
        <id>/posts/debian11-locales</id>
        <link href="https://ysicing.me/posts/debian11-locales"/>
        <updated>2021-09-01T02:24:49.000Z</updated>
        <summary type="html"><![CDATA[升级Debian11后又遇到locales报错]]></summary>
        <content type="html"><![CDATA[<p>前几天升级Debian11后, 使用iTerm登录机器提示:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">perl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> warning</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Setting locale failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">perl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> warning</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Please check that your locale settings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LANGUAGE </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"en_US.utf8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LC_ALL </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"en_US.UTF-8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LC_TERMINAL </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"iTerm2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    LANG </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"en_US.utf8"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    are supported and installed on your system</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">perl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> warning</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Falling back to the standard locale </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"C"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_CTYPE to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_MESSAGES to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_ALL to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_CTYPE to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_MESSAGES to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Cannot set LC_ALL to </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> locale</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> No such file or directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这不能忍，一梭子<code>dpkg-reconfigure</code>解决</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">dpkg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">reconfigure locales</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 勾选上</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">en_US</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">zh_CN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ok</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 选择默认</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">en_US</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 最终结果</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Generating locales </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">this might take a while</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  en_HK</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  en_US</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  zh_CN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">UTF</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> done</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Generation complete</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意:</p><ul><li>需要使用root用户</li></ul>]]></content>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Caddy2插件Geocn]]></title>
        <id>/posts/caddy2-plugin-geocn</id>
        <link href="https://ysicing.me/posts/caddy2-plugin-geocn"/>
        <updated>2021-08-31T08:00:25.000Z</updated>
        <summary type="html"><![CDATA[Caddy2插件Geocn相关信息]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么要geocn">为什么要Geocn<a class="hash-link" href="#为什么要geocn" title="标题的直接链接">​</a></h2><p>大部分场景下,我们网站允许任何人访问, 某些特殊场景下我们需要限制大陆ip访问。
但是已有插件<code>caddy-maxmind-geolocation</code>为啥不用。</p><p>默认使用的 GeoIP2 数据库是来自于 MaxMind 的 GeoLite2 免费数据库。这个数据库目前存在一下几个问题：</p><ul><li>获取不便：从 2019 年 12 月 30 日起，必须注册后才能下载</li><li>数据量大：数据库庞大，包含全球的 IP 地址段，约 4 MB</li><li>准确度低：对中国大陆的 IP 地址判定不准，如：香港阿里云的 IP 被判定为新加坡、中国大陆等</li></ul><p>新的政策要求注册才能下载会增加时间成本，而且会让自动化下载的难度大大增加。庞大的数据量无可厚非，但是对于大多数中国大陆的用户来说，仅需要去判断 IP 的地理位置是否属于中国大陆境内，其他国家的 IP 一律代理。过多的数据量会增加载入时间，降低查询效率。</p><p>基于上述考虑, 结合<code>caddy-maxmind-geolocation</code>和<code>Hackl0us/GeoIP2-CN</code>两者, 只有判断ip是否是中国大陆ip即可。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="核心设计">核心设计<a class="hash-link" href="#核心设计" title="标题的直接链接">​</a></h2><ul><li>使用<code>Hackl0us/GeoIP2-CN</code>提供的准确度高、用户使用体验好的仅含有中国大陆 IP 信息的 GeoIP2 数据库</li><li>使用<code>caddyhttp.RequestMatcher</code>, 不得不说 <code>Request Matchers</code><ul><li>获取<code>request.RemoteAddr</code>地址, 优先级最高</li><li>从<code>request.Header</code>获取<code>X-Forwarded-For</code>地址, 如果RemoteAddr为内网地址,才考虑</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用caddy">使用caddy<a class="hash-link" href="#使用caddy" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="编译caddy2">编译caddy2<a class="hash-link" href="#编译caddy2" title="标题的直接链接">​</a></h3><p>可以参考 <a href="https://github.com/ysicing/dockerfiles/blob/master/caddy2/Dockerfile" target="_blank" rel="noopener noreferrer">ysicing/caddy2</a></p><p>默认情况下, 直接使用提供的二进制即可。不过我们需要集成第三方插件，需要使用<code>xcaddy</code>自行编译</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 本地安装xcaddy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">go </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> github.com/caddyserver/xcaddy/cmd/xcaddy@latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># github action安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - name: Install Go</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      uses: actions/setup-go@v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      with:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        go-version: </span><span class="token number" style="color:rgb(9, 134, 88)">1.17</span><span class="token plain">.x</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - name: </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> xcaddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      run: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"install xcaddy"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          go get -u github.com/caddyserver/xcaddy/cmd/xcaddy@latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    - name: build bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      run: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">TZ</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">'Asia/Shanghai'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">$PATH</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable" style="color:rgb(9, 134, 88)">go </span><span class="token variable function" style="color:rgb(0, 0, 255)">env</span><span class="token variable" style="color:rgb(9, 134, 88)"> GOPATH</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain">/bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        xcaddy build --with github.com/ysicing/caddy2-geocn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>构建caddy二进制</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 使用remote code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xcaddy build --with github.com/ysicing/caddy2-geocn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 使用local code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">xcaddy build --with github.com/ysicing/caddy2-geocn</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">/caddy2-geocn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="插件本地化测试">插件本地化测试<a class="hash-link" href="#插件本地化测试" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cd </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git clone https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">geocn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd caddy2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">geocn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 二进制</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token plain"> run</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">GOOS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">linux xcaddy build </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">with github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">geocn</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">geocn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">rf Country</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">mmdb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wget https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Hackl0us</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">GeoIP2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">CN</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">raw</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">release</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Country</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">mmdb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker build </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t ghcr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">geocn </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f example</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Dockerfile </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>docker-compose.yaml示例如下:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">caddy2-geocn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ghcr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">proxy.hk1.godu.dev/ysicing/caddy2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">geocn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">geocn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'80:80'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'./Caddyfile:/etc/caddy/Caddyfile'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Caddyfile示例如下:</p><div class="language-Caddyfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Caddyfile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">(LOG) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    log {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        output file /var/log/caddy.log {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            roll_size 1mb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            roll_keep 5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            roll_keep_for 1h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        format console {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            time_format "iso8601"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">(COMCFG) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    encode zstd gzip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    debug</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">:80 {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    import COMCFG</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    import LOG</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    metrics /metrics</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @geofilter {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        not geocn {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            db_file "/etc/caddy/Country.mmdb"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # file_server @geofilter {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #    root /etc/caddy/example/deny</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    redir @geofilter  https://www.baidu.com{uri} permanent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    file_server {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        root /etc/caddy/example/allow</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker-compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="云环境">云环境<a class="hash-link" href="#云环境" title="标题的直接链接">​</a></h3><div class="language-docker codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-docker codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run -itd 80:80 ghcr.io/ysicing/caddy2-geocn:latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="应用场景">应用场景<a class="hash-link" href="#应用场景" title="标题的直接链接">​</a></h3><p><a href="https://ysicing.me" target="_blank" rel="noopener noreferrer">我的博客</a> 就是很好的示例, 分别使用代理和非代理方式访问</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="致谢">致谢<a class="hash-link" href="#致谢" title="标题的直接链接">​</a></h2><ul><li><a href="https://github.com/Hackl0us/GeoIP2-CN" target="_blank" rel="noopener noreferrer">Hackl0us/GeoIP2-CN</a></li><li><a href="https://caddyserver.com/" target="_blank" rel="noopener noreferrer">Caddyserver</a></li></ul>]]></content>
        <category label="caddy" term="caddy"/>
        <category label="caddy-plugin" term="caddy-plugin"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Debian 11安装k3s]]></title>
        <id>/posts/k3s-install-bullseye</id>
        <link href="https://ysicing.me/posts/k3s-install-bullseye"/>
        <updated>2021-08-15T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[Debian11 (Bullseye)安装k3s]]></summary>
        <content type="html"><![CDATA[<blockquote><p>k3s 是Rancher推出的轻量级 k8s.</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级debian10buster内核版本">升级debian10(buster)内核版本<a class="hash-link" href="#升级debian10buster内核版本" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(163, 21, 21)">'s/buster\/updates/bullseye-security/g;s/buster/bullseye/g'</span><span class="token plain"> /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> dist-upgrade -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># apt install -t bullseye-backports linux-image-amd64 -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># update-grub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># reboot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 内核</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Linux bj01 </span><span class="token number" style="color:rgb(9, 134, 88)">5.10</span><span class="token plain">.0-0.bpo.8-amd64 </span><span class="token comment" style="color:rgb(0, 128, 0)">#1 SMP Debian 5.10.46-2~bpo10+1 (2021-07-22) x86_64 GNU/Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体可以参考 <a href="/posts/debian-op/">Debian个人常用操作指南</a> 升级内核部分。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-wireguard">安装 wireguard<a class="hash-link" href="#安装-wireguard" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">#  所有节点需安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> wireguard -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装docker">安装docker<a class="hash-link" href="#安装docker" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">curl</span><span class="token plain"> -fsSL https://download.docker.com/linux/debian/gpg </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> apt-key </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian bullseye stable"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">tee</span><span class="token plain"> /etc/apt/sources.list.d/docker.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> -y docker-ce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 腾讯云使用bip有问题 169.254.123.1/24, 请使用172.30.42.1/16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/docker/daemon.json </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token string" style="color:rgb(163, 21, 21)">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "registry-mirrors": ["https://dyucrs4l.mirror.aliyuncs.com"],</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "bip": "169.254.123.1/24",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "max-concurrent-downloads": 10,</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-driver": "json-file",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-level": "warn",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-opts": {</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    "max-size": "30m",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    "max-file": "3"</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  },</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "storage-driver": "overlay2"</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl restart </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> info -f </span><span class="token string" style="color:rgb(163, 21, 21)">"{{json .ServerVersion }}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull registry.cn-beijing.aliyuncs.com/k7scn/tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> run --rm -v /usr/local/bin:/sysdir registry.cn-beijing.aliyuncs.com/k7scn/tools </span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> zxf /pkg.tgz -C /sysdir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署控制平面master节点">部署控制平面master节点<a class="hash-link" href="#部署控制平面master节点" title="标题的直接链接">​</a></h2><p>上面安装docker/tools时, 默认内置了k3s,版本<code>v1.18.19</code>, 也可以自行下载其他版本的k3s替换</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">k3s </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s version v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">18.19</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">k3s1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a260c3c6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 执行安装</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 默认开机启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">master</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认k3s.master.install配置参数如下:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">/usr/local/bin/k3s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --docker </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --flannel-backend wireguard </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --no-deploy traefik,servicelb </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --kube-proxy-arg </span><span class="token string" style="color:rgb(163, 21, 21)">"proxy-mode=ipvs"</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"masquerade-all=true"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    --kube-proxy-arg </span><span class="token string" style="color:rgb(163, 21, 21)">"metrics-bind-address=0.0.0.0"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看组件状态</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">k3s kubectl get cs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                 STATUS    MESSAGE   ERROR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">controller</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager   Healthy   ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">scheduler            Healthy   ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署计算worker节点">部署计算worker节点<a class="hash-link" href="#部署计算worker节点" title="标题的直接链接">​</a></h2><p>从master节点获取token</p><ul><li>K3S_TOKEN : 加入集群所需的token，可以在控制节点上查看<code>/var/lib/rancher/k3s/server/node-token</code> 文件</li><li>K3S_URL: master节点地址</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">export K3S_URL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export K3S_TOKEN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">K102f2c1f6c878f693700c24b741d309d2ff4038ade912f0a44248781c04376e878</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">bc39d44d89042011b985f267eebe2b2f</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">worker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="查看节点状态">查看节点状态<a class="hash-link" href="#查看节点状态" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">~</span><span class="token comment" style="color:rgb(0, 128, 0)"># kubectl get nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME    STATUS   ROLES    AGE   VERSION</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s02   Ready    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   53m   v1.18.19+k3s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s03   Ready    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   52m   v1.18.19+k3s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k3s01   Ready    master   54m   v1.18.19+k3s1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="k3s" term="k3s"/>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[基于ALIDNS使用cert-manager自动签发TLS证书]]></title>
        <id>/posts/cert-manager-install</id>
        <link href="https://ysicing.me/posts/cert-manager-install"/>
        <updated>2020-10-26T03:02:44.000Z</updated>
        <summary type="html"><![CDATA[k8s 上利用 cert-manager 自动签发 TLS 证书]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h2><p>随着互联网发展，https越来越普及，是个网站都要上个https，否则就是非主流哈哈哈。之前也介绍过<strong>caddy</strong>，自动签发https证书，这是一个传统的方式。那么服务上到k8s上，如何实现永久免费证书了。<strong>cert-manager</strong> 是 Kubernetes 上比较牛逼的证书管理工具，可以帮助从各种来源颁发证书，而且确保证书有效且最新，并尝试在到期前的配置时间续订证书。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="工作原理">工作原理<a class="hash-link" href="#工作原理" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20201026/high-level-overview.svg" alt="005" class="img_ev3q"></p><p><strong>cert-manager</strong>部署到 Kubernetes 集群后，根据实际指定的CRD资源来签发证书并自动续期。</p><p>部分名词解释</p><ul><li><p><strong>Issuer</strong>/<strong>ClusterIssuer</strong>: 定义证书签发的姿势。两者唯一区别就是<strong>Issuer</strong>只能用来签发单一ns下的证书，<strong>ClusterIssuer</strong>可以签发集群级别的证书。</p></li><li><p><strong>Certificate</strong>: 具体签发域名以及通过哪种姿势(即<b>指定Issuer/ClusterIssuer</b>)。</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="证书签发原理">证书签发原理<a class="hash-link" href="#证书签发原理" title="标题的直接链接">​</a></h3><p>由于<strong>cert-manager</strong>是基于<strong>ACME</strong>协议与<strong>Let's Encrypt</strong>来签发免费证书，这里就不详细说明这个了, 其主流校验方式是<strong>HTTP-01</strong> 和 <strong>DNS-01</strong>。由于我们需要在内网签发证书，HTTP-01校验方式就不太适用了。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="操作步骤">操作步骤<a class="hash-link" href="#操作步骤" title="标题的直接链接">​</a></h2><blockquote><p>推荐使用<strong>helmv3</strong>安装</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-cert-manager">安装 cert-manager<a class="hash-link" href="#安装-cert-manager" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 创建命名空间</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create namespace cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 添加helm仓库或者更新</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo add jetstack https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">charts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">jetstack</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helminit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 一键安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">gitee</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">godu</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helminit</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">raw</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">master</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token number" style="color:rgb(9, 134, 88)">.3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">version v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0.3</span><span class="token plain"> jetstack</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看安装情况</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                                       READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">6564dc56bf</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">qgxlr              </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          97s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cainjector</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">7b98cf8646</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t6cqd   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          97s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cert</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">webhook</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">5f8bb4f46c</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">44hzt      </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          97s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dns-01校验">DNS-01校验<a class="hash-link" href="#dns-01校验" title="标题的直接链接">​</a></h3><p>因为dns托管在阿里云，且cert-manager不支持alidns，只能通过webhook方式部署，来扩展DNS提供商。</p><p>这里以阿里dns + alidns-webhook方式为例。</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署alidns-webhook">部署alidns-webhook<a class="hash-link" href="#部署alidns-webhook" title="标题的直接链接">​</a></h4><ul><li>安装alidns-webhook</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 默认镜像使用阿里云k7scn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f https://gitee.com/godu/helminit/raw/master/cert-manager/alidns-cm-webhook.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>创建alidns api secret</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alidns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manager</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">access-key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> YOUR_ACCESS_KEY </span><span class="token comment" style="color:rgb(0, 128, 0)"># base64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">secret-key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> YOUR_SECRET_KEY</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里需要注意两点，一个是Secret值问题，需要避免\n或者空格影响</p><p>建议这样 <code>echo -n YOUR_ACCESS_KEY | base64</code>， 还有如果是要创建 ClusterIssuer，Secret 需要创建在 cert-manager 所在命名空间中，如果是 Issuer，那就创建在 Issuer 所在命名空间中。</p><p>第2个点就是配置alidns的RAM，这里有个RAM坑。</p><p>RAM权限设置如下:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"Version"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"Statement"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Action"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Resource"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"acs:alidns:*:*:domain/&lt;域名&gt;"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Effect"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Allow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Action"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeSiteMonitorIspInfos"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeSiteMonitorIspCityInfos"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeSupportLines"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeDomains"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeDomainNs"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token string" style="color:rgb(163, 21, 21)">"alidns:DescribeDomainGroups"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Resource"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"acs:alidns:*:*:*"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token property">"Effect"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Allow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>正常情况下只需要配置第一条规则即可，但是由于alidns-webhook会校验这个域名存不存在,如果不配置会报403权限</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pragkent</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">alidns</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">webhook</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">blob</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">master</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">alidns</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain">#L26</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">Client</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">getHostedZone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">zone </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    request </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> alidns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">CreateDescribeDomainsRequest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">KeyWord </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">UnFqdn</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">zone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">SearchMode </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"EXACT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dnsc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">DescribeDomains</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(0, 0, 0)">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    zones </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Domains</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Domain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">zones</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Errorf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"zone %s does not exist"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> zone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> zones</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">DomainName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建clusterissuer">创建ClusterIssuer<a class="hash-link" href="#创建clusterissuer" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manager.io/v1alpha2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIssuer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> letsencrypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">acme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># Change to your letsencrypt email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">email</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> your@domain </span><span class="token comment" style="color:rgb(0, 128, 0)"># 你的邮箱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">//acme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">v02.api.letsencrypt.org/directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">privateKeySecretRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> letsencrypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">solvers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">dns01</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">webhook</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">groupName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> acme.yourcompany.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">solverName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alidns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">region</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">accessKeySecretRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alidns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> access</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">secretKeySecretRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alidns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-certificate">创建 Certificate<a class="hash-link" href="#创建-certificate" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">manager.io/v1alpha2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Certificate</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> gaea</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod </span><span class="token comment" style="color:rgb(0, 128, 0)"># 证书保存的 secret 名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">commonName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dnsNames</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*.bj-internal.ops.domain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"*.bj-external.ops.domain"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">issuerRef</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> letsencrypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIssuer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>通过dns验证可以创建泛域名证书。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取和使用证书">获取和使用证书<a class="hash-link" href="#获取和使用证书" title="标题的直接链接">​</a></h3><p>创建好 Certificate 后，稍等2-3分钟 我们可以 查看是否签发成功:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl get certificate </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n gaea</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                READY   SECRET                  AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tls</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ops</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">domain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">prod   True   tls</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ops</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">domain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">prod   2m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看证书信息</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl get secrets</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tls</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ops</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">domain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">prod  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n gaea</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">op </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o json </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> jq '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token string" style="color:rgb(163, 21, 21)">"tls.crt"</span><span class="token char" style="color:rgb(129, 31, 63)">' | tr '</span><span class="token plain">\"</span><span class="token char" style="color:rgb(129, 31, 63)">' '</span><span class="token plain"> ' </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> base64 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> openssl x509 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">in </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">dev</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">stdin </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">text </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">noout</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用证书">使用证书<a class="hash-link" href="#使用证书" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> gaea</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> log01.bj</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">internal.ops.domain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">2379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> log01.bj</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">internal.ops.domain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">loadBalancer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10.10.10.159</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="总结">总结<a class="hash-link" href="#总结" title="标题的直接链接">​</a></h2><p>到这里为止,  <b>cert-manager </b> 基本操作已经完成。</p><p>源码部分  <a href="https://gitee.com/godu/helminit" target="_blank" rel="noopener noreferrer">godu/helminit</a></p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="cert-manager" term="cert-manager"/>
        <category label="aliyun" term="aliyun"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用Artifactory部署私有化软件源]]></title>
        <id>/posts/artifactory-setup-mirrors</id>
        <link href="https://ysicing.me/posts/artifactory-setup-mirrors"/>
        <updated>2020-09-30T14:01:08.000Z</updated>
        <summary type="html"><![CDATA[使用Artifactory部署私有化软件源]]></summary>
        <content type="html"><![CDATA[<blockquote><p>趁着节前，需要折(dao)腾(shi)一下去年部署的artifactory镜像源，并将升级到7.x版本。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="场景">场景<a class="hash-link" href="#场景" title="标题的直接链接">​</a></h2><p>部署私有化软件源，对内提供服务。这里只作为软件源测试使用，其他场景自行琢磨。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署服务">部署服务<a class="hash-link" href="#部署服务" title="标题的直接链接">​</a></h2><p>部署很简单，这里使用docker-compose方式部署</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">compose</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token char" style="color:rgb(129, 31, 63)">'2.1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ossv2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">pro</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">7.6</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ossv2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">data</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ossv2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">opt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">jfrog</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1.17</span><span class="token number" style="color:rgb(9, 134, 88)">.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">log</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">log</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wwwroot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注意事项">注意事项<a class="hash-link" href="#注意事项" title="标题的直接链接">​</a></h4><ul><li><strong>artifactory</strong> 持久化数据目录可用空间最好稍微大些(<b>&gt;500GB</b>)，具体看镜像源数目多少。</li><li>使用nginx进行反向代理。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置源">配置源<a class="hash-link" href="#配置源" title="标题的直接链接">​</a></h2><p>7.x 和 6.x 版本差别还挺大的。</p><p><code>docker-compose up -d</code> 启动服务后，访问 <code>&lt;ip&gt;:8082</code> 进行初始化服务配置，基本默认配置即可或者SKIP跳过。</p><blockquote><p>在此过程中有一步比较坑，就是创建默认的<strong>Repositories</strong>，这个跳过跳过，否则后面在使用过程中就要踩坑了，如配置<strong>Debian</strong>或者源后<strong>Alpine</strong>后，如果文件路径里有<strong>.</strong>就会导致文件无法下载404</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="artifactory-源">artifactory 源<a class="hash-link" href="#artifactory-源" title="标题的直接链接">​</a></h3><p>简单介绍一下，</p><ul><li>Local 本地 （通常放一些内部的二进制文件或者其他，当oss用）</li><li>Remote 远程 (常用，默认就基本使用这个 通常镜像aliyun或者tuna)</li><li>Virtual 虚拟 (local + remote)</li></ul><p>这里我截取部分软件源示例，基本傻瓜式操作</p><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirrors01.png" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例配置debian源">示例配置Debian源<a class="hash-link" href="#示例配置debian源" title="标题的直接链接">​</a></h2><p>正常Debian源如下:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">deb https://mirrors.ysicing.me/debian/ buster main contrib non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb https://mirrors.ysicing.me/debian/ buster-updates main contrib non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb https://mirrors.ysicing.me/debian/ buster-backports main contrib non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb https://mirrors.ysicing.me/debian-security buster/updates main contrib non-free</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果想达成如上，需要做两件事</p><ul><li>镜像Debian源</li><li>配置域名</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="镜像debian源">镜像Debian源<a class="hash-link" href="#镜像debian源" title="标题的直接链接">​</a></h4><ul><li>创建Remote Repositories <code>debian</code> 和 <code>debian-security</code></li></ul><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/debian_create_repo.png" class="img_ev3q"></p><ul><li>配置debian Remote Repositories</li></ul><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirrors_debian.png" class="img_ev3q"></p><p>同理 debian-security 类似</p><ul><li>配置完成后访问 <strong>\&lt;ip<!-- -->&gt;<!-- -->:8082/artifactory/debian/</strong> 或者 <strong>\&lt;ip<!-- -->&gt;<!-- -->:8081/artifactory/debian/</strong></li></ul><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/list_debian.png" class="img_ev3q"></p><p>到这里，我们已经实现了</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">deb http://172.16.72.42:8082/artifactory/debian/ buster main contrib non-free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ip+端口的方式终究不太好记，是时候拖出nginx大杀器了</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置nginx">配置nginx<a class="hash-link" href="#配置nginx" title="标题的直接链接">​</a></h4><p>这里不具体说nginx配置了，直接上配置</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    listen </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    listen </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    listen </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"> ssl http2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    listen </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"> ssl http2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    server_name mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">$http_x_forwarded_proto </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token char" style="color:rgb(129, 31, 63)">''</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        set $http_x_forwarded_proto  $scheme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    index index</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">html</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    root </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">public</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # SSL</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ssl_certificate </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssl</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">crt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ssl_certificate_key </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssl</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # security</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # include security</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    location </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        root </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">public</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    location ~ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">html</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">htm</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">reponew</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        root </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">public</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    location ~ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">json</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">       root </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">public</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # location ~ </span><span class="token operator" style="color:rgb(0, 0, 0)">^</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    #     root </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">www</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">public</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    location </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy_pass http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8081</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">api</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # chunked_transfer_encoding on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # client_max_body_size </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # reverse proxy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    location </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy_buffering    off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy_buffer_size  128k</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy_buffers </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain">  128k</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    client_max_body_size 100m</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        proxy_pass http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8081</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        include nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        location ~ </span><span class="token operator" style="color:rgb(0, 0, 0)">^</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            proxy_pass    http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8081</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            include nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # additional config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">general</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>类似两个配置拿自<strong>nginxconfig.io</strong></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># proxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_http_version    </span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_cache_bypass    $http_upgrade</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_read_timeout  2400s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_pass_header   Server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_next_upstream </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token plain"> timeout non_idempotent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_next_upstream_tries    </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header Upgrade            $http_upgrade</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header Connection         </span><span class="token string" style="color:rgb(163, 21, 21)">"upgrade"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header Host                $host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Real</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IP            $remote_addr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Forwarded</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">For    $proxy_add_x_forwarded_for</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Forwarded</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Proto    $scheme</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Forwarded</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Host    $host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">proxy_set_header X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Forwarded</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Port    $server_port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># general</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># favicon</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ico</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">location </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">favicon</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ico </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    log_not_found off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    access_log off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># robots</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">location </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">robots</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">txt </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    log_not_found off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    access_log off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># assets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> media</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">location ~</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> \</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token function" style="color:rgb(0, 0, 255)">css</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">?</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token function" style="color:rgb(0, 0, 255)">js</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">\</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">?</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">jpe?g</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">png</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">gif</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">ico</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">cur</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">heic</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">webp</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">tiff?</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">mp3</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">m4a</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">aac</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">ogg</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">midi?</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">wav</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">mp4</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">mov</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">webm</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">mpe?g</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">avi</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">ogv</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">flv</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">wmv</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    expires 7d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    access_log on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># svg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fonts</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">location ~</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> \</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">svgz?</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">ttf</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">ttc</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">otf</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">eot</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">woff2?</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">$ </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    add_header Access</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Control</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Allow</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Origin </span><span class="token string" style="color:rgb(163, 21, 21)">"*"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    expires 7d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    access_log off</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># gzip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gzip on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gzip_vary on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gzip_proxied any</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gzip_comp_level </span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">gzip_types text</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">plain text</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">css text</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">xml application</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">json application</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">javascript application</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">rss</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">xml application</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">atom</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">xml image</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">svg</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">xml</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>到这里软件源配置就基本完成了。</p><p>效果图如下:</p><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/mirros_done.png" class="img_ev3q"></p><p>UI借鉴了网易开源镜像站</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="踩的pypi坑小记备忘">踩的pypi坑，小记备忘<a class="hash-link" href="#踩的pypi坑小记备忘" title="标题的直接链接">​</a></h4><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200930/pypi.png" class="img_ev3q"></p><p>pypi源不同于其他，需要额外配置nginx规则</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    location </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy_pass http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">8081</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">artifactory</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">api</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    include nginxconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">proxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pip</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">global</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">index</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">url </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pypi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">simple</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 测试</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git clone https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">gitee</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysbot</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">CTFd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">git </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">depth </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd CTFd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pip3 install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">r requirements</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go代理">Go代理<a class="hash-link" href="#go代理" title="标题的直接链接">​</a></h4><p>新版本对Go代理做了优化，使用很流程，创建远程Go，源使用<code>https://goproxy.cn</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> env </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">w GO111MODULE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">on</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> env </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">w GOPROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">direct</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Artifactory" term="Artifactory"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[群晖配置Clash]]></title>
        <id>/posts/clash-dsm</id>
        <link href="https://ysicing.me/posts/clash-dsm"/>
        <updated>2020-09-20T13:05:54.000Z</updated>
        <summary type="html"><![CDATA[群晖配置Clash]]></summary>
        <content type="html"><![CDATA[<p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/clash.png" class="img_ev3q"></p><blockquote><p>趁着搬家，需要折(dao)腾(shi)一下吃灰的群晖，将Clash升级到2.0</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备clash配置文件">准备clash配置文件<a class="hash-link" href="#准备clash配置文件" title="标题的直接链接">​</a></h2><p>由于日常使用clashx，这里就不介绍如何获取Clash配置文件了。自行解决，可以参考大佬整理的<a href="https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/clash.yaml" target="_blank" rel="noopener noreferrer">LAZY_RULES</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="注意几点">注意几点<a class="hash-link" href="#注意几点" title="标题的直接链接">​</a></h4><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)">#HTTP(S) and SOCKS5 共用端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">mixed-port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">7890</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 允许局域网的连接（可用来共享代理）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">allow-lan</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># clash 的 RESTful API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">external-controller</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 0.0.0.0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">9090</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="效果">效果<a class="hash-link" href="#效果" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh01.jpg" class="img_ev3q"></p><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh02.jpg" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建clash-prod服务">创建clash-prod服务<a class="hash-link" href="#创建clash-prod服务" title="标题的直接链接">​</a></h3><ul><li>获取镜像或者上传镜像，这里默认上传镜像</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">clash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker save registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">clash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1.1</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> clash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh03.jpg" class="img_ev3q"></p><ul><li>创建容器</li></ul><p>点击镜像创建容器后，高级设置。</p><blockquote><ul><li>高级设置，勾选启用自动重新启动</li><li>卷，持久化配置文件</li><li>网络，勾选使用与Docker Host相同的网络(共享网络)</li></ul></blockquote><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh04.jpg" class="img_ev3q"></p><p>配置完成应用，即可。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建clash-ui服务">创建clash-ui服务<a class="hash-link" href="#创建clash-ui服务" title="标题的直接链接">​</a></h3><p>同理类似，这里简单说下</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker pull registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">clash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">yacd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker save registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">clash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">yacd </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> yacd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>不需要额外配置，当服务起来后，获取clash-ui默认分配的端口，浏览器访问，配置API地址为<strong><a href="http://127.0.0.1:9090" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9090</a></strong></li></ul><p>到这里就达到了上述效果。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="群晖配置代理">群晖配置代理<a class="hash-link" href="#群晖配置代理" title="标题的直接链接">​</a></h2><p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/blog/20200920/qh05.jpg" class="img_ev3q"></p>]]></content>
        <category label="clash" term="clash"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Caddy2初体验]]></title>
        <id>/posts/caddy2</id>
        <link href="https://ysicing.me/posts/caddy2"/>
        <updated>2020-09-15T23:38:56.000Z</updated>
        <summary type="html"><![CDATA[Caddy2初体验]]></summary>
        <content type="html"><![CDATA[<blockquote><p><code>Caddy2</code>使用小记</p></blockquote><blockquote><p>将<strong>Caddy</strong>升级到 <strong>Caddy2</strong>， 记录一下。 2.0版本改变挺大的。</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="环境">环境<a class="hash-link" href="#环境" title="标题的直接链接">​</a></h2><p>腾讯云香港轻量, <strong>Debian 10</strong>, 秒不可言。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装caddy2">安装caddy2<a class="hash-link" href="#安装caddy2" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用镜像或者源安装推荐源安装">使用镜像或者源安装(推荐源安装)<a class="hash-link" href="#使用镜像或者源安装推荐源安装" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull registry.cn-beijing.aliyuncs.com/k7scn/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 或者</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"deb [trusted=yes] https://apt.fury.io/caddy/ /"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/apt/sources.list.d/caddy-fury.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> caddy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用二进制安装">使用二进制安装<a class="hash-link" href="#使用二进制安装" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://github.com/caddyserver/caddy/releases/download/v2.1.1/caddy_2.1.1_linux_amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> xf caddy_2.1.1_linux_amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">mv</span><span class="token plain"> caddy /usr/local/bin/caddy2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>配置systemd</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Documentation</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddyserver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docs</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">After</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">network</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">User</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Group</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EnvironmentFile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2 run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">environ </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">config </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecReload</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy2 reload </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">config </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">caddy</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TimeoutStopSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNOFILE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1048576</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNPROC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">512</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PrivateTmp</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ProtectSystem</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">full</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AmbientCapabilities</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">CAP_NET_BIND_SERVICE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WantedBy</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">multi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="caddyfile使用">Caddyfile使用<a class="hash-link" href="#caddyfile使用" title="标题的直接链接">​</a></h2><blockquote><p>目前 Caddy2 官方推荐配置文件使用 JSON 格式，或者，不使用配置文件，直接调用 admin API。但我推荐使用 Caddyfile, 日常维护起来要方便一些</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">caddy2 adapt --config /etc/caddy/Caddyfile --validate  </span><span class="token comment" style="color:rgb(0, 128, 0)">#校验是否合法</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><del>官方虽然说从v1升级到v2很简单，我信你的鬼</del><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例">示例<a class="hash-link" href="#示例" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # 开启实验性 HTTP</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  experimental_http3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # 测试通过的生产环境中去除该项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # acme_ca https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">acme</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">staging</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v02</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">api</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">letsencrypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">common_headers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  encode gzip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">secure_headers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  header </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Strict</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Transport</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Security </span><span class="token string" style="color:rgb(163, 21, 21)">"max-age=31536000; includeSubDomains; preload"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Frame</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Options SAMEORIGIN</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    X</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Content</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Type</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Options nosniff</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ci</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">hk2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">godu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dev </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  tls ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing@gmail</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> common_headers</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> secure_headers</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  reverse_proxy </span><span class="token number" style="color:rgb(9, 134, 88)">169.254</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">hk2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">godu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dev </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  tls ops</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing@gmail</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> common_headers</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> secure_headers</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  reverse_proxy </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">404</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        respond </span><span class="token string" style="color:rgb(163, 21, 21)">"2020 hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h4><p>caddy2 引入了全局选项<strong>global options</strong>的概念，并且如果全局选项存在，必须位于 Caddyfile 的开头</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 全局配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # 开启实验性 HTTP</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  experimental_http3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # 测试通过的生产环境中去除该项</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # acme_ca https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">acme</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">staging</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v02</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">api</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">letsencrypt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">directory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>支持<strong>HTTP/3</strong>， 工作在 UDP 协议上，需要放行443 UDP</li><li>Let’s Encrypt 测试环境，默认caddy2是处于生产环境，测试时可改为测试环境</li></ol><p><a href="https://caddyserver.com/docs/caddyfile" target="_blank" rel="noopener noreferrer">官方文档</a></p>]]></content>
        <category label="caddy" term="caddy"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vagrant从入门到放弃]]></title>
        <id>/posts/vagrant-study</id>
        <link href="https://ysicing.me/posts/vagrant-study"/>
        <updated>2020-09-14T00:04:15.000Z</updated>
        <summary type="html"><![CDATA[vagrant简单介绍使用]]></summary>
        <content type="html"><![CDATA[<p><img loading="lazy" src="https://gitee.com/godu/blogimage/raw/master/docker/vagrant-k8s.png" alt="vagrant" class="img_ev3q"></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="源起">源起<a class="hash-link" href="#源起" title="标题的直接链接">​</a></h2><p>有时候跑一些服务，需要在Linux上运行，需要快速拉起分布式开发测试环境配置，不可能通过创建虚拟机安装服务等一系列操作，否则一行命令，一上午。这时候就需要一款科学的工具来管理虚拟机。有人会说，不是有<strong>docker</strong>么，为啥还用<strong>vagrant</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="区别">区别<a class="hash-link" href="#区别" title="标题的直接链接">​</a></h3><p>这里简单说下区别</p><p><strong>vagrant</strong>是vm的编排工具,是管理编排环境，对标应该是<strong>docker-compose</strong>
<strong>docker</strong>是将应用轻量化构建和部署工具</p><p>个人认为两者使用纬度不一样， 而且应用场景哪个方便用哪个。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="用法">用法<a class="hash-link" href="#用法" title="标题的直接链接">​</a></h2><p>上面说到<strong>vagrant</strong>是vm虚拟机的编排工具，目前支持多个虚拟机软件，常见用<strong>virtualbox</strong>，也推荐用这个。</p><p><a href="https://learn.hashicorp.com/collections/vagrant/getting-started" target="_blank" rel="noopener noreferrer">官方文档 Getting Started</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装vagrant">安装vagrant<a class="hash-link" href="#安装vagrant" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># MacOS, 默认已经virtualbox</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew cask </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> vagrant </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者通过官网安装 <a href="https://www.vagrantup.com/downloads" target="_blank" rel="noopener noreferrer">Download Vagrant</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化一个项目">初始化一个项目<a class="hash-link" href="#初始化一个项目" title="标题的直接链接">​</a></h4><p><code>Vagrantfile</code>是用来定义vagrant project的，使用ruby语法，不过你不需要知道ruby就可以写一个Vagrantfile。</p><p>示例来源于 <a href="https://raw.githubusercontent.com/ysicing/debian-vagrant/master/Vagrantfile" target="_blank" rel="noopener noreferrer">ysicing/debian-vagrant</a></p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># -*- mode: ruby -*-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># vi: set ft=ruby :</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vagrant.configure("2") do |config|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config.vm.box_check_update = false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config.vm.provider 'virtualbox' do |vb|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   vb.customize [ "guestproperty", "set", :id, "/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold", 1000 ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config.vm.synced_folder ".", "/vagrant", type: "nfs", nfs_udp: false, disabled: true</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  $num_instances = 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  (1..$num_instances).each do |i|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    config.vm.define "node#{i}" do |node|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.box = "ysicing/debian"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.hostname = "debian105-#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      #node.ssh.username = "root"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      #node.ssh.password = "vagrant"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      ip = "11.11.11.#{i+10}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.network "private_network", ip: ip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.provider "virtualbox" do |vb|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.gui = false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.memory = "1024"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.cpus = 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.name = "node#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.customize ["modifyvm", :id, "--ioapic", "on"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.provision "shell", inline: "uname -a"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>简单说下核心重要相关参数:</p><ul><li><strong>vm.provider</strong>  虚拟机服务</li><li><strong>vm.box</strong> 虚拟机镜像, 类似docker镜像镜像</li><li><strong>cpus,memory,network,instances</strong> 虚拟机资源副本信息等</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用基础命令">常用基础命令<a class="hash-link" href="#常用基础命令" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># ssh登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant </span><span class="token function" style="color:rgb(0, 0, 255)">ssh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 销毁</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant destroy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 关机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant </span><span class="token function" style="color:rgb(0, 0, 255)">halt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例部署k8s集群">示例部署k8s集群<a class="hash-link" href="#示例部署k8s集群" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">mkdir vm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Vagrantfile </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ruby </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># vi</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> set ft</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ruby </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vagrant</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">configure</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">config</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box_check_update </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provider </span><span class="token char" style="color:rgb(129, 31, 63)">'virtualbox'</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vb</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"guestproperty"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"set"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  $num_instances </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">$num_instances</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">each do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">define </span><span class="token string" style="color:rgb(163, 21, 21)">"0660b6a92e962a930692651db4562957#{i}"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing/debian"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">hostname </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"0660b6a92e962a930692651db4562957#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">network </span><span class="token string" style="color:rgb(163, 21, 21)">"public_network"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> use_dhcp_assigned_default_route</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> bridge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 'en0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Wi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Fi </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Wireless</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      # node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provision </span><span class="token string" style="color:rgb(163, 21, 21)">"shell"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"always"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> inline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ntpdate ntp.api.bz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">network </span><span class="token string" style="color:rgb(163, 21, 21)">"private_network"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"11.11.11.11#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provision </span><span class="token string" style="color:rgb(163, 21, 21)">"shell"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"always"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> inline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"echo hello from 0660b6a92e962a930692651db4562957#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provider </span><span class="token string" style="color:rgb(163, 21, 21)">"virtualbox"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vb</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">gui </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">memory </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cpus </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"0660b6a92e962a930692651db4562957#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--natdnshostresolver1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"on"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--ioapic"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"on"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # cpu 使用率</span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--cpuexecutioncap"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"50"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动虚拟机</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vagrant up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.110</span><span class="token plain">，</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain">，</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token plain"> root</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vagrant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># pre k8s pkg</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tmp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">data registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1.16</span><span class="token number" style="color:rgb(9, 134, 88)">.15</span><span class="token plain"> cp </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">data</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sealos init </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">master </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.110</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">user root </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">passwd vagrant </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">version v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">16.15</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">repo registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">url </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tmp</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kube</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="其他场景">其他场景<a class="hash-link" href="#其他场景" title="标题的直接链接">​</a></h4><p>本地起多个虚拟机环境测试，其他没必要，感觉没docker-compose方便。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Vagrant</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">configure</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">config</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provision </span><span class="token string" style="color:rgb(163, 21, 21)">"shell"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> inline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"echo Hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">define </span><span class="token string" style="color:rgb(163, 21, 21)">"web"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">web</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    web</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"apache"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">define </span><span class="token string" style="color:rgb(163, 21, 21)">"db"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">db</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"mysql"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian-box简介">debian box简介<a class="hash-link" href="#debian-box简介" title="标题的直接链接">​</a></h2><p>默认box使用<strong>ysicing/debian</strong>, 个人自用debian镜像，源码如下<a href="https://github.com/ysicing/debian-vagrant" target="_blank" rel="noopener noreferrer">ysicing/debian-vagrant</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定制">定制<a class="hash-link" href="#定制" title="标题的直接链接">​</a></h4><ul><li>默认允许<strong>root</strong>(密码<strong>vagrant</strong>)用户登录</li><li>默认dns为<strong>1.2.4.8</strong>, <strong>114.114.114.114</strong></li><li>镜像源为 <strong>mirrors.aliyun.com</strong></li><li>默认硬盘80G</li><li>安装了常用运维工具</li><li>...</li></ul><hr>]]></content>
        <category label="vagrant" term="vagrant"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Istio 1.7安装]]></title>
        <id>/posts/istio-install</id>
        <link href="https://ysicing.me/posts/istio-install"/>
        <updated>2020-09-01T13:53:59.000Z</updated>
        <summary type="html"><![CDATA[k8s部署istio 1.7]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装记录">安装记录<a class="hash-link" href="#安装记录" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">git</span><span class="token plain"> clone https://github.com/ysicing/istio-install.git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> istio-install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">istioctl </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --set </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">profile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo --set </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">hub</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">registry.cn-beijing.aliyuncs.com/k7scn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署demo">部署demo<a class="hash-link" href="#部署demo" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl create ns istio</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label namespace istio</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo istio</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">injection</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">enabled</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f example</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bookinfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n istio</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="istio" term="istio"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Consul安装]]></title>
        <id>/posts/consul-install</id>
        <link href="https://ysicing.me/posts/consul-install"/>
        <updated>2020-08-03T12:04:08.000Z</updated>
        <summary type="html"><![CDATA[helm安装consule]]></summary>
        <content type="html"><![CDATA[<blockquote><p>通过helm快速安装consule</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 默认已存在默认sc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get sc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">data </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">     nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">data      Delete          Immediate           </span><span class="token boolean">false</span><span class="token plain">                  206d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>安装consul</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helminit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl create ns gaea</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i consul </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set global</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">imageRegistry</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">repository</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">b</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">consul \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set volumePermissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set volumePermissions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">repository</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">b</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">minideb \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set persistence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">repository</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">b</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">consul</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">exporter \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">set ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">version </span><span class="token number" style="color:rgb(9, 134, 88)">7.1</span><span class="token number" style="color:rgb(9, 134, 88)">.3</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    bitnami</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">consul  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n gaea</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">op </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="consul" term="consul"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用ergo快速安装k8s1.18.4]]></title>
        <id>/posts/k8s-install-ergo</id>
        <link href="https://ysicing.me/posts/k8s-install-ergo"/>
        <updated>2020-06-19T14:30:18.000Z</updated>
        <summary type="html"><![CDATA[本地使用ergo快速安装k8s1.18.4]]></summary>
        <content type="html"><![CDATA[<blockquote><p>基于<a href="https://github.com/ysicing/sealos" target="_blank" rel="noopener noreferrer">sealos</a>, 一键高可用，简单上手, 安装k8s 1.18.4版本</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备虚拟机">准备虚拟机<a class="hash-link" href="#准备虚拟机" title="标题的直接链接">​</a></h2><p>环境: 3台机器(debian/buster 10.4, 11.11.11.111~11.11.11.113, 2核4G80G存储)</p><p>{{&lt; expand "ergo vm create --vmname k8s --vmnum 3" &gt;}}</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ ergo  vm create   </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">vmname k8s </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">vmnum </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I0523 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15.819808</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">17953</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Using config file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">66</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> check system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">73</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> check system done</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> It looks good</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">78</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> check vagrant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">utils</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">exec cmd is </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  which </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">vagrant</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vagrant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">utils</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">exec cmd is </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  which </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">VirtualBoxVM</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">VirtualBoxVM</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">85</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> write Vagrantfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">92</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> vagranfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ruby </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># vi</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> set ft</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ruby </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vagrant</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">configure</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">config</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box_check_update </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provider </span><span class="token char" style="color:rgb(129, 31, 63)">'virtualbox'</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vb</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"guestproperty"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"set"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  $num_instances </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">$num_instances</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">each do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">i</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">define </span><span class="token string" style="color:rgb(163, 21, 21)">"k8s#{i}"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">box </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing/debian"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">hostname </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"k8s#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">network </span><span class="token string" style="color:rgb(163, 21, 21)">"public_network"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> use_dhcp_assigned_default_route</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> bridge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 'en0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Wi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Fi </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Wireless</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      # node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provision </span><span class="token string" style="color:rgb(163, 21, 21)">"shell"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"always"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> inline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ntpdate ntp.api.bz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">network </span><span class="token string" style="color:rgb(163, 21, 21)">"private_network"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"11.11.11.11#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provision </span><span class="token string" style="color:rgb(163, 21, 21)">"shell"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"always"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> inline</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"echo hello from k8s#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">provider </span><span class="token string" style="color:rgb(163, 21, 21)">"virtualbox"</span><span class="token plain"> do </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain">vb</span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">gui </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">memory </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cpus </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"k8s#{i}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--natdnshostresolver1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"on"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--ioapic"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"on"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # cpu 使用率</span><span class="token number" style="color:rgb(9, 134, 88)">50</span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">customize </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"modifyvm"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--cpuexecutioncap"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"50"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">117</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> vagrant up</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Bringing machine </span><span class="token char" style="color:rgb(129, 31, 63)">'k8s1'</span><span class="token plain"> up with </span><span class="token char" style="color:rgb(129, 31, 63)">'virtualbox'</span><span class="token plain"> provider</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Bringing machine </span><span class="token char" style="color:rgb(129, 31, 63)">'k8s2'</span><span class="token plain"> up with </span><span class="token char" style="color:rgb(129, 31, 63)">'virtualbox'</span><span class="token plain"> provider</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Bringing machine </span><span class="token char" style="color:rgb(129, 31, 63)">'k8s3'</span><span class="token plain"> up with </span><span class="token char" style="color:rgb(129, 31, 63)">'virtualbox'</span><span class="token plain"> provider</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">37</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">130</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> ip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> root</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vagrant</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">37</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ergo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">linux</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">133</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 销毁方式</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> cd </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> vagrant destroy </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>{{&lt; /expand &gt;}}</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化环境">初始化环境<a class="hash-link" href="#初始化环境" title="标题的直接链接">​</a></h2><p>{{&lt; expand "ergo vm init --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113" &gt;}}</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 安装基础软件 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">77s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Install dbus </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the hostname module </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">84s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 删除默认安装 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">60s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Gathering Facts </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">15s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 加载内核模块 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">92s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> gather facts </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">67s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 增加内核模块开机加载配置 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">63s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 启用systemd自动加载模块服务 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">53s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 禁用系统 swap </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">47s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 设置系统 ulimits </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">41s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 优化设置 journal 日志 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">37s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 把SCTP列入内核模块黑名单 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">36s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 删除fstab swap 相关配置 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">34s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 设置系统参数 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">32s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 准备 journal 日志相关目录 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">32s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 创建 systemd 配置目录 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">30s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 重启 journald 服务 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">30s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> update </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">security</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">limits</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">28s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 生效系统参数 </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">19s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prepare </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 设置 ulimits </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">12s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>{{&lt; /expand &gt;}}</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装docker">安装docker<a class="hash-link" href="#安装docker" title="标题的直接链接">​</a></h2><p>{{&lt; expand "ergo install docker --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant" &gt;}}</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> sh </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">c 'docker version'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Client</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Docker Engine </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> Community</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">           </span><span class="token number" style="color:rgb(9, 134, 88)">19.03</span><span class="token number" style="color:rgb(9, 134, 88)">.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> API version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       </span><span class="token number" style="color:rgb(9, 134, 88)">1.40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Go version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        go1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">13.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Git commit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        9d988398e7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Built</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">             Fri May </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> OS</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">           linux</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Experimental</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">      </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Docker Engine </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> Community</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Engine</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">          </span><span class="token number" style="color:rgb(9, 134, 88)">19.03</span><span class="token number" style="color:rgb(9, 134, 88)">.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  API version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">      </span><span class="token number" style="color:rgb(9, 134, 88)">1.40</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">minimum version </span><span class="token number" style="color:rgb(9, 134, 88)">1.12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Go version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       go1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">13.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Git commit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       9d988398e7</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Built</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">            Fri May </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">00</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">57</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  OS</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Arch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">          linux</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Experimental</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">     </span><span class="token boolean">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> containerd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">          </span><span class="token number" style="color:rgb(9, 134, 88)">1.2</span><span class="token number" style="color:rgb(9, 134, 88)">.13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  GitCommit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        7ad184331fa3e55e52b890ea95e65ba581ae3429</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> runc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">          </span><span class="token number" style="color:rgb(9, 134, 88)">1.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">rc10</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  GitCommit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        dc9208a3303feef5b3839f4323d9beb36df0a9dd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">          </span><span class="token number" style="color:rgb(9, 134, 88)">0.18</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  GitCommit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        fec3683</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">If you would like to use Docker as a non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">root user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> you should now consider</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">adding your user to the </span><span class="token string" style="color:rgb(163, 21, 21)">"docker"</span><span class="token plain"> group with something like</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sudo usermod </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">aG docker your</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Remember that you will have to log out and back in </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> this to take effect</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WARNING</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Adding a user to the </span><span class="token string" style="color:rgb(163, 21, 21)">"docker"</span><span class="token plain"> group will grant the ability to run</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         containers which can be used to obtain root privileges on the</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         docker host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         Refer to https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">engine</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">security</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">security</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">#docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">daemon</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">attack</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">surface</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> more information</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Synchronizing state of docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service with SysV service script with </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lib</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">sysv</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Executing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lib</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">sysv</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">install enable docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">"19.03.9"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unable to find image 'ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest' locally</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">latest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pulling from ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">0d6b48c80e92</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pull complete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">f28c196b1246</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pull complete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">04bb1e97c214</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pull complete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Digest</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> sha256</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">c689021150ec06af298db958d24c19fdbe3aea7c6717c5dee53f7e9071b4cd76</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Downloaded newer image </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>{{&lt; /expand &gt;}}</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装常用小工具">安装常用小工具<a class="hash-link" href="#安装常用小工具" title="标题的直接链接">​</a></h2><p>{{&lt; expand "ergo install tools --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant" &gt;}}</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">I0523 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">35</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">59.919563</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">19284</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">51</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> Using config file</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">I0523 </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">35</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">59.920024</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">19284</span><span class="token plain"> install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">55</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> 🎉 安装 tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">35</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">59</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">exec cmd is </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools tar zxf </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">C </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">08</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">command result is</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">08</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">exec cmd is </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools tar zxf </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">C </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">command result is</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">12</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">exec cmd is </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools tar zxf </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">C </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">05</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">23</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">15</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">36</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">26</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">DEBG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Users</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kunnos</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshcmd@v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">6.0</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sshutil</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ssh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">command result is</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>{{&lt; /expand &gt;}}</p><p>{{&lt; boxmd &gt;}}
<code>ergo shell --ip 11.11.11.111 --ip 11.11.11.112 --ip 11.11.11.113 --pass vagrant --cmd upgrade-tools</code>
或者在当前机器直接执行
<code>upgrade-tools</code>
{{&lt; /boxmd &gt;}}</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装k8s">安装k8s<a class="hash-link" href="#安装k8s" title="标题的直接链接">​</a></h2><blockquote><p>说明，我定制了sealos和calico版本为最新版本,且使用了在线安装包</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 安装了k8s </span><span class="token number" style="color:rgb(9, 134, 88)">1.18</span><span class="token number" style="color:rgb(9, 134, 88)">.4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 安装了ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 配置nfs，默认存储类为nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergo install k8s </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">enablenfs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">mip </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">wip </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pass vagrant </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ingresstype </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">enablekuboard </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">regioncn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装其他ingress">安装其他ingress<a class="hash-link" href="#安装其他ingress" title="标题的直接链接">​</a></h3><p>支持<code>nginx-ingress</code>, <code>traefik</code>, <code>ingress-nginx</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ergo install ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pk ~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ssh</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">id_rsa </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">regioncn </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ingresstype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证">验证<a class="hash-link" href="#验证" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get node</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME   STATUS   ROLES    AGE    VERSION</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k8s1   Ready    master   2m2s   v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">18.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k8s2   Ready    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   87s    v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">18.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">k8s3   Ready    </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">   87s    v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">18.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME              STATUS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">           Active   2m6s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx     Active   2m13s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lease   Active   2m7s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">public       Active   2m7s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system       Active   2m8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get cs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                 STATUS    MESSAGE             ERROR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">controller</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager   Healthy   ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">scheduler            Healthy   ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">etcd</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">               Healthy   </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"health"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get sc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                 PROVISIONER       RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">data </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">   nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">provisioner   Delete          Immediate           </span><span class="token boolean">false</span><span class="token plain">                  60s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[开源k8slb工具Metallb]]></title>
        <id>/posts/k8s-slb-metallb</id>
        <link href="https://ysicing.me/posts/k8s-slb-metallb"/>
        <updated>2020-06-19T14:14:20.000Z</updated>
        <summary type="html"><![CDATA[本文主要讲述穷人如何使用LoadBalancer]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h2><p>kubernetes本身并没有实现LoadBalancer, 如果是云上用户，可以使用云服务商提供k8s的LoadBalancer, 如阿里云的slb。</p><p>当我们把k8s部署在私有云时，需要简单的LoadBalancer来验证工作，开源的metallb就是一个不错的选择。</p><p>通过k8s原生的方式提供LB类型的Service支持，开箱即用。</p><p>核心特性:</p><ul><li><code>地址分配</code> MetalLB会为用户的lb类型service分配IP地址，该IP地址需要用户预先分配</li><li><code>外部申明</code> 地址分配后还需要通知到网络中的其他主机, 有两种方式基于ARP的Layer2和BGP</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="原理">原理<a class="hash-link" href="#原理" title="标题的直接链接">​</a></h2><ul><li>Layer2 (默认使用)</li><li>BGP</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="layer2">Layer2<a class="hash-link" href="#layer2" title="标题的直接链接">​</a></h3><p>只需要一段跟K8s管理网相同网段的地址即可, 通常这种就可以了。</p><p>在此模式下, 会从k8s节点中选一个Leader节点，在这个节点上面响应LB地址段的ARP请求，从而使上层路由把发往LB的流量都发到Leader节点。缺点也很明显，所有对LB的请求都会发往Leader节点。如果当前Service下面的Pod分布在不同节点，那么这个流量还会从Leader发往相应的节点。</p><p>局限性: 单节点流量瓶颈和慢故障转移</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="bgp">BGP<a class="hash-link" href="#bgp" title="标题的直接链接">​</a></h3><p>需要上层路由器支持BGP，不在需要Leader节点。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo add bitnami https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">charts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bitnami</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bitnami</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i metallb bitnami</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">metallb  </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">create</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">namespace </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 默认空配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get cm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">config  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o yaml </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lbconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lbconfig</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> metallb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    address</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">pools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> lbpool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> layer2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      addresses</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.150</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="测试">测试<a class="hash-link" href="#测试" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># lb.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LoadBalancer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f lb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get pods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">svc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                                   READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">d46f5678b</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">hm7r6   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          96s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pod</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">d46f5678b</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">zgfxd   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          96s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                    TYPE           CLUSTER</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IP     EXTERNAL</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IP    </span><span class="token function" style="color:rgb(0, 0, 255)">PORT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">S</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">        AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubernetes      ClusterIP      </span><span class="token number" style="color:rgb(9, 134, 88)">10.96</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">         </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP        88m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service   LoadBalancer   </span><span class="token number" style="color:rgb(9, 134, 88)">10.98</span><span class="token number" style="color:rgb(9, 134, 88)">.184</span><span class="token number" style="color:rgb(9, 134, 88)">.75</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.150</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">32002</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP   6s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>ysicing</name>
        </author>
        <category label="kubernetes" term="kubernetes"/>
        <category label="LoadBalancer" term="LoadBalancer"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Etcd使用入门]]></title>
        <id>/posts/etcd-op</id>
        <link href="https://ysicing.me/posts/etcd-op"/>
        <updated>2020-05-31T11:54:36.000Z</updated>
        <summary type="html"><![CDATA[Etcd使用入门]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h2><p>etcd是CoreOS团队发起的开源项目，目标是构建一个高可用的分布式键值(key-value)数据库。etcd内部采用raft协议作为一致性算法，etcd基于Go语言实现。</p><p>etcd比较多的应用场景是用于服务发现。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用helm安装etcd">使用helm安装etcd<a class="hash-link" href="#使用helm安装etcd" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm search repo etcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                    CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bitnami/etcd            </span><span class="token number" style="color:rgb(9, 134, 88)">4.8</span><span class="token plain">.2           </span><span class="token number" style="color:rgb(9, 134, 88)">3.4</span><span class="token plain">.9           etcd is a distributed key value store that prov</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">incubator/etcd          </span><span class="token number" style="color:rgb(9, 134, 88)">0.7</span><span class="token plain">.4           </span><span class="token number" style="color:rgb(9, 134, 88)">3.2</span><span class="token plain">.26          Distributed reliable key-value store </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the mo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">stable/etcd-operator    </span><span class="token number" style="color:rgb(9, 134, 88)">0.10</span><span class="token plain">.3          </span><span class="token number" style="color:rgb(9, 134, 88)">0.9</span><span class="token plain">.4           CoreOS etcd-operator Helm chart </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Kubernetes    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">stable/zetcd            </span><span class="token number" style="color:rgb(9, 134, 88)">0.1</span><span class="token plain">.9           </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain">.3           CoreOS zetcd Helm chart </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> Kubernetes  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 下载helm包,执行定制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm pull bitnami/etcd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 使用nodeport, 禁用rbac，禁用存储</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> etcd bitnami/etcd --set service.type</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NodePort --set service.type</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NodePort --set auth.rbac.enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">false --set persistence.enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">false -n ops-open</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">NODE_IP</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable" style="color:rgb(9, 134, 88)">kubectl get nodes --namespace ops-open -o </span><span class="token variable assign-left variable" style="color:rgb(9, 134, 88)">jsonpath</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable string" style="color:rgb(163, 21, 21)">"{.items[0].status.addresses[0].address}"</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">NODE_PORT</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable" style="color:rgb(9, 134, 88)">kubectl get --namespace ops-open -o </span><span class="token variable assign-left variable" style="color:rgb(9, 134, 88)">jsonpath</span><span class="token variable operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable string" style="color:rgb(163, 21, 21)">"{.spec.ports[0].nodePort}"</span><span class="token variable" style="color:rgb(9, 134, 88)"> services etcd</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ETCDURL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://</span><span class="token variable" style="color:rgb(9, 134, 88)">$NODE_IP</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$NODE_PORT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"etcd URL: </span><span class="token string variable" style="color:rgb(9, 134, 88)">$ETCDURL</span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">ECTDCTL_API</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">etcdctl member list --endpoints</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token variable" style="color:rgb(9, 134, 88)">$ETCDURL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <author>
            <name>ysicing</name>
        </author>
        <category label="etcd" term="etcd"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[在k8s中使用docker in docker]]></title>
        <id>/posts/docker-in-k8s</id>
        <link href="https://ysicing.me/posts/docker-in-k8s"/>
        <updated>2020-05-29T08:55:18.000Z</updated>
        <summary type="html"><![CDATA[使用docker in docker]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h2><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># docker.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> gaea</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.gaea.me/workload</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> app</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.gaea.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">k8s.gaea.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dockerd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'docker:18.09.9-dind'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">securityContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token key atrule">privileged</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'docker:18.09.9'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DOCKER_HOST</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tcp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">//127.0.0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"/bin/sh"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"-c"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"docker info &gt;/dev/null 2&gt;&amp;1; while [ $? -ne 0 ] ; do sleep 3; docker info &gt;/dev/null 2&gt;&amp;1; done; docker pull library/busybox:latest; docker save -o busybox-latest.tar library/busybox:latest; docker rmi library/busybox:latest; while true; do sleep 86400; done"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">k8s.gaea.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> gaea</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">op</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> tcp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token number" style="color:rgb(9, 134, 88)">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2375</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">clusterIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">k8s.gaea.me/name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">api</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply -f docker.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># docker api地址: docker-api-0.docker-api.gaea-op.svc.cluster.local</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exec</span><span class="token plain"> -it pods/docker-api-0   -n gaea-op -c docker-cli -- ash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/ </span><span class="token comment" style="color:rgb(0, 128, 0)"># docker info</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="go-api操作">go api操作<a class="hash-link" href="#go-api操作" title="标题的直接链接">​</a></h2>]]></content>
        <category label="docker" term="docker"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Prometheus Operator 初体验]]></title>
        <id>/posts/prometheus-install</id>
        <link href="https://ysicing.me/posts/prometheus-install"/>
        <updated>2020-05-25T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[Prometheus Operator 初体验]]></summary>
        <content type="html"><![CDATA[<blockquote><p>通过Operator创建Prometheus</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="脚本部署">脚本部署<a class="hash-link" href="#脚本部署" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#  在之前的基础上，配置了存储storageclass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git clone https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd prometheus</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># prometheus</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">prometheus</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">storageclass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml #配置存储</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">bash </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">x </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 在管理节点执行，如有报错，在执行一下</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>与<a href="https://github.com/coreos/kube-prometheus/tree/master/manifests" target="_blank" rel="noopener noreferrer">官方</a>的区别支持了数据持久化和域名配置,部分监控组件如etcd等</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ergo安装">ergo安装<a class="hash-link" href="#ergo安装" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ergo install prom  </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pass oac5eeWosie7aiP5Um2AeKahkaiCeigh  </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">domain godu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="prometheus" term="prometheus"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[helm小记]]></title>
        <id>/posts/helm</id>
        <link href="https://ysicing.me/posts/helm"/>
        <updated>2020-05-23T18:55:18.000Z</updated>
        <summary type="html"><![CDATA[记录helm相关使用]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><blockquote><p>安装docker时默认已经安装了helm,如果不是最新版本请<code>upgrade-tools</code></p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">upgrade-tools</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm version</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">version.BuildInfo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">Version:</span><span class="token string" style="color:rgb(163, 21, 21)">"v3.2.1"</span><span class="token plain">, GitCommit:</span><span class="token string" style="color:rgb(163, 21, 21)">"fe51cd1e31e6a202cba7dead9552a6d418ded79a"</span><span class="token plain">, GitTreeState:</span><span class="token string" style="color:rgb(163, 21, 21)">"clean"</span><span class="token plain">, GoVersion:</span><span class="token string" style="color:rgb(163, 21, 21)">"go1.13.10"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置helm镜像库">配置helm镜像库<a class="hash-link" href="#配置helm镜像库" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 自动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helminit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 手动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> stable http://mirror.azure.cn/kubernetes/charts/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo </span><span class="token function" style="color:rgb(0, 0, 255)">add</span><span class="token plain"> incubator http://mirror.azure.cn/kubernetes/charts-incubator/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="helm" term="helm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ergo安装ingress安装]]></title>
        <id>/posts/ingress-install</id>
        <link href="https://ysicing.me/posts/ingress-install"/>
        <updated>2020-05-22T19:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s部署ingress]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="域名相关">域名相关<a class="hash-link" href="#域名相关" title="标题的直接链接">​</a></h2><p>默认情况下, 本地环境域名测试</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.112</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vlb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ergo安装">ergo安装<a class="hash-link" href="#ergo安装" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Usage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ergo install ingress </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">help                 help </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ingresstype </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">   ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> traefik</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ingress-nginx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Global Flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">config </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">   config file </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> is $HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">doge</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ip strings      需要安装节点ip </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pass </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">     管理员密码</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pk </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">       管理员私钥</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">regioncn        默认使用gitee源 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">user </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">     管理员 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"root"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例: <code>ergo install ingress --ip 10.147.20.43 --pk ~/.ssh/id_rsa --regioncn --ingresstype traefik</code></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="历史安装">历史安装<a class="hash-link" href="#历史安装" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nginx-ingress-controller-ingress-nginx">NGINX Ingress Controller (ingress-nginx)<a class="hash-link" href="#nginx-ingress-controller-ingress-nginx" title="标题的直接链接">​</a></h3><p>使用helm方式安装</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm install nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1.34</span><span class="token number" style="color:rgb(9, 134, 88)">.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml stable</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 升级</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm upgrade nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1.34</span><span class="token number" style="color:rgb(9, 134, 88)">.2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml stable</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nginx-ingress-controllers-kubernetes-ingress">NGINX Ingress Controllers (kubernetes-ingress)<a class="hash-link" href="#nginx-ingress-controllers-kubernetes-ingress" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo add nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">stable https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm install nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">helm</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginxnc</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0.4</span><span class="token number" style="color:rgb(9, 134, 88)">.3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">stable</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 或者</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署文档 <a href="https://github.com/nginxinc/kubernetes-ingress/tree/v1.6.0/deployments" target="_blank" rel="noopener noreferrer">nginxinc/kubernetes-ingress v1.6.0</a></p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="ingress" term="ingress"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[如何在线重装Debian11]]></title>
        <id>/posts/debian-reinstall</id>
        <link href="https://ysicing.me/posts/debian-reinstall"/>
        <updated>2020-05-22T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[介绍如何给云服务商提供的机器在线重装Debian，以轻量云为例]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-背景">1. 背景<a class="hash-link" href="#1-背景" title="标题的直接链接">​</a></h2><ul><li>云服务商提供的机器可能安装了一些服务组件，如监控等等，想要一个干净的环境。</li><li>一条命令快速重装干净的Linux环境</li><li>目前仅支持Debian(不会不打算支持其他系统)</li><li>基于萌咖大佬的二次魔改</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-定制">2. 定制<a class="hash-link" href="#2-定制" title="标题的直接链接">​</a></h2><ul><li>默认root密码 vagrant(安装完成建议修改，禁止密码登录)</li><li>默认配置源为<code>mirrors.tuna.tsinghua.edu.cn</code>,默认添加了<code>security</code>,<code>backports</code></li><li>默认时区为<code>Asia/Shanghai</code></li><li>默认安装了<code>curl wget openssh-server sudo sed apt-transport-https net-tools</code>等常用工具</li><li>同时默认支持自定义密码</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-安装">3. 安装<a class="hash-link" href="#3-安装" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">curl</span><span class="token plain"> -sSL https://sh.ysicing.me/reinstall/install.sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 指定参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># -p 默认密码vagrant</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># -m 默认源aliyun</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> --no-check-certificate -qO- </span><span class="token string" style="color:rgb(163, 21, 21)">'https://sh.ysicing.me/reinstall/install.sh'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> -p thah6oob7KieChie</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-特殊-自定义硬盘">3.1 特殊: 自定义硬盘<a class="hash-link" href="#31-特殊-自定义硬盘" title="标题的直接链接">​</a></h3><blockquote><p>存在多个硬盘时，需要下载 <a href="https://sh.ysicing.me/reinstall/install-sdev.sh" target="_blank" rel="noopener noreferrer"><code>https://sh.ysicing.me/reinstall/install-sdev.sh</code></a>文件，编辑如下部分即可</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># -p 默认密码vagrant</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># -m 默认源aliyun</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># -s 指定启动硬盘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> --no-check-certificate -qO- </span><span class="token string" style="color:rgb(163, 21, 21)">'https://sh.ysicing.me/reinstall/install-sdev.sh'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> -p thah6oob7KieChie -s /dev/sdb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-参考附录">4. 参考附录<a class="hash-link" href="#4-参考附录" title="标题的直接链接">​</a></h2><p><a href="https://moeclub.org/2018/04/03/603/?spm=ysicing.me" target="_blank" rel="noopener noreferrer">[ Linux VPS ] Debian/Ubuntu/CentOS 网络安装/重装系统/纯净安装 一键脚本</a></p>]]></content>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[docker快速安装]]></title>
        <id>/posts/docker</id>
        <link href="https://ysicing.me/posts/docker"/>
        <updated>2020-05-19T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[使用ergo快速安装docker]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装docker">安装docker<a class="hash-link" href="#安装docker" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">curl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">fsSL https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docker</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> bash </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">或者</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ergo install docker </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>做了如下设置</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"exec-opts"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"native.cgroupdriver=systemd"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"registry-mirrors"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"https://dyucrs4l.mirror.aliyuncs.com"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"bip"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"169.254.0.1/24"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"max-concurrent-downloads"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"log-driver"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"json-file"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"log-level"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"warn"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"log-opts"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"max-size"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"20m"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"max-file"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token property">"storage-driver"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"overlay2"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装tools">安装tools<a class="hash-link" href="#安装tools" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools tar zxf </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">C </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>内置了</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">etcdctl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">v3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helminit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker-compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">calicoctl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ctop</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cclear </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">清理退出容器</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">din </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">进入容器 din </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">cname/</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">cid</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> ash/bash</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">默认</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">/sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dps </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">容器状态</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">etcdcli </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">特别支持k8s集群的etcd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kbtoken </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">查看kuboard admin用户token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kdtoken </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">查看dashboard-admin 用户token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">istioctl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">upgrade-tools // 升级二进制</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="docker" term="docker"/>
        <category label="cri" term="cri"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ACK 添加内网负载均衡]]></title>
        <id>/posts/aliyun-ack-ingress</id>
        <link href="https://ysicing.me/posts/aliyun-ack-ingress"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[ACK 添加内网负载均衡]]></summary>
        <content type="html"><![CDATA[<p>先已经创建好内网slb,获取slb的ID为<code>lb-xxxx</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># intranet</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">slb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # 这里服务取名为nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">intranet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">intranet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">intranet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 指明SLB实例地址类型为私网类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">beta</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">alicloud</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">loadbalancer</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">address</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> intranet</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 修改为您的私网SLB实例ID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">beta</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">alicloud</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">loadbalancer</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> lb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">xxxx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # 是否自动创建SLB端口监听（会覆写已有端口监听），也可手动创建端口监听</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">beta</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">alicloud</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">loadbalancer</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">force</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">override</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">listeners</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token char" style="color:rgb(129, 31, 63)">'true'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  # route traffic to other nodes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  externalTrafficPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Cluster"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    # </span><span class="token keyword" style="color:rgb(0, 0, 255)">select</span><span class="token plain"> app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生效内网slb</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f intranet</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">slb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看slb</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lb                                  LoadBalancer   </span><span class="token number" style="color:rgb(9, 134, 88)">172</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x    </span><span class="token number" style="color:rgb(9, 134, 88)">39</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x   </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">31110</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">31574</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP   20h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">lb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">intranet                         LoadBalancer   </span><span class="token number" style="color:rgb(9, 134, 88)">172</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x    </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">x   </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">30740</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">30852</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP   73m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="ingress" term="ingress"/>
        <category label="kubernetes" term="kubernetes"/>
        <category label="ack" term="ack"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[知识点]]></title>
        <id>/posts/faq</id>
        <link href="https://ysicing.me/posts/faq"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[知识点]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docker-npm安装问题">docker npm安装问题<a class="hash-link" href="#docker-npm安装问题" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">npm config set unsafe</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">perm </span><span class="token boolean">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="git操作">git操作<a class="hash-link" href="#git操作" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 改崩了</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git fetch </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git reset </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">hard origin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">master</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 放弃本地全部</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">单个</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git checkout </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">git checkout </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain"> filename</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="misc" term="misc"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Go基础]]></title>
        <id>/posts/go-study-ch1</id>
        <link href="https://ysicing.me/posts/go-study-ch1"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[Go基础]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="变量和常量">变量和常量<a class="hash-link" href="#变量和常量" title="标题的直接链接">​</a></h3><p>关键字&amp;保留字</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token number" style="color:rgb(9, 134, 88)">25</span><span class="token plain">个保留字</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">break</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">interface</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">select</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(0, 0, 255)">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">chan</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">goto</span><span class="token plain">         </span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain">      </span><span class="token keyword" style="color:rgb(0, 0, 255)">switch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">fallthrough</span><span class="token plain">  </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain">           </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">continue</span><span class="token plain">     </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain">          </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain">       </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain">       </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token number" style="color:rgb(9, 134, 88)">37</span><span class="token plain">个保留字</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Constants</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token boolean">true</span><span class="token plain">  </span><span class="token boolean">false</span><span class="token plain">  </span><span class="token boolean">iota</span><span class="token plain">  </span><span class="token boolean">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Types</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">int8</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">int16</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">int32</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">int64</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin" style="color:rgb(0, 112, 193)">uint</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">uint8</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">uint16</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">uint32</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">uint64</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">uintptr</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin" style="color:rgb(0, 112, 193)">float32</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">float64</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">complex128</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">complex64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token builtin" style="color:rgb(0, 112, 193)">bool</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">byte</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">rune</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Functions</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">len</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">cap</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">new</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">append</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">copy</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">close</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">delete</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin" style="color:rgb(0, 112, 193)">complex</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">real</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">imag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token builtin" style="color:rgb(0, 112, 193)">panic</span><span class="token plain">  </span><span class="token builtin" style="color:rgb(0, 112, 193)">recover</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注意</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token plain"> 函数外的每个语句都必须以关键字开始（</span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain">、</span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain">、</span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain">等）</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2.</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain">不能使用在函数外。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3.</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token plain">多用于占位，表示忽略值</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">匿名变量，不占用命名空间，不会分配内存，不需要存在重复申明</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="变量">变量<a class="hash-link" href="#变量" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 全局变量m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> m </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    m </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">200</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 此处声明局部变量m</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常量">常量<a class="hash-link" href="#常量" title="标题的直接链接">​</a></h4><p>常量是恒定不变的值</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> pi </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3.1415</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// const声明多个常量时，如果省略了值则表示和上面一行的值相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    p1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3.1415</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    p2 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 3.1415</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    p3 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 3.1415</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="iota">iota<a class="hash-link" href="#iota" title="标题的直接链接">​</a></h4><p>iota是go语言的常量计数器，只能在常量的表达式中使用。iota在const关键字出现时将被重置为0。const中每新增一行常量声明将使iota计数一次(iota可理解为const语句块中的行索引)</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n1 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n2 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n3 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token boolean">_</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)">// 跳过某些值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n4 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n5 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    n6 </span><span class="token comment" style="color:rgb(0, 128, 0)">// 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token boolean">_</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    KB </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 1 1&lt;&lt;10 2^10 1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    MB </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 2 1&lt;&lt;20 2^20 1024*1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token boolean">iota</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 1,2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> d  </span><span class="token comment" style="color:rgb(0, 128, 0)">// 2, 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基本数据类型">基本数据类型<a class="hash-link" href="#基本数据类型" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"math"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">17</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// int 型 (int64)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 17 十进制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%b \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 10001 二进制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%o \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 021 八进制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%x \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 0x11 16禁止</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%.2f \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> math</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">Pi</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 默认都是浮点型float64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> s </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"666"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%T \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 类型 string </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%v \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 值 666</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%#v \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 值 "666"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注: </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">布尔类型变量的默认值为</span><span class="token boolean">false</span><span class="token plain">。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Go 语言中不允许将整型强制转换为布尔型</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">布尔型无法参与数值运算，也无法与其他类型进行转换</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="字符串">字符串<a class="hash-link" href="#字符串" title="标题的直接链接">​</a></h3><p>字符串需要使用<code>"</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">s1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>多行字符串需要使用`<!-- -->`<!-- -->`</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">s1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">`牛</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">牛 牛</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">牛</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="字符串操作">字符串操作<a class="hash-link" href="#字符串操作" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">"strings"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    a </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"666"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    b </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"777"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    c </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"-"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> b</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(0, 128, 0)">// len 长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sprintf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%s%s"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 拼接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">                     </span><span class="token comment" style="color:rgb(0, 128, 0)">// 拼接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">strings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Split</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"-"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 分割</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    res </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> strings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Split</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"-"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">           </span><span class="token comment" style="color:rgb(0, 128, 0)">// 分割</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">strings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">HasPrefix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"6"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> strings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">HasSuffix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"6"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//前缀/后缀判断</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    s </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"China万岁"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// byte</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%T %v(%c) \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// rune</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%T %v(%c) \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>uint8类型, 或者叫 byte型 代表了ASCII码的一个字符.</li><li>rune类型, 代表一个 UTF-8字符(中文), 实际是一个int32.</li><li>因为UTF8编码下一个中文汉字由3~4个字节组成,一个rune字符由一个或多个byte组成.</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="流程控制">流程控制<a class="hash-link" href="#流程控制" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="if">if<a class="hash-link" href="#if" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> 表达式</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    分支</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> 表达式</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    分支</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    分支</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="for">for<a class="hash-link" href="#for" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 基本格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> j</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    k </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> k </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">k</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        k</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    s </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"HellGo"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> s </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d---&gt;%v(%T)--&gt;%c\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// rune</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 死循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//for {</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//  fmt.Println("666")</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="switch-case">switch case<a class="hash-link" href="#switch-case" title="标题的直接链接">​</a></h4><p>简化判断</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">switch</span><span class="token plain"> a </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"3"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">switch</span><span class="token plain"> a </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">fallthrough</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 可以执行满足条件的case的下一个case, 了解即可</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"3"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="goto">goto<a class="hash-link" href="#goto" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9999</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;=</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> j</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> i </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d * %d = %d "</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> i </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d * %d = %d\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                </span><span class="token keyword" style="color:rgb(0, 0, 255)">goto</span><span class="token plain"> breakTag</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">breakTag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"end"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="运算符">运算符<a class="hash-link" href="#运算符" title="标题的直接链接">​</a></h3><p>算数运算符: + - * / %
关系运算符: == != &gt; &gt;= &lt; &lt;&lt; (结果为bool值)
逻辑运算符: &amp;&amp; || ! (结果为bool值)
位运算符: &amp; (相与 同为1为1)｜(相或 有1为1) ^（相异 或不同为1） &lt;&lt; (乘2的n次方)  &gt;&gt; (除2的n次方)
赋值运算符: 先其他运算再赋值</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 5 --- 101 左移 2 10100 --- 10 5 * 2^ 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 5 --- 101 右移 2 001 --- 1 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注: <code>++</code>,<code>--</code> 单独语句，不是运算符</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="数组">数组<a class="hash-link" href="#数组" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> 数组变量名 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">元素数量</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">T </span><span class="token comment" style="color:rgb(0, 128, 0)">// 一旦定义，长度不能变</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>数组初始化</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a1 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//数组会初始化为int类型的零值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a2 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//使用指定的初始值完成初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a3 </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 让编译器根据初始值的个数自行推断数组的长度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a4 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 指定索引值的方式来初始化数组 [0, 1, 0 ,3]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>数组遍历</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// for循环遍历</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> a </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    b </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> b </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> i </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d\t"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> j</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>数组是值类型，赋值和传参会复制整个数组。因此改变副本的值，不会改变本身的值。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="切片slice">切片slice<a class="hash-link" href="#切片slice" title="标题的直接链接">​</a></h3><p>切片是引用类型，拥有相同类型元素的可变长度的序列</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> 切片名 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">切片类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> name </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 动态创建</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">T</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// T 类型，size 长度， cap容量(从第一个到最后容量数)，cap 可省却</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">//var a []int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"a"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"b"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    d </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    e </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">e</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 3， 3-10 7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    s1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// [0,0,0]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    s2 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> s1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 拷贝前后两个变量共享底层数组，对一个切片的修改会影响另一个切片的内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    s2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 遍历和for一样</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d\t"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> </span><span class="token boolean">_</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> s2 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%d\t"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>切片的本质就是对底层数组的封装</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="append">append<a class="hash-link" href="#append" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> num </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">// 追加一个元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        num </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%v len:%d cap:%d ptr:%p\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 追加多个元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    num </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%v, \n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    num1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">98</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 追加切片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    num </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> num1</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">num</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="copy">copy<a class="hash-link" href="#copy" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">copy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">目标切片</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">源切片</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// copy()复制切片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    a </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    c </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">copy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)">//使用copy()函数将切片a中的元素复制到切片c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//[1 2 3 4 5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//[1 2 3 4 5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//[1 2 3 4 5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//[1000 2 3 4 5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">var</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 已经有5个了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        a </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Sprintf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%v"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// [     0 1 2 3 4 5 6 7 8 9] 20 15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="指针">指针<a class="hash-link" href="#指针" title="标题的直接链接">​</a></h3><ul><li>取地址 <code>&amp;a</code></li><li>根据地址取值 <code>*b</code></li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="make--new">make &amp; new<a class="hash-link" href="#make--new" title="标题的直接链接">​</a></h4><p>都用来申请内存</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin" style="color:rgb(0, 112, 193)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> slice，</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token plain">， </span><span class="token keyword" style="color:rgb(0, 0, 255)">chan</span><span class="token plain">申请内存，返回类型本身</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin" style="color:rgb(0, 112, 193)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 基本数据类型申请内存</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 返回指针</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 且内存对应的值为类型零值</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">a </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">new</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map">map<a class="hash-link" href="#map" title="标题的直接链接">​</a></h3><p>散列表(hash)实现, 无序的基于key-value的数据结构,引用类型，必须初始化才能使用.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">KeyType</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">ValueType</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">keytype</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">valuetype</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">cap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">code </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"a"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"a"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">code</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"b"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"b"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 判断 值是否存在</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">value</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> ok </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> ok </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 不存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> v </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">range</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// k,v v可省略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="函数">函数<a class="hash-link" href="#函数" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> 函数名</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">参数</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">返回值</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sum1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sum </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> sum</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回值定义了返回值名，return可省却</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sum2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">sum </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    sum </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// 可变参数，可变参数可有可无</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sum3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 切片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    r1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sum1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    r2 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sum2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">r1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">sum3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 1 []</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">sum3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">sum3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="defer">defer<a class="hash-link" href="#defer" title="标题的直接链接">​</a></h3><p>延迟处理, 多个defer 按照先进后出处理。</p><p>函数return分成两步</p><ul><li>返回值赋值</li><li>defer</li><li>return</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">deferdemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">name </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    x </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        x</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 修改x不是 返回值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回值赋值 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 修改x值为 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// retrun 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        x</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回值赋值 x=5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 修改x值为 x=6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// return 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 返回值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">y </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    x </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        x</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// y = x = 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// x = 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// return y = 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        x</span><span class="token operator" style="color:rgb(0, 0, 0)">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// x = 5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 副本 x = 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// return x</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">deferdemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"666"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">deferdemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"777"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">deferdemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"888"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">deferdemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"999"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">f1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">f4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 5,6,5,5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="匿名函数">匿名函数<a class="hash-link" href="#匿名函数" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 多次执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    e1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">e1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">// 立即执行，只执行一次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> y </span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="闭包">闭包<a class="hash-link" href="#闭包" title="标题的直接链接">​</a></h3><ol><li>函数作为返回值</li><li>外部变量引用</li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"strings"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">// checkMail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">checkMail</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">domain </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">name </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> strings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">HasSuffix</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> domain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"@"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> domain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    talkFunc </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">checkMail</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"@ysicing.me"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">talkFunc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"i"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token function" style="color:rgb(0, 0, 255)">talkFunc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"root@ysicing.me"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="panicrecover">panic/recover<a class="hash-link" href="#panicrecover" title="标题的直接链接">​</a></h3><ul><li>recover()和defer一起使用</li><li>defer在panic语句前</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"fmt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">funcA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"a"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">funcB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">defer</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        err </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">recover</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">panic</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"error"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"b"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">funC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Println</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"c"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">main</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">funcA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">funcB</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:rgb(0, 0, 255)">funC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="占位符">占位符<a class="hash-link" href="#占位符" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    m1 </span><span class="token operator" style="color:rgb(0, 0, 0)">:=</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">make</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">int</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    m1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"demo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%v\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> m1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 值的默认格式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%+v\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> m1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// 类似%v, 结构体会加字段名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%#v\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> m1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// map[string]int{"demo":1} 值Go语法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    fmt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token function" style="color:rgb(0, 0, 255)">Printf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">"%T\n"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> m1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">// map[string]int 打印类型</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="结构体">结构体<a class="hash-link" href="#结构体" title="标题的直接链接">​</a></h3>]]></content>
        <category label="go" term="go"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[helm部署docker registry]]></title>
        <id>/posts/helm-docker-registry</id>
        <link href="https://ysicing.me/posts/helm-docker-registry"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[helm部署docker registry]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署docker-registry">部署docker registry<a class="hash-link" href="#部署docker-registry" title="标题的直接链接">​</a></h2><blockquote><p>最近大陆push镜像老是超时，于是想自建一个，使用helm方式, 和drone安装方式类似</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm pull stable</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">registry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tar xf docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">registry</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1.9</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> cd docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">registry</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 编辑values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">自定义配置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 注释部分为调整</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">replicaCount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">updateStrategy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">podAnnotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">podLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">repository</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 2.7.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 启用ingress</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> hub.local.godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"0"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># k8s ingress 413</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nginx.org/client-max-body-size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"0"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># nginxnc ingress 413</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> hub.local.godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">persistence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">accessMode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'ReadWriteOnce'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 5Gi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">existingClaim</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry </span><span class="token comment" style="color:rgb(0, 128, 0)"># 同drone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> filesystem</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">secrets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">haSharedSecret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">htpasswd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">configData</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">log</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">fields</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> registry</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">cache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">blobdescriptor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> inmemory</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">addr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">headers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">X-Content-Type-Options</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">nosniff</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">health</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">storagedriver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">threshold</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">securityContext</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">runAsUser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">fsGroup</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">priorityClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">podDisruptionBudget</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">tolerations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">extraVolumeMounts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">extraVolumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>deploy</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm install registry </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f values</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml stable</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">docker</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">registry</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="helm" term="helm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[helm部署drone]]></title>
        <id>/posts/helm-drone</id>
        <link href="https://ysicing.me/posts/helm-drone"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[helm部署drone]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用helm安装drone">使用Helm安装Drone<a class="hash-link" href="#使用helm安装drone" title="标题的直接链接">​</a></h2><blockquote><p>一个比较热门的轻量级CI/CD开源工具：<a href="https://drone.io/" target="_blank" rel="noopener noreferrer">Drone</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="简介">简介<a class="hash-link" href="#简介" title="标题的直接链接">​</a></h3><ul><li>Drone是用Go开发的开源轻量级CI/CD工具</li><li>使用简单的 YAML 配置文件来定义和执行 Docker 容器中定义的 Pipeline</li><li>构成简单,服务占用资源少<ul><li>Server端负责身份认证，仓库配置，用户、Secrets 以及 Webhook 相关的配置</li><li>Agent端用于接受构建的作业和真正用于运行的 Pipeline 工作流</li></ul></li><li>安装简单，支持主流Git托管服务(github,gitea等)</li><li>官方文档也很全</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="环境">环境<a class="hash-link" href="#环境" title="标题的直接链接">​</a></h3><ul><li>helm v3.0.2</li><li>drone 1.6.1</li><li>k8s 1.17.0</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="准备工作">准备工作<a class="hash-link" href="#准备工作" title="标题的直接链接">​</a></h3><p>注册<a href="https://github.com/settings/developers" target="_blank" rel="noopener noreferrer">Github OAuth应用</a></p><p><img loading="lazy" alt="drone github oauth应用" src="/assets/images/github-14fb1ca78d40bc6eef834c663512ba22.png" width="1532" height="1184" class="img_ev3q"></p><p>获取到github oauth <code>Client ID</code>,<code>Client Secret</code>留用。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建持久化存储">创建持久化存储<a class="hash-link" href="#创建持久化存储" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># https://sh.ysicing.me/k8s/demo/pvc.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> PersistentVolume</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dronepv</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">capacity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 2Gi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Delete</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 192.168.100.101</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> /k8sdata/default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">drone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">pvc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dronepvc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ReadWriteOnce</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 2Gi</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">test</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># nfs 地址需要按需调整一下</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pvc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pvc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h3><blockquote><p>本文使用helm方式安装，因为需要对配置做些调整，需要自定义一些配置</p></blockquote><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 获取最新的离线drone包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">helm pull  stable/drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> xf drone-2.4.0.tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 编辑values.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例values.yaml如下</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 有注释的地方说明有修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">images</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">repository</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"docker.io/drone/drone"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 1.6.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">repository</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"docker.io/drone/agent"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 1.6.1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">repository</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"docker.io/library/docker"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tag</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 18.06.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">ce</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">dind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">pullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">httpPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ClusterIP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">exposeGRPC</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 启用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> drone.godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 证书，集群内已经证书的secret了，可以不启用，因为我的dev域名必须https访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> drone.godu.dev </span><span class="token comment" style="color:rgb(0, 128, 0)"># 域名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">sourceControl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">provider</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> github </span><span class="token comment" style="color:rgb(0, 128, 0)"># github</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxx </span><span class="token comment" style="color:rgb(0, 128, 0)"># github oauth id xxx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> clientSecret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretValue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> xxxx </span><span class="token comment" style="color:rgb(0, 128, 0)"># github oauth secret xxxx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">//github.com</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">gitlab</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> clientSecret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretValue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">gitea</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> clientSecret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretValue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">gogs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">bitbucketCloud</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientID</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> clientSecret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">clientSecretValue</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">bitbucketServer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">consumerKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> consumerKey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">privateKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> privateKey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">username</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">passwordKey</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> password</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"drone.godu.dev"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rpcProtocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">adminUser</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing </span><span class="token comment" style="color:rgb(0, 128, 0)"># github 登录后就具有管理员权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">alwaysAuth</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 运行 Drone 的任务的时候就是直接使用 Kubernetes 的 Job 资源对象来执行，而不是 Drone 的 agent.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">DRONE_LOGS_DEBUG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">DRONE_DATABASE_DRIVER</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"sqlite3"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">DRONE_DATABASE_DATASOURCE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/var/lib/drone/drone.sqlite"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">affinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tolerations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">extraContainers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">|</span><span class="token scalar string" style="color:rgb(163, 21, 21)"></span><br></span><span class="token-line" style="color:#000000"><span class="token scalar string" style="color:rgb(163, 21, 21)">  extraVolumes: |</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">DRONE_LOGS_DEBUG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">affinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tolerations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">dind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> overlay2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metrics</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">persistence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">enabled</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">existingClaim</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dronepvc </span><span class="token comment" style="color:rgb(0, 128, 0)"># 刚刚创建的持久化 pvc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">rbac</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">create</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">serviceAccount</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">create</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署drone</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> drone -f values.yaml stable/drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ helm status drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME: drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LAST DEPLOYED: Sun Jan  </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">20</span><span class="token plain">:30:00 </span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAMESPACE: default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">STATUS: deployed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">REVISION: </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TEST SUITE: None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NOTES:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*********************************************************************************</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">***        PLEASE BE PATIENT: drone may take a few minutes to </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain">         ***</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*********************************************************************************</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">From outside the cluster, the server URL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> are:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     http://drone.godu.dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最后</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">drone</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">drone# kubectl get pods </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                                  READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drone</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">drone</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">5bffbc56df</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">qzk28   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          35m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">drone</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">drone# kubectl get ing </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">drone</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME          HOSTS            ADDRESS   PORTS     AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drone</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">drone   drone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">godu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dev             </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">443</span><span class="token plain">   36m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="触发ci构建">触发CI构建<a class="hash-link" href="#触发ci构建" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># .drone.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> pipeline</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">steps</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> golang</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">GOPROXY</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">//goproxy.cn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">commands</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> CGO_ENABLED=0 go build </span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> plugins/docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">settings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">repo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing/godemo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">use_cache</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">username</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">from_secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dockeruser</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">password</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">from_secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">when</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">event</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> push</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">branch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> master</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>代码地址: <a href="https://github.com/BeidouCloudPlatform/demo/blob/master/.drone.yml" target="_blank" rel="noopener noreferrer">BeidouCloudPlatform/demo</a></p><p><img loading="lazy" alt="drone ci" src="/assets/images/ci-7b623898033464578e29b8f17c6d0207.png" width="2624" height="450" class="img_ev3q"></p><p><img loading="lazy" alt="drone 详情页" src="/assets/images/d-cf2398210db93625f930a9f2f6409f1b.png" width="2150" height="1072" class="img_ev3q"></p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cli工具">Cli工具<a class="hash-link" href="#cli工具" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew install drone</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cli</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export DRONE_SERVER</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">drone</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">godu</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export DRONE_TOKEN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drone info</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 修复webhook，如果调整了域名，可以通过此命令修复webhook</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drone repo repair  BeidouCloudPlatform</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="job清理问题">Job清理问题<a class="hash-link" href="#job清理问题" title="标题的直接链接">​</a></h3><p>因为使用Job的方式进行pipline操作，如果不启用<code>TTLAfterFinished</code>会导致job不会被自动清理。 开启feature请参考 <a href="/posts/k8s-feature">feature开启</a></p><p>默认drone清理是300s</p>]]></content>
        <category label="drone" term="drone"/>
        <category label="helm" term="helm"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[debian10安装k3s]]></title>
        <id>/posts/k3s-install</id>
        <link href="https://ysicing.me/posts/k3s-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[debian10安装k3s]]></summary>
        <content type="html"><![CDATA[<p>k3s 是Rancher推出的轻量级 k8s.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级内核版本">升级内核版本<a class="hash-link" href="#升级内核版本" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt dist</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">upgrade</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports linux</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">image</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">update</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">grub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">reboot</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 内核</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Linux cn2 </span><span class="token number" style="color:rgb(9, 134, 88)">5.6</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> SMP Debian </span><span class="token number" style="color:rgb(9, 134, 88)">5.6</span><span class="token number" style="color:rgb(9, 134, 88)">.14</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain">~bpo10</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">06</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">09</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> x86_64 GNU</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体可以参考 <a href="/posts/debian-op/">Debian个人常用操作指南</a> 升级内核部分。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装-wireguard">安装 wireguard<a class="hash-link" href="#安装-wireguard" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">#  所有节点需安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install wireguard </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署控制平面master节点">部署控制平面master节点<a class="hash-link" href="#部署控制平面master节点" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Lightweight Kubernetes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Documentation</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Wants</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">network</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">online</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WantedBy</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">multi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Type</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">notify</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EnvironmentFile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">KillMode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">process</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Delegate</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Having non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">zero Limit</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">s causes performance problems due to accounting overhead</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># in the kernel</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"> We recommend using cgroups to do container</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">local accounting</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNOFILE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1048576</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNPROC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitCORE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TasksMax</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TimeoutStartSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RestartSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStartPre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sbin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">modprobe br_netfilter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStartPre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sbin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">modprobe overlay</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    server \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">tls</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">san </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">external</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">docker \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pause</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">image registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pause</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.2</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">flannel</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backend wireguard \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">arg </span><span class="token string" style="color:rgb(163, 21, 21)">"proxy-mode=ipvs"</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"masquerade-all=true"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">arg </span><span class="token string" style="color:rgb(163, 21, 21)">"metrics-bind-address=0.0.0.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开机启动</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">systemctl </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">enable</span><span class="token plain"> k3s --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看组件状态</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">k3s kubectl get cs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                 STATUS    MESSAGE   ERROR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">controller</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">manager   Healthy   ok</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">scheduler            Healthy   ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署计算worker节点">部署计算worker节点<a class="hash-link" href="#部署计算worker节点" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">Lightweight Kubernetes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Documentation</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Wants</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">network</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">online</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WantedBy</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">multi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Type</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">exec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EnvironmentFile</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">env</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">KillMode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">process</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Delegate</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNOFILE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitNPROC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LimitCORE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TasksMax</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">infinity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TimeoutStartSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Restart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">RestartSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">5s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStartPre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sbin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">modprobe br_netfilter</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStartPre</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sbin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">modprobe overlay</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s agent \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">external</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.43</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">node</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.43</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">docker \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pause</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">image registry</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">beijing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyuncs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7scn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pause</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">3.2</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">arg </span><span class="token string" style="color:rgb(163, 21, 21)">"proxy-mode=ipvs"</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"masquerade-all=true"</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">arg </span><span class="token string" style="color:rgb(163, 21, 21)">"metrics-bind-address=0.0.0.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>K3S_TOKEN : 加入集群所需的token，可以在控制节点上查看<code>/var/lib/rancher/k3s/server/node-token</code> 文件</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k3s</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">env </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">K3S_URL</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">10.147</span><span class="token number" style="color:rgb(9, 134, 88)">.20</span><span class="token number" style="color:rgb(9, 134, 88)">.42</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">K3S_TOKEN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">K102f2c1f6c878f693700c24b741d309d2ff4038ade912f0a44248781c04376e878</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">server</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">bc39d44d89042011b985f267eebe2b2f</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开机启动 </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable k3s</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">agent </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="k3s" term="k3s"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s常用扩展组件]]></title>
        <id>/posts/k8s-addons</id>
        <link href="https://ysicing.me/posts/k8s-addons"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s常用扩展组件]]></summary>
        <content type="html"><![CDATA[<blockquote><p>扩展了Kubernetes的功能</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署kuboard">部署kuboard<a class="hash-link" href="#部署kuboard" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kuboard</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 因为ingress部署关系，所以配置解析域名为ui</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 管理节点执行，获取token</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kbtoken</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署metrics-server">部署metrics-server<a class="hash-link" href="#部署metrics-server" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">metrics</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署dashboard">部署Dashboard<a class="hash-link" href="#部署dashboard" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sealos install </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">pkg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">url https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sealstore</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">dashboard</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">releases</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">download</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">v2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">bata5</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">dashboard</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tar</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kdtoken</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s实践之calico mtu]]></title>
        <id>/posts/k8s-calico-mtu</id>
        <link href="https://ysicing.me/posts/k8s-calico-mtu"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s实践之calico mtu]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ucloud-网络">Ucloud 网络<a class="hash-link" href="#ucloud-网络" title="标题的直接链接">​</a></h2><p>ucloud默认mtu是 1454</p><p>所以calico需要改mtu</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl patch configmap</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">calico</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">config </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">system </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token plain"> merge   </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"data"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"veth_mtu"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"1404"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参考 <a href="https://docs.projectcalico.org/networking/mtu" target="_blank" rel="noopener noreferrer">Configure MTU to maximize network performance</a></p>]]></content>
        <category label="calico" term="calico"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s配置默认存储]]></title>
        <id>/posts/k8s-default-sc</id>
        <link href="https://ysicing.me/posts/k8s-default-sc"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s配置默认存储]]></summary>
        <content type="html"><![CDATA[<blockquote><p>配置默认存储</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 集群已有存储类型（StorageClass），执行 kubectl get sc看下当前是否设置了默认的 storageclass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get sc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl patch storageclass nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">data </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">p '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"metadata"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"annotations"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"storageclass.kubernetes.io/is-default-class"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="csi" term="csi"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[开启集群feature开启集群feature]]></title>
        <id>/posts/k8s-feature</id>
        <link href="https://ysicing.me/posts/k8s-feature"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[开启集群feature]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="ttlsecondsafterfinished">ttlSecondsAfterFinished<a class="hash-link" href="#ttlsecondsafterfinished" title="标题的直接链接">​</a></h2><p>自动清理完成和失败的Job，目前该特性默认不启用。如何判断未启用,查看job资源，在spec里未发现<code>ttlSecondsAfterFinished</code>定义则表示未启用。</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启用">启用<a class="hash-link" href="#启用" title="标题的直接链接">​</a></h2><p>我的集群使用sealos安装的，其配置文件在 <code>/etc/kubernetes/manifests</code>下,分别调整 kube-apiserver.yaml,kube-controller-manager.yaml,kube-scheduler.yaml配置，新增</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 示例</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">scheduler</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">authentication</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">kubeconfig</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">authorization</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">kubeconfig</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">bind</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">address</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">kubeconfig</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">leader</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">elect</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">feature</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">gates</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">TTLAfterFinished</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"> # 新增配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">gcr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">scheduler</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">17.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调整完成后稍等片刻,相关pod会重建。</p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[nginx ingress 配置域名证书]]></title>
        <id>/posts/k8s-ingress-tls-config</id>
        <link href="https://ysicing.me/posts/k8s-ingress-tls-config"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[nginx ingress 配置域名证书]]></summary>
        <content type="html"><![CDATA[<blockquote><p>nginx ingress 配置域名证书(默认以ingress-nginx为例)</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建证书">&nbsp;创建证书<a class="hash-link" href="#创建证书" title="标题的直接链接">​</a></h2><p>默认已经签发证书</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-secret">创建 secret<a class="hash-link" href="#创建-secret" title="标题的直接链接">​</a></h2><p>创建好证书以后，需要将证书内容放到 secret 中，secret 中全部内容需要 base64 编码</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># ingress-secret.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">prom</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> monitoring</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubernetes.io/tls</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls.crt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> &lt;base64 encoded cert</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls.key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> &lt;base64 encoded key</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>完成创建</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">~</span><span class="token comment" style="color:rgb(0, 128, 0)"># kubectl apply -f ingress-secret.yml -n monitoring</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">secret/ingress-secret created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">~</span><span class="token comment" style="color:rgb(0, 128, 0)"># kubectl apply -f ingress-secret.yml -n kube-system</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">secret/ingress-secret created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者通过如下方式</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl create secret tls ingress-secret --key tls.key.pem --cert tls.pem</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置ingress">配置ingress<a class="hash-link" href="#配置ingress" title="标题的直接链接">​</a></h2><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> prom</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> monitoring</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">tls</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> prom.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> grafana.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> alter.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> prom.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> grafana.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> grafana</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">3000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alter.k7s.xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> alertmanager</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">main</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">9093</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="ingress" term="ingress"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s实践之基础概念]]></title>
        <id>/posts/k8s-intro-base</id>
        <link href="https://ysicing.me/posts/k8s-intro-base"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s实践之基础概念]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="概念篇">概念篇<a class="hash-link" href="#概念篇" title="标题的直接链接">​</a></h2><blockquote><p>Kubernetes 基本概念和使用方法</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="架构">架构<a class="hash-link" href="#架构" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="k8s架构" src="/assets/images/k8s-arch-9fe5b4b795e082e8a7aee38397c0a3f3.png" width="1858" height="860" class="img_ev3q"></p><p><img loading="lazy" alt="k8s整体架构" src="/assets/images/kubernetes-high-level-component-archtecture-9a7e64a8539e5b2a413981ad46c61aec.jpg" width="1858" height="1126" class="img_ev3q"></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">etcd保存了整个集群的状态；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiserver提供了资源操作的唯一入口，并提供认证、授权、访问控制、API注册和发现等机制；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">controller manager负责维护集群的状态，比如故障检测、自动扩展、滚动更新等；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">scheduler负责资源的调度，按照预定的调度策略将Pod调度到相应的机器上；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubelet负责维护容器的生命周期，同时也负责Volume（CSI）和网络（CNI）的管理；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Container runtime负责镜像管理以及Pod和容器的真正运行（CRI）；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy负责为Service提供cluster内部的服务发现和负载均衡；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CoreDns 集群dns解析服务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Ingress Controller 应用层负载均衡提供对外访问服务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">state</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">metrics 集群监控</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Prometheus 资源监控</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Dashboard Web UI </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mastercontrol-plane节点">Master(Control Plane)节点<a class="hash-link" href="#mastercontrol-plane节点" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="master节点架构" src="/assets/images/kubernetes-master-arch-3d03b455e4b2c628b0fada2cc033a918.png" width="1600" height="1067" class="img_ev3q"></p><p>Master是集群的控制平面:</p><ul><li>负载集群的全局决策(如调度等)</li><li>探测响应集群事件(如探测应用的实例数是否符合预期)</li><li>通常master节点不调度业务服务</li></ul><p>Master节点主要包括kube-apiserver、kube-scheduler、kube-controller-manager和etcd四个组件。</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kube-apiserver: API服务, Kubernetes控制平面的前端，所有请求入口</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube-scheduler: </span><span class="token function" style="color:rgb(0, 0, 255)">watch</span><span class="token plain"> API资源状态，根据相关条件调度到合适的node节点创建相关资源</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube-controller-manager: 生命周期管理和API业务逻辑</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">如: 节点控制器,副本控制器</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">etcd: k8s数据存储组件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cloud-controller-manager: 云服务商组件，对接各家云资源</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">云服务商维护</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="workernode节点">Worker(Node)节点<a class="hash-link" href="#workernode节点" title="标题的直接链接">​</a></h3><p><img loading="lazy" alt="worker节点架构" src="/assets/images/kubernetes-node-arch-eea5c34ff359c438b0b8830eb253154f.png" width="1600" height="1067" class="img_ev3q"></p><p>包括kubelet、kube-proxy和Container Runtime三个组件。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubelet</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    运行在集群每个节点的客户端，需要确保相关容器运行在pod中；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    通过PodSpecs标签，描述容器的运行状态；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kubelet只管理通过kubernetes创建的容器。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proxy：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    是一个运行在集群每个节点的网络代理组件</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">主要是维护网络规则，保证集群内外与Pod通信。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Container Runtime：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    支持运行容器底层环境的软件；</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    支持： </span><span class="token function" style="color:rgb(0, 0, 255)">CRI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Container Runtime Interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> 如Docker</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Containerd。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="核心addons">核心Addons<a class="hash-link" href="#核心addons" title="标题的直接链接">​</a></h3><blockquote><p>Addons 使用 Kubernetes 资源（DaemonSet、Deployment等）实现集群的功能特性。由于他们提供集群级别的功能特性，addons使用到的Kubernetes资源都放置在 <code>kube-system</code>名称空间下。</p></blockquote><ul><li>CNI(Calico等)</li><li>DNS(CoreDNS等)</li><li>UI(Dashboard)</li><li>...</li></ul><p><a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener noreferrer">官方Addons</a></p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s实践之部署第一个应用]]></title>
        <id>/posts/k8s-intro-deploy</id>
        <link href="https://ysicing.me/posts/k8s-intro-deploy"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s实践之部署第一个应用]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署第一个应用">部署第一个应用<a class="hash-link" href="#部署第一个应用" title="标题的直接链接">​</a></h2><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># https://sh.ysicing.me/k8s/demo/deploy.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> apps/v1    </span><span class="token comment" style="color:rgb(0, 128, 0)">#与k8s集群版本有关，使用 kubectl api-versions 即可查看当前集群支持的版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment    </span><span class="token comment" style="color:rgb(0, 128, 0)">#该配置的类型，我们使用的是 Deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">#译名为元数据，即 Deployment 的一些基本属性和信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> default </span><span class="token comment" style="color:rgb(0, 128, 0)"># 命名空间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">deployment    </span><span class="token comment" style="color:rgb(0, 128, 0)">#Deployment 的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#标签，可以灵活定位一个或多个资源，其中key和value均可自定义，可以定义多组，目前不需要理解</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo    </span><span class="token comment" style="color:rgb(0, 128, 0)">#为该Deployment设置key为app，value为demo的标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">#这是关于该Deployment的描述，可以理解为你期待该Deployment在k8s中如何使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#使用该Deployment创建一个应用程序实例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#strategy: #滚动策略 最多新增一个，最小下线一个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#  rollingUpdate:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#    maxSurge: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#    maxUnavailable: 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#  type: RollingUpdate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#标签选择器，与上面的标签共同作用，目前不需要理解</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">#选择包含标签app:demo的资源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#这是选择或创建的Pod的模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#Pod的元数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#Pod的标签，上面的selector即选择包含标签app:demo的Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">#期望Pod实现的功能（即在pod中部署）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)">#生成container，与docker中的container是同一种</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> godemo    </span><span class="token comment" style="color:rgb(0, 128, 0)">#container的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing/godemo    </span><span class="token comment" style="color:rgb(0, 128, 0)">#使用镜像godemo创建container，该container默认80端口可访问</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>部署应用</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deployment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">apps</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看部署结果</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 默认ns就是</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">可省却</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get deployments </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME              READY   UP</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">TO</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">            </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">           2m54s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                               READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cjjwr   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          3m17s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>Deployment</code>是pod控制器</p><p>常见pod控制器</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">守护型</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    无状态非系统级应用</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Deployment </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">如nginx</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    无状态系统级应用</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> DaemonSet </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">如日志监控收集端，每个node节点仅且需要跑一个pod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    有状态应用</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> StatefulSet </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">数据库类应用如mysql等</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">非守护型</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    一次性任务</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    定时任务</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> CronJob</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="常用命令">常用命令<a class="hash-link" href="#常用命令" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 获取资料</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl explain 类型</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">如pods</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 获取资源信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get 资源类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods 获取</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">租户的所有pods资源列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get nodes 获取节点资源列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get deploy 获取</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">租户类型为deployment的资源列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 显示资源的详细信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe 资源类型 资源名称</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe deploy demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment 获取</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">租户deployment类型且名为demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment的详细信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 看pod日志，类似docker logs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs Pod名称 </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl logs demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cjjwr 查看</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">租户下pod名为demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cjjwr的日志</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 进入容器，类型docker exec</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">it Pod名称 操作命令</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl exec </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">it demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cjjwr ash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> #</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="访问部署的应用">访问部署的应用<a class="hash-link" href="#访问部署的应用" title="标题的直接链接">​</a></h2><p>那么，部署完第一个应用又该如何访问?</p><p>Kubernetes 中的 Service（服务） 提供了这样的一个抽象层，它选择具备某些特征的 Pod（容器组）并为它们定义一个访问方式。</p><p>在创建Service的时候，通过设置配置文件中的 spec.type 字段的值，可以以不同方式向外部暴露应用程序，这里介绍常用的3种：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">ClusterIP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">默认</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 集群内部可访问</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NAT方式</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">可以通过访问集群中任意节点</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">端口号的方式访问服务 </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">NodeIP</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">NodePort</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">此时ClusterIP的访问方式仍然可用。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">LoadBalancer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 负载均衡</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">依赖云访问</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">。此时 ClusterIP 和 NodePort 的访问方式仍然可用。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="ClusterIP方式" src="/assets/images/clusterip-76d087794a416ce22ae33af491a95c3a.png" width="2132" height="1162" class="img_ev3q">
<img loading="lazy" alt="NodePort方式" src="/assets/images/NodePort-03f53eb1a5a5391bc74f3be6c7b5070d.png" width="2072" height="1498" class="img_ev3q">
<img loading="lazy" alt="LoadBalancer方式" src="/assets/images/lb-a636a1367ef5f755229b5d551c5d3755.png" width="2114" height="1526" class="img_ev3q"></p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl explain svc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># https://sh.ysicing.me/k8s/demo/svc.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">service    </span><span class="token comment" style="color:rgb(0, 128, 0)">#Service 的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)">#Service 自己的标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo   </span><span class="token comment" style="color:rgb(0, 128, 0)">#为该 Service 设置 key 为 app，value 为 demo 的标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">       </span><span class="token comment" style="color:rgb(0, 128, 0)">#这是关于该 Service 的定义，描述了 Service 如何选择 Pod，如何被访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">     </span><span class="token comment" style="color:rgb(0, 128, 0)">#标签选择器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo   </span><span class="token comment" style="color:rgb(0, 128, 0)">#选择包含标签 app:demo 的 Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">port </span><span class="token comment" style="color:rgb(0, 128, 0)">#端口的名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> TCP       </span><span class="token comment" style="color:rgb(0, 128, 0)">#协议类型 TCP/UDP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">            </span><span class="token comment" style="color:rgb(0, 128, 0)">#集群内的其他容器组可通过 80 端口访问 Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">nodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)">#通过任意节点的 32600 端口访问 Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)">#将请求转发到匹配 Pod 的 80 端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> NodePort    </span><span class="token comment" style="color:rgb(0, 128, 0)">#Serive的类型，ClusterIP/NodePort/LoaderBalancer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生效</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">svc</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看service，通过之前的文档</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl get svc </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME           TYPE       CLUSTER</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IP    EXTERNAL</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">IP   </span><span class="token function" style="color:rgb(0, 0, 255)">PORT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">S</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">        AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service   NodePort   </span><span class="token number" style="color:rgb(9, 134, 88)">10.96</span><span class="token number" style="color:rgb(9, 134, 88)">.37</span><span class="token number" style="color:rgb(9, 134, 88)">.87</span><span class="token plain">   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">        </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP   55s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe svc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                   app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">              kubectl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">last</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">applied</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"apiVersion"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"v1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"kind"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"Service"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"metadata"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"annotations"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"labels"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"app"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"name"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-service"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"namespace"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">"spe</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                 app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">IP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                       </span><span class="token number" style="color:rgb(9, 134, 88)">10.96</span><span class="token number" style="color:rgb(9, 134, 88)">.37</span><span class="token number" style="color:rgb(9, 134, 88)">.87</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">port  </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TargetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">               </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                 demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">port  </span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Endpoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.219</span><span class="token number" style="color:rgb(9, 134, 88)">.5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Session Affinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">         None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">External Traffic Policy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  Cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Events</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试服务访问</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 在集群节点</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl </span><span class="token number" style="color:rgb(9, 134, 88)">10.96</span><span class="token number" style="color:rgb(9, 134, 88)">.37</span><span class="token number" style="color:rgb(9, 134, 88)">.87</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.219</span><span class="token number" style="color:rgb(9, 134, 88)">.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.101</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl </span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.102</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>那么问题来了，如果想通过clusterip方式提供对外服务，该怎么做？</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> networking</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">v1beta1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    app</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress # ingress名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  rules</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> host</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz # 域名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        paths</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> backend</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              serviceName</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service # godemo的 service名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">              servicePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">port # godemo的service定义的port</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            path</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> #路径</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>生效</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ingress</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">networking</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get ing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME           HOSTS                ADDRESS   PORTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress   godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz             </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain">      91s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>验证ingress</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">curl godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz      </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这时候流量增加，怎么快速伸缩应用。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="伸缩应用">伸缩应用<a class="hash-link" href="#伸缩应用" title="标题的直接链接">​</a></h3><p>伸缩 的实现可以通过更改 deploy.yaml 文件中部署的 replicas（副本数）来完成</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> replicas</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 改完生效</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy2</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deployment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">apps</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment configured</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 查看pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                               READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">78v28   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          16s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cjjwr   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          15m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">mn7r8   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          16s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">59cd96d4d5</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">mvxk2   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          16s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 修改了 Deployment 的 replicas 为 </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> 后，Kubernetes 又为该 Deployment 创建了 </span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> 新的 Pod，这 </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> 个 Pod 有相同的标签。因此nginx Service 通过标签选择器与新的 Pod建立了对应关系，将访问流量通过负载均衡在 </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> 个 Pod 之间进行转发</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                   app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">              kubectl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">last</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">applied</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">configuration</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"apiVersion"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"v1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"kind"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"Service"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"metadata"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"annotations"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"labels"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"app"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"name"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-service"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"namespace"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">"spe</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Selector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                 app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     NodePort</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">IP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                       </span><span class="token number" style="color:rgb(9, 134, 88)">10.96</span><span class="token number" style="color:rgb(9, 134, 88)">.37</span><span class="token number" style="color:rgb(9, 134, 88)">.87</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                     demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">port  </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">TargetPort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">               </span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NodePort</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                 demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">port  </span><span class="token number" style="color:rgb(9, 134, 88)">32600</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">TCP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Endpoints</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.109</span><span class="token number" style="color:rgb(9, 134, 88)">.71</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.109</span><span class="token number" style="color:rgb(9, 134, 88)">.72</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.219</span><span class="token number" style="color:rgb(9, 134, 88)">.5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">80</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> more</span><span class="token operator" style="color:rgb(0, 0, 0)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Session Affinity</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">         None</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">External Traffic Policy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">  Cluster</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Events</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">                   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>验证效果,流量是负载到后端不同pod上</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-mn7r8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.109.71/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-cjjwr"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.5/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# curl godemo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-59cd96d4d5-78v28"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.219.6/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="最后">最后<a class="hash-link" href="#最后" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">陈述式：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kubectl create </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f xx.yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">申明式（建议使用）：</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kubectl apply </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">f xx.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>pod容器如果未发生调度，重启容器ip是不会改变的</li></ul><p>另外除了Service这种网络，还有<code>hostPort</code>,<code>hostNetwork</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">hostPort：直接将容器的端口与所调度的节点上的端口路由，这样可以通过宿主机的IP加上来访问Pod了</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> Ingress就是这样的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">hostNetwork：共享宿主机的网络名称空间</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这里可以这么测试使用hostPort</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy3</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get pods  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">l app</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">demo </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o wide</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                               READY   STATUS    RESTARTS   AGE    IP              NODE   NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">6c5664f4d6</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">s6w8v   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          112s   </span><span class="token number" style="color:rgb(9, 134, 88)">172.16</span><span class="token number" style="color:rgb(9, 134, 88)">.109</span><span class="token number" style="color:rgb(9, 134, 88)">.68</span><span class="token plain">   k8s2   </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">           </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl </span><span class="token number" style="color:rgb(9, 134, 88)">666</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">slb</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k7s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">xyz</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">28080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"hostname"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"demo-deployment-6c5664f4d6-s6w8v"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"ip"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">"eth0"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"172.16.109.68/32"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token string" style="color:rgb(163, 21, 21)">"lo"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token string" style="color:rgb(163, 21, 21)">"127.0.0.1/8"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[kubectl plugin插件机制初体验之krew]]></title>
        <id>/posts/k8s-kubectl-plugins</id>
        <link href="https://ysicing.me/posts/k8s-kubectl-plugins"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[kubectl plugin插件机制初体验之krew]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="kubectl-plugin插件机制初体验之krew">kubectl plugin插件机制初体验之krew<a class="hash-link" href="#kubectl-plugin插件机制初体验之krew" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="插件机制">插件机制<a class="hash-link" href="#插件机制" title="标题的直接链接">​</a></h3><p>这个早就已经GA了，其作用允许开发者以独立的二进制或脚本形式发布自定义的kubectl子命令, 灵活快速操作k8s</p><p>插件不限制语言，只需将脚本或二进制可执行文件以<code>kubectl-&lt;plugin-name&gt;</code>的前缀放到PATH中即可.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="官方示例">官方示例<a class="hash-link" href="#官方示例" title="标题的直接链接">​</a></h4><p>官方Go示例辅助库 <a href="https://github.com/kubernetes/cli-runtime.git" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/cli-runtime.git</a></p><p>不太简单的官方示例插件 <a href="https://github.com/kubernetes/sample-cli-plugin" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/sample-cli-plugin</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="示例插件">示例插件<a class="hash-link" href="#示例插件" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">mkdir </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">$PATH</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例插件如下：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# cat </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubectl</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">#</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">echo $</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>赋予执行权限 </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">chmod </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubectl</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>运行测试:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl demo </span><span class="token number" style="color:rgb(9, 134, 88)">666</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">666</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl plugin list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The following compatible plugins are available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubectl</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>kubectl plugin list</code> 可以查看PATH中查看有哪些插件</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="krew">krew<a class="hash-link" href="#krew" title="标题的直接链接">​</a></h3><p>Package manager for kubectl plugins -- <a href="https://krew.dev" target="_blank" rel="noopener noreferrer">krew</a></p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装krew">安装krew<a class="hash-link" href="#安装krew" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># Bash and ZSH</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  set </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> cd </span><span class="token string" style="color:rgb(163, 21, 21)">"$(mktemp -d)"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  curl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">fsSLO </span><span class="token string" style="color:rgb(163, 21, 21)">"https://github.com/kubernetes-sigs/krew/releases/download/v0.3.4/krew.{tar.gz,yaml}"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  tar zxvf krew</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">gz </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  KREW</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">krew</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">linux_amd64 </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"$KREW"</span><span class="token plain"> install </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">manifest</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">krew</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yaml </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">archive</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">krew</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tar</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">gz </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"$KREW"</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bashrc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">zshrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">$PATH</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">$</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">KREW_ROOT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">$HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">krew</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看当前可用的kubectl plugin，发现多了一个kubect-krew</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl plugin list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The following compatible plugins are available</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubectl</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">demo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">root</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">krew</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubectl</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">krew</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="krew使用">krew使用<a class="hash-link" href="#krew使用" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">kubectl krew</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">krew is the kubectl plugin manager</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You can invoke krew through kubectl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"kubectl krew [command]..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Usage</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  krew </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Available Commands</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  help        Help about any command</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  info        Show information about a kubectl plugin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  install     Install kubectl plugins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  list        List installed kubectl plugins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  search      Discover kubectl plugins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  uninstall   Uninstall plugins</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  update      Update the local </span><span class="token builtin" style="color:rgb(0, 112, 193)">copy</span><span class="token plain"> of the plugin index</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  upgrade     Upgrade installed plugins to newer versions</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  version     Show krew version and diagnostics</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">h</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">help      help </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> krew</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">v Level   number </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> the log level verbosity</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Use </span><span class="token string" style="color:rgb(163, 21, 21)">"krew [command] --help"</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> more information about a command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初体验">初体验<a class="hash-link" href="#初体验" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">No resources found in </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl krew install change</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installing plugin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> change</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Installed plugin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> change</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl krew list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PLUGIN     VERSION</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">change</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ns  v1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">krew       v0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">3.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl change</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ns nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">namespace changed to </span><span class="token string" style="color:rgb(163, 21, 21)">"nginx-ingress"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~# kubectl get pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">root@k8s1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">~#  kubectl get pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                  READY   STATUS              RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">rfswh   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running             </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          2m6s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nginx</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ingress</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v6c4l   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running             </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          2m6s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="krew" term="krew"/>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s标签和选择器]]></title>
        <id>/posts/k8s-labels</id>
        <link href="https://ysicing.me/posts/k8s-labels"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s标签和选择器]]></summary>
        <content type="html"><![CDATA[<p>格式要求：</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">有效标签值必须为 </span><span class="token number" style="color:rgb(9, 134, 88)">63</span><span class="token plain"> 个字符或更少，并且必须为空或以字母数字字符（</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">a</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">z0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">9A</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">Z</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain">）开头和结尾，中间可以包含破折号（</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">）、下划线（</span><span class="token boolean">_</span><span class="token plain">）、点（</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">）和字母或数字</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="节点调度nodeselector">节点调度nodeSelector<a class="hash-link" href="#节点调度nodeselector" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 打label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl label nodes </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">node-name</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">label-key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">label-value</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 显示label</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get </span><span class="token function" style="color:rgb(0, 0, 255)">node</span><span class="token plain"> --show-labels</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>pod调度到节点</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> test</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">nodeSelector</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">disktype</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ssd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s实践之安装linkerdv2]]></title>
        <id>/posts/k8s-linkerd-install</id>
        <link href="https://ysicing.me/posts/k8s-linkerd-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s实践之安装linkerdv2]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装linkerd-v2">安装linkerd v2<a class="hash-link" href="#安装linkerd-v2" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装二进制">安装二进制<a class="hash-link" href="#安装二进制" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">rm </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">v </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tools tar zxf </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pkg</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tgz </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">C </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sysdir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="获取相关镜像">获取相关镜像<a class="hash-link" href="#获取相关镜像" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"gcr.io/linkerd-io"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -F/ </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> tag gcr.io/linkerd-io/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> ysicing/linkerd-io-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"gcr.io/linkerd-io"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -F/ </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> push ysicing/linkerd-io-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="同步到内网环境">同步到内网环境<a class="hash-link" href="#同步到内网环境" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"gcr.io/linkerd-io"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -F/ </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull ysicing/linkerd-io-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"gcr.io/linkerd-io"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -F/ </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> tag ysicing/linkerd-io-</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> hub.godu.dev/linkerd/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --ignore-cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> image: </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -e </span><span class="token string" style="color:rgb(163, 21, 21)">'s/^ *//'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">sort</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $2}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">grep</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"gcr.io/linkerd-io"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">awk</span><span class="token plain"> -F/ </span><span class="token string" style="color:rgb(163, 21, 21)">'{print $NF}'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">xargs</span><span class="token plain"> -I </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> push hub.godu.dev/linkerd/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">linkerd check --pre</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> --registry hub.godu.dev/linkerd </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linkerd check</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="启用">启用<a class="hash-link" href="#启用" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 已有应用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">n emojivoto deploy</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">web </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o yaml </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> linkerd inject </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> kubectl apply </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">f </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> 创建应用</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">app </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">TalkController</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">CustomAnnotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">map</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token builtin" style="color:rgb(0, 112, 193)">string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string" style="color:rgb(163, 21, 21)">"linkerd.io/inject"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"enabled"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">//"prometheus.io/port": "12306",</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token comment" style="color:rgb(0, 128, 0)">//"prometheus.io/scrape": "true",</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># deploy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        linkerd</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">inject</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> enabled</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">port</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        prometheus</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">scrape</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="linkerd" term="linkerd"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[minikube安装k8s]]></title>
        <id>/posts/k8s-minikube-install</id>
        <link href="https://ysicing.me/posts/k8s-minikube-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[minikube安装k8s]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="minikube安装k8s">minikube安装k8s<a class="hash-link" href="#minikube安装k8s" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos安装">MacOS安装<a class="hash-link" href="#macos安装" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> minikube</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># PROXY可以根据自己需要设置，可不设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">minikube start --cpus</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> --memory 4g --disk-size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">40g --driver</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">virtualbox --image-repository</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">registry.cn-hangzhou.aliyuncs.com/google_containers --nodes</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> --docker-env </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">HTTP_PROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://192.168.99.1:7890 --docker-env </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">HTTPS_PROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://192.168.99.1:7890  --docker-env </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">NO_PROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token plain">.0.1/32,192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="minikube" term="minikube"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s实践之资源管理的权限控制]]></title>
        <id>/posts/k8s-sa</id>
        <link href="https://ysicing.me/posts/k8s-sa"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[k8s实践之资源管理的权限控制]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="k8s-资源管理的权限控制">k8s 资源管理的权限控制<a class="hash-link" href="#k8s-资源管理的权限控制" title="标题的直接链接">​</a></h2><p>在k8s中，由系统自身的接口来创建和管理的账号类型只有一种，叫做<code>ServiceAccount</code>。
可以使用下面的命令来查看目前系统已有的<code>ServiceAccount</code>，简写<code>sa</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get sa</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME      SECRETS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain">   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">         2d8h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查看sa具体定义</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get sa </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  creationTimestamp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"2020-01-05T06:27:59Z"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  resourceVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"428"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  selfLink</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">api</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">v1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">namespaces</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">serviceaccounts</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  uid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 9881e9a3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">4097</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">44b4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a9e3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e5a9d4e516e0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">secrets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8xcpl # 引用了名为</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8xcpl的secrets</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get secrets </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8xcpl  </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">data</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">crt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5akNDQWJLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQ0FYRFRJd01ERXdOVEEyTWpjeE5Gb1lEekl4TVRneE1qRXlNRFl5TnpFMFdqQVZNUk13RVFZRApWUVFERXdwcmRXSmxjbTVsZEdWek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCnoyS0ttbzh2emdXWE1WR09hSy9DeWk2cGZ2T0psWUMxd1paRTdWS3IwTENFZDBQWXVKbk10NStQdVhKUkw4OFUKK2t2U0RGRm1RS3J6QUhCN0IwNGVybEwyd0NHeDZwa2FIOFBMMTJqKzdUUW5VS2doa1lHb1ZxUjNKV3NTSS9jcwo0ampGWTJyVmY3Z3pDNG9LbHlBc2VRdXFRaERPV004emtCalFYa3gyZVdnSSthRFNpOHd5SHNSNXZwK0Y4TkNOCnEreHY3bFczOERBcTB2SGlSYnBlZHVCTWpUTksyaHlYYWpyeFpWNTZxTTdnRUJWcVBjRCtUWmQySGs2SGQ2dlgKaGhTeTdUQ3lOY1kvbi9HNjRscTBUaG9JZTBWaFBncG8rU3JzRXVOVTBqWlFmRllDMDRWZlluSU0yZmxuSkY5YQpVWjkraVEza25ZR3RmSTA4cXRScjh3SURBUUFCb3lNd0lUQU9CZ05WSFE4QkFmOEVCQU1DQXFRd0R3WURWUjBUCkFRSC9CQVV3QXdFQi96QU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFOWHdQUkRLd05yMEFzMVpiN1NWWnVQeSsKMVhtbWhWS3dVUmVROXF2QjQwWU5sTVBKMVVqbUNyVmdVRmM4WldmUEhwTmZ6Z2dXTUJUbFFrZDhOK1NhTHB3bAo0bTJtMlpmTTV6Q3R2QVg2MzhHZUVPYTViVkNHcXhudUNVOWQxb2p0M2JZSkYwZGxSMy9VY3FpaDRaeEdUL0syCkJweEZ5QXBRRUZ0elhVZmE0dTBYcFBwUU1aa2txK2hkd01mZjQ3VlBma3NUazUvN2ZaK08vUXk4SElSM00wWFEKUWZyRWpIRXRwL2VSU1hENm95ZHF4R2RKL0pOWU4rKzJYU05lRm51bDFOakh2bG1IT1JpRDI2S2Rqb24vT1Y5cgplYlp0T1oxRmJPVVVFNktJRG9CWTJIK0JCWVppNkwzajJBRkpFTFozWE5tNUdlSTB0NGduWW8zSXU0SnRmZz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ZGVmYXVsdA</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltUnBTa2RCWlZwcVMwOVdOVmxCVDJkemQySTBkRlpPVVVkRlVHOVZYMXB0VDA1Q1dXeG5UVGhhTVdjaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUprWldaaGRXeDBJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbVJsWm1GMWJIUXRkRzlyWlc0dE9IaGpjR3dpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1dVlXMWxJam9pWkdWbVlYVnNkQ0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVnlkbWxqWlMxaFkyTnZkVzUwTG5WcFpDSTZJams0T0RGbE9XRXpMVFF3T1RjdE5EUmlOQzFoT1dVekxXVTFZVGxrTkdVMU1UWmxNQ0lzSW5OMVlpSTZJbk41YzNSbGJUcHpaWEoyYVdObFlXTmpiM1Z1ZERwa1pXWmhkV3gwT21SbFptRjFiSFFpZlEub1NwZ0w4V3liYlJEb0tvYUpxclJ1RkxGOUN6SW1tdlo3VEtWU1RXdVpnWVpCWTRRZ092NjVCbGFLTF9qQU9DSFNyQzd6WW5pSjlXVDVCcVd2N3dfQU9XdEhURVJWSU00Y3I5LXh6LUxMRHZ6bl9qZlNIR0VoSnBPZHZnMGppRFZydi0xanJOb2g1S3VKMGw0TlNULVBnemtUQTU5bWhfNzdodFRtdzJfaDJCWHNDWDBROFg1dm5uMTBMVFJaeHRtNnZTank5dVRIcUZpa0pkU2pTX2c1SjJiS3BXVW1sZnl6OWNKTkliNWhDS0hYVEYyWGlDaG9vMlI3RmdvcHc5X1ltNWxLc2JudGh0bHA5TDUzZ2M2UV9IUkRvb05hSk04RHZndTNybXJheUhPa193RkFTbE1XZ2NkZzF0OGNjYXIwM1V0aWZ5RElDS2s1OTBMM2d2T0hR</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  annotations</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">uid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 9881e9a3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">4097</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">44b4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a9e3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e5a9d4e516e0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  creationTimestamp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"2020-01-05T06:27:59Z"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8xcpl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  resourceVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"421"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  selfLink</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">api</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">v1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">namespaces</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">secrets</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8xcpl</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  uid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> 2f07379e</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">80bb</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">4c24</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a3e3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">8a37d1c4c9fb</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">type</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> kubernetes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">service</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">account</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建sa">创建sa<a class="hash-link" href="#创建sa" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl create sa ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">serviceaccount</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get sa ysicing </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o yaml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ServiceAccount</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  creationTimestamp</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"2020-01-07T14:40:07Z"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  namespace</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  resourceVersion</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"134248"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  selfLink</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">api</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">v1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">namespaces</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">serviceaccounts</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  uid</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> e5f19802</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a196</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">47d6</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">b194</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">3684642357ef</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">secrets</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">zvgr4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 获取token</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">这里token是原始token，未经过base64加密</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl describe secrets ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">token</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">zvgr4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试请求k8s api,发现还是403.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ curl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">k  https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.101</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6443</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">healthz</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ping </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">H 'Authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">PZRFY_5_mV8fAJCVJ</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"kind"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Status"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"apiVersion"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"v1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"metadata"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"status"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Failure"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"message"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"forbidden: User \"system:serviceaccount:default:ysicing\" cannot get path \"/healthz/ping\""</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"reason"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Forbidden"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"details"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:rgb(163, 21, 21)">"code"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">403</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>k8s对资源操作权限划分的比较详细:</p><ul><li>写权限<ul><li>create</li><li>update</li><li>delete</li><li>patch</li></ul></li><li>读权限 <ul><li>get</li><li>list</li><li>watch</li></ul></li></ul><p>配置sa ysicing访问资源,即配置 <code>.kube/config</code></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 配置sa ysicing token鉴权信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl config set</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">credentials ysicing </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">token eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">PZRFY_5_mV8fAJCVJ</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">User </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing"</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 配置集群访问信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">crt 从</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.101</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">pki</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">crt获取的</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl config set</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">cluster local </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">server https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.101</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6443</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">certificate</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">authority </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">kube</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ca</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">crt </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">embed</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">certs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Cluster </span><span class="token string" style="color:rgb(163, 21, 21)">"local"</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 配置context</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> 将cluster </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;</span><span class="token plain"> user 绑定</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl config set</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">context local</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ctx </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">cluster local </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">user ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Context </span><span class="token string" style="color:rgb(163, 21, 21)">"local-ctx"</span><span class="token plain"> created</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 切换ctx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl config use</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">context local</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ctx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Switched to context </span><span class="token string" style="color:rgb(163, 21, 21)">"local-ctx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>请求接口</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Error from server </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Forbidden</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> pods is forbidden</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> User </span><span class="token string" style="color:rgb(163, 21, 21)">"system:serviceaccount:default:ysicing"</span><span class="token plain"> cannot list resource </span><span class="token string" style="color:rgb(163, 21, 21)">"pods"</span><span class="token plain"> in API group </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"> in the namespace </span><span class="token string" style="color:rgb(163, 21, 21)">"default"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="授权配置">授权配置<a class="hash-link" href="#授权配置" title="标题的直接链接">​</a></h3><ul><li>创建角色，定义资源操作权限(ClusterRole/Role)</li><li>角色绑定，将角色与Sa绑定(ClusterRoleBinding/RoleBinding)</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 创建角色</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl create role ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">role </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">resource pod</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">deployment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">secret</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">ingress </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">verb create</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">update</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token builtin" style="color:rgb(0, 112, 193)">delete</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">patch</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">watch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">role</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">rbac</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">role created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get roles</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME           AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">role   34s</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 角色绑定</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl create rolebinding ysbot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">binding </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">role ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">role </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">serviceaccount </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">rolebinding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">rbac</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysbot</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">binding created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再次获取pods信息</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl config use</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">context local</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ctx</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Switched to context </span><span class="token string" style="color:rgb(163, 21, 21)">"local-ctx"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl get pods</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">NAME                               READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">demo</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">deployment</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">6c5664f4d6</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">s6w8v   </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">     Running   </span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain">          2d4h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再次请求<code>https://192.168.100.101:6443/healthz/ping</code>发现依旧403，那么给ysicing sa通过ClusterRoleBinding 授予一个名为 cluster-admin 的 ClusterRole</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl config use</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">context kubernetes</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">admin@kubernetes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Switched to context </span><span class="token string" style="color:rgb(163, 21, 21)">"kubernetes-admin@kubernetes"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ kubectl create clusterrolebinding cluster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ysicing </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">clusterrole cluster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">admin </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">serviceaccount </span><span class="token keyword" style="color:rgb(0, 0, 255)">default</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ysicing</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">clusterrolebinding</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">rbac</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">k8s</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">io</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">cluster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ysicing created</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">➜  ~ curl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">k  https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">192.168</span><span class="token number" style="color:rgb(9, 134, 88)">.100</span><span class="token number" style="color:rgb(9, 134, 88)">.101</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">6443</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">healthz</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ping </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">H 'Authorization</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6ImRpSkdBZVpqS09WNVlBT2dzd2I0dFZOUUdFUG9VX1ptT05CWWxnTThaMWcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InlzaWNpbmctdG9rZW4tenZncjQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoieXNpY2luZyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImU1ZjE5ODAyLWExOTYtNDdkNi1iMTk0LTM2ODQ2NDIzNTdlZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnlzaWNpbmcifQ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">D6L4y4N8e6IzGdiLcRMT_hxtJ2fhLsNTJs4hh7NJlEEulyvklwuA2AFWpdvw5aRXx5DVoHZq__bZ1M2s3</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">wP_hL57IsoLgW9yFb2GVpnwFXOGe_YipyYcqaVkhpNd7GKjMMxS2IKOdYsX</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">yBreQsI8x77WPb3ux6TNTFTCv2mmLl1P</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">0c9TCeeyjjHACYUnV07oHwRk7CJ5ee_S34ZZkEz</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ulf2E7xm5cwqWUd738WrN8LwK6p293WwBHeAh3fgK2iAgu5W</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">PZRFY_5_mV8fAJCVJ</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">E95WVQUplfuCLQBUx33mDseMuW7keCUJg2JkeSnE3mw_K09EuAt8EXkCDkWQ'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ok</span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 真香哈哈哈哈</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>cluster-admin</code>权限特别大,实际使用还需要谨慎操作。</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 可以查看具体定义</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">kubectl get role ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">role</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[NFS存储]]></title>
        <id>/posts/nfs-install-k8s</id>
        <link href="https://ysicing.me/posts/nfs-install-k8s"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[NFS存储]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nfs存储">NFS存储<a class="hash-link" href="#nfs存储" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian">Debian<a class="hash-link" href="#debian" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">kernel</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 配置</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mkdir </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8sdata</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">echo </span><span class="token string" style="color:rgb(163, 21, 21)">"/k8sdata/ *(insecure,rw,sync,no_root_squash,no_subtree_check)"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">exports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exportfs </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 测试</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">showmount </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centos">CentOS<a class="hash-link" href="#centos" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 安装nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">yum install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">utils</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 配置共享目录</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mkdir </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k8sdata</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">echo </span><span class="token string" style="color:rgb(163, 21, 21)">"/k8sdata *(insecure,rw,sync,no_root_squash)"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">exports</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动nfs</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start rpcbind</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl start nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">exportfs </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">r</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 测试</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">showmount </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e </span><span class="token number" style="color:rgb(9, 134, 88)">127.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一键部署nfs且配置默认存储">一键部署nfs且配置默认存储<a class="hash-link" href="#一键部署nfs且配置默认存储" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 未安装存储</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">curl https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> bash</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 已有存储</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wget https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">me</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">k7s</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nfs</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy_exist_nfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">deploy_exist_nfs</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">ip</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">path</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="csi" term="csi"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[使用nvm进行node版本管理]]></title>
        <id>/posts/nodejs-install</id>
        <link href="https://ysicing.me/posts/nodejs-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[使用nvm进行node版本管理]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用nvm进行node版本管理">使用nvm进行node版本管理<a class="hash-link" href="#使用nvm进行node版本管理" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装nvm">安装nvm<a class="hash-link" href="#安装nvm" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">curl</span><span class="token plain"> -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.2/install.sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 默认会写.zshrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">### .zshrc nvm start </span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">NVM_DIR</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string environment constant" style="color:rgb(129, 31, 63)">$HOME</span><span class="token string" style="color:rgb(163, 21, 21)">/.nvm"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -s </span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$NVM_DIR</span><span class="token string" style="color:rgb(163, 21, 21)">/nvm.sh"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">. </span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$NVM_DIR</span><span class="token string" style="color:rgb(163, 21, 21)">/nvm.sh"</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># This loads nvm</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain"> -s </span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$NVM_DIR</span><span class="token string" style="color:rgb(163, 21, 21)">/bash_completion"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain">. </span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$NVM_DIR</span><span class="token string" style="color:rgb(163, 21, 21)">/bash_completion"</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># This loads nvm bash_completion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">### .zshrc nvm end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> .zshrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nvm </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">node</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># "node" is an alias for the latest version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="nodejs" term="nodejs"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[OpenLDAP安装初体验]]></title>
        <id>/posts/openldap-install</id>
        <link href="https://ysicing.me/posts/openldap-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[OpenLDAP安装初体验]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="openldap安装初体验">OpenLDAP安装初体验<a class="hash-link" href="#openldap安装初体验" title="标题的直接链接">​</a></h2><blockquote><p>简介这里不在描述，google即可</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="docke快速部署">docke快速部署<a class="hash-link" href="#docke快速部署" title="标题的直接链接">​</a></h3><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">openldap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> osixia/openldap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">1.3.0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> openldap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_LOG_LEVEL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"256"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_ORGANISATION</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Godu Inc."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_DOMAIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ysicing.me"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_BASE_DN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_ADMIN_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"meadmin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_CONFIG_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"meconfig"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_READONLY_USER</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_READONLY_USER_USERNAME</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"readonly"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_READONLY_USER_PASSWORD</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"readonly"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_RFC2307BIS_SCHEMA</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_BACKEND</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"mdb"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_TLS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_REPLICATION</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">KEEP_EXISTING_CONFIG</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_REMOVE_CONFIG_AFTER_SETUP</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"true"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">LDAP_SSL_HELPER_PREFIX</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ldap"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">tty</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">stdin_open</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token boolean important">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"389:389"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"636:636"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">domainname</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"ldap.ysicing.me"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># important: same as hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)">#    hostname: "ldap.ysicing.me"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">"--copy-service"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"--loglevel"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"debug"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">phpldapadmin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> osixia/phpldapadmin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> phpldapadmin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">PHPLDAPADMIN_LDAP_HOSTS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"openldap"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token key atrule">PHPLDAPADMIN_HTTPS</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"false"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"8080:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> openldap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证">验证<a class="hash-link" href="#验证" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">din openldap</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ldapsearch </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">x </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">H ldap</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">localhost </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">b dc</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">dc</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">me </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D 'cn</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">admin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">dc</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">ysicing</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">dc</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">me' </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">w meadmin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者访问<code>127.0.0.1:8080</code></p>]]></content>
        <category label="ldap" term="ldap"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Systemd 定时器教程]]></title>
        <id>/posts/systemd-timers</id>
        <link href="https://ysicing.me/posts/systemd-timers"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[Systemd 定时器教程]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="定时任务如每65分钟执行一次">定时任务，如每65分钟执行一次<a class="hash-link" href="#定时任务如每65分钟执行一次" title="标题的直接链接">​</a></h2><p><a href="https://www.v2ex.com/t/631917#reply40" target="_blank" rel="noopener noreferrer">crontab 定时任务 65 分钟执行一次，怎么写？</a></p><p>这个时候，用系统自带的crontab就不好实现了,这时候就是systemd该上场了</p><p>参考<a href="http://www.ruanyifeng.com/blog/2018/03/systemd-timer.html" target="_blank" rel="noopener noreferrer">Systemd 定时器教程</a></p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">timer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">example timer</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Timer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnUnitActiveSec</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">1h</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unit</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WantedBy</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">multi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">systemd</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">system</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">example</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Unit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">example</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Service</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ExecStart</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">相关命令</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WantedBy</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">multi</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">target</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>定制定时器</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">OnActiveSec：定时器生效后，多少时间开始执行任务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnBootSec：系统启动后，多少时间开始执行任务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnStartupSec：Systemd 进程启动后，多少时间开始执行任务</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnUnitActiveSec：该单元上次执行后，等多少时间再次执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnUnitInactiveSec： 定时器上次关闭后多少时间，再次执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">OnCalendar：基于绝对时间，而不是相对时间执行</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AccuracySec：如果因为各种原因，任务必须推迟执行，推迟的最大秒数，默认是</span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain">秒</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unit：真正要执行的任务，默认是同名的带有</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">service后缀的单元</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Persistent：如果设置了该字段，即使定时器到时没有启动，也会自动执行相应的单元</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">WakeSystem：如果系统休眠，是否自动唤醒系统</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Timer和Service大体用法一致</p>]]></content>
        <category label="misc" term="misc"/>
        <category label="linux" term="linux"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[vim配置]]></title>
        <id>/posts/vim-config</id>
        <link href="https://ysicing.me/posts/vim-config"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[vim配置]]></summary>
        <content type="html"><![CDATA[<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装vim-plug">安装vim plug<a class="hash-link" href="#安装vim-plug" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">curl </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">fLo ~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">autoload</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">plug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vim </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">create</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">dirs https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">raw</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">githubusercontent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">junegunn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">plug</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">master</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">plug</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vim</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="写配置">写配置<a class="hash-link" href="#写配置" title="标题的直接链接">​</a></h3><p>向<code>~/.vimrc</code>写入</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">" autocmd BufWritePost $MYVIMRC source $MYVIMRC</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 关闭兼容模式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set nocompatible</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 设置行号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set nu</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">"突出显示当前行</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">列</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set cursorline</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set cursorcolumn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">"显示括号匹配</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set showmatch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" tab 缩进</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set tabstop</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> " 设置Tab长度为</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">空格</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set shiftwidth</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> " 设置自动缩进长度为</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain">空格</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set autoindent " 继承前一行的缩进方式，适用于多行注释</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 定义快捷键的前缀，即</span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Leader</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">let mapleader</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">";"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> 系统剪切板复制粘贴 </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" v 模式下复制内容到系统剪切板</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vmap </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Leader</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">c "</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">yy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" n 模式下复制一行到系统剪切板</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nmap </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Leader</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">c "</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">yy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" n 模式下粘贴系统剪切板的内容</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">nmap </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Leader</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">v "</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">p</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 开启实时搜索</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set incsearch</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 搜索时大小写不敏感</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">set ignorecase</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">syntax enable</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">syntax on                    " 开启文件类型侦测</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">filetype plugin indent on    " 启用自动补全</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 退出插入模式指定类型的文件自动保存</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">au InsertLeave </span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">php write</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">call plug#</span><span class="token function" style="color:rgb(0, 0, 255)">begin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">'~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">plugged'</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 可以快速对齐的插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'junegunn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">easy</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">align'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 用来提供一个导航目录的侧边栏</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'scrooloose</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nerdtree'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 可以在导航目录中看到 git 版本信息</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'Xuyuanp</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">nerdtree</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">git</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">plugin'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 自动补全括号的插件，包括小括号，中括号，以及花括号</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'jiangmiao</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">auto</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">pairs'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" 可以在 vim 中使用 tab 补全</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'vim</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">scripts</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">SuperTab'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'majutsushi</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">tagbar'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> 主要插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'fatih</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token char" style="color:rgb(129, 31, 63)">', { '</span><span class="token plain">tag</span><span class="token char" style="color:rgb(129, 31, 63)">': '</span><span class="token operator" style="color:rgb(0, 0, 0)">*</span><span class="token plain">' </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">" </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> 中的代码追踪，输入 gd 就可以自动跳转</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Plug 'dgryski</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">vim</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">godef'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">call plug#</span><span class="token function" style="color:rgb(0, 0, 255)">end</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装插件">安装插件<a class="hash-link" href="#安装插件" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">vim ~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vimrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">PlugInstall</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 更新插件</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">PlugUpdate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="vim" term="vim"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[vscode配置]]></title>
        <id>/posts/vscode-config</id>
        <link href="https://ysicing.me/posts/vscode-config"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[vscode配置]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="vscode配置">vscode配置<a class="hash-link" href="#vscode配置" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装好go相关插件配置工具包">安装好Go相关插件，配置工具包<a class="hash-link" href="#安装好go相关插件配置工具包" title="标题的直接链接">​</a></h3><p>使用<code>command+shift+P</code>快捷键,然后键入<code>Go: Install/Update Tools</code>选中全部(根据需要),稍等片刻，就会安装完成。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="自定义配置项">自定义配置项<a class="hash-link" href="#自定义配置项" title="标题的直接链接">​</a></h3><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"git.autofetch"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"files.autoSave"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"onWindowChange"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"workbench.colorTheme"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"Go - Sources"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"terminal.integrated.shell.osx"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"/bin/zsh"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.autocompleteUnimportedPackages"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.gocodeAutoBuild"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.useLanguageServer"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"goOutliner.enableDebugChannel"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"goOutliner.extendExplorerTab"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.inferGopath"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.docsTool"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"godoc"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.gocodePackageLookupMode"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"go"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.gotoSymbol.includeImports"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.useCodeSnippetsOnFunctionSuggest"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//使用代码片段提示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.useCodeSnippetsOnFunctionSuggestWithoutType"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.formatTool"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"goimports"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//代码格式化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   </span><span class="token comment" style="color:rgb(0, 128, 0)">// "go.buildOnSave": true, //保存代码时自动编译</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.lintOnSave"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"file"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//保存代码时优化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.vetOnSave"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">"package"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//保存代码时检查潜在错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token property">"go.coverOnSave"</span><span class="token operator" style="color:rgb(0, 0, 0)">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)">//保存代码时执行测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="vscode" term="vscode"/>
        <category label="go" term="go"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[内网穿透之wireguard]]></title>
        <id>/posts/wireguard-install</id>
        <link href="https://ysicing.me/posts/wireguard-install"/>
        <updated>2020-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[内网穿透之wireguard]]></summary>
        <content type="html"><![CDATA[<blockquote><p>内网穿透之wireguard</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安装">安装<a class="hash-link" href="#安装" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian">Debian<a class="hash-link" href="#debian" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># Debian Bullseye 之前版本都需要启用backports源来支持安装</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install wireguard </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="macos">macOS<a class="hash-link" href="#macos" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">brew install wireguard</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置服务端">配置服务端<a class="hash-link" href="#配置服务端" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">cd </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wireguard</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建服务端密钥对</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">umask </span><span class="token number" style="color:rgb(9, 134, 88)">077</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wg genkey </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> tee privatekey </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> wg pubkey </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> publickey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 创建wg0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wireguard</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wg0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PrivateKey </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Private Key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Address </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fd86</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ea04</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1115</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ListenPort </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">51820</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PostUp </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> iptables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">A FORWARD </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i wg0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j ACCEPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> iptables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t nat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">A POSTROUTING </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o eth0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j MASQUERADE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ip6tables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">A FORWARD </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i wg0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j ACCEPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ip6tables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t nat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">A POSTROUTING </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o eth0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j MASQUERADE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PostDown </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> iptables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D FORWARD </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i wg0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j ACCEPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> iptables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t nat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D POSTROUTING </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o eth0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j MASQUERADE</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ip6tables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D FORWARD </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i wg0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j ACCEPT</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> ip6tables </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t nat </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">D POSTROUTING </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">o eth0 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">j MASQUERADE</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SaveConfig </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">quick up wg0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 开机启动</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">systemctl enable wg</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">quick@wg0</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wg show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置客户端">配置客户端<a class="hash-link" href="#配置客户端" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">umask </span><span class="token number" style="color:rgb(9, 134, 88)">077</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wg genkey </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> tee privatekey </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> wg pubkey </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> publickey</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wireguard</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wg0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Interface</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PrivateKey </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Output of privatekey file that contains your private key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Address </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.2</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fd86</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ea04</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1115</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="连接客户端和服务端">连接客户端和服务端<a class="hash-link" href="#连接客户端和服务端" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="法一-客户端操作">法一 客户端操作<a class="hash-link" href="#法一-客户端操作" title="标题的直接链接">​</a></h3><ol><li><code>wg-quick down wg0</code></li><li>直接编辑客户端配置文件</li><li>启动<code>wg-quick up wg0;systemctl enable wg-quick@wg0</code></li></ol><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wireguard</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">wg0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf 新增</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">Peer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PublicKey </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Server Public key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Endpoint </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Server Public IP</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">51820</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AllowedIPs </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10.0</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token number" style="color:rgb(9, 134, 88)">.2</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> fd86</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ea04</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1115</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="法二-服务端操作">法二 服务端操作<a class="hash-link" href="#法二-服务端操作" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">wg set wg0 peer </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Client Public Key</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> endpoint </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;</span><span class="token plain">Client IP address</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">51820</span><span class="token plain"> allowed</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ips </span><span class="token number" style="color:rgb(9, 134, 88)">203.0</span><span class="token number" style="color:rgb(9, 134, 88)">.113</span><span class="token number" style="color:rgb(9, 134, 88)">.12</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">24</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">fd86</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">ea04</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">1115</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="问题解决">问题解决<a class="hash-link" href="#问题解决" title="标题的直接链接">​</a></h2><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># </span><span class="token number" style="color:rgb(9, 134, 88)">1.</span><span class="token plain"> 内核模块没有</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">lsmod </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> grep wireguard </span><span class="token operator" style="color:rgb(0, 0, 0)">&amp;&amp;</span><span class="token plain"> echo yes </span><span class="token operator" style="color:rgb(0, 0, 0)">||</span><span class="token plain"> echo no</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">no</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">modprobe wireguard</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">modprobe</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> FATAL</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Module wireguard not found in directory </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">lib</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">modules</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dkms status</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">wireguard</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">0.0</span><span class="token number" style="color:rgb(9, 134, 88)">.20200318</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">4.19</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">8</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> x86_64</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> installed</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">uname </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Linux cn3 </span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> SMP Debian </span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.19</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">~bpo10</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token number" style="color:rgb(9, 134, 88)">2020</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">03</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">09</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> x86_64 GNU</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dkms autoinstall</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Error</span><span class="token operator" style="color:rgb(0, 0, 0)">!</span><span class="token plain"> Your kernel headers </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> kernel </span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 cannot be found</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Please install the linux</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">headers</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 </span><span class="token keyword" style="color:rgb(0, 0, 255)">package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 解决方式</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y linux</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">headers</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">5.4</span><span class="token number" style="color:rgb(9, 134, 88)">.0</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">bpo</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># ipv6 RTNETLINK answers</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Permission denied</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">启用ipv6即可</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">net</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ipv6</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">all</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">disable_ipv6</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="wireguard" term="wireguard"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[awk 中关于多个$的用法]]></title>
        <id>/posts/awk-func</id>
        <link href="https://ysicing.me/posts/awk-func"/>
        <updated>2019-12-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[awk 中关于多个$的用法]]></summary>
        <content type="html"><![CDATA[<blockquote><p>上周有遇到过这个问题 <code>awk '{print $$1}'</code> 这个$$是什么用法呢</p></blockquote><p>间接字段寻址,其类似</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token char" style="color:rgb(129, 31, 63)">' ===&gt; awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token char" style="color:rgb(129, 31, 63)">' ===&gt; awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">Nr</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $Nr</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>示例:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">$ echo </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e </span><span class="token string" style="color:rgb(163, 21, 21)">"1 b c d\n2 b c d\n3 b c d\n4 b c d"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> b c d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> b c d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> b c d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> b c d</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">$ echo </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">e </span><span class="token string" style="color:rgb(163, 21, 21)">"1 b c d\n2 b c d\n3 b c d\n4 b c d"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain">  # since filed #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> result </span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> first field</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">b  # since filed #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> result </span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> secondfield</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">c  # since filed #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">3</span><span class="token plain"> result </span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> third field</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">d  # since filed #</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> result </span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> fourth field</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>类似$可以根据需要添加更多</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $$$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">' </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain">  awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $$</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token char" style="color:rgb(129, 31, 63)">' ===&gt; awk '</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token builtin" style="color:rgb(0, 112, 193)">print</span><span class="token plain"> $</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">$</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">$</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="shell" term="shell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker配置默认网桥ip地址]]></title>
        <id>/posts/docker-default-address-pools</id>
        <link href="https://ysicing.me/posts/docker-default-address-pools"/>
        <updated>2019-09-13T10:24:06.000Z</updated>
        <summary type="html"><![CDATA[本文主要记录docker配置默认网络ip段]]></summary>
        <content type="html"><![CDATA[<blockquote><p>记录一下</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="修改docker默认桥接网络ip段">修改docker默认桥接网络ip段<a class="hash-link" href="#修改docker默认桥接网络ip段" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> /etc/docker/daemon.json </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token string" style="color:rgb(163, 21, 21)">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">{</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "registry-mirrors": ["https://dyucrs4l.mirror.aliyuncs.com"],</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "bip": "169.254.0.1/24",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "max-concurrent-downloads": 10,</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-driver": "json-file",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-level": "warn",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "log-opts": {</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    "max-size": "20m",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    "max-file": "2"</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  },</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "default-address-pools": [</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    {</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">      "base": "100.250.0.0/16",</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">      "size": 24</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  ],</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">  "storage-driver": "overlay2"</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">}</span><br></span><span class="token-line" style="color:#000000"><span class="token string" style="color:rgb(163, 21, 21)">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启docker</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">systemctl restart </span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>参考文档 <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noopener noreferrer">dockerd</a></p>]]></content>
        <category label="docker" term="docker"/>
        <category label="cri" term="cri"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[阿里云轻量应用服务器升级内核]]></title>
        <id>/posts/aliyun-debian-upgrade-kernel</id>
        <link href="https://ysicing.me/posts/aliyun-debian-upgrade-kernel"/>
        <updated>2019-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[阿里云轻量应用服务器升级内核]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="阿里云轻量应用服务器升级内核">阿里云轻量应用服务器升级内核<a class="hash-link" href="#阿里云轻量应用服务器升级内核" title="标题的直接链接">​</a></h2><blockquote><p>升级有风险请慎重哦</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置说明">配置说明<a class="hash-link" href="#配置说明" title="标题的直接链接">​</a></h4><blockquote><p>阿里云HK 1核1G1TB30Mbps ¥24/m
Debian 9.9</p></blockquote><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新源">更新源<a class="hash-link" href="#更新源" title="标题的直接链接">​</a></h4><blockquote><p>需要移除默认源，使用如下源</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 需要添加buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports源</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">sed </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">i </span><span class="token string" style="color:rgb(163, 21, 21)">"s#stretch#buster#g"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">apt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 示例</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">a li yun c</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">updates main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">proposed</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">updates main non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free contrib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports main non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free contrib</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">security</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">updates main non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free contrib</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更新升级</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt-get</span><span class="token plain"> dist-upgrade -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级到最新内核">升级到最新内核<a class="hash-link" href="#升级到最新内核" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">apt</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">get install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">t buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports linux</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">image</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">amd64 </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">update</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">grub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt autoclean</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">apt autoremove </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级完成后docker无法启动">升级完成后docker无法启动<a class="hash-link" href="#升级完成后docker无法启动" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">prior storage driver aufs failed</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> driver not supported</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>删除<code>/var/lib/docker</code>，docker存储由aufs变成overlay2</p>]]></content>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[一键安装go1.17]]></title>
        <id>/posts/go-install</id>
        <link href="https://ysicing.me/posts/go-install"/>
        <updated>2019-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[一键安装go1.17.1]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux环境一键脚本">Linux环境一键脚本<a class="hash-link" href="#linux环境一键脚本" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">curl</span><span class="token plain"> https://sh.ysicing.me/install/go.sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="changelog">ChangeLog<a class="hash-link" href="#changelog" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="20210911">20210911<a class="hash-link" href="#20210911" title="标题的直接链接">​</a></h4><ul><li>更新脚本支持lima普通用户</li><li>go升级到1.17.1</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mac安装">Mac安装<a class="hash-link" href="#mac安装" title="标题的直接链接">​</a></h2><p>如果已经安装了brew，就可以快速安装了</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 安装git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew install git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装</span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">brew install </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># add GOBIN path to your PATH in ~</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">zshrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export GO111MODULE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">on</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export GOPROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">goproxy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export GOPATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"/Users/ysicing/go"</span><span class="token plain"> # 示例</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export GOBIN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"$GOPATH/bin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">export PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">$HOME</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">local</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">opt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mysql</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">client</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">bin</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">$GOBIN</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">$PATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置visual-studio-code-editor">配置Visual Studio Code Editor<a class="hash-link" href="#配置visual-studio-code-editor" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">快捷键cmd</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">shift</span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain">p</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">键入</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">go</span><span class="token plain"> install</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">选择 </span><span class="token string" style="color:rgb(163, 21, 21)">"Go: Install/Update Tools"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Check all the checkboxes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linux安装">Linux安装<a class="hash-link" href="#linux安装" title="标题的直接链接">​</a></h2><p>访问 <a href="https://golang.google.cn/dl/" target="_blank" rel="noopener noreferrer">golang中国</a> 获取最新go版本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://dl.google.com/go/go1.17.linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">tar</span><span class="token plain"> -C /usr/local -xzf go1.17.linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 配置 .bashrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GO111MODULE</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">on</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GOPROXY</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">https://goproxy.cn</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GOPATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"/root/go"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">GOBIN</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"</span><span class="token string variable" style="color:rgb(9, 134, 88)">$GOPATH</span><span class="token string" style="color:rgb(163, 21, 21)">/bin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:rgb(129, 31, 63)">PATH</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token environment constant" style="color:rgb(129, 31, 63)">$PATH</span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">:</span><span class="token variable" style="color:rgb(9, 134, 88)">$GOBIN</span><span class="token plain">:/usr/local/go/bin</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">source</span><span class="token plain"> .bashrc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 验证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">go </span><span class="token function" style="color:rgb(0, 0, 255)">env</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="go" term="go"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[AdGuard使用姿势]]></title>
        <id>/posts/dns-adguard-install</id>
        <link href="https://ysicing.me/posts/dns-adguard-install"/>
        <updated>2019-04-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[AdGuard使用姿势]]></summary>
        <content type="html"><![CDATA[<blockquote><p>AdGuard Home使用Golang开发，因此安装非常简单，这里以容器的方式部署为例，其它方式可参考官方帮助文档。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="主要功能">主要功能<a class="hash-link" href="#主要功能" title="标题的直接链接">​</a></h3><ul><li>拦截AD</li><li>号称隐私保护</li><li>家庭保护模式</li><li>自定义过滤(劫持) (😂我用的最多的是这个)</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="部署">部署<a class="hash-link" href="#部署" title="标题的直接链接">​</a></h3><p>二话不说直接上</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># docker-compose.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">'2.1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> spanda/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./ssl</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/root/.caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> /var/log/caddy</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/var/log/caddy</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./Caddyfile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/etc/Caddyfile</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token key atrule">dns</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> adguard/adguardhome</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> dns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./ad/conf</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/opt/adguardhome/conf</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain"> ./ad/work</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">/opt/adguardhome/work</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">network_mode</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> always</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Caddyfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">dns.ysicing.net </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   gzip</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   tls root@ysicing.net</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   log / /var/log/caddy/dns.ysicing.net.log "</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">remote</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">when</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">method</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">uri</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">proto</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">status</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token punctuation" style="color:rgb(4, 81, 165)">&gt;</span><span class="token plain">User</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain">latency</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain">" </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        rotate_size 50</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        rotate_age  90</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        rotate_keep 20</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        rotate_compress</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    header / </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Strict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Transport</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Security "max</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">age=31536000;includeSubDomains;preload"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Access</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Control</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Allow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Origin  *</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        Access</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Control</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Allow</span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Methods "GET</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> POST</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> OPTIONS"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">-</span><span class="token plain">Server</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    proxy / 127.0.0.1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain">7070 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        transparent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        websocket</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>访问公网<code>IP:3000</code>,按着无脑一顿猛操作。修改默认web监听端口为127.0.0.1:7070,53端口默认监听全部。</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="使用">使用<a class="hash-link" href="#使用" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="windows">Windows<a class="hash-link" href="#windows" title="标题的直接链接">​</a></h4><ol><li>打开网络和Internet设置</li><li>打开网络和共享中心</li><li>打开以太网</li><li>打开属性</li><li>编辑TCP/IPV4</li><li>使用下面的DNS服务器 首 59.110.220.53 备 8.8.8.8</li></ol><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mac">Mac<a class="hash-link" href="#mac" title="标题的直接链接">​</a></h4><p>跳过很简单</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="安卓">安卓<a class="hash-link" href="#安卓" title="标题的直接链接">​</a></h4><p>自己折腾吧，私有dns搞不定，官方APP可以</p>]]></content>
        <category label="dns" term="dns"/>
        <category label="tools" term="tools"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[龙芯Mips64el平台上部署K8s]]></title>
        <id>/posts/mips64el-loongson-k8s</id>
        <link href="https://ysicing.me/posts/mips64el-loongson-k8s"/>
        <updated>2018-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[龙芯Mips64el平台上部署K8s]]></summary>
        <content type="html"><![CDATA[<blockquote><p>不会具体讲怎么部署，原理都类似,将原先amd64换成mips64el</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="中标麒麟龙芯cpu源">中标麒麟龙芯CPU源<a class="hash-link" href="#中标麒麟龙芯cpu源" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># /etc/yum.repos.d/ns7-mips.repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ns7-mips64el-os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NeoKylin Linux Advanced Server </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - </span><span class="token variable" style="color:rgb(9, 134, 88)">$basearch</span><span class="token plain"> - Os</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://download.cs2c.com.cn/neokylin/server/releases/7.0/ls_64/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ns7-mips64el-extras</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NeoKylin Linux Advanced Server </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - Addons</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://download.cs2c.com.cn/neokylin/server/everything/7.0/ls_64/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">ns7-mips64el-updates</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">NeoKylin Linux Advanced Server </span><span class="token number" style="color:rgb(9, 134, 88)">7</span><span class="token plain"> - Updates</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">baseurl</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">http://download.cs2c.com.cn/neokylin/server/updates/7.0/ls_64/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgcheck</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">gpgkey</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-neokylin-release</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">enabled</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还有一个就是龙芯自己的仓库比较迷，但是软件包比较新</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">http://ftp.loongnix.org/os/loongnix/1.0/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="基础镜像">基础镜像<a class="hash-link" href="#基础镜像" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="neokylin基础镜像">neokylin基础镜像<a class="hash-link" href="#neokylin基础镜像" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> https://raw.githubusercontent.com/docker/docker/master/contrib/mkimage-yum.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">chmod</span><span class="token plain"> +x ./mkimage-yum.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./mkimage-yum.sh -y /etc/yum.conf nk-base</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">wget</span><span class="token plain"> http://list.isoftos.win/script/create_docker_image.loogson</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">chmod</span><span class="token plain"> +x create_docker_image.loogson</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">./create_docker_image.loogson nk-base</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian基础镜像">debian基础镜像<a class="hash-link" href="#debian基础镜像" title="标题的直接链接">​</a></h3><p>可以通过异构构建镜像方式</p><p>可以参考大佬项目 <a href="https://github.com/liupeng0518/debian-debootstrap" target="_blank" rel="noopener noreferrer">debian-debootstrap</a></p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="k8s编译">k8s编译<a class="hash-link" href="#k8s编译" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="宿主机编译">宿主机编译<a class="hash-link" href="#宿主机编译" title="标题的直接链接">​</a></h3><blockquote><p>4核16G,性能太差,源码编译安装go新版本差不多两小时</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通过异构镜像编译">通过异构镜像编译<a class="hash-link" href="#通过异构镜像编译" title="标题的直接链接">​</a></h3><p>大概修改印象: </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># 第一处</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">mips64*</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">host_arch</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mips64le</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 第二处</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token string" style="color:rgb(163, 21, 21)">"linux/mips64le"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CGO_ENABLED</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">CC</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">mips64el-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 第三处</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">linux/mips64le</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 第四处</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">uint64转换一下</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>具体可以通过make &lt;xxx组件名&gt;</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pause镜像">pause镜像<a class="hash-link" href="#pause镜像" title="标题的直接链接">​</a></h2><p>这个得注意一下, 不能用空镜像，可以使用基础镜像</p>]]></content>
        <category label="kubernetes" term="kubernetes"/>
        <category label="mips64el" term="mips64el"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Debian个人常用操作指南]]></title>
        <id>/posts/debian-op</id>
        <link href="https://ysicing.me/posts/debian-op"/>
        <updated>2017-05-18T14:55:18.000Z</updated>
        <summary type="html"><![CDATA[Debian常用操作指南]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="一键最新脚本">一键最新脚本<a class="hash-link" href="#一键最新脚本" title="标题的直接链接">​</a></h2><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token builtin class-name" style="color:rgb(38, 127, 153)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(9, 134, 88)">MIRRORS</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">"http://mirrors.aliyun.com"</span><span class="token plain"> </span><span class="token comment" style="color:rgb(0, 128, 0)"># 默认是清华源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">curl</span><span class="token plain"> -s https://sh.ysicing.me/debian/init.sh </span><span class="token operator" style="color:rgb(0, 0, 0)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian-11">Debian 11<a class="hash-link" href="#debian-11" title="标题的直接链接">​</a></h2><blockquote><p>赶紧升级Debian 11, 好处多多</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="升级debian10buster内核版本">升级debian10(buster)内核版本<a class="hash-link" href="#升级debian10buster内核版本" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> -i </span><span class="token string" style="color:rgb(163, 21, 21)">'s/buster\/updates/bullseye-security/g;s/buster/bullseye/g'</span><span class="token plain"> /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> dist-upgrade -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># apt install -t bullseye-backports linux-image-amd64 -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># update-grub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># reboot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 内核</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Linux bj01 </span><span class="token number" style="color:rgb(9, 134, 88)">5.10</span><span class="token plain">.0-0.bpo.8-amd64 </span><span class="token comment" style="color:rgb(0, 128, 0)">#1 SMP Debian 5.10.46-2~bpo10+1 (2021-07-22) x86_64 GNU/Linux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian-10存档">Debian 10存档<a class="hash-link" href="#debian-10存档" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建debian虚拟机">创建Debian虚拟机<a class="hash-link" href="#创建debian虚拟机" title="标题的直接链接">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Usage:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  ergo vm create </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">flags</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Flags:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  -h, --help            </span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">help</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> create</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --path string     Vagrantfile所在目录, </span><span class="token environment constant" style="color:rgb(129, 31, 63)">$HOME</span><span class="token plain">/vm</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --vmcpus string   虚拟机CPU数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">default </span><span class="token string" style="color:rgb(163, 21, 21)">"2"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --vmmem string    虚拟机Mem MB数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">default </span><span class="token string" style="color:rgb(163, 21, 21)">"4096"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --vmname string   虚拟机名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      --vmnum string    虚拟机副本数 </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">default </span><span class="token string" style="color:rgb(163, 21, 21)">"1"</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain">   </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>默认使用ergo创建虚拟机</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ergo vm create --vmcpus </span><span class="token number" style="color:rgb(9, 134, 88)">4</span><span class="token plain"> --vmmem </span><span class="token number" style="color:rgb(9, 134, 88)">8192</span><span class="token plain"> --vmname debian</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>或者自行使用<code>Vagrantfile</code></p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># -*- mode: ruby -*-</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># vi: set ft=ruby :</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Vagrant.configure("2") do |config|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config.vm.box_check_update = false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  config.vm.provider 'virtualbox' do |vb|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">   vb.customize [ "guestproperty", "set", :id, "/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold", 1000 ]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  $num_instances = 1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  (1..$num_instances).each do |i|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    config.vm.define "debian#{i}" do |node|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.box = "ysicing/debian"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.hostname = "debian#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.network "public_network", use_dhcp_assigned_default_route: true, bridge: 'en0: Wi-Fi (Wireless)'</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      # node.vm.provision "shell", run: "always", inline: "ntpdate ntp.api.bz"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.network "private_network", ip: "11.11.11.11#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.provision "shell", run: "always", inline: "echo hello from debian#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      node.vm.provider "virtualbox" do |vb|</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.gui = false</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.memory = 8192</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.cpus = 4</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.name = "debian#{i}"</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.customize ["modifyvm", :id, "--ioapic", "on"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        # cpu 使用率50%</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        vb.customize ["modifyvm", :id, "--cpuexecutioncap", "50"]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  end</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化debian">初始化Debian<a class="hash-link" href="#初始化debian" title="标题的直接链接">​</a></h3><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">ergo vm init </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">ip </span><span class="token number" style="color:rgb(9, 134, 88)">11.11</span><span class="token number" style="color:rgb(9, 134, 88)">.11</span><span class="token number" style="color:rgb(9, 134, 88)">.111</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">docker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 默认会使用ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ansible镜像，执行ansible脚本初始化debian，</span><span class="token operator" style="color:rgb(0, 0, 0)">--</span><span class="token plain">docker参数默认表示安装docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="手动执行之宿主机初始化">手动执行之宿主机初始化<a class="hash-link" href="#手动执行之宿主机初始化" title="标题的直接链接">​</a></h4><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">git clone https</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">github</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">ysicing</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">play</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ansible</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">git</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cd play</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">ansible</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 安装ansible</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain">如果已安装可跳过</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">install</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 配置初始化机器</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cp inventory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ini</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">example inventory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ini</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># 执行初始化</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ansible</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">playbook init</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="手动执行之容器化方式初始化">手动执行之容器化方式初始化<a class="hash-link" href="#手动执行之容器化方式初始化" title="标题的直接链接">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> pull ysicing/ansible</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">docker</span><span class="token plain"> run -it --rm ysicing/ansible </span><span class="token function" style="color:rgb(0, 0, 255)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">cp</span><span class="token plain"> inventory.ini.example inventory.ini</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># 初始化系统</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ansible-playbook init.yml</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="debian-10升级内核">Debian 10升级内核<a class="hash-link" href="#debian-10升级内核" title="标题的直接链接">​</a></h3><blockquote><p>添加buster-backports源，如果你使用ysicin/debian镜像可跳过</p></blockquote><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"># 默认</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">apt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">list </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">aliyun</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">com</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">security buster</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">updates main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"># Ucloud</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">cat </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">apt</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">sources</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">list </span><span class="token operator" style="color:rgb(0, 0, 0)">&lt;&lt;</span><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ucloud</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">backports main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">deb http</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">mirrors</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">ucloud</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">cn</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">debian</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">security</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain"> buster</span><span class="token operator" style="color:rgb(0, 0, 0)">/</span><span class="token plain">updates main contrib non</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">free</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>更新升级</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> dist-upgrade -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> -t buster-backports linux-image-amd64 -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">update-grub</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> autoclean</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">apt</span><span class="token plain"> autoremove -y</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="debian" term="debian"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[README]]></title>
        <id>/posts/blog-notice</id>
        <link href="https://ysicing.me/posts/blog-notice"/>
        <updated>2013-07-28T05:21:00.000Z</updated>
        <summary type="html"><![CDATA[你好,我的博客]]></summary>
        <content type="html"><![CDATA[<blockquote><p>如果你觉得我的文章或者项目对你有用，那么来做一只小可爱吧！<a href="https://afdian.net/@ysicing" target="_blank" rel="noopener noreferrer">爱发电@ysicing</a></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="开始之前">开始之前<a class="hash-link" href="#开始之前" title="标题的直接链接">​</a></h2><p>在阅读本书之前希望您掌握以下知识和准备以下环境：</p><ul><li>Debian 常用命令</li><li>Docker 基本操作</li><li>Mac/Linux 皆可</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="系列主题">系列主题<a class="hash-link" href="#系列主题" title="标题的直接链接">​</a></h2><ul><li>Kubernetes(1.23)实践</li><li>Go(1.18)开发实践</li><li>运维实践(主要是基于Debian(bullseye)发行版)</li></ul><h2>？</h2><p>欢迎交流, 一起努力.</p><p>如果有任何疑问或错误，欢迎在 issues 进行提问或给予修正意见</p><p>如果喜欢或对你有所帮助，欢迎 Star，对我是一种鼓励和推进 😀</p>]]></content>
        <category label="site" term="site"/>
    </entry>
</feed>